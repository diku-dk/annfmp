#ifdef __GNUC__
#pragma GCC diagnostic ignored "-Wunused-function"
#pragma GCC diagnostic ignored "-Wunused-variable"
#pragma GCC diagnostic ignored "-Wparentheses"
#pragma GCC diagnostic ignored "-Wunused-label"
#endif
#ifdef __clang__
#pragma clang diagnostic ignored "-Wunused-function"
#pragma clang diagnostic ignored "-Wunused-variable"
#pragma clang diagnostic ignored "-Wparentheses"
#pragma clang diagnostic ignored "-Wunused-label"
#endif
// Headers

#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>
#include <cuda.h>
#include <cuda_runtime.h>
#include <nvrtc.h>


// Initialisation

int futhark_get_num_sizes(void);
const char *futhark_get_size_name(int);
const char *futhark_get_size_class(int);
struct futhark_context_config ;
struct futhark_context_config *futhark_context_config_new(void);
void futhark_context_config_free(struct futhark_context_config *cfg);
void futhark_context_config_add_nvrtc_option(struct futhark_context_config *cfg,
                                             const char *opt);
void futhark_context_config_set_debugging(struct futhark_context_config *cfg,
                                          int flag);
void futhark_context_config_set_profiling(struct futhark_context_config *cfg,
                                          int flag);
void futhark_context_config_set_logging(struct futhark_context_config *cfg,
                                        int flag);
void futhark_context_config_set_device(struct futhark_context_config *cfg, const
                                       char *s);
void futhark_context_config_dump_program_to(struct futhark_context_config *cfg,
                                            const char *path);
void
futhark_context_config_load_program_from(struct futhark_context_config *cfg,
                                         const char *path);
void futhark_context_config_dump_ptx_to(struct futhark_context_config *cfg,
                                        const char *path);
void futhark_context_config_load_ptx_from(struct futhark_context_config *cfg,
                                          const char *path);
void
futhark_context_config_set_default_group_size(struct futhark_context_config *cfg,
                                              int size);
void
futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg,
                                              int num);
void
futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg,
                                             int num);
void
futhark_context_config_set_default_threshold(struct futhark_context_config *cfg,
                                             int num);
int futhark_context_config_set_size(struct futhark_context_config *cfg, const
                                    char *size_name, size_t size_value);
struct futhark_context ;
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg);
void futhark_context_free(struct futhark_context *ctx);

// Arrays

struct futhark_f32_1d ;
struct futhark_f32_1d *futhark_new_f32_1d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0);
struct futhark_f32_1d *futhark_new_raw_f32_1d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0);
int futhark_free_f32_1d(struct futhark_context *ctx,
                        struct futhark_f32_1d *arr);
int futhark_values_f32_1d(struct futhark_context *ctx,
                          struct futhark_f32_1d *arr, float *data);
CUdeviceptr futhark_values_raw_f32_1d(struct futhark_context *ctx,
                                      struct futhark_f32_1d *arr);
const int64_t *futhark_shape_f32_1d(struct futhark_context *ctx,
                                    struct futhark_f32_1d *arr);
struct futhark_f32_2d ;
struct futhark_f32_2d *futhark_new_f32_2d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0,
                                          int64_t dim1);
struct futhark_f32_2d *futhark_new_raw_f32_2d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0, int64_t dim1);
int futhark_free_f32_2d(struct futhark_context *ctx,
                        struct futhark_f32_2d *arr);
int futhark_values_f32_2d(struct futhark_context *ctx,
                          struct futhark_f32_2d *arr, float *data);
CUdeviceptr futhark_values_raw_f32_2d(struct futhark_context *ctx,
                                      struct futhark_f32_2d *arr);
const int64_t *futhark_shape_f32_2d(struct futhark_context *ctx,
                                    struct futhark_f32_2d *arr);
struct futhark_f32_3d ;
struct futhark_f32_3d *futhark_new_f32_3d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0,
                                          int64_t dim1, int64_t dim2);
struct futhark_f32_3d *futhark_new_raw_f32_3d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0, int64_t dim1,
                                              int64_t dim2);
int futhark_free_f32_3d(struct futhark_context *ctx,
                        struct futhark_f32_3d *arr);
int futhark_values_f32_3d(struct futhark_context *ctx,
                          struct futhark_f32_3d *arr, float *data);
CUdeviceptr futhark_values_raw_f32_3d(struct futhark_context *ctx,
                                      struct futhark_f32_3d *arr);
const int64_t *futhark_shape_f32_3d(struct futhark_context *ctx,
                                    struct futhark_f32_3d *arr);
struct futhark_i32_1d ;
struct futhark_i32_1d *futhark_new_i32_1d(struct futhark_context *ctx, const
                                          int32_t *data, int64_t dim0);
struct futhark_i32_1d *futhark_new_raw_i32_1d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0);
int futhark_free_i32_1d(struct futhark_context *ctx,
                        struct futhark_i32_1d *arr);
int futhark_values_i32_1d(struct futhark_context *ctx,
                          struct futhark_i32_1d *arr, int32_t *data);
CUdeviceptr futhark_values_raw_i32_1d(struct futhark_context *ctx,
                                      struct futhark_i32_1d *arr);
const int64_t *futhark_shape_i32_1d(struct futhark_context *ctx,
                                    struct futhark_i32_1d *arr);
struct futhark_i32_2d ;
struct futhark_i32_2d *futhark_new_i32_2d(struct futhark_context *ctx, const
                                          int32_t *data, int64_t dim0,
                                          int64_t dim1);
struct futhark_i32_2d *futhark_new_raw_i32_2d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0, int64_t dim1);
int futhark_free_i32_2d(struct futhark_context *ctx,
                        struct futhark_i32_2d *arr);
int futhark_values_i32_2d(struct futhark_context *ctx,
                          struct futhark_i32_2d *arr, int32_t *data);
CUdeviceptr futhark_values_raw_i32_2d(struct futhark_context *ctx,
                                      struct futhark_i32_2d *arr);
const int64_t *futhark_shape_i32_2d(struct futhark_context *ctx,
                                    struct futhark_i32_2d *arr);
struct futhark_i32_3d ;
struct futhark_i32_3d *futhark_new_i32_3d(struct futhark_context *ctx, const
                                          int32_t *data, int64_t dim0,
                                          int64_t dim1, int64_t dim2);
struct futhark_i32_3d *futhark_new_raw_i32_3d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0, int64_t dim1,
                                              int64_t dim2);
int futhark_free_i32_3d(struct futhark_context *ctx,
                        struct futhark_i32_3d *arr);
int futhark_values_i32_3d(struct futhark_context *ctx,
                          struct futhark_i32_3d *arr, int32_t *data);
CUdeviceptr futhark_values_raw_i32_3d(struct futhark_context *ctx,
                                      struct futhark_i32_3d *arr);
const int64_t *futhark_shape_i32_3d(struct futhark_context *ctx,
                                    struct futhark_i32_3d *arr);
struct futhark_u8_2d ;
struct futhark_u8_2d *futhark_new_u8_2d(struct futhark_context *ctx, const
                                        uint8_t *data, int64_t dim0,
                                        int64_t dim1);
struct futhark_u8_2d *futhark_new_raw_u8_2d(struct futhark_context *ctx, const
                                            CUdeviceptr data, int offset,
                                            int64_t dim0, int64_t dim1);
int futhark_free_u8_2d(struct futhark_context *ctx, struct futhark_u8_2d *arr);
int futhark_values_u8_2d(struct futhark_context *ctx, struct futhark_u8_2d *arr,
                         uint8_t *data);
CUdeviceptr futhark_values_raw_u8_2d(struct futhark_context *ctx,
                                     struct futhark_u8_2d *arr);
const int64_t *futhark_shape_u8_2d(struct futhark_context *ctx,
                                   struct futhark_u8_2d *arr);

// Opaque values


// Entry points

int futhark_entry_buildKDtree(struct futhark_context *ctx, int32_t *out0,
                              int32_t *out1, int32_t *out2,
                              struct futhark_f32_2d **out3,
                              struct futhark_i32_1d **out4,
                              struct futhark_i32_1d **out5,
                              struct futhark_i32_1d **out6,
                              struct futhark_f32_1d **out7,
                              struct futhark_i32_1d **out8, const int32_t in0,
                              const struct futhark_f32_2d *in1);
int futhark_entry_exactKnnFixK(struct futhark_context *ctx,
                               struct futhark_i32_2d **out0,
                               struct futhark_f32_2d **out1, int32_t *out2,
                               const struct futhark_f32_2d *in0, const
                               struct futhark_i32_1d *in1, const
                               struct futhark_f32_1d *in2, const
                               struct futhark_i32_1d *in3, const int32_t in4,
                               const struct futhark_f32_2d *in5, const
                               struct futhark_i32_1d *in6, const
                               struct futhark_i32_2d *in7, const
                               struct futhark_f32_2d *in8);
int futhark_entry_findNaturalLeavesFixK(struct futhark_context *ctx,
                                        struct futhark_i32_2d **out0,
                                        struct futhark_f32_2d **out1,
                                        struct futhark_i32_1d **out2, const
                                        struct futhark_f32_2d *in0, const
                                        struct futhark_i32_1d *in1, const
                                        struct futhark_f32_1d *in2, const
                                        struct futhark_f32_2d *in3);
int futhark_entry_mkImgPatches(struct futhark_context *ctx,
                               struct futhark_u8_2d **out0, const int32_t in0,
                               const struct futhark_i32_3d *in1);
int futhark_entry_propagateFixK(struct futhark_context *ctx,
                                struct futhark_i32_2d **out0,
                                struct futhark_f32_2d **out1, const int32_t in0,
                                const int32_t in1, const
                                struct futhark_f32_2d *in2, const
                                struct futhark_i32_1d *in3, const
                                struct futhark_i32_1d *in4, const
                                struct futhark_f32_2d *in5, const
                                struct futhark_i32_1d *in6, const
                                struct futhark_i32_2d *in7, const
                                struct futhark_f32_2d *in8);
int futhark_entry_reducePatchDim(struct futhark_context *ctx,
                                 struct futhark_f32_2d **out0, const
                                 struct futhark_u8_2d *in0, const
                                 struct futhark_f32_2d *in1, const
                                 struct futhark_f32_1d *in2);
int futhark_entry_selectBestNN(struct futhark_context *ctx,
                               struct futhark_i32_1d **out0,
                               struct futhark_f32_1d **out1, float *out2, const
                               int32_t in0, const struct futhark_i32_2d *in1,
                               const struct futhark_i32_3d *in2, const
                               struct futhark_i32_3d *in3);
int futhark_entry_selectBestNN_BAD(struct futhark_context *ctx,
                                   struct futhark_i32_1d **out0,
                                   struct futhark_f32_1d **out1, const
                                   int32_t in0, const
                                   struct futhark_i32_2d *in1, const
                                   struct futhark_f32_3d *in2, const
                                   struct futhark_f32_3d *in3);

// Miscellaneous

int futhark_context_sync(struct futhark_context *ctx);
int futhark_context_clear_caches(struct futhark_context *ctx);
char *futhark_context_report(struct futhark_context *ctx);
char *futhark_context_get_error(struct futhark_context *ctx);
void futhark_context_pause_profiling(struct futhark_context *ctx);
void futhark_context_unpause_profiling(struct futhark_context *ctx);
#define FUTHARK_BACKEND_cuda
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <math.h>
#include <stdint.h>
#undef NDEBUG
#include <assert.h>
#include <stdarg.h>
// Start of util.h.
//
// Various helper functions that are useful in all generated C code.

static const char *fut_progname = "(embedded Futhark)";

static void futhark_panic(int eval, const char *fmt, ...) {
  va_list ap;
  va_start(ap, fmt);
  fprintf(stderr, "%s: ", fut_progname);
  vfprintf(stderr, fmt, ap);
  va_end(ap);
  exit(eval);
}

// For generating arbitrary-sized error messages.  It is the callers
// responsibility to free the buffer at some point.
static char* msgprintf(const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = 1 + (size_t)vsnprintf(NULL, 0, s, vl);
  char *buffer = (char*) malloc(needed);
  va_start(vl, s); // Must re-init.
  vsnprintf(buffer, needed, s, vl);
  return buffer;
}

// Read a file into a NUL-terminated string; returns NULL on error.
static void* slurp_file(const char *filename, size_t *size) {
  unsigned char *s;
  FILE *f = fopen(filename, "rb"); // To avoid Windows messing with linebreaks.
  if (f == NULL) return NULL;
  fseek(f, 0, SEEK_END);
  size_t src_size = ftell(f);
  fseek(f, 0, SEEK_SET);
  s = (unsigned char*) malloc(src_size + 1);
  if (fread(s, 1, src_size, f) != src_size) {
    free(s);
    s = NULL;
  } else {
    s[src_size] = '\0';
  }
  fclose(f);

  if (size) {
    *size = src_size;
  }

  return s;
}

// Dump 'n' bytes from 'buf' into the file at the designated location.
// Returns 0 on success.
static int dump_file(const char *file, const void *buf, size_t n) {
  FILE *f = fopen(file, "w");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(buf, sizeof(char), n, f) != n) {
    return 1;
  }

  if (fclose(f) != 0) {
    return 1;
  }

  return 0;
}

struct str_builder {
  char *str;
  size_t capacity; // Size of buffer.
  size_t used; // Bytes used, *not* including final zero.
};

static void str_builder_init(struct str_builder *b) {
  b->capacity = 10;
  b->used = 0;
  b->str = malloc(b->capacity);
  b->str[0] = 0;
}

static void str_builder(struct str_builder *b, const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = (size_t)vsnprintf(NULL, 0, s, vl);

  while (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }

  va_start(vl, s); // Must re-init.
  vsnprintf(b->str+b->used, b->capacity-b->used, s, vl);
  b->used += needed;
}

// End of util.h.

// Start of timing.h.

// The function get_wall_time() returns the wall time in microseconds
// (with an unspecified offset).

#ifdef _WIN32

#include <windows.h>

static int64_t get_wall_time(void) {
  LARGE_INTEGER time,freq;
  assert(QueryPerformanceFrequency(&freq));
  assert(QueryPerformanceCounter(&time));
  return ((double)time.QuadPart / freq.QuadPart) * 1000000;
}

#else
// Assuming POSIX

#include <time.h>
#include <sys/time.h>

static int64_t get_wall_time(void) {
  struct timeval time;
  assert(gettimeofday(&time,NULL) == 0);
  return time.tv_sec * 1000000 + time.tv_usec;
}

#endif

// End of timing.h.

#ifdef _MSC_VER
#define inline __inline
#endif
#include <string.h>
#include <inttypes.h>
#include <ctype.h>
#include <errno.h>
#include <assert.h>
#include <cuda.h>
#include <cuda_runtime.h>
#include <nvrtc.h>

// Start of lock.h.

// A very simple cross-platform implementation of locks.  Uses
// pthreads on Unix and some Windows thing there.  Futhark's
// host-level code is not multithreaded, but user code may be, so we
// need some mechanism for ensuring atomic access to API functions.
// This is that mechanism.  It is not exposed to user code at all, so
// we do not have to worry about name collisions.

#ifdef _WIN32

typedef HANDLE lock_t;

static void create_lock(lock_t *lock) {
  *lock = CreateMutex(NULL,  // Default security attributes.
                      FALSE, // Initially unlocked.
                      NULL); // Unnamed.
}

static void lock_lock(lock_t *lock) {
  assert(WaitForSingleObject(*lock, INFINITE) == WAIT_OBJECT_0);
}

static void lock_unlock(lock_t *lock) {
  assert(ReleaseMutex(*lock));
}

static void free_lock(lock_t *lock) {
  CloseHandle(*lock);
}

#else
// Assuming POSIX

#include <pthread.h>

typedef pthread_mutex_t lock_t;

static void create_lock(lock_t *lock) {
  int r = pthread_mutex_init(lock, NULL);
  assert(r == 0);
}

static void lock_lock(lock_t *lock) {
  int r = pthread_mutex_lock(lock);
  assert(r == 0);
}

static void lock_unlock(lock_t *lock) {
  int r = pthread_mutex_unlock(lock);
  assert(r == 0);
}

static void free_lock(lock_t *lock) {
  // Nothing to do for pthreads.
  (void)lock;
}

#endif

// End of lock.h.

static inline uint8_t add8(uint8_t x, uint8_t y)
{
    return x + y;
}
static inline uint16_t add16(uint16_t x, uint16_t y)
{
    return x + y;
}
static inline uint32_t add32(uint32_t x, uint32_t y)
{
    return x + y;
}
static inline uint64_t add64(uint64_t x, uint64_t y)
{
    return x + y;
}
static inline uint8_t sub8(uint8_t x, uint8_t y)
{
    return x - y;
}
static inline uint16_t sub16(uint16_t x, uint16_t y)
{
    return x - y;
}
static inline uint32_t sub32(uint32_t x, uint32_t y)
{
    return x - y;
}
static inline uint64_t sub64(uint64_t x, uint64_t y)
{
    return x - y;
}
static inline uint8_t mul8(uint8_t x, uint8_t y)
{
    return x * y;
}
static inline uint16_t mul16(uint16_t x, uint16_t y)
{
    return x * y;
}
static inline uint32_t mul32(uint32_t x, uint32_t y)
{
    return x * y;
}
static inline uint64_t mul64(uint64_t x, uint64_t y)
{
    return x * y;
}
static inline uint8_t udiv8(uint8_t x, uint8_t y)
{
    return x / y;
}
static inline uint16_t udiv16(uint16_t x, uint16_t y)
{
    return x / y;
}
static inline uint32_t udiv32(uint32_t x, uint32_t y)
{
    return x / y;
}
static inline uint64_t udiv64(uint64_t x, uint64_t y)
{
    return x / y;
}
static inline uint8_t udiv_up8(uint8_t x, uint8_t y)
{
    return (x + y - 1) / y;
}
static inline uint16_t udiv_up16(uint16_t x, uint16_t y)
{
    return (x + y - 1) / y;
}
static inline uint32_t udiv_up32(uint32_t x, uint32_t y)
{
    return (x + y - 1) / y;
}
static inline uint64_t udiv_up64(uint64_t x, uint64_t y)
{
    return (x + y - 1) / y;
}
static inline uint8_t umod8(uint8_t x, uint8_t y)
{
    return x % y;
}
static inline uint16_t umod16(uint16_t x, uint16_t y)
{
    return x % y;
}
static inline uint32_t umod32(uint32_t x, uint32_t y)
{
    return x % y;
}
static inline uint64_t umod64(uint64_t x, uint64_t y)
{
    return x % y;
}
static inline uint8_t udiv_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint16_t udiv_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint32_t udiv_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint64_t udiv_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline uint8_t udiv_up_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint16_t udiv_up_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint32_t udiv_up_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint64_t udiv_up_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : (x + y - 1) / y;
}
static inline uint8_t umod_safe8(uint8_t x, uint8_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint16_t umod_safe16(uint16_t x, uint16_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint32_t umod_safe32(uint32_t x, uint32_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline uint64_t umod_safe64(uint64_t x, uint64_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int8_t sdiv8(int8_t x, int8_t y)
{
    int8_t q = x / y;
    int8_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int16_t sdiv16(int16_t x, int16_t y)
{
    int16_t q = x / y;
    int16_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int32_t sdiv32(int32_t x, int32_t y)
{
    int32_t q = x / y;
    int32_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int64_t sdiv64(int64_t x, int64_t y)
{
    int64_t q = x / y;
    int64_t r = x % y;
    
    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}
static inline int8_t sdiv_up8(int8_t x, int8_t y)
{
    return sdiv8(x + y - 1, y);
}
static inline int16_t sdiv_up16(int16_t x, int16_t y)
{
    return sdiv16(x + y - 1, y);
}
static inline int32_t sdiv_up32(int32_t x, int32_t y)
{
    return sdiv32(x + y - 1, y);
}
static inline int64_t sdiv_up64(int64_t x, int64_t y)
{
    return sdiv64(x + y - 1, y);
}
static inline int8_t smod8(int8_t x, int8_t y)
{
    int8_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int16_t smod16(int16_t x, int16_t y)
{
    int16_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int32_t smod32(int32_t x, int32_t y)
{
    int32_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int64_t smod64(int64_t x, int64_t y)
{
    int64_t r = x % y;
    
    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}
static inline int8_t sdiv_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : sdiv8(x, y);
}
static inline int16_t sdiv_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : sdiv16(x, y);
}
static inline int32_t sdiv_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : sdiv32(x, y);
}
static inline int64_t sdiv_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : sdiv64(x, y);
}
static inline int8_t sdiv_up_safe8(int8_t x, int8_t y)
{
    return sdiv_safe8(x + y - 1, y);
}
static inline int16_t sdiv_up_safe16(int16_t x, int16_t y)
{
    return sdiv_safe16(x + y - 1, y);
}
static inline int32_t sdiv_up_safe32(int32_t x, int32_t y)
{
    return sdiv_safe32(x + y - 1, y);
}
static inline int64_t sdiv_up_safe64(int64_t x, int64_t y)
{
    return sdiv_safe64(x + y - 1, y);
}
static inline int8_t smod_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : smod8(x, y);
}
static inline int16_t smod_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : smod16(x, y);
}
static inline int32_t smod_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : smod32(x, y);
}
static inline int64_t smod_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : smod64(x, y);
}
static inline int8_t squot8(int8_t x, int8_t y)
{
    return x / y;
}
static inline int16_t squot16(int16_t x, int16_t y)
{
    return x / y;
}
static inline int32_t squot32(int32_t x, int32_t y)
{
    return x / y;
}
static inline int64_t squot64(int64_t x, int64_t y)
{
    return x / y;
}
static inline int8_t srem8(int8_t x, int8_t y)
{
    return x % y;
}
static inline int16_t srem16(int16_t x, int16_t y)
{
    return x % y;
}
static inline int32_t srem32(int32_t x, int32_t y)
{
    return x % y;
}
static inline int64_t srem64(int64_t x, int64_t y)
{
    return x % y;
}
static inline int8_t squot_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int16_t squot_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int32_t squot_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int64_t squot_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : x / y;
}
static inline int8_t srem_safe8(int8_t x, int8_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int16_t srem_safe16(int16_t x, int16_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int32_t srem_safe32(int32_t x, int32_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int64_t srem_safe64(int64_t x, int64_t y)
{
    return y == 0 ? 0 : x % y;
}
static inline int8_t smin8(int8_t x, int8_t y)
{
    return x < y ? x : y;
}
static inline int16_t smin16(int16_t x, int16_t y)
{
    return x < y ? x : y;
}
static inline int32_t smin32(int32_t x, int32_t y)
{
    return x < y ? x : y;
}
static inline int64_t smin64(int64_t x, int64_t y)
{
    return x < y ? x : y;
}
static inline uint8_t umin8(uint8_t x, uint8_t y)
{
    return x < y ? x : y;
}
static inline uint16_t umin16(uint16_t x, uint16_t y)
{
    return x < y ? x : y;
}
static inline uint32_t umin32(uint32_t x, uint32_t y)
{
    return x < y ? x : y;
}
static inline uint64_t umin64(uint64_t x, uint64_t y)
{
    return x < y ? x : y;
}
static inline int8_t smax8(int8_t x, int8_t y)
{
    return x < y ? y : x;
}
static inline int16_t smax16(int16_t x, int16_t y)
{
    return x < y ? y : x;
}
static inline int32_t smax32(int32_t x, int32_t y)
{
    return x < y ? y : x;
}
static inline int64_t smax64(int64_t x, int64_t y)
{
    return x < y ? y : x;
}
static inline uint8_t umax8(uint8_t x, uint8_t y)
{
    return x < y ? y : x;
}
static inline uint16_t umax16(uint16_t x, uint16_t y)
{
    return x < y ? y : x;
}
static inline uint32_t umax32(uint32_t x, uint32_t y)
{
    return x < y ? y : x;
}
static inline uint64_t umax64(uint64_t x, uint64_t y)
{
    return x < y ? y : x;
}
static inline uint8_t shl8(uint8_t x, uint8_t y)
{
    return x << y;
}
static inline uint16_t shl16(uint16_t x, uint16_t y)
{
    return x << y;
}
static inline uint32_t shl32(uint32_t x, uint32_t y)
{
    return x << y;
}
static inline uint64_t shl64(uint64_t x, uint64_t y)
{
    return x << y;
}
static inline uint8_t lshr8(uint8_t x, uint8_t y)
{
    return x >> y;
}
static inline uint16_t lshr16(uint16_t x, uint16_t y)
{
    return x >> y;
}
static inline uint32_t lshr32(uint32_t x, uint32_t y)
{
    return x >> y;
}
static inline uint64_t lshr64(uint64_t x, uint64_t y)
{
    return x >> y;
}
static inline int8_t ashr8(int8_t x, int8_t y)
{
    return x >> y;
}
static inline int16_t ashr16(int16_t x, int16_t y)
{
    return x >> y;
}
static inline int32_t ashr32(int32_t x, int32_t y)
{
    return x >> y;
}
static inline int64_t ashr64(int64_t x, int64_t y)
{
    return x >> y;
}
static inline uint8_t and8(uint8_t x, uint8_t y)
{
    return x & y;
}
static inline uint16_t and16(uint16_t x, uint16_t y)
{
    return x & y;
}
static inline uint32_t and32(uint32_t x, uint32_t y)
{
    return x & y;
}
static inline uint64_t and64(uint64_t x, uint64_t y)
{
    return x & y;
}
static inline uint8_t or8(uint8_t x, uint8_t y)
{
    return x | y;
}
static inline uint16_t or16(uint16_t x, uint16_t y)
{
    return x | y;
}
static inline uint32_t or32(uint32_t x, uint32_t y)
{
    return x | y;
}
static inline uint64_t or64(uint64_t x, uint64_t y)
{
    return x | y;
}
static inline uint8_t xor8(uint8_t x, uint8_t y)
{
    return x ^ y;
}
static inline uint16_t xor16(uint16_t x, uint16_t y)
{
    return x ^ y;
}
static inline uint32_t xor32(uint32_t x, uint32_t y)
{
    return x ^ y;
}
static inline uint64_t xor64(uint64_t x, uint64_t y)
{
    return x ^ y;
}
static inline bool ult8(uint8_t x, uint8_t y)
{
    return x < y;
}
static inline bool ult16(uint16_t x, uint16_t y)
{
    return x < y;
}
static inline bool ult32(uint32_t x, uint32_t y)
{
    return x < y;
}
static inline bool ult64(uint64_t x, uint64_t y)
{
    return x < y;
}
static inline bool ule8(uint8_t x, uint8_t y)
{
    return x <= y;
}
static inline bool ule16(uint16_t x, uint16_t y)
{
    return x <= y;
}
static inline bool ule32(uint32_t x, uint32_t y)
{
    return x <= y;
}
static inline bool ule64(uint64_t x, uint64_t y)
{
    return x <= y;
}
static inline bool slt8(int8_t x, int8_t y)
{
    return x < y;
}
static inline bool slt16(int16_t x, int16_t y)
{
    return x < y;
}
static inline bool slt32(int32_t x, int32_t y)
{
    return x < y;
}
static inline bool slt64(int64_t x, int64_t y)
{
    return x < y;
}
static inline bool sle8(int8_t x, int8_t y)
{
    return x <= y;
}
static inline bool sle16(int16_t x, int16_t y)
{
    return x <= y;
}
static inline bool sle32(int32_t x, int32_t y)
{
    return x <= y;
}
static inline bool sle64(int64_t x, int64_t y)
{
    return x <= y;
}
static inline int8_t pow8(int8_t x, int8_t y)
{
    int8_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int16_t pow16(int16_t x, int16_t y)
{
    int16_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int32_t pow32(int32_t x, int32_t y)
{
    int32_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline int64_t pow64(int64_t x, int64_t y)
{
    int64_t res = 1, rem = y;
    
    while (rem != 0) {
        if (rem & 1)
            res *= x;
        rem >>= 1;
        x *= x;
    }
    return res;
}
static inline bool itob_i8_bool(int8_t x)
{
    return x;
}
static inline bool itob_i16_bool(int16_t x)
{
    return x;
}
static inline bool itob_i32_bool(int32_t x)
{
    return x;
}
static inline bool itob_i64_bool(int64_t x)
{
    return x;
}
static inline int8_t btoi_bool_i8(bool x)
{
    return x;
}
static inline int16_t btoi_bool_i16(bool x)
{
    return x;
}
static inline int32_t btoi_bool_i32(bool x)
{
    return x;
}
static inline int64_t btoi_bool_i64(bool x)
{
    return x;
}
#define sext_i8_i8(x) ((int8_t) (int8_t) x)
#define sext_i8_i16(x) ((int16_t) (int8_t) x)
#define sext_i8_i32(x) ((int32_t) (int8_t) x)
#define sext_i8_i64(x) ((int64_t) (int8_t) x)
#define sext_i16_i8(x) ((int8_t) (int16_t) x)
#define sext_i16_i16(x) ((int16_t) (int16_t) x)
#define sext_i16_i32(x) ((int32_t) (int16_t) x)
#define sext_i16_i64(x) ((int64_t) (int16_t) x)
#define sext_i32_i8(x) ((int8_t) (int32_t) x)
#define sext_i32_i16(x) ((int16_t) (int32_t) x)
#define sext_i32_i32(x) ((int32_t) (int32_t) x)
#define sext_i32_i64(x) ((int64_t) (int32_t) x)
#define sext_i64_i8(x) ((int8_t) (int64_t) x)
#define sext_i64_i16(x) ((int16_t) (int64_t) x)
#define sext_i64_i32(x) ((int32_t) (int64_t) x)
#define sext_i64_i64(x) ((int64_t) (int64_t) x)
#define zext_i8_i8(x) ((int8_t) (uint8_t) x)
#define zext_i8_i16(x) ((int16_t) (uint8_t) x)
#define zext_i8_i32(x) ((int32_t) (uint8_t) x)
#define zext_i8_i64(x) ((int64_t) (uint8_t) x)
#define zext_i16_i8(x) ((int8_t) (uint16_t) x)
#define zext_i16_i16(x) ((int16_t) (uint16_t) x)
#define zext_i16_i32(x) ((int32_t) (uint16_t) x)
#define zext_i16_i64(x) ((int64_t) (uint16_t) x)
#define zext_i32_i8(x) ((int8_t) (uint32_t) x)
#define zext_i32_i16(x) ((int16_t) (uint32_t) x)
#define zext_i32_i32(x) ((int32_t) (uint32_t) x)
#define zext_i32_i64(x) ((int64_t) (uint32_t) x)
#define zext_i64_i8(x) ((int8_t) (uint64_t) x)
#define zext_i64_i16(x) ((int16_t) (uint64_t) x)
#define zext_i64_i32(x) ((int32_t) (uint64_t) x)
#define zext_i64_i64(x) ((int64_t) (uint64_t) x)
#if defined(__OPENCL_VERSION__)
static int32_t futrts_popc8(int8_t x)
{
    return popcount(x);
}
static int32_t futrts_popc16(int16_t x)
{
    return popcount(x);
}
static int32_t futrts_popc32(int32_t x)
{
    return popcount(x);
}
static int32_t futrts_popc64(int64_t x)
{
    return popcount(x);
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_popc8(int8_t x)
{
    return __popc(zext_i8_i32(x));
}
static int32_t futrts_popc16(int16_t x)
{
    return __popc(zext_i16_i32(x));
}
static int32_t futrts_popc32(int32_t x)
{
    return __popc(x);
}
static int32_t futrts_popc64(int64_t x)
{
    return __popcll(x);
}
#else
static int32_t futrts_popc8(int8_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc16(int16_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc32(int32_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
static int32_t futrts_popc64(int64_t x)
{
    int c = 0;
    
    for (; x; ++c)
        x &= x - 1;
    return c;
}
#endif
#if defined(__OPENCL_VERSION__)
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    return mul_hi(a, b);
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    return mul_hi(a, b);
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    return mul_hi(a, b);
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    return mul_hi(a, b);
}
#elif defined(__CUDA_ARCH__)
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    uint16_t aa = a;
    uint16_t bb = b;
    
    return aa * bb >> 8;
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    uint32_t aa = a;
    uint32_t bb = b;
    
    return aa * bb >> 16;
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    return mulhi(a, b);
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    return mul64hi(a, b);
}
#else
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)
{
    uint16_t aa = a;
    uint16_t bb = b;
    
    return aa * bb >> 8;
}
static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)
{
    uint32_t aa = a;
    uint32_t bb = b;
    
    return aa * bb >> 16;
}
static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)
{
    uint64_t aa = a;
    uint64_t bb = b;
    
    return aa * bb >> 32;
}
static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)
{
    __uint128_t aa = a;
    __uint128_t bb = b;
    
    return aa * bb >> 64;
}
#endif
#if defined(__OPENCL_VERSION__)
static uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)
{
    return mad_hi(a, b, c);
}
static uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)
{
    return mad_hi(a, b, c);
}
static uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)
{
    return mad_hi(a, b, c);
}
static uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)
{
    return mad_hi(a, b, c);
}
#else
static uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)
{
    return futrts_mul_hi8(a, b) + c;
}
static uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)
{
    return futrts_mul_hi16(a, b) + c;
}
static uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)
{
    return futrts_mul_hi32(a, b) + c;
}
static uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)
{
    return futrts_mul_hi64(a, b) + c;
}
#endif
#if defined(__OPENCL_VERSION__)
static int32_t futrts_clzz8(int8_t x)
{
    return clz(x);
}
static int32_t futrts_clzz16(int16_t x)
{
    return clz(x);
}
static int32_t futrts_clzz32(int32_t x)
{
    return clz(x);
}
static int32_t futrts_clzz64(int64_t x)
{
    return clz(x);
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_clzz8(int8_t x)
{
    return __clz(zext_i8_i32(x)) - 24;
}
static int32_t futrts_clzz16(int16_t x)
{
    return __clz(zext_i16_i32(x)) - 16;
}
static int32_t futrts_clzz32(int32_t x)
{
    return __clz(x);
}
static int32_t futrts_clzz64(int64_t x)
{
    return __clzll(x);
}
#else
static int32_t futrts_clzz8(int8_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz16(int16_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz32(int32_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
static int32_t futrts_clzz64(int64_t x)
{
    int n = 0;
    int bits = sizeof(x) * 8;
    
    for (int i = 0; i < bits; i++) {
        if (x < 0)
            break;
        n++;
        x <<= 1;
    }
    return n;
}
#endif
#if defined(__OPENCL_VERSION__)
static int32_t futrts_ctzz8(int8_t x)
{
    int i = 0;
    
    for (; i < 8 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz16(int16_t x)
{
    int i = 0;
    
    for (; i < 16 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz32(int32_t x)
{
    int i = 0;
    
    for (; i < 32 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
static int32_t futrts_ctzz64(int64_t x)
{
    int i = 0;
    
    for (; i < 64 && (x & 1) == 0; i++, x >>= 1)
        ;
    return i;
}
#elif defined(__CUDA_ARCH__)
static int32_t futrts_ctzz8(int8_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 8 : y - 1;
}
static int32_t futrts_ctzz16(int16_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 16 : y - 1;
}
static int32_t futrts_ctzz32(int32_t x)
{
    int y = __ffs(x);
    
    return y == 0 ? 32 : y - 1;
}
static int32_t futrts_ctzz64(int64_t x)
{
    int y = __ffsll(x);
    
    return y == 0 ? 64 : y - 1;
}
#else
static int32_t futrts_ctzz8(int8_t x)
{
    return x == 0 ? 8 : __builtin_ctz((uint32_t) x);
}
static int32_t futrts_ctzz16(int16_t x)
{
    return x == 0 ? 16 : __builtin_ctz((uint32_t) x);
}
static int32_t futrts_ctzz32(int32_t x)
{
    return x == 0 ? 32 : __builtin_ctz(x);
}
static int32_t futrts_ctzz64(int64_t x)
{
    return x == 0 ? 64 : __builtin_ctzl(x);
}
#endif
static inline float fdiv32(float x, float y)
{
    return x / y;
}
static inline float fadd32(float x, float y)
{
    return x + y;
}
static inline float fsub32(float x, float y)
{
    return x - y;
}
static inline float fmul32(float x, float y)
{
    return x * y;
}
static inline float fmin32(float x, float y)
{
    return fmin(x, y);
}
static inline float fmax32(float x, float y)
{
    return fmax(x, y);
}
static inline float fpow32(float x, float y)
{
    return pow(x, y);
}
static inline bool cmplt32(float x, float y)
{
    return x < y;
}
static inline bool cmple32(float x, float y)
{
    return x <= y;
}
static inline float sitofp_i8_f32(int8_t x)
{
    return (float) x;
}
static inline float sitofp_i16_f32(int16_t x)
{
    return (float) x;
}
static inline float sitofp_i32_f32(int32_t x)
{
    return (float) x;
}
static inline float sitofp_i64_f32(int64_t x)
{
    return (float) x;
}
static inline float uitofp_i8_f32(uint8_t x)
{
    return (float) x;
}
static inline float uitofp_i16_f32(uint16_t x)
{
    return (float) x;
}
static inline float uitofp_i32_f32(uint32_t x)
{
    return (float) x;
}
static inline float uitofp_i64_f32(uint64_t x)
{
    return (float) x;
}
static inline int8_t fptosi_f32_i8(float x)
{
    return (int8_t) x;
}
static inline int16_t fptosi_f32_i16(float x)
{
    return (int16_t) x;
}
static inline int32_t fptosi_f32_i32(float x)
{
    return (int32_t) x;
}
static inline int64_t fptosi_f32_i64(float x)
{
    return (int64_t) x;
}
static inline uint8_t fptoui_f32_i8(float x)
{
    return (uint8_t) x;
}
static inline uint16_t fptoui_f32_i16(float x)
{
    return (uint16_t) x;
}
static inline uint32_t fptoui_f32_i32(float x)
{
    return (uint32_t) x;
}
static inline uint64_t fptoui_f32_i64(float x)
{
    return (uint64_t) x;
}
static inline double fdiv64(double x, double y)
{
    return x / y;
}
static inline double fadd64(double x, double y)
{
    return x + y;
}
static inline double fsub64(double x, double y)
{
    return x - y;
}
static inline double fmul64(double x, double y)
{
    return x * y;
}
static inline double fmin64(double x, double y)
{
    return fmin(x, y);
}
static inline double fmax64(double x, double y)
{
    return fmax(x, y);
}
static inline double fpow64(double x, double y)
{
    return pow(x, y);
}
static inline bool cmplt64(double x, double y)
{
    return x < y;
}
static inline bool cmple64(double x, double y)
{
    return x <= y;
}
static inline double sitofp_i8_f64(int8_t x)
{
    return (double) x;
}
static inline double sitofp_i16_f64(int16_t x)
{
    return (double) x;
}
static inline double sitofp_i32_f64(int32_t x)
{
    return (double) x;
}
static inline double sitofp_i64_f64(int64_t x)
{
    return (double) x;
}
static inline double uitofp_i8_f64(uint8_t x)
{
    return (double) x;
}
static inline double uitofp_i16_f64(uint16_t x)
{
    return (double) x;
}
static inline double uitofp_i32_f64(uint32_t x)
{
    return (double) x;
}
static inline double uitofp_i64_f64(uint64_t x)
{
    return (double) x;
}
static inline int8_t fptosi_f64_i8(double x)
{
    return (int8_t) x;
}
static inline int16_t fptosi_f64_i16(double x)
{
    return (int16_t) x;
}
static inline int32_t fptosi_f64_i32(double x)
{
    return (int32_t) x;
}
static inline int64_t fptosi_f64_i64(double x)
{
    return (int64_t) x;
}
static inline uint8_t fptoui_f64_i8(double x)
{
    return (uint8_t) x;
}
static inline uint16_t fptoui_f64_i16(double x)
{
    return (uint16_t) x;
}
static inline uint32_t fptoui_f64_i32(double x)
{
    return (uint32_t) x;
}
static inline uint64_t fptoui_f64_i64(double x)
{
    return (uint64_t) x;
}
static inline float fpconv_f32_f32(float x)
{
    return (float) x;
}
static inline double fpconv_f32_f64(float x)
{
    return (double) x;
}
static inline float fpconv_f64_f32(double x)
{
    return (float) x;
}
static inline double fpconv_f64_f64(double x)
{
    return (double) x;
}
static inline float futrts_log32(float x)
{
    return log(x);
}
static inline float futrts_log2_32(float x)
{
    return log2(x);
}
static inline float futrts_log10_32(float x)
{
    return log10(x);
}
static inline float futrts_sqrt32(float x)
{
    return sqrt(x);
}
static inline float futrts_exp32(float x)
{
    return exp(x);
}
static inline float futrts_cos32(float x)
{
    return cos(x);
}
static inline float futrts_sin32(float x)
{
    return sin(x);
}
static inline float futrts_tan32(float x)
{
    return tan(x);
}
static inline float futrts_acos32(float x)
{
    return acos(x);
}
static inline float futrts_asin32(float x)
{
    return asin(x);
}
static inline float futrts_atan32(float x)
{
    return atan(x);
}
static inline float futrts_cosh32(float x)
{
    return cosh(x);
}
static inline float futrts_sinh32(float x)
{
    return sinh(x);
}
static inline float futrts_tanh32(float x)
{
    return tanh(x);
}
static inline float futrts_acosh32(float x)
{
    return acosh(x);
}
static inline float futrts_asinh32(float x)
{
    return asinh(x);
}
static inline float futrts_atanh32(float x)
{
    return atanh(x);
}
static inline float futrts_atan2_32(float x, float y)
{
    return atan2(x, y);
}
static inline float futrts_gamma32(float x)
{
    return tgamma(x);
}
static inline float futrts_lgamma32(float x)
{
    return lgamma(x);
}
static inline bool futrts_isnan32(float x)
{
    return isnan(x);
}
static inline bool futrts_isinf32(float x)
{
    return isinf(x);
}
static inline int32_t futrts_to_bits32(float x)
{
    union {
        float f;
        int32_t t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline float futrts_from_bits32(int32_t x)
{
    union {
        int32_t f;
        float t;
    } p;
    
    p.f = x;
    return p.t;
}
#ifdef __OPENCL_VERSION__
static inline float fmod32(float x, float y)
{
    return fmod(x, y);
}
static inline float futrts_round32(float x)
{
    return rint(x);
}
static inline float futrts_floor32(float x)
{
    return floor(x);
}
static inline float futrts_ceil32(float x)
{
    return ceil(x);
}
static inline float futrts_lerp32(float v0, float v1, float t)
{
    return mix(v0, v1, t);
}
static inline float futrts_mad32(float a, float b, float c)
{
    return mad(a, b, c);
}
static inline float futrts_fma32(float a, float b, float c)
{
    return fma(a, b, c);
}
#else
static inline float fmod32(float x, float y)
{
    return fmodf(x, y);
}
static inline float futrts_round32(float x)
{
    return rintf(x);
}
static inline float futrts_floor32(float x)
{
    return floorf(x);
}
static inline float futrts_ceil32(float x)
{
    return ceilf(x);
}
static inline float futrts_lerp32(float v0, float v1, float t)
{
    return v0 + (v1 - v0) * t;
}
static inline float futrts_mad32(float a, float b, float c)
{
    return a * b + c;
}
static inline float futrts_fma32(float a, float b, float c)
{
    return fmaf(a, b, c);
}
#endif
static inline double futrts_log64(double x)
{
    return log(x);
}
static inline double futrts_log2_64(double x)
{
    return log2(x);
}
static inline double futrts_log10_64(double x)
{
    return log10(x);
}
static inline double futrts_sqrt64(double x)
{
    return sqrt(x);
}
static inline double futrts_exp64(double x)
{
    return exp(x);
}
static inline double futrts_cos64(double x)
{
    return cos(x);
}
static inline double futrts_sin64(double x)
{
    return sin(x);
}
static inline double futrts_tan64(double x)
{
    return tan(x);
}
static inline double futrts_acos64(double x)
{
    return acos(x);
}
static inline double futrts_asin64(double x)
{
    return asin(x);
}
static inline double futrts_atan64(double x)
{
    return atan(x);
}
static inline double futrts_cosh64(double x)
{
    return cosh(x);
}
static inline double futrts_sinh64(double x)
{
    return sinh(x);
}
static inline double futrts_tanh64(double x)
{
    return tanh(x);
}
static inline double futrts_acosh64(double x)
{
    return acosh(x);
}
static inline double futrts_asinh64(double x)
{
    return asinh(x);
}
static inline double futrts_atanh64(double x)
{
    return atanh(x);
}
static inline double futrts_atan2_64(double x, double y)
{
    return atan2(x, y);
}
static inline double futrts_gamma64(double x)
{
    return tgamma(x);
}
static inline double futrts_lgamma64(double x)
{
    return lgamma(x);
}
static inline double futrts_fma64(double a, double b, double c)
{
    return fma(a, b, c);
}
static inline double futrts_round64(double x)
{
    return rint(x);
}
static inline double futrts_ceil64(double x)
{
    return ceil(x);
}
static inline double futrts_floor64(double x)
{
    return floor(x);
}
static inline bool futrts_isnan64(double x)
{
    return isnan(x);
}
static inline bool futrts_isinf64(double x)
{
    return isinf(x);
}
static inline int64_t futrts_to_bits64(double x)
{
    union {
        double f;
        int64_t t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline double futrts_from_bits64(int64_t x)
{
    union {
        int64_t f;
        double t;
    } p;
    
    p.f = x;
    return p.t;
}
static inline double fmod64(double x, double y)
{
    return fmod(x, y);
}
#ifdef __OPENCL_VERSION__
static inline double futrts_lerp64(double v0, double v1, double t)
{
    return mix(v0, v1, t);
}
static inline double futrts_mad64(double a, double b, double c)
{
    return mad(a, b, c);
}
#else
static inline double futrts_lerp64(double v0, double v1, double t)
{
    return v0 + (v1 - v0) * t;
}
static inline double futrts_mad64(double a, double b, double c)
{
    return a * b + c;
}
#endif
int init_constants(struct futhark_context *);
int free_constants(struct futhark_context *);
static int32_t buildKDtreezicounter_mem_realtype_40861[10240];
static int32_t buildKDtreezicounter_mem_realtype_40885[10240];
static int32_t buildKDtreezicounter_mem_realtype_40926[10240];
static int32_t exactKnnFixKzicounter_mem_realtype_41244[10] = {0, 0, 0, 0, 0, 0,
                                                               0, 0, 0, 0};
static int32_t reducePatchDimzicounter_mem_realtype_41565[10240];
static int32_t selectBestNNzicounter_mem_realtype_41584[10] = {0, 0, 0, 0, 0, 0,
                                                               0, 0, 0, 0};
static int32_t selectBestNNzicounter_mem_realtype_41639[10] = {0, 0, 0, 0, 0, 0,
                                                               0, 0, 0, 0};
struct memblock_device {
    int *references;
    CUdeviceptr mem;
    int64_t size;
    const char *desc;
} ;
struct memblock {
    int *references;
    char *mem;
    int64_t size;
    const char *desc;
} ;
#include <cuda.h>
#include <nvrtc.h>
typedef CUdeviceptr fl_mem_t;
// Start of free_list.h.

// An entry in the free list.  May be invalid, to avoid having to
// deallocate entries as soon as they are removed.  There is also a
// tag, to help with memory reuse.
struct free_list_entry {
  size_t size;
  fl_mem_t mem;
  const char *tag;
  unsigned char valid;
};

struct free_list {
  struct free_list_entry *entries;        // Pointer to entries.
  int capacity;                           // Number of entries.
  int used;                               // Number of valid entries.
};

static void free_list_init(struct free_list *l) {
  l->capacity = 30; // Picked arbitrarily.
  l->used = 0;
  l->entries = (struct free_list_entry*) malloc(sizeof(struct free_list_entry) * l->capacity);
  for (int i = 0; i < l->capacity; i++) {
    l->entries[i].valid = 0;
  }
}

// Remove invalid entries from the free list.
static void free_list_pack(struct free_list *l) {
  int p = 0;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[p] = l->entries[i];
      p++;
    }
  }

  // Now p is the number of used elements.  We don't want it to go
  // less than the default capacity (although in practice it's OK as
  // long as it doesn't become 1).
  if (p < 30) {
    p = 30;
  }
  l->entries = realloc(l->entries, p * sizeof(struct free_list_entry));
  l->capacity = p;
}

static void free_list_destroy(struct free_list *l) {
  assert(l->used == 0);
  free(l->entries);
}

static int free_list_find_invalid(struct free_list *l) {
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (!l->entries[i].valid) {
      break;
    }
  }
  return i;
}

static void free_list_insert(struct free_list *l, size_t size, fl_mem_t mem, const char *tag) {
  int i = free_list_find_invalid(l);

  if (i == l->capacity) {
    // List is full; so we have to grow it.
    int new_capacity = l->capacity * 2 * sizeof(struct free_list_entry);
    l->entries = realloc(l->entries, new_capacity);
    for (int j = 0; j < l->capacity; j++) {
      l->entries[j+l->capacity].valid = 0;
    }
    l->capacity *= 2;
  }

  // Now 'i' points to the first invalid entry.
  l->entries[i].valid = 1;
  l->entries[i].size = size;
  l->entries[i].mem = mem;
  l->entries[i].tag = tag;

  l->used++;
}

// Find and remove a memory block of the indicated tag, or if that
// does not exist, another memory block with exactly the desired size.
// Returns 0 on success.
static int free_list_find(struct free_list *l, size_t size,
                          size_t *size_out, fl_mem_t *mem_out) {
  int size_match = -1;
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid &&
        size <= l->entries[i].size &&
        (size_match < 0 || l->entries[i].size < l->entries[size_match].size)) {
      // If this entry is valid, has sufficient size, and is smaller than the
      // best entry found so far, use this entry.
      size_match = i;
    }
  }

  if (size_match >= 0) {
    l->entries[size_match].valid = 0;
    *size_out = l->entries[size_match].size;
    *mem_out = l->entries[size_match].mem;
    l->used--;
    return 0;
  } else {
    return 1;
  }
}

// Remove the first block in the free list.  Returns 0 if a block was
// removed, and nonzero if the free list was already empty.
static int free_list_first(struct free_list *l, fl_mem_t *mem_out) {
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[i].valid = 0;
      *mem_out = l->entries[i].mem;
      l->used--;
      return 0;
    }
  }

  return 1;
}

// End of free_list.h.

// Start of cuda.h.

#define CUDA_SUCCEED(x) cuda_api_succeed(x, #x, __FILE__, __LINE__)
#define NVRTC_SUCCEED(x) nvrtc_api_succeed(x, #x, __FILE__, __LINE__)

static inline void cuda_api_succeed(CUresult res, const char *call,
    const char *file, int line) {
  if (res != CUDA_SUCCESS) {
    const char *err_str;
    cuGetErrorString(res, &err_str);
    if (err_str == NULL) { err_str = "Unknown"; }
    futhark_panic(-1, "%s:%d: CUDA call\n  %s\nfailed with error code %d (%s)\n",
        file, line, call, res, err_str);
  }
}

static inline void nvrtc_api_succeed(nvrtcResult res, const char *call,
                                     const char *file, int line) {
  if (res != NVRTC_SUCCESS) {
    const char *err_str = nvrtcGetErrorString(res);
    futhark_panic(-1, "%s:%d: NVRTC call\n  %s\nfailed with error code %d (%s)\n",
        file, line, call, res, err_str);
  }
}

struct cuda_config {
  int debugging;
  int logging;
  const char *preferred_device;
  int preferred_device_num;

  const char *dump_program_to;
  const char *load_program_from;

  const char *dump_ptx_to;
  const char *load_ptx_from;

  size_t default_block_size;
  size_t default_grid_size;
  size_t default_tile_size;
  size_t default_threshold;

  int default_block_size_changed;
  int default_grid_size_changed;
  int default_tile_size_changed;

  int num_sizes;
  const char **size_names;
  const char **size_vars;
  size_t *size_values;
  const char **size_classes;
};

static void cuda_config_init(struct cuda_config *cfg,
                             int num_sizes,
                             const char *size_names[],
                             const char *size_vars[],
                             size_t *size_values,
                             const char *size_classes[]) {
  cfg->debugging = 0;
  cfg->logging = 0;
  cfg->preferred_device_num = 0;
  cfg->preferred_device = "";
  cfg->dump_program_to = NULL;
  cfg->load_program_from = NULL;

  cfg->dump_ptx_to = NULL;
  cfg->load_ptx_from = NULL;

  cfg->default_block_size = 256;
  cfg->default_grid_size = 0; // Set properly later.
  cfg->default_tile_size = 32;
  cfg->default_threshold = 32*1024;

  cfg->default_block_size_changed = 0;
  cfg->default_grid_size_changed = 0;
  cfg->default_tile_size_changed = 0;

  cfg->num_sizes = num_sizes;
  cfg->size_names = size_names;
  cfg->size_vars = size_vars;
  cfg->size_values = size_values;
  cfg->size_classes = size_classes;
}

// A record of something that happened.
struct profiling_record {
  cudaEvent_t *events; // Points to two events.
  int *runs;
  int64_t *runtime;
};

struct cuda_context {
  CUdevice dev;
  CUcontext cu_ctx;
  CUmodule module;

  struct cuda_config cfg;

  struct free_list free_list;

  size_t max_block_size;
  size_t max_grid_size;
  size_t max_tile_size;
  size_t max_threshold;
  size_t max_shared_memory;
  size_t max_bespoke;

  size_t lockstep_width;

  struct profiling_record *profiling_records;
  int profiling_records_capacity;
  int profiling_records_used;
};

#define CU_DEV_ATTR(x) (CU_DEVICE_ATTRIBUTE_##x)
#define device_query(dev,attrib) _device_query(dev, CU_DEV_ATTR(attrib))
static int _device_query(CUdevice dev, CUdevice_attribute attrib) {
  int val;
  CUDA_SUCCEED(cuDeviceGetAttribute(&val, attrib, dev));
  return val;
}

#define CU_FUN_ATTR(x) (CU_FUNC_ATTRIBUTE_##x)
#define function_query(fn,attrib) _function_query(dev, CU_FUN_ATTR(attrib))
static int _function_query(CUfunction dev, CUfunction_attribute attrib) {
  int val;
  CUDA_SUCCEED(cuFuncGetAttribute(&val, attrib, dev));
  return val;
}

static void set_preferred_device(struct cuda_config *cfg, const char *s) {
  int x = 0;
  if (*s == '#') {
    s++;
    while (isdigit(*s)) {
      x = x * 10 + (*s++)-'0';
    }
    // Skip trailing spaces.
    while (isspace(*s)) {
      s++;
    }
  }
  cfg->preferred_device = s;
  cfg->preferred_device_num = x;
}

static int cuda_device_setup(struct cuda_context *ctx) {
  char name[256];
  int count, chosen = -1, best_cc = -1;
  int cc_major_best, cc_minor_best;
  int cc_major, cc_minor;
  CUdevice dev;

  CUDA_SUCCEED(cuDeviceGetCount(&count));
  if (count == 0) { return 1; }

  int num_device_matches = 0;

  // XXX: Current device selection policy is to choose the device with the
  // highest compute capability (if no preferred device is set).
  // This should maybe be changed, since greater compute capability is not
  // necessarily an indicator of better performance.
  for (int i = 0; i < count; i++) {
    CUDA_SUCCEED(cuDeviceGet(&dev, i));

    cc_major = device_query(dev, COMPUTE_CAPABILITY_MAJOR);
    cc_minor = device_query(dev, COMPUTE_CAPABILITY_MINOR);

    CUDA_SUCCEED(cuDeviceGetName(name, sizeof(name) - 1, dev));
    name[sizeof(name) - 1] = 0;

    if (ctx->cfg.debugging) {
      fprintf(stderr, "Device #%d: name=\"%s\", compute capability=%d.%d\n",
          i, name, cc_major, cc_minor);
    }

    if (device_query(dev, COMPUTE_MODE) == CU_COMPUTEMODE_PROHIBITED) {
      if (ctx->cfg.debugging) {
        fprintf(stderr, "Device #%d is compute-prohibited, ignoring\n", i);
      }
      continue;
    }

    if (best_cc == -1 || cc_major > cc_major_best ||
        (cc_major == cc_major_best && cc_minor > cc_minor_best)) {
      best_cc = i;
      cc_major_best = cc_major;
      cc_minor_best = cc_minor;
    }

    if (strstr(name, ctx->cfg.preferred_device) != NULL &&
        num_device_matches++ == ctx->cfg.preferred_device_num) {
      chosen = i;
      break;
    }
  }

  if (chosen == -1) { chosen = best_cc; }
  if (chosen == -1) { return 1; }

  if (ctx->cfg.debugging) {
    fprintf(stderr, "Using device #%d\n", chosen);
  }

  CUDA_SUCCEED(cuDeviceGet(&ctx->dev, chosen));
  return 0;
}

static char *concat_fragments(const char *src_fragments[]) {
  size_t src_len = 0;
  const char **p;

  for (p = src_fragments; *p; p++) {
    src_len += strlen(*p);
  }

  char *src = (char*) malloc(src_len + 1);
  size_t n = 0;
  for (p = src_fragments; *p; p++) {
    strcpy(src + n, *p);
    n += strlen(*p);
  }

  return src;
}

static const char *cuda_nvrtc_get_arch(CUdevice dev) {
  struct {
    int major;
    int minor;
    const char *arch_str;
  } static const x[] = {
    { 3, 0, "compute_30" },
    { 3, 2, "compute_32" },
    { 3, 5, "compute_35" },
    { 3, 7, "compute_37" },
    { 5, 0, "compute_50" },
    { 5, 2, "compute_52" },
    { 5, 3, "compute_53" },
    { 6, 0, "compute_60" },
    { 6, 1, "compute_61" },
    { 6, 2, "compute_62" },
    { 7, 0, "compute_70" },
    { 7, 2, "compute_72" },
    { 7, 5, "compute_75" }
  };

  int major = device_query(dev, COMPUTE_CAPABILITY_MAJOR);
  int minor = device_query(dev, COMPUTE_CAPABILITY_MINOR);

  int chosen = -1;
  for (int i = 0; i < sizeof(x)/sizeof(x[0]); i++) {
    if (x[i].major < major || (x[i].major == major && x[i].minor <= minor)) {
      chosen = i;
    } else {
      break;
    }
  }

  if (chosen == -1) {
    futhark_panic(-1, "Unsupported compute capability %d.%d\n", major, minor);
  }

  if (x[chosen].major != major || x[chosen].minor != minor) {
    fprintf(stderr,
            "Warning: device compute capability is %d.%d, but newest supported by Futhark is %d.%d.\n",
            major, minor, x[chosen].major, x[chosen].minor);
  }

  return x[chosen].arch_str;
}

static char *cuda_nvrtc_build(struct cuda_context *ctx, const char *src,
                              const char *extra_opts[]) {
  nvrtcProgram prog;
  NVRTC_SUCCEED(nvrtcCreateProgram(&prog, src, "futhark-cuda", 0, NULL, NULL));
  int arch_set = 0, num_extra_opts;

  // nvrtc cannot handle multiple -arch options.  Hence, if one of the
  // extra_opts is -arch, we have to be careful not to do our usual
  // automatic generation.
  for (num_extra_opts = 0; extra_opts[num_extra_opts] != NULL; num_extra_opts++) {
    if (strstr(extra_opts[num_extra_opts], "-arch")
        == extra_opts[num_extra_opts] ||
        strstr(extra_opts[num_extra_opts], "--gpu-architecture")
        == extra_opts[num_extra_opts]) {
      arch_set = 1;
    }
  }

  size_t n_opts, i = 0, i_dyn, n_opts_alloc = 20 + num_extra_opts + ctx->cfg.num_sizes;
  const char **opts = (const char**) malloc(n_opts_alloc * sizeof(const char *));
  if (!arch_set) {
    opts[i++] = "-arch";
    opts[i++] = cuda_nvrtc_get_arch(ctx->dev);
  }
  opts[i++] = "-default-device";
  if (ctx->cfg.debugging) {
    opts[i++] = "-G";
    opts[i++] = "-lineinfo";
  } else {
    opts[i++] = "--disable-warnings";
  }
  i_dyn = i;
  for (size_t j = 0; j < ctx->cfg.num_sizes; j++) {
    opts[i++] = msgprintf("-D%s=%zu", ctx->cfg.size_vars[j],
        ctx->cfg.size_values[j]);
  }
  opts[i++] = msgprintf("-DLOCKSTEP_WIDTH=%zu", ctx->lockstep_width);
  opts[i++] = msgprintf("-DMAX_THREADS_PER_BLOCK=%zu", ctx->max_block_size);

  // It is crucial that the extra_opts are last, so that the free()
  // logic below does not cause problems.
  for (int j = 0; extra_opts[j] != NULL; j++) {
    opts[i++] = extra_opts[j];
  }

  n_opts = i;

  if (ctx->cfg.debugging) {
    fprintf(stderr, "NVRTC compile options:\n");
    for (size_t j = 0; j < n_opts; j++) {
      fprintf(stderr, "\t%s\n", opts[j]);
    }
    fprintf(stderr, "\n");
  }

  nvrtcResult res = nvrtcCompileProgram(prog, n_opts, opts);
  if (res != NVRTC_SUCCESS) {
    size_t log_size;
    if (nvrtcGetProgramLogSize(prog, &log_size) == NVRTC_SUCCESS) {
      char *log = (char*) malloc(log_size);
      if (nvrtcGetProgramLog(prog, log) == NVRTC_SUCCESS) {
        fprintf(stderr,"Compilation log:\n%s\n", log);
      }
      free(log);
    }
    NVRTC_SUCCEED(res);
  }

  for (i = i_dyn; i < n_opts-num_extra_opts; i++) { free((char *)opts[i]); }
  free(opts);

  char *ptx;
  size_t ptx_size;
  NVRTC_SUCCEED(nvrtcGetPTXSize(prog, &ptx_size));
  ptx = (char*) malloc(ptx_size);
  NVRTC_SUCCEED(nvrtcGetPTX(prog, ptx));

  NVRTC_SUCCEED(nvrtcDestroyProgram(&prog));

  return ptx;
}

static void cuda_size_setup(struct cuda_context *ctx)
{
  if (ctx->cfg.default_block_size > ctx->max_block_size) {
    if (ctx->cfg.default_block_size_changed) {
      fprintf(stderr,
          "Note: Device limits default block size to %zu (down from %zu).\n",
          ctx->max_block_size, ctx->cfg.default_block_size);
    }
    ctx->cfg.default_block_size = ctx->max_block_size;
  }
  if (ctx->cfg.default_grid_size > ctx->max_grid_size) {
    if (ctx->cfg.default_grid_size_changed) {
      fprintf(stderr,
          "Note: Device limits default grid size to %zu (down from %zu).\n",
          ctx->max_grid_size, ctx->cfg.default_grid_size);
    }
    ctx->cfg.default_grid_size = ctx->max_grid_size;
  }
  if (ctx->cfg.default_tile_size > ctx->max_tile_size) {
    if (ctx->cfg.default_tile_size_changed) {
      fprintf(stderr,
          "Note: Device limits default tile size to %zu (down from %zu).\n",
          ctx->max_tile_size, ctx->cfg.default_tile_size);
    }
    ctx->cfg.default_tile_size = ctx->max_tile_size;
  }

  if (!ctx->cfg.default_grid_size_changed) {
    ctx->cfg.default_grid_size =
      (device_query(ctx->dev, MULTIPROCESSOR_COUNT) *
       device_query(ctx->dev, MAX_THREADS_PER_MULTIPROCESSOR))
      / ctx->cfg.default_block_size;
  }

  for (int i = 0; i < ctx->cfg.num_sizes; i++) {
    const char *size_class, *size_name;
    size_t *size_value, max_value = 0, default_value = 0;

    size_class = ctx->cfg.size_classes[i];
    size_value = &ctx->cfg.size_values[i];
    size_name = ctx->cfg.size_names[i];

    if (strstr(size_class, "group_size") == size_class) {
      max_value = ctx->max_block_size;
      default_value = ctx->cfg.default_block_size;
    } else if (strstr(size_class, "num_groups") == size_class) {
      max_value = ctx->max_grid_size;
      default_value = ctx->cfg.default_grid_size;
      // XXX: as a quick and dirty hack, use twice as many threads for
      // histograms by default.  We really should just be smarter
      // about sizes somehow.
      if (strstr(size_name, ".seghist_") != NULL) {
        default_value *= 2;
      }
    } else if (strstr(size_class, "tile_size") == size_class) {
      max_value = ctx->max_tile_size;
      default_value = ctx->cfg.default_tile_size;
    } else if (strstr(size_class, "threshold") == size_class) {
      // Threshold can be as large as it takes.
      default_value = ctx->cfg.default_threshold;
    } else {
      // Bespoke sizes have no limit or default.
    }

    if (*size_value == 0) {
      *size_value = default_value;
    } else if (max_value > 0 && *size_value > max_value) {
      fprintf(stderr, "Note: Device limits %s to %zu (down from %zu)\n",
              size_name, max_value, *size_value);
      *size_value = max_value;
    }
  }
}

static void cuda_module_setup(struct cuda_context *ctx,
                              const char *src_fragments[],
                              const char *extra_opts[]) {
  char *ptx = NULL, *src = NULL;

  if (ctx->cfg.load_program_from == NULL) {
    src = concat_fragments(src_fragments);
  } else {
    src = slurp_file(ctx->cfg.load_program_from, NULL);
  }

  if (ctx->cfg.load_ptx_from) {
    if (ctx->cfg.load_program_from != NULL) {
      fprintf(stderr,
              "WARNING: Using PTX from %s instead of C code from %s\n",
              ctx->cfg.load_ptx_from, ctx->cfg.load_program_from);
    }
    ptx = slurp_file(ctx->cfg.load_ptx_from, NULL);
  }

  if (ctx->cfg.dump_program_to != NULL) {
    dump_file(ctx->cfg.dump_program_to, src, strlen(src));
  }

  if (ptx == NULL) {
    ptx = cuda_nvrtc_build(ctx, src, extra_opts);
  }

  if (ctx->cfg.dump_ptx_to != NULL) {
    dump_file(ctx->cfg.dump_ptx_to, ptx, strlen(ptx));
  }

  CUDA_SUCCEED(cuModuleLoadData(&ctx->module, ptx));

  free(ptx);
  if (src != NULL) {
    free(src);
  }
}

static void cuda_setup(struct cuda_context *ctx, const char *src_fragments[], const char *extra_opts[]) {
  CUDA_SUCCEED(cuInit(0));

  if (cuda_device_setup(ctx) != 0) {
    futhark_panic(-1, "No suitable CUDA device found.\n");
  }
  CUDA_SUCCEED(cuCtxCreate(&ctx->cu_ctx, 0, ctx->dev));

  free_list_init(&ctx->free_list);

  ctx->max_shared_memory = device_query(ctx->dev, MAX_SHARED_MEMORY_PER_BLOCK);
  ctx->max_block_size = device_query(ctx->dev, MAX_THREADS_PER_BLOCK);
  ctx->max_grid_size = device_query(ctx->dev, MAX_GRID_DIM_X);
  ctx->max_tile_size = sqrt(ctx->max_block_size);
  ctx->max_threshold = 0;
  ctx->max_bespoke = 0;
  ctx->lockstep_width = device_query(ctx->dev, WARP_SIZE);

  cuda_size_setup(ctx);
  cuda_module_setup(ctx, src_fragments, extra_opts);
}

// Count up the runtime all the profiling_records that occured during execution.
// Also clears the buffer of profiling_records.
static cudaError_t cuda_tally_profiling_records(struct cuda_context *ctx) {
  cudaError_t err;
  for (int i = 0; i < ctx->profiling_records_used; i++) {
    struct profiling_record record = ctx->profiling_records[i];

    float ms;
    if ((err = cudaEventElapsedTime(&ms, record.events[0], record.events[1])) != CUDA_SUCCESS) {
      return err;
    }

    // CUDA provides milisecond resolution, but we want microseconds.
    *record.runs += 1;
    *record.runtime += ms*1000;

    if ((err = cudaEventDestroy(record.events[0])) != CUDA_SUCCESS) {
      return err;
    }
    if ((err = cudaEventDestroy(record.events[1])) != CUDA_SUCCESS) {
      return err;
    }

    free(record.events);
  }

  ctx->profiling_records_used = 0;

  return CUDA_SUCCESS;
}

// Returns pointer to two events.
static cudaEvent_t* cuda_get_events(struct cuda_context *ctx, int *runs, int64_t *runtime) {
    if (ctx->profiling_records_used == ctx->profiling_records_capacity) {
      ctx->profiling_records_capacity *= 2;
      ctx->profiling_records =
        realloc(ctx->profiling_records,
                ctx->profiling_records_capacity *
                sizeof(struct profiling_record));
    }
    cudaEvent_t *events = calloc(2, sizeof(cudaEvent_t));
    cudaEventCreate(&events[0]);
    cudaEventCreate(&events[1]);
    ctx->profiling_records[ctx->profiling_records_used].events = events;
    ctx->profiling_records[ctx->profiling_records_used].runs = runs;
    ctx->profiling_records[ctx->profiling_records_used].runtime = runtime;
    ctx->profiling_records_used++;
    return events;
}

static CUresult cuda_free_all(struct cuda_context *ctx);

static void cuda_cleanup(struct cuda_context *ctx) {
  CUDA_SUCCEED(cuda_free_all(ctx));
  (void)cuda_tally_profiling_records(ctx);
  free(ctx->profiling_records);
  CUDA_SUCCEED(cuModuleUnload(ctx->module));
  CUDA_SUCCEED(cuCtxDestroy(ctx->cu_ctx));
}

static CUresult cuda_alloc(struct cuda_context *ctx, size_t min_size,
                           const char *tag, CUdeviceptr *mem_out) {
  if (min_size < sizeof(int)) {
    min_size = sizeof(int);
  }

  size_t size;
  if (free_list_find(&ctx->free_list, min_size, &size, mem_out) == 0) {
    if (size >= min_size) {
      return CUDA_SUCCESS;
    } else {
      CUresult res = cuMemFree(*mem_out);
      if (res != CUDA_SUCCESS) {
        return res;
      }
    }
  }

  CUresult res = cuMemAlloc(mem_out, min_size);
  while (res == CUDA_ERROR_OUT_OF_MEMORY) {
    CUdeviceptr mem;
    if (free_list_first(&ctx->free_list, &mem) == 0) {
      res = cuMemFree(mem);
      if (res != CUDA_SUCCESS) {
        return res;
      }
    } else {
      break;
    }
    res = cuMemAlloc(mem_out, min_size);
  }

  return res;
}

static CUresult cuda_free(struct cuda_context *ctx, CUdeviceptr mem,
                          const char *tag) {
  size_t size;
  CUdeviceptr existing_mem;

  // If there is already a block with this tag, then remove it.
  if (free_list_find(&ctx->free_list, -1, &size, &existing_mem) == 0) {
    CUresult res = cuMemFree(existing_mem);
    if (res != CUDA_SUCCESS) {
      return res;
    }
  }

  CUresult res = cuMemGetAddressRange(NULL, &size, mem);
  if (res == CUDA_SUCCESS) {
    free_list_insert(&ctx->free_list, size, mem, tag);
  }

  return res;
}

static CUresult cuda_free_all(struct cuda_context *ctx) {
  CUdeviceptr mem;
  free_list_pack(&ctx->free_list);
  while (free_list_first(&ctx->free_list, &mem) == 0) {
    CUresult res = cuMemFree(mem);
    if (res != CUDA_SUCCESS) {
      return res;
    }
  }

  return CUDA_SUCCESS;
}

// End of cuda.h.

const char *cuda_program[] =
           {"#define FUTHARK_CUDA\ntypedef char int8_t;\ntypedef short int16_t;\ntypedef int int32_t;\ntypedef long long int64_t;\ntypedef unsigned char uint8_t;\ntypedef unsigned short uint16_t;\ntypedef unsigned int uint32_t;\ntypedef unsigned long long uint64_t;\ntypedef uint8_t uchar;\ntypedef uint16_t ushort;\ntypedef uint32_t uint;\ntypedef uint64_t ulong;\n#define __kernel extern \"C\" __global__ __launch_bounds__(MAX_THREADS_PER_BLOCK)\n#define __global\n#define __local\n#define __private\n#define __constant\n#define __write_only\n#define __read_only\nstatic inline int get_group_id_fn(int block_dim0, int block_dim1,\n                                  int block_dim2, int d)\n{\n    switch (d) {\n        \n      case 0:\n        d = block_dim0;\n        break;\n        \n      case 1:\n        d = block_dim1;\n        break;\n        \n      case 2:\n        d = block_dim2;\n        break;\n    }\n    switch (d) {\n        \n      case 0:\n        return blockIdx.x;\n        \n      case 1:\n        return blockIdx.y;\n        \n      case 2:\n        return blockIdx.z;\n        \n      default:\n        return 0;\n    }\n}\n#define get_group_id(d) get_group_id_fn(block_dim0, block_dim1, block_dim2, d)\nstatic inline int get_num_groups_fn(int block_dim0, int block_dim1,\n                                    int block_dim2, int d)\n{\n    switch (d) {\n        \n      case 0:\n        d = block_dim0;\n        break;\n        \n      case 1:\n        d = block_dim1;\n        break;\n        \n      case 2:\n        d = block_dim2;\n        break;\n    }\n    switch (d) {\n        \n      case 0:\n        return gridDim.x;\n        \n      case 1:\n        return gridDim.y;\n        \n      case 2:\n        return gridDim.z;\n        \n      default:\n        return 0;\n    }\n}\n#define get_num_groups(d) get_num_groups_fn(block_dim0, block_dim1, block_dim2, d)\nstatic inline int get_local_id(int d)\n{\n    switch (d) {\n        \n      case 0:\n        return threadIdx.x;\n        \n      case 1:\n        return threadIdx.y;\n        \n      case 2:\n        return threadI",
            "dx.z;\n        \n      default:\n        return 0;\n    }\n}\nstatic inline int get_local_size(int d)\n{\n    switch (d) {\n        \n      case 0:\n        return blockDim.x;\n        \n      case 1:\n        return blockDim.y;\n        \n      case 2:\n        return blockDim.z;\n        \n      default:\n        return 0;\n    }\n}\nstatic inline int get_global_id_fn(int block_dim0, int block_dim1,\n                                   int block_dim2, int d)\n{\n    return get_group_id(d) * get_local_size(d) + get_local_id(d);\n}\n#define get_global_id(d) get_global_id_fn(block_dim0, block_dim1, block_dim2, d)\nstatic inline int get_global_size(int block_dim0, int block_dim1,\n                                  int block_dim2, int d)\n{\n    return get_num_groups(d) * get_local_size(d);\n}\n#define CLK_LOCAL_MEM_FENCE 1\n#define CLK_GLOBAL_MEM_FENCE 2\nstatic inline void barrier(int x)\n{\n    __syncthreads();\n}\nstatic inline void mem_fence_local()\n{\n    __threadfence_block();\n}\nstatic inline void mem_fence_global()\n{\n    __threadfence();\n}\n#define NAN (0.0/0.0)\n#define INFINITY (1.0/0.0)\nextern volatile __shared__ char shared_mem[];\nstatic inline uint8_t add8(uint8_t x, uint8_t y)\n{\n    return x + y;\n}\nstatic inline uint16_t add16(uint16_t x, uint16_t y)\n{\n    return x + y;\n}\nstatic inline uint32_t add32(uint32_t x, uint32_t y)\n{\n    return x + y;\n}\nstatic inline uint64_t add64(uint64_t x, uint64_t y)\n{\n    return x + y;\n}\nstatic inline uint8_t sub8(uint8_t x, uint8_t y)\n{\n    return x - y;\n}\nstatic inline uint16_t sub16(uint16_t x, uint16_t y)\n{\n    return x - y;\n}\nstatic inline uint32_t sub32(uint32_t x, uint32_t y)\n{\n    return x - y;\n}\nstatic inline uint64_t sub64(uint64_t x, uint64_t y)\n{\n    return x - y;\n}\nstatic inline uint8_t mul8(uint8_t x, uint8_t y)\n{\n    return x * y;\n}\nstatic inline uint16_t mul16(uint16_t x, uint16_t y)\n{\n    return x * y;\n}\nstatic inline uint32_t mul32(uint32_t x, uint32_t y)\n{\n    return x * y;\n}\nstatic inline uint64_t mul64(uint64_t x, uint64_t y)\n{\n    return x * y;\n",
            "}\nstatic inline uint8_t udiv8(uint8_t x, uint8_t y)\n{\n    return x / y;\n}\nstatic inline uint16_t udiv16(uint16_t x, uint16_t y)\n{\n    return x / y;\n}\nstatic inline uint32_t udiv32(uint32_t x, uint32_t y)\n{\n    return x / y;\n}\nstatic inline uint64_t udiv64(uint64_t x, uint64_t y)\n{\n    return x / y;\n}\nstatic inline uint8_t udiv_up8(uint8_t x, uint8_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint16_t udiv_up16(uint16_t x, uint16_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint32_t udiv_up32(uint32_t x, uint32_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint64_t udiv_up64(uint64_t x, uint64_t y)\n{\n    return (x + y - 1) / y;\n}\nstatic inline uint8_t umod8(uint8_t x, uint8_t y)\n{\n    return x % y;\n}\nstatic inline uint16_t umod16(uint16_t x, uint16_t y)\n{\n    return x % y;\n}\nstatic inline uint32_t umod32(uint32_t x, uint32_t y)\n{\n    return x % y;\n}\nstatic inline uint64_t umod64(uint64_t x, uint64_t y)\n{\n    return x % y;\n}\nstatic inline uint8_t udiv_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint16_t udiv_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint32_t udiv_safe32(uint32_t x, uint32_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint64_t udiv_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline uint8_t udiv_up_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint16_t udiv_up_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint32_t udiv_up_safe32(uint32_t x, uint32_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint64_t udiv_up_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : (x + y - 1) / y;\n}\nstatic inline uint8_t umod_safe8(uint8_t x, uint8_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline uint16_t umod_safe16(uint16_t x, uint16_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline uint32_t umod_safe32(uint32_t x, uint32_t y)\n{\n    r",
            "eturn y == 0 ? 0 : x % y;\n}\nstatic inline uint64_t umod_safe64(uint64_t x, uint64_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int8_t sdiv8(int8_t x, int8_t y)\n{\n    int8_t q = x / y;\n    int8_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int16_t sdiv16(int16_t x, int16_t y)\n{\n    int16_t q = x / y;\n    int16_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int32_t sdiv32(int32_t x, int32_t y)\n{\n    int32_t q = x / y;\n    int32_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int64_t sdiv64(int64_t x, int64_t y)\n{\n    int64_t q = x / y;\n    int64_t r = x % y;\n    \n    return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\nstatic inline int8_t sdiv_up8(int8_t x, int8_t y)\n{\n    return sdiv8(x + y - 1, y);\n}\nstatic inline int16_t sdiv_up16(int16_t x, int16_t y)\n{\n    return sdiv16(x + y - 1, y);\n}\nstatic inline int32_t sdiv_up32(int32_t x, int32_t y)\n{\n    return sdiv32(x + y - 1, y);\n}\nstatic inline int64_t sdiv_up64(int64_t x, int64_t y)\n{\n    return sdiv64(x + y - 1, y);\n}\nstatic inline int8_t smod8(int8_t x, int8_t y)\n{\n    int8_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int16_t smod16(int16_t x, int16_t y)\n{\n    int16_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int32_t smod32(int32_t x, int32_t y)\n{\n    int32_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int64_t smod64(int64_t x, int64_t y)\n{\n    int64_t r = x % y;\n    \n    return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\nstatic inline int8_t sdiv_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : sdiv8(x, y);\n}\nstatic inline int16_t sdiv_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : sdiv16(x, y);\n}\nstatic inline int32_t sdiv_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0",
            " : sdiv32(x, y);\n}\nstatic inline int64_t sdiv_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : sdiv64(x, y);\n}\nstatic inline int8_t sdiv_up_safe8(int8_t x, int8_t y)\n{\n    return sdiv_safe8(x + y - 1, y);\n}\nstatic inline int16_t sdiv_up_safe16(int16_t x, int16_t y)\n{\n    return sdiv_safe16(x + y - 1, y);\n}\nstatic inline int32_t sdiv_up_safe32(int32_t x, int32_t y)\n{\n    return sdiv_safe32(x + y - 1, y);\n}\nstatic inline int64_t sdiv_up_safe64(int64_t x, int64_t y)\n{\n    return sdiv_safe64(x + y - 1, y);\n}\nstatic inline int8_t smod_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : smod8(x, y);\n}\nstatic inline int16_t smod_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : smod16(x, y);\n}\nstatic inline int32_t smod_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : smod32(x, y);\n}\nstatic inline int64_t smod_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : smod64(x, y);\n}\nstatic inline int8_t squot8(int8_t x, int8_t y)\n{\n    return x / y;\n}\nstatic inline int16_t squot16(int16_t x, int16_t y)\n{\n    return x / y;\n}\nstatic inline int32_t squot32(int32_t x, int32_t y)\n{\n    return x / y;\n}\nstatic inline int64_t squot64(int64_t x, int64_t y)\n{\n    return x / y;\n}\nstatic inline int8_t srem8(int8_t x, int8_t y)\n{\n    return x % y;\n}\nstatic inline int16_t srem16(int16_t x, int16_t y)\n{\n    return x % y;\n}\nstatic inline int32_t srem32(int32_t x, int32_t y)\n{\n    return x % y;\n}\nstatic inline int64_t srem64(int64_t x, int64_t y)\n{\n    return x % y;\n}\nstatic inline int8_t squot_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int16_t squot_safe16(int16_t x, int16_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int32_t squot_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int64_t squot_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : x / y;\n}\nstatic inline int8_t srem_safe8(int8_t x, int8_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int16_t srem_safe16(int16_t x, int16_t y)\n{\n    retu",
            "rn y == 0 ? 0 : x % y;\n}\nstatic inline int32_t srem_safe32(int32_t x, int32_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int64_t srem_safe64(int64_t x, int64_t y)\n{\n    return y == 0 ? 0 : x % y;\n}\nstatic inline int8_t smin8(int8_t x, int8_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int16_t smin16(int16_t x, int16_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int32_t smin32(int32_t x, int32_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int64_t smin64(int64_t x, int64_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint8_t umin8(uint8_t x, uint8_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint16_t umin16(uint16_t x, uint16_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint32_t umin32(uint32_t x, uint32_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline uint64_t umin64(uint64_t x, uint64_t y)\n{\n    return x < y ? x : y;\n}\nstatic inline int8_t smax8(int8_t x, int8_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int16_t smax16(int16_t x, int16_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int32_t smax32(int32_t x, int32_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline int64_t smax64(int64_t x, int64_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint8_t umax8(uint8_t x, uint8_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint16_t umax16(uint16_t x, uint16_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint32_t umax32(uint32_t x, uint32_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint64_t umax64(uint64_t x, uint64_t y)\n{\n    return x < y ? y : x;\n}\nstatic inline uint8_t shl8(uint8_t x, uint8_t y)\n{\n    return x << y;\n}\nstatic inline uint16_t shl16(uint16_t x, uint16_t y)\n{\n    return x << y;\n}\nstatic inline uint32_t shl32(uint32_t x, uint32_t y)\n{\n    return x << y;\n}\nstatic inline uint64_t shl64(uint64_t x, uint64_t y)\n{\n    return x << y;\n}\nstatic inline uint8_t lshr8(uint8_t x, uint8_t y)\n{\n    return x >> y;\n}\nstatic inline uint16_t lshr16(uint16_t x, uint16_t y)\n{\n    return x >> y;\n}\nstatic inline uint32_t lshr32(uint32_t ",
            "x, uint32_t y)\n{\n    return x >> y;\n}\nstatic inline uint64_t lshr64(uint64_t x, uint64_t y)\n{\n    return x >> y;\n}\nstatic inline int8_t ashr8(int8_t x, int8_t y)\n{\n    return x >> y;\n}\nstatic inline int16_t ashr16(int16_t x, int16_t y)\n{\n    return x >> y;\n}\nstatic inline int32_t ashr32(int32_t x, int32_t y)\n{\n    return x >> y;\n}\nstatic inline int64_t ashr64(int64_t x, int64_t y)\n{\n    return x >> y;\n}\nstatic inline uint8_t and8(uint8_t x, uint8_t y)\n{\n    return x & y;\n}\nstatic inline uint16_t and16(uint16_t x, uint16_t y)\n{\n    return x & y;\n}\nstatic inline uint32_t and32(uint32_t x, uint32_t y)\n{\n    return x & y;\n}\nstatic inline uint64_t and64(uint64_t x, uint64_t y)\n{\n    return x & y;\n}\nstatic inline uint8_t or8(uint8_t x, uint8_t y)\n{\n    return x | y;\n}\nstatic inline uint16_t or16(uint16_t x, uint16_t y)\n{\n    return x | y;\n}\nstatic inline uint32_t or32(uint32_t x, uint32_t y)\n{\n    return x | y;\n}\nstatic inline uint64_t or64(uint64_t x, uint64_t y)\n{\n    return x | y;\n}\nstatic inline uint8_t xor8(uint8_t x, uint8_t y)\n{\n    return x ^ y;\n}\nstatic inline uint16_t xor16(uint16_t x, uint16_t y)\n{\n    return x ^ y;\n}\nstatic inline uint32_t xor32(uint32_t x, uint32_t y)\n{\n    return x ^ y;\n}\nstatic inline uint64_t xor64(uint64_t x, uint64_t y)\n{\n    return x ^ y;\n}\nstatic inline bool ult8(uint8_t x, uint8_t y)\n{\n    return x < y;\n}\nstatic inline bool ult16(uint16_t x, uint16_t y)\n{\n    return x < y;\n}\nstatic inline bool ult32(uint32_t x, uint32_t y)\n{\n    return x < y;\n}\nstatic inline bool ult64(uint64_t x, uint64_t y)\n{\n    return x < y;\n}\nstatic inline bool ule8(uint8_t x, uint8_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule16(uint16_t x, uint16_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule32(uint32_t x, uint32_t y)\n{\n    return x <= y;\n}\nstatic inline bool ule64(uint64_t x, uint64_t y)\n{\n    return x <= y;\n}\nstatic inline bool slt8(int8_t x, int8_t y)\n{\n    return x < y;\n}\nstatic inline bool slt16(int16_t x, int16_t y)\n{\n    return x < y;\n}\nstatic i",
            "nline bool slt32(int32_t x, int32_t y)\n{\n    return x < y;\n}\nstatic inline bool slt64(int64_t x, int64_t y)\n{\n    return x < y;\n}\nstatic inline bool sle8(int8_t x, int8_t y)\n{\n    return x <= y;\n}\nstatic inline bool sle16(int16_t x, int16_t y)\n{\n    return x <= y;\n}\nstatic inline bool sle32(int32_t x, int32_t y)\n{\n    return x <= y;\n}\nstatic inline bool sle64(int64_t x, int64_t y)\n{\n    return x <= y;\n}\nstatic inline int8_t pow8(int8_t x, int8_t y)\n{\n    int8_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int16_t pow16(int16_t x, int16_t y)\n{\n    int16_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int32_t pow32(int32_t x, int32_t y)\n{\n    int32_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline int64_t pow64(int64_t x, int64_t y)\n{\n    int64_t res = 1, rem = y;\n    \n    while (rem != 0) {\n        if (rem & 1)\n            res *= x;\n        rem >>= 1;\n        x *= x;\n    }\n    return res;\n}\nstatic inline bool itob_i8_bool(int8_t x)\n{\n    return x;\n}\nstatic inline bool itob_i16_bool(int16_t x)\n{\n    return x;\n}\nstatic inline bool itob_i32_bool(int32_t x)\n{\n    return x;\n}\nstatic inline bool itob_i64_bool(int64_t x)\n{\n    return x;\n}\nstatic inline int8_t btoi_bool_i8(bool x)\n{\n    return x;\n}\nstatic inline int16_t btoi_bool_i16(bool x)\n{\n    return x;\n}\nstatic inline int32_t btoi_bool_i32(bool x)\n{\n    return x;\n}\nstatic inline int64_t btoi_bool_i64(bool x)\n{\n    return x;\n}\n#define sext_i8_i8(x) ((int8_t) (int8_t) x)\n#define sext_i8_i16(x) ((int16_t) (int8_t) x)\n#define sext_i8_i32(x) ((int32_t) (int8_t) x)\n#define sext_i8_i64(x) ((int64_t) (int8_t) x)\n#define sext_i16_i8(x) ((int8_t) (int16_t) x)\n#define sext_i16_i16(x) ((int1",
            "6_t) (int16_t) x)\n#define sext_i16_i32(x) ((int32_t) (int16_t) x)\n#define sext_i16_i64(x) ((int64_t) (int16_t) x)\n#define sext_i32_i8(x) ((int8_t) (int32_t) x)\n#define sext_i32_i16(x) ((int16_t) (int32_t) x)\n#define sext_i32_i32(x) ((int32_t) (int32_t) x)\n#define sext_i32_i64(x) ((int64_t) (int32_t) x)\n#define sext_i64_i8(x) ((int8_t) (int64_t) x)\n#define sext_i64_i16(x) ((int16_t) (int64_t) x)\n#define sext_i64_i32(x) ((int32_t) (int64_t) x)\n#define sext_i64_i64(x) ((int64_t) (int64_t) x)\n#define zext_i8_i8(x) ((int8_t) (uint8_t) x)\n#define zext_i8_i16(x) ((int16_t) (uint8_t) x)\n#define zext_i8_i32(x) ((int32_t) (uint8_t) x)\n#define zext_i8_i64(x) ((int64_t) (uint8_t) x)\n#define zext_i16_i8(x) ((int8_t) (uint16_t) x)\n#define zext_i16_i16(x) ((int16_t) (uint16_t) x)\n#define zext_i16_i32(x) ((int32_t) (uint16_t) x)\n#define zext_i16_i64(x) ((int64_t) (uint16_t) x)\n#define zext_i32_i8(x) ((int8_t) (uint32_t) x)\n#define zext_i32_i16(x) ((int16_t) (uint32_t) x)\n#define zext_i32_i32(x) ((int32_t) (uint32_t) x)\n#define zext_i32_i64(x) ((int64_t) (uint32_t) x)\n#define zext_i64_i8(x) ((int8_t) (uint64_t) x)\n#define zext_i64_i16(x) ((int16_t) (uint64_t) x)\n#define zext_i64_i32(x) ((int32_t) (uint64_t) x)\n#define zext_i64_i64(x) ((int64_t) (uint64_t) x)\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_popc8(int8_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    return popcount(x);\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    return popcount(x);\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_popc8(int8_t x)\n{\n    return __popc(zext_i8_i32(x));\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    return __popc(zext_i16_i32(x));\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    return __popc(x);\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    return __popcll(x);\n}\n#else\nstatic int32_t futrts_popc8(int8_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return ",
            "c;\n}\nstatic int32_t futrts_popc16(int16_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\nstatic int32_t futrts_popc32(int32_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\nstatic int32_t futrts_popc64(int64_t x)\n{\n    int c = 0;\n    \n    for (; x; ++c)\n        x &= x - 1;\n    return c;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    return mul_hi(a, b);\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    return mul_hi(a, b);\n}\n#elif defined(__CUDA_ARCH__)\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    uint16_t aa = a;\n    uint16_t bb = b;\n    \n    return aa * bb >> 8;\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    uint32_t aa = a;\n    uint32_t bb = b;\n    \n    return aa * bb >> 16;\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    return mulhi(a, b);\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    return mul64hi(a, b);\n}\n#else\nstatic uint8_t futrts_mul_hi8(uint8_t a, uint8_t b)\n{\n    uint16_t aa = a;\n    uint16_t bb = b;\n    \n    return aa * bb >> 8;\n}\nstatic uint16_t futrts_mul_hi16(uint16_t a, uint16_t b)\n{\n    uint32_t aa = a;\n    uint32_t bb = b;\n    \n    return aa * bb >> 16;\n}\nstatic uint32_t futrts_mul_hi32(uint32_t a, uint32_t b)\n{\n    uint64_t aa = a;\n    uint64_t bb = b;\n    \n    return aa * bb >> 32;\n}\nstatic uint64_t futrts_mul_hi64(uint64_t a, uint64_t b)\n{\n    __uint128_t aa = a;\n    __uint128_t bb = b;\n    \n    return aa * bb >> 64;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint32_t futrts_mad_hi32(uint",
            "32_t a, uint32_t b, uint32_t c)\n{\n    return mad_hi(a, b, c);\n}\nstatic uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)\n{\n    return mad_hi(a, b, c);\n}\n#else\nstatic uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c)\n{\n    return futrts_mul_hi8(a, b) + c;\n}\nstatic uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c)\n{\n    return futrts_mul_hi16(a, b) + c;\n}\nstatic uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c)\n{\n    return futrts_mul_hi32(a, b) + c;\n}\nstatic uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c)\n{\n    return futrts_mul_hi64(a, b) + c;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    return clz(x);\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    return clz(x);\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    return __clz(zext_i8_i32(x)) - 24;\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    return __clz(zext_i16_i32(x)) - 16;\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    return __clz(x);\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    return __clzll(x);\n}\n#else\nstatic int32_t futrts_clzz8(int8_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz16(int16_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz32(int32_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\nstatic int32_t futrts_clzz64(int64_t x)\n{\n    int n = 0;\n    int bits = sizeof(x) * 8;\n    \n    for (int i = 0; i < bits",
            "; i++) {\n        if (x < 0)\n            break;\n        n++;\n        x <<= 1;\n    }\n    return n;\n}\n#endif\n#if defined(__OPENCL_VERSION__)\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    int i = 0;\n    \n    for (; i < 8 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz16(int16_t x)\n{\n    int i = 0;\n    \n    for (; i < 16 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    int i = 0;\n    \n    for (; i < 32 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    int i = 0;\n    \n    for (; i < 64 && (x & 1) == 0; i++, x >>= 1)\n        ;\n    return i;\n}\n#elif defined(__CUDA_ARCH__)\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 8 : y - 1;\n}\nstatic int32_t futrts_ctzz16(int16_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 16 : y - 1;\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    int y = __ffs(x);\n    \n    return y == 0 ? 32 : y - 1;\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    int y = __ffsll(x);\n    \n    return y == 0 ? 64 : y - 1;\n}\n#else\nstatic int32_t futrts_ctzz8(int8_t x)\n{\n    return x == 0 ? 8 : __builtin_ctz((uint32_t) x);\n}\nstatic int32_t futrts_ctzz16(int16_t x)\n{\n    return x == 0 ? 16 : __builtin_ctz((uint32_t) x);\n}\nstatic int32_t futrts_ctzz32(int32_t x)\n{\n    return x == 0 ? 32 : __builtin_ctz(x);\n}\nstatic int32_t futrts_ctzz64(int64_t x)\n{\n    return x == 0 ? 64 : __builtin_ctzl(x);\n}\n#endif\nstatic inline float fdiv32(float x, float y)\n{\n    return x / y;\n}\nstatic inline float fadd32(float x, float y)\n{\n    return x + y;\n}\nstatic inline float fsub32(float x, float y)\n{\n    return x - y;\n}\nstatic inline float fmul32(float x, float y)\n{\n    return x * y;\n}\nstatic inline float fmin32(float x, float y)\n{\n    return fmin(x, y);\n}\nstatic inline float fmax32(float x, float y)\n{\n    return fmax(x, y);\n}\nstatic inline float fpow32(float x, float y)\n{\n    return pow(x, y);\n}\nstatic inline",
            " bool cmplt32(float x, float y)\n{\n    return x < y;\n}\nstatic inline bool cmple32(float x, float y)\n{\n    return x <= y;\n}\nstatic inline float sitofp_i8_f32(int8_t x)\n{\n    return (float) x;\n}\nstatic inline float sitofp_i16_f32(int16_t x)\n{\n    return (float) x;\n}\nstatic inline float sitofp_i32_f32(int32_t x)\n{\n    return (float) x;\n}\nstatic inline float sitofp_i64_f32(int64_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i8_f32(uint8_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i16_f32(uint16_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i32_f32(uint32_t x)\n{\n    return (float) x;\n}\nstatic inline float uitofp_i64_f32(uint64_t x)\n{\n    return (float) x;\n}\nstatic inline int8_t fptosi_f32_i8(float x)\n{\n    return (int8_t) x;\n}\nstatic inline int16_t fptosi_f32_i16(float x)\n{\n    return (int16_t) x;\n}\nstatic inline int32_t fptosi_f32_i32(float x)\n{\n    return (int32_t) x;\n}\nstatic inline int64_t fptosi_f32_i64(float x)\n{\n    return (int64_t) x;\n}\nstatic inline uint8_t fptoui_f32_i8(float x)\n{\n    return (uint8_t) x;\n}\nstatic inline uint16_t fptoui_f32_i16(float x)\n{\n    return (uint16_t) x;\n}\nstatic inline uint32_t fptoui_f32_i32(float x)\n{\n    return (uint32_t) x;\n}\nstatic inline uint64_t fptoui_f32_i64(float x)\n{\n    return (uint64_t) x;\n}\nstatic inline float futrts_log32(float x)\n{\n    return log(x);\n}\nstatic inline float futrts_log2_32(float x)\n{\n    return log2(x);\n}\nstatic inline float futrts_log10_32(float x)\n{\n    return log10(x);\n}\nstatic inline float futrts_sqrt32(float x)\n{\n    return sqrt(x);\n}\nstatic inline float futrts_exp32(float x)\n{\n    return exp(x);\n}\nstatic inline float futrts_cos32(float x)\n{\n    return cos(x);\n}\nstatic inline float futrts_sin32(float x)\n{\n    return sin(x);\n}\nstatic inline float futrts_tan32(float x)\n{\n    return tan(x);\n}\nstatic inline float futrts_acos32(float x)\n{\n    return acos(x);\n}\nstatic inline float futrts_asin32(float x)\n{\n    return asin(x);\n}\nstatic inline float futrts_atan32(float x)\n{",
            "\n    return atan(x);\n}\nstatic inline float futrts_cosh32(float x)\n{\n    return cosh(x);\n}\nstatic inline float futrts_sinh32(float x)\n{\n    return sinh(x);\n}\nstatic inline float futrts_tanh32(float x)\n{\n    return tanh(x);\n}\nstatic inline float futrts_acosh32(float x)\n{\n    return acosh(x);\n}\nstatic inline float futrts_asinh32(float x)\n{\n    return asinh(x);\n}\nstatic inline float futrts_atanh32(float x)\n{\n    return atanh(x);\n}\nstatic inline float futrts_atan2_32(float x, float y)\n{\n    return atan2(x, y);\n}\nstatic inline float futrts_gamma32(float x)\n{\n    return tgamma(x);\n}\nstatic inline float futrts_lgamma32(float x)\n{\n    return lgamma(x);\n}\nstatic inline bool futrts_isnan32(float x)\n{\n    return isnan(x);\n}\nstatic inline bool futrts_isinf32(float x)\n{\n    return isinf(x);\n}\nstatic inline int32_t futrts_to_bits32(float x)\n{\n    union {\n        float f;\n        int32_t t;\n    } p;\n    \n    p.f = x;\n    return p.t;\n}\nstatic inline float futrts_from_bits32(int32_t x)\n{\n    union {\n        int32_t f;\n        float t;\n    } p;\n    \n    p.f = x;\n    return p.t;\n}\n#ifdef __OPENCL_VERSION__\nstatic inline float fmod32(float x, float y)\n{\n    return fmod(x, y);\n}\nstatic inline float futrts_round32(float x)\n{\n    return rint(x);\n}\nstatic inline float futrts_floor32(float x)\n{\n    return floor(x);\n}\nstatic inline float futrts_ceil32(float x)\n{\n    return ceil(x);\n}\nstatic inline float futrts_lerp32(float v0, float v1, float t)\n{\n    return mix(v0, v1, t);\n}\nstatic inline float futrts_mad32(float a, float b, float c)\n{\n    return mad(a, b, c);\n}\nstatic inline float futrts_fma32(float a, float b, float c)\n{\n    return fma(a, b, c);\n}\n#else\nstatic inline float fmod32(float x, float y)\n{\n    return fmodf(x, y);\n}\nstatic inline float futrts_round32(float x)\n{\n    return rintf(x);\n}\nstatic inline float futrts_floor32(float x)\n{\n    return floorf(x);\n}\nstatic inline float futrts_ceil32(float x)\n{\n    return ceilf(x);\n}\nstatic inline float futrts_lerp32(float v0, float v1, float t)",
            "\n{\n    return v0 + (v1 - v0) * t;\n}\nstatic inline float futrts_mad32(float a, float b, float c)\n{\n    return a * b + c;\n}\nstatic inline float futrts_fma32(float a, float b, float c)\n{\n    return fmaf(a, b, c);\n}\n#endif\nstatic inline double fdiv64(double x, double y)\n{\n    return x / y;\n}\nstatic inline double fadd64(double x, double y)\n{\n    return x + y;\n}\nstatic inline double fsub64(double x, double y)\n{\n    return x - y;\n}\nstatic inline double fmul64(double x, double y)\n{\n    return x * y;\n}\nstatic inline double fmin64(double x, double y)\n{\n    return fmin(x, y);\n}\nstatic inline double fmax64(double x, double y)\n{\n    return fmax(x, y);\n}\nstatic inline double fpow64(double x, double y)\n{\n    return pow(x, y);\n}\nstatic inline bool cmplt64(double x, double y)\n{\n    return x < y;\n}\nstatic inline bool cmple64(double x, double y)\n{\n    return x <= y;\n}\nstatic inline double sitofp_i8_f64(int8_t x)\n{\n    return (double) x;\n}\nstatic inline double sitofp_i16_f64(int16_t x)\n{\n    return (double) x;\n}\nstatic inline double sitofp_i32_f64(int32_t x)\n{\n    return (double) x;\n}\nstatic inline double sitofp_i64_f64(int64_t x)\n{\n    return (double) x;\n}\nstatic inline double uitofp_i8_f64(uint8_t x)\n{\n    return (double) x;\n}\nstatic inline double uitofp_i16_f64(uint16_t x)\n{\n    return (double) x;\n}\nstatic inline double uitofp_i32_f64(uint32_t x)\n{\n    return (double) x;\n}\nstatic inline double uitofp_i64_f64(uint64_t x)\n{\n    return (double) x;\n}\nstatic inline int8_t fptosi_f64_i8(double x)\n{\n    return (int8_t) x;\n}\nstatic inline int16_t fptosi_f64_i16(double x)\n{\n    return (int16_t) x;\n}\nstatic inline int32_t fptosi_f64_i32(double x)\n{\n    return (int32_t) x;\n}\nstatic inline int64_t fptosi_f64_i64(double x)\n{\n    return (int64_t) x;\n}\nstatic inline uint8_t fptoui_f64_i8(double x)\n{\n    return (uint8_t) x;\n}\nstatic inline uint16_t fptoui_f64_i16(double x)\n{\n    return (uint16_t) x;\n}\nstatic inline uint32_t fptoui_f64_i32(double x)\n{\n    return (uint32_t) x;\n}\nstatic inline uint64_",
            "t fptoui_f64_i64(double x)\n{\n    return (uint64_t) x;\n}\nstatic inline double futrts_log64(double x)\n{\n    return log(x);\n}\nstatic inline double futrts_log2_64(double x)\n{\n    return log2(x);\n}\nstatic inline double futrts_log10_64(double x)\n{\n    return log10(x);\n}\nstatic inline double futrts_sqrt64(double x)\n{\n    return sqrt(x);\n}\nstatic inline double futrts_exp64(double x)\n{\n    return exp(x);\n}\nstatic inline double futrts_cos64(double x)\n{\n    return cos(x);\n}\nstatic inline double futrts_sin64(double x)\n{\n    return sin(x);\n}\nstatic inline double futrts_tan64(double x)\n{\n    return tan(x);\n}\nstatic inline double futrts_acos64(double x)\n{\n    return acos(x);\n}\nstatic inline double futrts_asin64(double x)\n{\n    return asin(x);\n}\nstatic inline double futrts_atan64(double x)\n{\n    return atan(x);\n}\nstatic inline double futrts_cosh64(double x)\n{\n    return cosh(x);\n}\nstatic inline double futrts_sinh64(double x)\n{\n    return sinh(x);\n}\nstatic inline double futrts_tanh64(double x)\n{\n    return tanh(x);\n}\nstatic inline double futrts_acosh64(double x)\n{\n    return acosh(x);\n}\nstatic inline double futrts_asinh64(double x)\n{\n    return asinh(x);\n}\nstatic inline double futrts_atanh64(double x)\n{\n    return atanh(x);\n}\nstatic inline double futrts_atan2_64(double x, double y)\n{\n    return atan2(x, y);\n}\nstatic inline double futrts_gamma64(double x)\n{\n    return tgamma(x);\n}\nstatic inline double futrts_lgamma64(double x)\n{\n    return lgamma(x);\n}\nstatic inline double futrts_fma64(double a, double b, double c)\n{\n    return fma(a, b, c);\n}\nstatic inline double futrts_round64(double x)\n{\n    return rint(x);\n}\nstatic inline double futrts_ceil64(double x)\n{\n    return ceil(x);\n}\nstatic inline double futrts_floor64(double x)\n{\n    return floor(x);\n}\nstatic inline bool futrts_isnan64(double x)\n{\n    return isnan(x);\n}\nstatic inline bool futrts_isinf64(double x)\n{\n    return isinf(x);\n}\nstatic inline int64_t futrts_to_bits64(double x)\n{\n    union {\n        double f;\n        int64_t t;\n",
            "    } p;\n    \n    p.f = x;\n    return p.t;\n}\nstatic inline double futrts_from_bits64(int64_t x)\n{\n    union {\n        int64_t f;\n        double t;\n    } p;\n    \n    p.f = x;\n    return p.t;\n}\nstatic inline double fmod64(double x, double y)\n{\n    return fmod(x, y);\n}\n#ifdef __OPENCL_VERSION__\nstatic inline double futrts_lerp64(double v0, double v1, double t)\n{\n    return mix(v0, v1, t);\n}\nstatic inline double futrts_mad64(double a, double b, double c)\n{\n    return mad(a, b, c);\n}\n#else\nstatic inline double futrts_lerp64(double v0, double v1, double t)\n{\n    return v0 + (v1 - v0) * t;\n}\nstatic inline double futrts_mad64(double a, double b, double c)\n{\n    return a * b + c;\n}\n#endif\nstatic inline float fpconv_f32_f32(float x)\n{\n    return (float) x;\n}\nstatic inline double fpconv_f32_f64(float x)\n{\n    return (double) x;\n}\nstatic inline float fpconv_f64_f32(double x)\n{\n    return (float) x;\n}\nstatic inline double fpconv_f64_f64(double x)\n{\n    return (double) x;\n}\n// Start of atomics.h\n\ninline int32_t atomic_add_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((int32_t*)p, x);\n#else\n  return atomic_add(p, x);\n#endif\n}\n\ninline int32_t atomic_add_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((int32_t*)p, x);\n#else\n  return atomic_add(p, x);\n#endif\n}\n\ninline float atomic_fadd_f32_global(volatile __global float *p, float x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((float*)p, x);\n#else\n  union { int32_t i; float f; } old;\n  union { int32_t i; float f; } assumed;\n  old.f = *p;\n  do {\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg((volatile __global int32_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\ninline float atomic_fadd_f32_local(volatile __local float *p, float x) {\n#ifdef FUTHARK_CUDA\n  return atomicAdd((float*)p, x);\n#else\n  union { int32_t i; float f; } old;\n  union { int32_t i; float f; } assumed;\n  old.f = *p;\n  do {",
            "\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg((volatile __local int32_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\ninline int32_t atomic_smax_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline int32_t atomic_smax_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline int32_t atomic_smin_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline int32_t atomic_smin_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline uint32_t atomic_umax_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline uint32_t atomic_umax_i32_local(volatile __local uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\ninline uint32_t atomic_umin_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline uint32_t atomic_umin_i32_local(volatile __local uint32_t *p, uint32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\ninline int32_t atomic_and_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\ninline int32_t atomic_and_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\ninline int32_t ",
            "atomic_or_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\ninline int32_t atomic_or_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\ninline int32_t atomic_xor_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xor_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xchg_i32_global(volatile __global int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_xchg_i32_local(volatile __local int32_t *p, int32_t x) {\n#ifdef FUTHARK_CUDA\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\ninline int32_t atomic_cmpxchg_i32_global(volatile __global int32_t *p,\n                                         int32_t cmp, int32_t val) {\n#ifdef FUTHARK_CUDA\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\ninline int32_t atomic_cmpxchg_i32_local(volatile __local int32_t *p,\n                                         int32_t cmp, int32_t val) {\n#ifdef FUTHARK_CUDA\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\n// End of atomics.h\n\n\n\n\n__kernel void buildKDtreezireplicate_40593(int32_t nodes_this_lvl_32221,\n                                           int32_t pts_per_node_at_lev_32225,\n                                           __global unsigned char *mem_39556,\n                                           __global unsigned char *mem_39561)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t re",
            "plicate_gtid_40593;\n    int32_t replicate_ltid_40594;\n    int32_t replicate_gid_40595;\n    \n    replicate_gtid_40593 = get_global_id(0);\n    replicate_ltid_40594 = get_local_id(0);\n    replicate_gid_40595 = get_group_id(0);\n    if (slt64(replicate_gtid_40593, sext_i32_i64(nodes_this_lvl_32221) *\n              sext_i32_i64(pts_per_node_at_lev_32225))) {\n        ((__global\n          int32_t *) mem_39561)[sext_i32_i64(squot32(replicate_gtid_40593,\n                                                     pts_per_node_at_lev_32225)) *\n                                sext_i32_i64(pts_per_node_at_lev_32225) +\n                                sext_i32_i64(replicate_gtid_40593 -\n                                squot32(replicate_gtid_40593,\n                                        pts_per_node_at_lev_32225) *\n                                pts_per_node_at_lev_32225)] = ((__global\n                                                                int32_t *) mem_39556)[sext_i32_i64(replicate_gtid_40593 -\n                                                                                      squot32(replicate_gtid_40593,\n                                                                                              pts_per_node_at_lev_32225) *\n                                                                                      pts_per_node_at_lev_32225)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void buildKDtreeziscan_stage1_37746(__global int *global_failure,\n                                             uint scan_arr_mem_40721_backing_offset_0,\n                                             uint scan_arr_mem_40719_backing_offset_1,\n                                             uint scan_arr_mem_40717_backing_offset_2,\n                                             uint scan_arr_mem_40715_backing_offset_3,\n                                             int32_t nodes_this_lvl_32221,\n                                             int32_t pts_per_node_at_lev_32225,\n                                ",
            "             int32_t lifted_2_radix_sort_step_arg_38052,\n                                             int32_t lifted_0_get_bit_arg_38053,\n                                             unsigned char res_38054,\n                                             unsigned char res_38055, __global\n                                             unsigned char *mem_param_39843,\n                                             __global unsigned char *mem_39905,\n                                             __global unsigned char *mem_39910,\n                                             __global unsigned char *mem_39915,\n                                             __global unsigned char *mem_39920,\n                                             __global unsigned char *mem_39925,\n                                             int32_t num_threads_40709)\n{\n    #define segscan_group_sizze_38155 (buildKDtreezisegscan_group_sizze_37740)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *scan_arr_mem_40721_backing_3 =\n                  &shared_mem[scan_arr_mem_40721_backing_offset_0];\n    volatile char *scan_arr_mem_40719_backing_2 =\n                  &shared_mem[scan_arr_mem_40719_backing_offset_1];\n    volatile char *scan_arr_mem_40717_backing_1 =\n                  &shared_mem[scan_arr_mem_40717_backing_offset_2];\n    volatile char *scan_arr_mem_40715_backing_0 =\n                  &shared_mem[scan_arr_mem_40715_backing_offset_3];\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40710;\n    int32_t local_tid_40711;\n    int32_t group_sizze_40714;\n    int32_t wave_sizze_40713;\n    int32_t group_tid_40712;\n    \n    global_tid_40710 = get_global_id(0);\n    local_tid_40711 = get_local_id(0);\n    group_sizze_40714 = get_local_size(0);\n    wave_sizze_40713 = LOCKSTEP_WIDTH;\n    group_tid_40712 = get_group_id(0);\n    \n    int32_t phys_tid_37746;\n    \n    phys_tid_37746 = global_tid_40710;\n    \n    __local char *scan_",
            "arr_mem_40715;\n    __local char *scan_arr_mem_40717;\n    __local char *scan_arr_mem_40719;\n    __local char *scan_arr_mem_40721;\n    \n    scan_arr_mem_40715 = (__local char *) scan_arr_mem_40715_backing_0;\n    scan_arr_mem_40717 = (__local char *) scan_arr_mem_40717_backing_1;\n    scan_arr_mem_40719 = (__local char *) scan_arr_mem_40719_backing_2;\n    scan_arr_mem_40721 = (__local char *) scan_arr_mem_40721_backing_3;\n    \n    int32_t x_38163;\n    int32_t x_38164;\n    int32_t x_38165;\n    int32_t x_38166;\n    int32_t x_38167;\n    int32_t x_38168;\n    int32_t x_38169;\n    int32_t x_38170;\n    \n    x_38163 = 0;\n    x_38164 = 0;\n    x_38165 = 0;\n    x_38166 = 0;\n    for (int32_t j_40723 = 0; j_40723 < sdiv_up32(nodes_this_lvl_32221 *\n                                                  pts_per_node_at_lev_32225,\n                                                  num_threads_40709);\n         j_40723++) {\n        int32_t chunk_offset_40724 = segscan_group_sizze_38155 * j_40723 +\n                group_tid_40712 * (segscan_group_sizze_38155 *\n                                   sdiv_up32(nodes_this_lvl_32221 *\n                                             pts_per_node_at_lev_32225,\n                                             num_threads_40709));\n        int32_t flat_idx_40725 = chunk_offset_40724 + local_tid_40711;\n        int32_t gtid_37735 = squot32(flat_idx_40725, pts_per_node_at_lev_32225);\n        int32_t gtid_37745 = flat_idx_40725 - squot32(flat_idx_40725,\n                                                      pts_per_node_at_lev_32225) *\n                pts_per_node_at_lev_32225;\n        \n        // threads in bounds read input\n        {\n            if (slt32(gtid_37735, nodes_this_lvl_32221) && slt32(gtid_37745,\n                                                                 pts_per_node_at_lev_32225)) {\n                float x_38176 = ((__global\n                                  float *) mem_param_39843)[sext_i32_i64(gtid_37735) *\n                                     ",
            "                       sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                            sext_i32_i64(gtid_37745)];\n                int32_t i32_arg_38177;\n                \n                i32_arg_38177 = futrts_to_bits32(x_38176);\n                \n                int32_t unsign_arg_38178 = ashr32(i32_arg_38177,\n                                                  lifted_0_get_bit_arg_38053);\n                int32_t unsign_arg_38179 = 1 & unsign_arg_38178;\n                int32_t unsign_arg_38180 = ashr32(i32_arg_38177, 31);\n                int32_t unsign_arg_38181 = 1 & unsign_arg_38180;\n                bool cond_38182 = unsign_arg_38181 == 1;\n                bool x_38183 = !cond_38182;\n                bool y_38184 = res_38054 && x_38183;\n                bool cond_38185 = cond_38182 || y_38184;\n                int32_t res_38186;\n                \n                if (cond_38185) {\n                    int32_t res_38187 = 1 ^ unsign_arg_38179;\n                    \n                    res_38186 = res_38187;\n                } else {\n                    res_38186 = unsign_arg_38179;\n                }\n                \n                int32_t x_38188 = mul32(2, res_38186);\n                int32_t unsign_arg_38189 = ashr32(i32_arg_38177,\n                                                  lifted_2_radix_sort_step_arg_38052);\n                int32_t unsign_arg_38190 = 1 & unsign_arg_38189;\n                bool y_38191 = res_38055 && x_38183;\n                bool cond_38192 = cond_38182 || y_38191;\n                int32_t res_38193;\n                \n                if (cond_38192) {\n                    int32_t res_38194 = 1 ^ unsign_arg_38190;\n                    \n                    res_38193 = res_38194;\n                } else {\n                    res_38193 = unsign_arg_38190;\n                }\n                \n                int32_t res_38195 = add32(x_38188, res_38193);\n                bool cond_38196 = res_38195 == 0;\n                int32_",
            "t res_38197 = btoi_bool_i32(cond_38196);\n                int32_t res_38198;\n                int32_t res_38199;\n                int32_t res_38200;\n                \n                if (cond_38196) {\n                    res_38198 = 0;\n                    res_38199 = 0;\n                    res_38200 = 0;\n                } else {\n                    bool cond_38201 = res_38195 == 1;\n                    int32_t res_38202 = btoi_bool_i32(cond_38201);\n                    int32_t res_38203;\n                    int32_t res_38204;\n                    \n                    if (cond_38201) {\n                        res_38203 = 0;\n                        res_38204 = 0;\n                    } else {\n                        bool cond_38205 = res_38195 == 2;\n                        int32_t res_38206 = btoi_bool_i32(cond_38205);\n                        bool cond_neg_38207 = !cond_38205;\n                        int32_t res_38208 = btoi_bool_i32(cond_neg_38207);\n                        \n                        res_38203 = res_38206;\n                        res_38204 = res_38208;\n                    }\n                    res_38198 = res_38202;\n                    res_38199 = res_38203;\n                    res_38200 = res_38204;\n                }\n                // write to-scan values to parameters\n                {\n                    x_38167 = res_38197;\n                    x_38168 = res_38198;\n                    x_38169 = res_38199;\n                    x_38170 = res_38200;\n                }\n                // write mapped values results to global memory\n                {\n                    ((__global int32_t *) mem_39925)[sext_i32_i64(gtid_37735) *\n                                                     sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                     sext_i32_i64(gtid_37745)] =\n                        res_38195;\n                }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some",
            " to-scan values to parameters, or read neutral\n            {\n                if (!(slt32(gtid_37735, nodes_this_lvl_32221) &&\n                      slt32(gtid_37745, pts_per_node_at_lev_32225))) {\n                    x_38167 = 0;\n                    x_38168 = 0;\n                    x_38169 = 0;\n                    x_38170 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                int32_t res_38171 = add32(x_38163, x_38167);\n                int32_t res_38172 = add32(x_38164, x_38168);\n                int32_t res_38173 = add32(x_38165, x_38169);\n                int32_t res_38174 = add32(x_38166, x_38170);\n                \n                ((__local\n                  int32_t *) scan_arr_mem_40715)[sext_i32_i64(local_tid_40711)] =\n                    res_38171;\n                ((__local\n                  int32_t *) scan_arr_mem_40717)[sext_i32_i64(local_tid_40711)] =\n                    res_38172;\n                ((__local\n                  int32_t *) scan_arr_mem_40719)[sext_i32_i64(local_tid_40711)] =\n                    res_38173;\n                ((__local\n                  int32_t *) scan_arr_mem_40721)[sext_i32_i64(local_tid_40711)] =\n                    res_38174;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int32_t x_40726;\n            int32_t x_40727;\n            int32_t x_40728;\n            int32_t x_40729;\n            int32_t x_40730;\n            int32_t x_40731;\n            int32_t x_40732;\n            int32_t x_40733;\n            int32_t x_40738;\n            int32_t x_40739;\n            int32_t x_40740;\n            int32_t x_40741;\n            int32_t x_40742;\n            int32_t x_40743;\n            int32_t x_40744;\n            int32_t x_40745;\n            int32_t skip_threads_40750;\n            \n            // read input for in-block scan\n            {\n                if (slt32(local_tid_40711, segscan_group_sizze_38155)) {\n                    x_40730 = (",
            "(volatile __local\n                                int32_t *) scan_arr_mem_40715)[sext_i32_i64(local_tid_40711)];\n                    x_40731 = ((volatile __local\n                                int32_t *) scan_arr_mem_40717)[sext_i32_i64(local_tid_40711)];\n                    x_40732 = ((volatile __local\n                                int32_t *) scan_arr_mem_40719)[sext_i32_i64(local_tid_40711)];\n                    x_40733 = ((volatile __local\n                                int32_t *) scan_arr_mem_40721)[sext_i32_i64(local_tid_40711)];\n                    if ((local_tid_40711 - squot32(local_tid_40711, 32) * 32) ==\n                        0) {\n                        x_40726 = x_40730;\n                        x_40727 = x_40731;\n                        x_40728 = x_40732;\n                        x_40729 = x_40733;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_40750 = 1;\n                while (slt32(skip_threads_40750, 32)) {\n                    if (sle32(skip_threads_40750, local_tid_40711 -\n                              squot32(local_tid_40711, 32) * 32) &&\n                        slt32(local_tid_40711, segscan_group_sizze_38155)) {\n                        // read operands\n                        {\n                            x_40726 = ((volatile __local\n                                        int32_t *) scan_arr_mem_40715)[sext_i32_i64(local_tid_40711 -\n                                                                       skip_threads_40750)];\n                            x_40727 = ((volatile __local\n                                        int32_t *) scan_arr_mem_40717)[sext_i32_i64(local_tid_40711 -\n                                                                       skip_threads_40750)];\n                            x_40728 = ((volatile __local\n                                        int32_t *) scan_arr_mem_40719)[sext_i32_i64(local_tid_40711 -\n      ",
            "                                                                 skip_threads_40750)];\n                            x_40729 = ((volatile __local\n                                        int32_t *) scan_arr_mem_40721)[sext_i32_i64(local_tid_40711 -\n                                                                       skip_threads_40750)];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_40751 = slt32(srem32(local_tid_40711 +\n                                                               chunk_offset_40724,\n                                                               pts_per_node_at_lev_32225),\n                                                        local_tid_40711 +\n                                                        chunk_offset_40724 -\n                                                        (local_tid_40711 -\n                                                         skip_threads_40750 +\n                                                         chunk_offset_40724));\n                            \n                            if (inactive_40751) {\n                                x_40726 = x_40730;\n                                x_40727 = x_40731;\n                                x_40728 = x_40732;\n                                x_40729 = x_40733;\n                            }\n                            if (!inactive_40751) {\n                                int32_t res_40734 = add32(x_40726, x_40730);\n                                int32_t res_40735 = add32(x_40727, x_40731);\n                                int32_t res_40736 = add32(x_40728, x_40732);\n                                int32_t res_40737 = add32(x_40729, x_40733);\n                                \n                                x_40726 = res_40734;\n                                x_40727 = res_40735;\n                                x_40728 = res_40736;\n                                x_40729 = res_40737;\n         ",
            "                   }\n                        }\n                    }\n                    if (sle32(wave_sizze_40713, skip_threads_40750)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_40750, local_tid_40711 -\n                              squot32(local_tid_40711, 32) * 32) &&\n                        slt32(local_tid_40711, segscan_group_sizze_38155)) {\n                        // write result\n                        {\n                            ((volatile __local\n                              int32_t *) scan_arr_mem_40715)[sext_i32_i64(local_tid_40711)] =\n                                x_40726;\n                            x_40730 = x_40726;\n                            ((volatile __local\n                              int32_t *) scan_arr_mem_40717)[sext_i32_i64(local_tid_40711)] =\n                                x_40727;\n                            x_40731 = x_40727;\n                            ((volatile __local\n                              int32_t *) scan_arr_mem_40719)[sext_i32_i64(local_tid_40711)] =\n                                x_40728;\n                            x_40732 = x_40728;\n                            ((volatile __local\n                              int32_t *) scan_arr_mem_40721)[sext_i32_i64(local_tid_40711)] =\n                                x_40729;\n                            x_40733 = x_40729;\n                        }\n                    }\n                    if (sle32(wave_sizze_40713, skip_threads_40750)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_40750 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_40711 - squot32(local_tid_40711, 32) * 32) ==\n                    31 && slt32(local_tid_40711, segscan_group_sizze_38155)) {\n                    ((volatile __",
            "local\n                      int32_t *) scan_arr_mem_40715)[sext_i32_i64(squot32(local_tid_40711,\n                                                                          32))] =\n                        x_40726;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40717)[sext_i32_i64(squot32(local_tid_40711,\n                                                                          32))] =\n                        x_40727;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40719)[sext_i32_i64(squot32(local_tid_40711,\n                                                                          32))] =\n                        x_40728;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40721)[sext_i32_i64(squot32(local_tid_40711,\n                                                                          32))] =\n                        x_40729;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_40752;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_40711, 32) == 0 &&\n                        slt32(local_tid_40711, segscan_group_sizze_38155)) {\n                        x_40742 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40715)[sext_i32_i64(local_tid_40711)];\n                        x_40743 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40717)[sext_i32_i64(local_tid_40711)];\n                        x_40744 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40719)[sext_i32_i64(local_tid_40711)];\n                        x_40745 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40721)[sext_i32_i64(local_tid_40711)]",
            ";\n                        if ((local_tid_40711 - squot32(local_tid_40711, 32) *\n                             32) == 0) {\n                            x_40738 = x_40742;\n                            x_40739 = x_40743;\n                            x_40740 = x_40744;\n                            x_40741 = x_40745;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_40752 = 1;\n                    while (slt32(skip_threads_40752, 32)) {\n                        if (sle32(skip_threads_40752, local_tid_40711 -\n                                  squot32(local_tid_40711, 32) * 32) &&\n                            (squot32(local_tid_40711, 32) == 0 &&\n                             slt32(local_tid_40711,\n                                   segscan_group_sizze_38155))) {\n                            // read operands\n                            {\n                                x_40738 = ((volatile __local\n                                            int32_t *) scan_arr_mem_40715)[sext_i32_i64(local_tid_40711 -\n                                                                           skip_threads_40752)];\n                                x_40739 = ((volatile __local\n                                            int32_t *) scan_arr_mem_40717)[sext_i32_i64(local_tid_40711 -\n                                                                           skip_threads_40752)];\n                                x_40740 = ((volatile __local\n                                            int32_t *) scan_arr_mem_40719)[sext_i32_i64(local_tid_40711 -\n                                                                           skip_threads_40752)];\n                                x_40741 = ((volatile __local\n                                            int32_t *) scan_arr_mem_40721)[sext_i32_i64(local_tid_40711 -\n                                                                           sk",
            "ip_threads_40752)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_40753 =\n                                     slt32(srem32(local_tid_40711 * 32 + 32 -\n                                                  1 + chunk_offset_40724,\n                                                  pts_per_node_at_lev_32225),\n                                           local_tid_40711 * 32 + 32 - 1 +\n                                           chunk_offset_40724 -\n                                           ((local_tid_40711 -\n                                             skip_threads_40752) * 32 + 32 - 1 +\n                                            chunk_offset_40724));\n                                \n                                if (inactive_40753) {\n                                    x_40738 = x_40742;\n                                    x_40739 = x_40743;\n                                    x_40740 = x_40744;\n                                    x_40741 = x_40745;\n                                }\n                                if (!inactive_40753) {\n                                    int32_t res_40746 = add32(x_40738, x_40742);\n                                    int32_t res_40747 = add32(x_40739, x_40743);\n                                    int32_t res_40748 = add32(x_40740, x_40744);\n                                    int32_t res_40749 = add32(x_40741, x_40745);\n                                    \n                                    x_40738 = res_40746;\n                                    x_40739 = res_40747;\n                                    x_40740 = res_40748;\n                                    x_40741 = res_40749;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_40713, skip_threads_40752)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n    ",
            "                    if (sle32(skip_threads_40752, local_tid_40711 -\n                                  squot32(local_tid_40711, 32) * 32) &&\n                            (squot32(local_tid_40711, 32) == 0 &&\n                             slt32(local_tid_40711,\n                                   segscan_group_sizze_38155))) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int32_t *) scan_arr_mem_40715)[sext_i32_i64(local_tid_40711)] =\n                                    x_40738;\n                                x_40742 = x_40738;\n                                ((volatile __local\n                                  int32_t *) scan_arr_mem_40717)[sext_i32_i64(local_tid_40711)] =\n                                    x_40739;\n                                x_40743 = x_40739;\n                                ((volatile __local\n                                  int32_t *) scan_arr_mem_40719)[sext_i32_i64(local_tid_40711)] =\n                                    x_40740;\n                                x_40744 = x_40740;\n                                ((volatile __local\n                                  int32_t *) scan_arr_mem_40721)[sext_i32_i64(local_tid_40711)] =\n                                    x_40741;\n                                x_40745 = x_40741;\n                            }\n                        }\n                        if (sle32(wave_sizze_40713, skip_threads_40752)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_40752 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_40711, 32) == 0 ||\n                      !slt32(local_tid_40711, segscan_group_sizze_38155))) {\n                    // read operands\n                  ",
            "  {\n                        x_40730 = x_40726;\n                        x_40731 = x_40727;\n                        x_40732 = x_40728;\n                        x_40733 = x_40729;\n                        x_40726 = ((__local\n                                    int32_t *) scan_arr_mem_40715)[sext_i32_i64(squot32(local_tid_40711,\n                                                                                        32) -\n                                                                   1)];\n                        x_40727 = ((__local\n                                    int32_t *) scan_arr_mem_40717)[sext_i32_i64(squot32(local_tid_40711,\n                                                                                        32) -\n                                                                   1)];\n                        x_40728 = ((__local\n                                    int32_t *) scan_arr_mem_40719)[sext_i32_i64(squot32(local_tid_40711,\n                                                                                        32) -\n                                                                   1)];\n                        x_40729 = ((__local\n                                    int32_t *) scan_arr_mem_40721)[sext_i32_i64(squot32(local_tid_40711,\n                                                                                        32) -\n                                                                   1)];\n                    }\n                    // perform operation\n                    {\n                        bool inactive_40754 = slt32(srem32(local_tid_40711 +\n                                                           chunk_offset_40724,\n                                                           pts_per_node_at_lev_32225),\n                                                    local_tid_40711 +\n                                                    chunk_offset_40724 -\n                                                    (squot32(local_tid_40711,\n               ",
            "                                              32) * 32 - 1 +\n                                                     chunk_offset_40724));\n                        \n                        if (inactive_40754) {\n                            x_40726 = x_40730;\n                            x_40727 = x_40731;\n                            x_40728 = x_40732;\n                            x_40729 = x_40733;\n                        }\n                        if (!inactive_40754) {\n                            int32_t res_40734 = add32(x_40726, x_40730);\n                            int32_t res_40735 = add32(x_40727, x_40731);\n                            int32_t res_40736 = add32(x_40728, x_40732);\n                            int32_t res_40737 = add32(x_40729, x_40733);\n                            \n                            x_40726 = res_40734;\n                            x_40727 = res_40735;\n                            x_40728 = res_40736;\n                            x_40729 = res_40737;\n                        }\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          int32_t *) scan_arr_mem_40715)[sext_i32_i64(local_tid_40711)] =\n                            x_40726;\n                        ((__local\n                          int32_t *) scan_arr_mem_40717)[sext_i32_i64(local_tid_40711)] =\n                            x_40727;\n                        ((__local\n                          int32_t *) scan_arr_mem_40719)[sext_i32_i64(local_tid_40711)] =\n                            x_40728;\n                        ((__local\n                          int32_t *) scan_arr_mem_40721)[sext_i32_i64(local_tid_40711)] =\n                            x_40729;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_40711, 32) == 0) {\n                    ((__local\n        ",
            "              int32_t *) scan_arr_mem_40715)[sext_i32_i64(local_tid_40711)] =\n                        x_40730;\n                    ((__local\n                      int32_t *) scan_arr_mem_40717)[sext_i32_i64(local_tid_40711)] =\n                        x_40731;\n                    ((__local\n                      int32_t *) scan_arr_mem_40719)[sext_i32_i64(local_tid_40711)] =\n                        x_40732;\n                    ((__local\n                      int32_t *) scan_arr_mem_40721)[sext_i32_i64(local_tid_40711)] =\n                        x_40733;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt32(gtid_37735, nodes_this_lvl_32221) && slt32(gtid_37745,\n                                                                     pts_per_node_at_lev_32225)) {\n                    ((__global int32_t *) mem_39905)[sext_i32_i64(gtid_37735) *\n                                                     sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                     sext_i32_i64(gtid_37745)] =\n                        ((__local\n                          int32_t *) scan_arr_mem_40715)[sext_i32_i64(local_tid_40711)];\n                    ((__global int32_t *) mem_39910)[sext_i32_i64(gtid_37735) *\n                                                     sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                     sext_i32_i64(gtid_37745)] =\n                        ((__local\n                          int32_t *) scan_arr_mem_40717)[sext_i32_i64(local_tid_40711)];\n                    ((__global int32_t *) mem_39915)[sext_i32_i64(gtid_37735) *\n                                                     sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                     sext_i32_i64(gtid_37745)] =\n                        ((__local\n                          int32_t *) scan_arr_mem_40719)[sext_i32_i",
            "64(local_tid_40711)];\n                    ((__global int32_t *) mem_39920)[sext_i32_i64(gtid_37735) *\n                                                     sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                     sext_i32_i64(gtid_37745)] =\n                        ((__local\n                          int32_t *) scan_arr_mem_40721)[sext_i32_i64(local_tid_40711)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_40755 = slt32(srem32(chunk_offset_40724 +\n                                                          segscan_group_sizze_38155,\n                                                          pts_per_node_at_lev_32225),\n                                                   chunk_offset_40724 +\n                                                   segscan_group_sizze_38155 -\n                                                   (chunk_offset_40724 +\n                                                    segscan_group_sizze_38155 -\n                                                    1));\n                bool should_load_carry_40756 = local_tid_40711 == 0 &&\n                     !crosses_segment_40755;\n                \n                if (should_load_carry_40756) {\n                    x_38163 = ((__local\n                                int32_t *) scan_arr_mem_40715)[sext_i32_i64(segscan_group_sizze_38155 -\n                                                               1)];\n                    x_38164 = ((__local\n                                int32_t *) scan_arr_mem_40717)[sext_i32_i64(segscan_group_sizze_38155 -\n                                                               1)];\n                    x_38165 = ((__local\n                                int32_t *) scan_arr_mem_40719)[sext_i32_i64(segscan_group_sizze_38155 -\n                                                               1)];\n      ",
            "              x_38166 = ((__local\n                                int32_t *) scan_arr_mem_40721)[sext_i32_i64(segscan_group_sizze_38155 -\n                                                               1)];\n                }\n                if (!should_load_carry_40756) {\n                    x_38163 = 0;\n                    x_38164 = 0;\n                    x_38165 = 0;\n                    x_38166 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_38155\n}\n__kernel void buildKDtreeziscan_stage2_37746(__global int *global_failure,\n                                             uint scan_arr_mem_40768_backing_offset_0,\n                                             uint scan_arr_mem_40766_backing_offset_1,\n                                             uint scan_arr_mem_40764_backing_offset_2,\n                                             uint scan_arr_mem_40762_backing_offset_3,\n                                             int32_t nodes_this_lvl_32221,\n                                             int32_t pts_per_node_at_lev_32225,\n                                             __global unsigned char *mem_39905,\n                                             __global unsigned char *mem_39910,\n                                             __global unsigned char *mem_39915,\n                                             __global unsigned char *mem_39920,\n                                             int32_t stage1_num_groups_40708,\n                                             int32_t num_threads_40709)\n{\n    #define segscan_group_sizze_38155 (buildKDtreezisegscan_group_sizze_37740)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *scan_arr_mem_40768_backing_3 =\n                  &shared_mem[scan_arr_mem_40768_backing_offset_0];\n    volatile char *scan_arr_mem_40766_backing_2 =\n                  &shared_mem[scan_arr_mem_4076",
            "6_backing_offset_1];\n    volatile char *scan_arr_mem_40764_backing_1 =\n                  &shared_mem[scan_arr_mem_40764_backing_offset_2];\n    volatile char *scan_arr_mem_40762_backing_0 =\n                  &shared_mem[scan_arr_mem_40762_backing_offset_3];\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40757;\n    int32_t local_tid_40758;\n    int32_t group_sizze_40761;\n    int32_t wave_sizze_40760;\n    int32_t group_tid_40759;\n    \n    global_tid_40757 = get_global_id(0);\n    local_tid_40758 = get_local_id(0);\n    group_sizze_40761 = get_local_size(0);\n    wave_sizze_40760 = LOCKSTEP_WIDTH;\n    group_tid_40759 = get_group_id(0);\n    \n    int32_t phys_tid_37746;\n    \n    phys_tid_37746 = global_tid_40757;\n    \n    __local char *scan_arr_mem_40762;\n    __local char *scan_arr_mem_40764;\n    __local char *scan_arr_mem_40766;\n    __local char *scan_arr_mem_40768;\n    \n    scan_arr_mem_40762 = (__local char *) scan_arr_mem_40762_backing_0;\n    scan_arr_mem_40764 = (__local char *) scan_arr_mem_40764_backing_1;\n    scan_arr_mem_40766 = (__local char *) scan_arr_mem_40766_backing_2;\n    scan_arr_mem_40768 = (__local char *) scan_arr_mem_40768_backing_3;\n    \n    int32_t flat_idx_40770;\n    \n    flat_idx_40770 = (local_tid_40758 + 1) * (segscan_group_sizze_38155 *\n                                              sdiv_up32(nodes_this_lvl_32221 *\n                                                        pts_per_node_at_lev_32225,\n                                                        num_threads_40709)) - 1;\n    \n    int32_t gtid_37735;\n    \n    gtid_37735 = squot32(flat_idx_40770, pts_per_node_at_lev_32225);\n    \n    int32_t gtid_37745;\n    \n    gtid_37745 = flat_idx_40770 - squot32(flat_idx_40770,\n                                          pts_per_node_at_lev_32225) *\n        pts_per_node_at_lev_32225;\n    // threads in bound read carries; others get neutral element\n    {\n        if (slt32(gtid_37735, nodes_this_lvl_32221) && slt32(gtid_37745,\n     ",
            "                                                        pts_per_node_at_lev_32225)) {\n            ((__local\n              int32_t *) scan_arr_mem_40762)[sext_i32_i64(local_tid_40758)] =\n                ((__global int32_t *) mem_39905)[sext_i32_i64(gtid_37735) *\n                                                 sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                 sext_i32_i64(gtid_37745)];\n            ((__local\n              int32_t *) scan_arr_mem_40764)[sext_i32_i64(local_tid_40758)] =\n                ((__global int32_t *) mem_39910)[sext_i32_i64(gtid_37735) *\n                                                 sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                 sext_i32_i64(gtid_37745)];\n            ((__local\n              int32_t *) scan_arr_mem_40766)[sext_i32_i64(local_tid_40758)] =\n                ((__global int32_t *) mem_39915)[sext_i32_i64(gtid_37735) *\n                                                 sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                 sext_i32_i64(gtid_37745)];\n            ((__local\n              int32_t *) scan_arr_mem_40768)[sext_i32_i64(local_tid_40758)] =\n                ((__global int32_t *) mem_39920)[sext_i32_i64(gtid_37735) *\n                                                 sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                 sext_i32_i64(gtid_37745)];\n        } else {\n            ((__local\n              int32_t *) scan_arr_mem_40762)[sext_i32_i64(local_tid_40758)] = 0;\n            ((__local\n              int32_t *) scan_arr_mem_40764)[sext_i32_i64(local_tid_40758)] = 0;\n            ((__local\n              int32_t *) scan_arr_mem_40766)[sext_i32_i64(local_tid_40758)] = 0;\n            ((__local\n              int32_t *) scan_arr_mem_40768)[sext_i32_i64(local_tid_40758)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t x_38163;\n    int32_t x_38164;\n    int32_t x_38",
            "165;\n    int32_t x_38166;\n    int32_t x_38167;\n    int32_t x_38168;\n    int32_t x_38169;\n    int32_t x_38170;\n    int32_t x_40771;\n    int32_t x_40772;\n    int32_t x_40773;\n    int32_t x_40774;\n    int32_t x_40775;\n    int32_t x_40776;\n    int32_t x_40777;\n    int32_t x_40778;\n    int32_t skip_threads_40783;\n    \n    // read input for in-block scan\n    {\n        if (slt32(local_tid_40758, stage1_num_groups_40708)) {\n            x_38167 = ((volatile __local\n                        int32_t *) scan_arr_mem_40762)[sext_i32_i64(local_tid_40758)];\n            x_38168 = ((volatile __local\n                        int32_t *) scan_arr_mem_40764)[sext_i32_i64(local_tid_40758)];\n            x_38169 = ((volatile __local\n                        int32_t *) scan_arr_mem_40766)[sext_i32_i64(local_tid_40758)];\n            x_38170 = ((volatile __local\n                        int32_t *) scan_arr_mem_40768)[sext_i32_i64(local_tid_40758)];\n            if ((local_tid_40758 - squot32(local_tid_40758, 32) * 32) == 0) {\n                x_38163 = x_38167;\n                x_38164 = x_38168;\n                x_38165 = x_38169;\n                x_38166 = x_38170;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_40783 = 1;\n        while (slt32(skip_threads_40783, 32)) {\n            if (sle32(skip_threads_40783, local_tid_40758 -\n                      squot32(local_tid_40758, 32) * 32) &&\n                slt32(local_tid_40758, stage1_num_groups_40708)) {\n                // read operands\n                {\n                    x_38163 = ((volatile __local\n                                int32_t *) scan_arr_mem_40762)[sext_i32_i64(local_tid_40758 -\n                                                               skip_threads_40783)];\n                    x_38164 = ((volatile __local\n                                int32_t *) scan_arr_mem_40764)[sext_i32_i64(local_tid_40758 -\n                                                               skip_threa",
            "ds_40783)];\n                    x_38165 = ((volatile __local\n                                int32_t *) scan_arr_mem_40766)[sext_i32_i64(local_tid_40758 -\n                                                               skip_threads_40783)];\n                    x_38166 = ((volatile __local\n                                int32_t *) scan_arr_mem_40768)[sext_i32_i64(local_tid_40758 -\n                                                               skip_threads_40783)];\n                }\n                // perform operation\n                {\n                    bool inactive_40784 = slt32(srem32((local_tid_40758 + 1) *\n                                                       (segscan_group_sizze_38155 *\n                                                        sdiv_up32(nodes_this_lvl_32221 *\n                                                                  pts_per_node_at_lev_32225,\n                                                                  num_threads_40709)) -\n                                                       1,\n                                                       pts_per_node_at_lev_32225),\n                                                (local_tid_40758 + 1) *\n                                                (segscan_group_sizze_38155 *\n                                                 sdiv_up32(nodes_this_lvl_32221 *\n                                                           pts_per_node_at_lev_32225,\n                                                           num_threads_40709)) -\n                                                1 - ((local_tid_40758 -\n                                                      skip_threads_40783 + 1) *\n                                                     (segscan_group_sizze_38155 *\n                                                      sdiv_up32(nodes_this_lvl_32221 *\n                                                                pts_per_node_at_lev_32225,\n                                                                num_threads",
            "_40709)) -\n                                                     1));\n                    \n                    if (inactive_40784) {\n                        x_38163 = x_38167;\n                        x_38164 = x_38168;\n                        x_38165 = x_38169;\n                        x_38166 = x_38170;\n                    }\n                    if (!inactive_40784) {\n                        int32_t res_38171 = add32(x_38163, x_38167);\n                        int32_t res_38172 = add32(x_38164, x_38168);\n                        int32_t res_38173 = add32(x_38165, x_38169);\n                        int32_t res_38174 = add32(x_38166, x_38170);\n                        \n                        x_38163 = res_38171;\n                        x_38164 = res_38172;\n                        x_38165 = res_38173;\n                        x_38166 = res_38174;\n                    }\n                }\n            }\n            if (sle32(wave_sizze_40760, skip_threads_40783)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_40783, local_tid_40758 -\n                      squot32(local_tid_40758, 32) * 32) &&\n                slt32(local_tid_40758, stage1_num_groups_40708)) {\n                // write result\n                {\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40762)[sext_i32_i64(local_tid_40758)] =\n                        x_38163;\n                    x_38167 = x_38163;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40764)[sext_i32_i64(local_tid_40758)] =\n                        x_38164;\n                    x_38168 = x_38164;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40766)[sext_i32_i64(local_tid_40758)] =\n                        x_38165;\n                    x_38169 = x_38165;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40768)[sext_i32_i64(local_tid_40758)] =\n                    ",
            "    x_38166;\n                    x_38170 = x_38166;\n                }\n            }\n            if (sle32(wave_sizze_40760, skip_threads_40783)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_40783 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_40758 - squot32(local_tid_40758, 32) * 32) == 31 &&\n            slt32(local_tid_40758, stage1_num_groups_40708)) {\n            ((volatile __local\n              int32_t *) scan_arr_mem_40762)[sext_i32_i64(squot32(local_tid_40758,\n                                                                  32))] =\n                x_38163;\n            ((volatile __local\n              int32_t *) scan_arr_mem_40764)[sext_i32_i64(squot32(local_tid_40758,\n                                                                  32))] =\n                x_38164;\n            ((volatile __local\n              int32_t *) scan_arr_mem_40766)[sext_i32_i64(squot32(local_tid_40758,\n                                                                  32))] =\n                x_38165;\n            ((volatile __local\n              int32_t *) scan_arr_mem_40768)[sext_i32_i64(squot32(local_tid_40758,\n                                                                  32))] =\n                x_38166;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_40785;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_40758, 32) == 0 && slt32(local_tid_40758,\n                                                           stage1_num_groups_40708)) {\n                x_40775 = ((volatile __local\n                            int32_t *) scan_arr_mem_40762)[sext_i32_i64(local_tid_40758)];\n                x_40776 = ((volatile __local\n                            int32_t *) scan_arr_mem_40764)[sext_i",
            "32_i64(local_tid_40758)];\n                x_40777 = ((volatile __local\n                            int32_t *) scan_arr_mem_40766)[sext_i32_i64(local_tid_40758)];\n                x_40778 = ((volatile __local\n                            int32_t *) scan_arr_mem_40768)[sext_i32_i64(local_tid_40758)];\n                if ((local_tid_40758 - squot32(local_tid_40758, 32) * 32) ==\n                    0) {\n                    x_40771 = x_40775;\n                    x_40772 = x_40776;\n                    x_40773 = x_40777;\n                    x_40774 = x_40778;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_40785 = 1;\n            while (slt32(skip_threads_40785, 32)) {\n                if (sle32(skip_threads_40785, local_tid_40758 -\n                          squot32(local_tid_40758, 32) * 32) &&\n                    (squot32(local_tid_40758, 32) == 0 && slt32(local_tid_40758,\n                                                                stage1_num_groups_40708))) {\n                    // read operands\n                    {\n                        x_40771 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40762)[sext_i32_i64(local_tid_40758 -\n                                                                   skip_threads_40785)];\n                        x_40772 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40764)[sext_i32_i64(local_tid_40758 -\n                                                                   skip_threads_40785)];\n                        x_40773 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40766)[sext_i32_i64(local_tid_40758 -\n                                                                   skip_threads_40785)];\n                        x_40774 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40768)[sext_i32_i64(local_tid_40758 -\n                ",
            "                                                   skip_threads_40785)];\n                    }\n                    // perform operation\n                    {\n                        bool inactive_40786 = slt32(srem32((local_tid_40758 *\n                                                            32 + 32 - 1 + 1) *\n                                                           (segscan_group_sizze_38155 *\n                                                            sdiv_up32(nodes_this_lvl_32221 *\n                                                                      pts_per_node_at_lev_32225,\n                                                                      num_threads_40709)) -\n                                                           1,\n                                                           pts_per_node_at_lev_32225),\n                                                    (local_tid_40758 * 32 + 32 -\n                                                     1 + 1) *\n                                                    (segscan_group_sizze_38155 *\n                                                     sdiv_up32(nodes_this_lvl_32221 *\n                                                               pts_per_node_at_lev_32225,\n                                                               num_threads_40709)) -\n                                                    1 - (((local_tid_40758 -\n                                                           skip_threads_40785) *\n                                                          32 + 32 - 1 + 1) *\n                                                         (segscan_group_sizze_38155 *\n                                                          sdiv_up32(nodes_this_lvl_32221 *\n                                                                    pts_per_node_at_lev_32225,\n                                                                    num_threads_40709)) -\n                                                         1));\n                      ",
            "  \n                        if (inactive_40786) {\n                            x_40771 = x_40775;\n                            x_40772 = x_40776;\n                            x_40773 = x_40777;\n                            x_40774 = x_40778;\n                        }\n                        if (!inactive_40786) {\n                            int32_t res_40779 = add32(x_40771, x_40775);\n                            int32_t res_40780 = add32(x_40772, x_40776);\n                            int32_t res_40781 = add32(x_40773, x_40777);\n                            int32_t res_40782 = add32(x_40774, x_40778);\n                            \n                            x_40771 = res_40779;\n                            x_40772 = res_40780;\n                            x_40773 = res_40781;\n                            x_40774 = res_40782;\n                        }\n                    }\n                }\n                if (sle32(wave_sizze_40760, skip_threads_40785)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_40785, local_tid_40758 -\n                          squot32(local_tid_40758, 32) * 32) &&\n                    (squot32(local_tid_40758, 32) == 0 && slt32(local_tid_40758,\n                                                                stage1_num_groups_40708))) {\n                    // write result\n                    {\n                        ((volatile __local\n                          int32_t *) scan_arr_mem_40762)[sext_i32_i64(local_tid_40758)] =\n                            x_40771;\n                        x_40775 = x_40771;\n                        ((volatile __local\n                          int32_t *) scan_arr_mem_40764)[sext_i32_i64(local_tid_40758)] =\n                            x_40772;\n                        x_40776 = x_40772;\n                        ((volatile __local\n                          int32_t *) scan_arr_mem_40766)[sext_i32_i64(local_tid_40758)] =\n                            x_40773;\n                ",
            "        x_40777 = x_40773;\n                        ((volatile __local\n                          int32_t *) scan_arr_mem_40768)[sext_i32_i64(local_tid_40758)] =\n                            x_40774;\n                        x_40778 = x_40774;\n                    }\n                }\n                if (sle32(wave_sizze_40760, skip_threads_40785)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_40785 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_40758, 32) == 0 || !slt32(local_tid_40758,\n                                                          stage1_num_groups_40708))) {\n            // read operands\n            {\n                x_38167 = x_38163;\n                x_38168 = x_38164;\n                x_38169 = x_38165;\n                x_38170 = x_38166;\n                x_38163 = ((__local\n                            int32_t *) scan_arr_mem_40762)[sext_i32_i64(squot32(local_tid_40758,\n                                                                                32) -\n                                                           1)];\n                x_38164 = ((__local\n                            int32_t *) scan_arr_mem_40764)[sext_i32_i64(squot32(local_tid_40758,\n                                                                                32) -\n                                                           1)];\n                x_38165 = ((__local\n                            int32_t *) scan_arr_mem_40766)[sext_i32_i64(squot32(local_tid_40758,\n                                                                                32) -\n                                                           1)];\n                x_38166 = ((__local\n                            int32_t *) scan_arr_mem_40768)[sext_i32_i64(squot32(local_tid_40758,\n                                                                                32) -\n            ",
            "                                               1)];\n            }\n            // perform operation\n            {\n                bool inactive_40787 = slt32(srem32((local_tid_40758 + 1) *\n                                                   (segscan_group_sizze_38155 *\n                                                    sdiv_up32(nodes_this_lvl_32221 *\n                                                              pts_per_node_at_lev_32225,\n                                                              num_threads_40709)) -\n                                                   1,\n                                                   pts_per_node_at_lev_32225),\n                                            (local_tid_40758 + 1) *\n                                            (segscan_group_sizze_38155 *\n                                             sdiv_up32(nodes_this_lvl_32221 *\n                                                       pts_per_node_at_lev_32225,\n                                                       num_threads_40709)) - 1 -\n                                            ((squot32(local_tid_40758, 32) *\n                                              32 - 1 + 1) *\n                                             (segscan_group_sizze_38155 *\n                                              sdiv_up32(nodes_this_lvl_32221 *\n                                                        pts_per_node_at_lev_32225,\n                                                        num_threads_40709)) -\n                                             1));\n                \n                if (inactive_40787) {\n                    x_38163 = x_38167;\n                    x_38164 = x_38168;\n                    x_38165 = x_38169;\n                    x_38166 = x_38170;\n                }\n                if (!inactive_40787) {\n                    int32_t res_38171 = add32(x_38163, x_38167);\n                    int32_t res_38172 = add32(x_38164, x_38168);\n                    int32_t res_38173 = add32(x_38165, x_381",
            "69);\n                    int32_t res_38174 = add32(x_38166, x_38170);\n                    \n                    x_38163 = res_38171;\n                    x_38164 = res_38172;\n                    x_38165 = res_38173;\n                    x_38166 = res_38174;\n                }\n            }\n            // write final result\n            {\n                ((__local\n                  int32_t *) scan_arr_mem_40762)[sext_i32_i64(local_tid_40758)] =\n                    x_38163;\n                ((__local\n                  int32_t *) scan_arr_mem_40764)[sext_i32_i64(local_tid_40758)] =\n                    x_38164;\n                ((__local\n                  int32_t *) scan_arr_mem_40766)[sext_i32_i64(local_tid_40758)] =\n                    x_38165;\n                ((__local\n                  int32_t *) scan_arr_mem_40768)[sext_i32_i64(local_tid_40758)] =\n                    x_38166;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_40758, 32) == 0) {\n            ((__local\n              int32_t *) scan_arr_mem_40762)[sext_i32_i64(local_tid_40758)] =\n                x_38167;\n            ((__local\n              int32_t *) scan_arr_mem_40764)[sext_i32_i64(local_tid_40758)] =\n                x_38168;\n            ((__local\n              int32_t *) scan_arr_mem_40766)[sext_i32_i64(local_tid_40758)] =\n                x_38169;\n            ((__local\n              int32_t *) scan_arr_mem_40768)[sext_i32_i64(local_tid_40758)] =\n                x_38170;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt32(gtid_37735, nodes_this_lvl_32221) && slt32(gtid_37745,\n                                                             pts_per_node_at_lev_32225)) {\n            ((__global int32_t *) mem_39905)[sext_i32_i64(gtid_37735) *\n                                             sext_i32_i64(pts_per_node_at_lev_32225) +\n                          ",
            "                   sext_i32_i64(gtid_37745)] =\n                ((__local\n                  int32_t *) scan_arr_mem_40762)[sext_i32_i64(local_tid_40758)];\n            ((__global int32_t *) mem_39910)[sext_i32_i64(gtid_37735) *\n                                             sext_i32_i64(pts_per_node_at_lev_32225) +\n                                             sext_i32_i64(gtid_37745)] =\n                ((__local\n                  int32_t *) scan_arr_mem_40764)[sext_i32_i64(local_tid_40758)];\n            ((__global int32_t *) mem_39915)[sext_i32_i64(gtid_37735) *\n                                             sext_i32_i64(pts_per_node_at_lev_32225) +\n                                             sext_i32_i64(gtid_37745)] =\n                ((__local\n                  int32_t *) scan_arr_mem_40766)[sext_i32_i64(local_tid_40758)];\n            ((__global int32_t *) mem_39920)[sext_i32_i64(gtid_37735) *\n                                             sext_i32_i64(pts_per_node_at_lev_32225) +\n                                             sext_i32_i64(gtid_37745)] =\n                ((__local\n                  int32_t *) scan_arr_mem_40768)[sext_i32_i64(local_tid_40758)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_38155\n}\n__kernel void buildKDtreeziscan_stage3_37746(__global int *global_failure,\n                                             int32_t nodes_this_lvl_32221,\n                                             int32_t pts_per_node_at_lev_32225,\n                                             int32_t num_groups_38156, __global\n                                             unsigned char *mem_39905, __global\n                                             unsigned char *mem_39910, __global\n                                             unsigned char *mem_39915, __global\n                                             unsigned char *mem_39920,\n                                             int32_t num_threads_40709,\n                                             int32_t ",
            "required_groups_40788)\n{\n    #define segscan_group_sizze_38155 (buildKDtreezisegscan_group_sizze_37740)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40789;\n    int32_t local_tid_40790;\n    int32_t group_sizze_40793;\n    int32_t wave_sizze_40792;\n    int32_t group_tid_40791;\n    \n    global_tid_40789 = get_global_id(0);\n    local_tid_40790 = get_local_id(0);\n    group_sizze_40793 = get_local_size(0);\n    wave_sizze_40792 = LOCKSTEP_WIDTH;\n    group_tid_40791 = get_group_id(0);\n    \n    int32_t phys_tid_37746;\n    \n    phys_tid_37746 = global_tid_40789;\n    \n    int32_t phys_group_id_40794;\n    \n    phys_group_id_40794 = get_group_id(0);\n    for (int32_t i_40795 = 0; i_40795 < sdiv_up32(required_groups_40788 -\n                                                  phys_group_id_40794,\n                                                  num_groups_38156);\n         i_40795++) {\n        int32_t virt_group_id_40796 = phys_group_id_40794 + i_40795 *\n                num_groups_38156;\n        int32_t flat_idx_40797 = virt_group_id_40796 *\n                segscan_group_sizze_38155 + local_tid_40790;\n        int32_t gtid_37735 = squot32(flat_idx_40797, pts_per_node_at_lev_32225);\n        int32_t gtid_37745 = flat_idx_40797 - squot32(flat_idx_40797,\n                                                      pts_per_node_at_lev_32225) *\n                pts_per_node_at_lev_32225;\n        int32_t orig_group_40798 = squot32(flat_idx_40797,\n                                           segscan_group_sizze_38155 *\n                                           sdiv_up32(nodes_this_lvl_32221 *\n                                                     pts_per_node_at_lev_32225,\n                                                     num_threads_40709));\n        int32_t carry_in_flat_idx_40799 = orig_group_40798 *\n                (segscan_group_sizze_38155 * sdiv_up32(nodes_this_lvl_322",
            "21 *\n                                                       pts_per_node_at_lev_32225,\n                                                       num_threads_40709)) - 1;\n        \n        if (slt32(gtid_37735, nodes_this_lvl_32221) && slt32(gtid_37745,\n                                                             pts_per_node_at_lev_32225)) {\n            if (!(orig_group_40798 == 0 || (flat_idx_40797 ==\n                                            (orig_group_40798 + 1) *\n                                            (segscan_group_sizze_38155 *\n                                             sdiv_up32(nodes_this_lvl_32221 *\n                                                       pts_per_node_at_lev_32225,\n                                                       num_threads_40709)) -\n                                            1 || slt32(srem32(flat_idx_40797,\n                                                              pts_per_node_at_lev_32225),\n                                                       flat_idx_40797 -\n                                                       carry_in_flat_idx_40799)))) {\n                int32_t x_38163;\n                int32_t x_38164;\n                int32_t x_38165;\n                int32_t x_38166;\n                int32_t x_38167;\n                int32_t x_38168;\n                int32_t x_38169;\n                int32_t x_38170;\n                \n                x_38163 = ((__global\n                            int32_t *) mem_39905)[sext_i32_i64(squot32(carry_in_flat_idx_40799,\n                                                                       pts_per_node_at_lev_32225)) *\n                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(carry_in_flat_idx_40799 -\n                                                  squot32(carry_in_flat_idx_40799,\n                                                          pts_per_node_at_lev_32225) *\n                            ",
            "                      pts_per_node_at_lev_32225)];\n                x_38164 = ((__global\n                            int32_t *) mem_39910)[sext_i32_i64(squot32(carry_in_flat_idx_40799,\n                                                                       pts_per_node_at_lev_32225)) *\n                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(carry_in_flat_idx_40799 -\n                                                  squot32(carry_in_flat_idx_40799,\n                                                          pts_per_node_at_lev_32225) *\n                                                  pts_per_node_at_lev_32225)];\n                x_38165 = ((__global\n                            int32_t *) mem_39915)[sext_i32_i64(squot32(carry_in_flat_idx_40799,\n                                                                       pts_per_node_at_lev_32225)) *\n                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(carry_in_flat_idx_40799 -\n                                                  squot32(carry_in_flat_idx_40799,\n                                                          pts_per_node_at_lev_32225) *\n                                                  pts_per_node_at_lev_32225)];\n                x_38166 = ((__global\n                            int32_t *) mem_39920)[sext_i32_i64(squot32(carry_in_flat_idx_40799,\n                                                                       pts_per_node_at_lev_32225)) *\n                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(carry_in_flat_idx_40799 -\n                                                  squot32(carry_in_flat_idx_40799,\n                                                          pts_per_node_at_lev_32225) *\n                                    ",
            "              pts_per_node_at_lev_32225)];\n                x_38167 = ((__global\n                            int32_t *) mem_39905)[sext_i32_i64(gtid_37735) *\n                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(gtid_37745)];\n                x_38168 = ((__global\n                            int32_t *) mem_39910)[sext_i32_i64(gtid_37735) *\n                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(gtid_37745)];\n                x_38169 = ((__global\n                            int32_t *) mem_39915)[sext_i32_i64(gtid_37735) *\n                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(gtid_37745)];\n                x_38170 = ((__global\n                            int32_t *) mem_39920)[sext_i32_i64(gtid_37735) *\n                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(gtid_37745)];\n                \n                int32_t res_38171;\n                \n                res_38171 = add32(x_38163, x_38167);\n                \n                int32_t res_38172 = add32(x_38164, x_38168);\n                int32_t res_38173 = add32(x_38165, x_38169);\n                int32_t res_38174 = add32(x_38166, x_38170);\n                \n                x_38163 = res_38171;\n                x_38164 = res_38172;\n                x_38165 = res_38173;\n                x_38166 = res_38174;\n                ((__global int32_t *) mem_39905)[sext_i32_i64(gtid_37735) *\n                                                 sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                 sext_i32_i64(gtid_37745)] =\n                    x_38163;\n                ((__global int32_t *) mem_39910)[sext_i32_i64(gti",
            "d_37735) *\n                                                 sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                 sext_i32_i64(gtid_37745)] =\n                    x_38164;\n                ((__global int32_t *) mem_39915)[sext_i32_i64(gtid_37735) *\n                                                 sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                 sext_i32_i64(gtid_37745)] =\n                    x_38165;\n                ((__global int32_t *) mem_39920)[sext_i32_i64(gtid_37735) *\n                                                 sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                 sext_i32_i64(gtid_37745)] =\n                    x_38166;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_38155\n}\n__kernel void buildKDtreezisegmap_36314(__global int *global_failure,\n                                        int32_t m_32135, int32_t d_32136,\n                                        __global unsigned char *input_mem_39418,\n                                        __global unsigned char *mem_39422)\n{\n    #define segmap_group_sizze_36330 (buildKDtreezisegmap_group_sizze_36317)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40315;\n    int32_t local_tid_40316;\n    int32_t group_sizze_40319;\n    int32_t wave_sizze_40318;\n    int32_t group_tid_40317;\n    \n    global_tid_40315 = get_global_id(0);\n    local_tid_40316 = get_local_id(0);\n    group_sizze_40319 = get_local_size(0);\n    wave_sizze_40318 = LOCKSTEP_WIDTH;\n    group_tid_40317 = get_group_id(0);\n    \n    int32_t phys_tid_36314;\n    \n    phys_tid_36314 = global_tid_40315;\n    \n    int32_t gtid_36313;\n    \n    gtid_36313 = sext_i64_i32(sext_i32_i64(group_tid_40317) *\n        sext_i32_i64(segmap_gr",
            "oup_sizze_36330) + sext_i32_i64(local_tid_40316));\n    if (slt32(gtid_36313, d_32136)) {\n        float res_36336;\n        float redout_39353 = INFINITY;\n        \n        for (int32_t i_39354 = 0; i_39354 < m_32135; i_39354++) {\n            float x_36340 = ((__global\n                              float *) input_mem_39418)[sext_i32_i64(i_39354) *\n                                                        sext_i32_i64(d_32136) +\n                                                        sext_i32_i64(gtid_36313)];\n            float res_36339 = fmin32(x_36340, redout_39353);\n            float redout_tmp_40320 = res_36339;\n            \n            redout_39353 = redout_tmp_40320;\n        }\n        res_36336 = redout_39353;\n        ((__global float *) mem_39422)[sext_i32_i64(gtid_36313)] = res_36336;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_36330\n}\n__kernel void buildKDtreezisegmap_36375(__global int *global_failure,\n                                        int32_t m_32135, int32_t d_32136,\n                                        __global unsigned char *input_mem_39418,\n                                        __global unsigned char *mem_39436)\n{\n    #define segmap_group_sizze_36391 (buildKDtreezisegmap_group_sizze_36378)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40382;\n    int32_t local_tid_40383;\n    int32_t group_sizze_40386;\n    int32_t wave_sizze_40385;\n    int32_t group_tid_40384;\n    \n    global_tid_40382 = get_global_id(0);\n    local_tid_40383 = get_local_id(0);\n    group_sizze_40386 = get_local_size(0);\n    wave_sizze_40385 = LOCKSTEP_WIDTH;\n    group_tid_40384 = get_group_id(0);\n    \n    int32_t phys_tid_36375;\n    \n    phys_tid_36375 = global_tid_40382;\n    \n    int32_t gtid_36374;\n    \n    gtid_36374 = sext_i64_i32(sext_i32_i64(group_tid_40384) *\n        sext_i32_i64(segmap_group_sizze_36391) + sext_i32_i64(local_tid",
            "_40383));\n    if (slt32(gtid_36374, d_32136)) {\n        float res_36397;\n        float redout_39355 = -INFINITY;\n        \n        for (int32_t i_39356 = 0; i_39356 < m_32135; i_39356++) {\n            float x_36401 = ((__global\n                              float *) input_mem_39418)[sext_i32_i64(i_39356) *\n                                                        sext_i32_i64(d_32136) +\n                                                        sext_i32_i64(gtid_36374)];\n            float res_36400 = fmax32(x_36401, redout_39355);\n            float redout_tmp_40387 = res_36400;\n            \n            redout_39355 = redout_tmp_40387;\n        }\n        res_36397 = redout_39355;\n        ((__global float *) mem_39436)[sext_i32_i64(gtid_36374)] = res_36397;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_36391\n}\n__kernel void buildKDtreezisegmap_36436(__global int *global_failure,\n                                        int failure_is_an_option, __global\n                                        int *global_failure_args,\n                                        int32_t d_32136, int32_t res_32166,\n                                        int32_t conc_tmp_32196, int32_t d_32210,\n                                        int32_t lev_32216,\n                                        int32_t nodes_this_lvl_32221,\n                                        int32_t segmap_usable_groups_36536,\n                                        __global unsigned char *mem_39449,\n                                        __global unsigned char *mem_39455,\n                                        __global unsigned char *mem_39458,\n                                        __global unsigned char *mem_39493,\n                                        __global unsigned char *mem_39508,\n                                        __global unsigned char *mem_39511)\n{\n    #define segmap_group_sizze_36533 (buildKDtreezisegmap_group_sizze_36439)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n  ",
            "  const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40484;\n    int32_t local_tid_40485;\n    int32_t group_sizze_40488;\n    int32_t wave_sizze_40487;\n    int32_t group_tid_40486;\n    \n    global_tid_40484 = get_global_id(0);\n    local_tid_40485 = get_local_id(0);\n    group_sizze_40488 = get_local_size(0);\n    wave_sizze_40487 = LOCKSTEP_WIDTH;\n    group_tid_40486 = get_group_id(0);\n    \n    int32_t phys_tid_36436;\n    \n    phys_tid_36436 = global_tid_40484;\n    \n    int32_t gtid_36435;\n    \n    gtid_36435 = sext_i64_i32(sext_i32_i64(group_tid_40486) *\n        sext_i32_i64(segmap_group_sizze_36533) + sext_i32_i64(local_tid_40485));\n    if (slt32(gtid_36435, nodes_this_lvl_32221)) {\n        int32_t x_36540 = add32(nodes_this_lvl_32221, gtid_36435);\n        int32_t node_ind_36541 = sub32(x_36540, 1);\n        \n        for (int32_t i_40489 = 0; i_40489 < conc_tmp_32196; i_40489++) {\n            ((__global float *) mem_39493)[sext_i32_i64(phys_tid_36436) +\n                                           sext_i32_i64(i_40489) *\n                                           sext_i32_i64(segmap_usable_groups_36536 *\n                                           segmap_group_sizze_36533)] =\n                ((__global float *) mem_39449)[sext_i32_i64(i_40489)];\n        }\n        \n        int32_t res_36543;\n        int32_t ancestor_36546 = 0;\n        \n        for (int32_t i_36545 = 0; i_36545 < lev_32216; i_36545++) {\n            int32_t x_36548 = sub32(lev_32216, i_36545);\n            int32_t k_36549 = sub32(x_36548, 1);\n            int32_t tpk_36550 = 1 << k_36549;\n            int32_t x_36551 = sub32(x_36540, tpk_36550);\n            bool zzero_36552 = tpk_36550 == 0;\n            bool nonzzero_36553 = !zzero_36552;\n            bool nonzzero_cert_36554;\n            \n            if (!nonzzero_36553) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 0) ==\n                        -1) {\n             ",
            "           ;\n                    }\n                    return;\n                }\n            }\n            \n            int32_t res_36555 = sdiv32(x_36551, tpk_36550);\n            bool x_36556 = sle32(0, ancestor_36546);\n            bool y_36557 = slt32(ancestor_36546, res_32166);\n            bool bounds_check_36558 = x_36556 && y_36557;\n            bool index_certs_36559;\n            \n            if (!bounds_check_36558) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 1) ==\n                        -1) {\n                        global_failure_args[0] = ancestor_36546;\n                        global_failure_args[1] = res_32166;\n                        ;\n                    }\n                    return;\n                }\n            }\n            \n            int32_t anc_dim_36560 = ((__global\n                                      int32_t *) mem_39458)[sext_i32_i64(ancestor_36546)];\n            int32_t x_36561 = 1 & res_36555;\n            bool cond_36562 = x_36561 == 0;\n            int32_t lub_ind_36563;\n            \n            if (cond_36562) {\n                lub_ind_36563 = anc_dim_36560;\n            } else {\n                int32_t res_36564 = add32(d_32210, anc_dim_36560);\n                \n                lub_ind_36563 = res_36564;\n            }\n            \n            float anc_med_36565 = ((__global\n                                    float *) mem_39455)[sext_i32_i64(ancestor_36546)];\n            bool res_36566;\n            \n            res_36566 = futrts_isinf32(anc_med_36565);\n            \n            bool cond_36567 = !res_36566;\n            float lw_val_36568;\n            \n            if (cond_36567) {\n                lw_val_36568 = anc_med_36565;\n            } else {\n                bool x_36569 = sle32(0, lub_ind_36563);\n                bool y_36570 = slt32(lub_ind_36563, conc_tmp_32196);\n                bool bounds_check_36571 = x_36569 && y_36570;\n                bool index_certs_36572;\n                \n      ",
            "          if (!bounds_check_36571) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 2) ==\n                            -1) {\n                            global_failure_args[0] = lub_ind_36563;\n                            global_failure_args[1] = conc_tmp_32196;\n                            ;\n                        }\n                        return;\n                    }\n                }\n                \n                float res_36573 = ((__global\n                                    float *) mem_39493)[sext_i32_i64(phys_tid_36436) +\n                                                        sext_i32_i64(lub_ind_36563) *\n                                                        sext_i32_i64(segmap_usable_groups_36536 *\n                                                        segmap_group_sizze_36533)];\n                \n                lw_val_36568 = res_36573;\n            }\n            \n            bool x_36574 = sle32(0, lub_ind_36563);\n            bool y_36575 = slt32(lub_ind_36563, conc_tmp_32196);\n            bool bounds_check_36576 = x_36574 && y_36575;\n            bool index_certs_36577;\n            \n            if (!bounds_check_36576) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 3) ==\n                        -1) {\n                        global_failure_args[0] = lub_ind_36563;\n                        global_failure_args[1] = conc_tmp_32196;\n                        ;\n                    }\n                    return;\n                }\n            }\n            ((__global float *) mem_39493)[sext_i32_i64(phys_tid_36436) +\n                                           sext_i32_i64(lub_ind_36563) *\n                                           sext_i32_i64(segmap_usable_groups_36536 *\n                                           segmap_group_sizze_36533)] =\n                lw_val_36568;\n            \n            int32_t ancestor_tmp_40490 = res_36555;\n            \n            ancestor_36",
            "546 = ancestor_tmp_40490;\n        }\n        res_36543 = ancestor_36546;\n        \n        int32_t res_36579;\n        float res_36580;\n        int32_t redout_39284;\n        float redout_39285;\n        \n        redout_39284 = -1;\n        redout_39285 = -INFINITY;\n        for (int32_t i_39286 = 0; i_39286 < d_32136; i_39286++) {\n            int32_t i_36589 = add32(d_32136, i_39286);\n            bool x_36590 = sle32(0, i_36589);\n            bool y_36591 = slt32(i_36589, conc_tmp_32196);\n            bool bounds_check_36592 = x_36590 && y_36591;\n            bool index_certs_36593;\n            \n            if (!bounds_check_36592) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 4) ==\n                        -1) {\n                        global_failure_args[0] = i_36589;\n                        global_failure_args[1] = conc_tmp_32196;\n                        ;\n                    }\n                    return;\n                }\n            }\n            \n            float x_36594 = ((__global\n                              float *) mem_39493)[sext_i32_i64(phys_tid_36436) +\n                                                  sext_i32_i64(i_36589) *\n                                                  sext_i32_i64(segmap_usable_groups_36536 *\n                                                  segmap_group_sizze_36533)];\n            bool y_36596 = slt32(i_39286, conc_tmp_32196);\n            bool index_certs_36598;\n            \n            if (!y_36596) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 5) ==\n                        -1) {\n                        global_failure_args[0] = i_39286;\n                        global_failure_args[1] = conc_tmp_32196;\n                        ;\n                    }\n                    return;\n                }\n            }\n            \n            float y_36599 = ((__global\n                              float *) mem_39493)[sext_i32_i64(phys_tid_36436) +\n           ",
            "                                       sext_i32_i64(i_39286) *\n                                                  sext_i32_i64(segmap_usable_groups_36536 *\n                                                  segmap_group_sizze_36533)];\n            float abs_arg_36600 = x_36594 - y_36599;\n            float res_36601 = (float) fabs(abs_arg_36600);\n            bool cond_36585 = res_36601 <= redout_39285;\n            int32_t res_36586;\n            \n            if (cond_36585) {\n                res_36586 = redout_39284;\n            } else {\n                res_36586 = i_39286;\n            }\n            \n            float res_36587;\n            \n            if (cond_36585) {\n                res_36587 = redout_39285;\n            } else {\n                res_36587 = res_36601;\n            }\n            \n            int32_t redout_tmp_40492 = res_36586;\n            float redout_tmp_40493 = res_36587;\n            \n            redout_39284 = redout_tmp_40492;\n            redout_39285 = redout_tmp_40493;\n        }\n        res_36579 = redout_39284;\n        res_36580 = redout_39285;\n        \n        bool cond_36602 = node_ind_36541 == 0;\n        bool cond_36603 = !cond_36602;\n        bool res_36604;\n        int32_t res_36605;\n        int32_t res_36606;\n        bool loop_while_36607;\n        int32_t cur_node_36608;\n        int32_t res_ind_36609;\n        \n        loop_while_36607 = cond_36603;\n        cur_node_36608 = node_ind_36541;\n        res_ind_36609 = -1;\n        while (loop_while_36607) {\n            int32_t x_36610 = sub32(cur_node_36608, 1);\n            int32_t res_36611 = sdiv32(x_36610, 2);\n            bool x_36612 = sle32(0, res_36611);\n            bool y_36613 = slt32(res_36611, res_32166);\n            bool bounds_check_36614 = x_36612 && y_36613;\n            bool index_certs_36615;\n            \n            if (!bounds_check_36614) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 6) ==\n                        -1) {\n                ",
            "        global_failure_args[0] = res_36611;\n                        global_failure_args[1] = res_32166;\n                        ;\n                    }\n                    return;\n                }\n            }\n            \n            int32_t x_36616 = ((__global\n                                int32_t *) mem_39458)[sext_i32_i64(res_36611)];\n            bool cond_36617 = x_36616 == res_36579;\n            int32_t res_ind_36618;\n            \n            if (cond_36617) {\n                res_ind_36618 = res_36611;\n            } else {\n                res_ind_36618 = -1;\n            }\n            \n            bool cond_36619 = res_36611 == 0;\n            bool cond_36620 = !cond_36619;\n            bool eq_x_y_36621 = -1 == res_36611;\n            bool p_and_eq_x_y_36622 = cond_36617 && eq_x_y_36621;\n            bool not_p_36623 = !cond_36617;\n            bool res_36624 = p_and_eq_x_y_36622 || not_p_36623;\n            bool x_36625 = cond_36620 && res_36624;\n            bool loop_while_tmp_40494 = x_36625;\n            int32_t cur_node_tmp_40495 = res_36611;\n            int32_t res_ind_tmp_40496 = res_ind_36618;\n            \n            loop_while_36607 = loop_while_tmp_40494;\n            cur_node_36608 = cur_node_tmp_40495;\n            res_ind_36609 = res_ind_tmp_40496;\n        }\n        res_36604 = loop_while_36607;\n        res_36605 = cur_node_36608;\n        res_36606 = res_ind_36609;\n        ((__global int32_t *) mem_39508)[sext_i32_i64(gtid_36435)] = res_36579;\n        ((__global int32_t *) mem_39511)[sext_i32_i64(gtid_36435)] = res_36606;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_36533\n}\n__kernel void buildKDtreezisegmap_36628(__global int *global_failure,\n                                        int failure_is_an_option, __global\n                                        int *global_failure_args,\n                                        int32_t res_32166,\n                                        int32_t nodes_this_lvl_32221, __global\n               ",
            "                         unsigned char *mem_39458, __global\n                                        unsigned char *mem_39544, __global\n                                        unsigned char *mem_39551)\n{\n    #define segmap_group_sizze_36876 (buildKDtreezisegmap_group_sizze_36631)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40583;\n    int32_t local_tid_40584;\n    int32_t group_sizze_40587;\n    int32_t wave_sizze_40586;\n    int32_t group_tid_40585;\n    \n    global_tid_40583 = get_global_id(0);\n    local_tid_40584 = get_local_id(0);\n    group_sizze_40587 = get_local_size(0);\n    wave_sizze_40586 = LOCKSTEP_WIDTH;\n    group_tid_40585 = get_group_id(0);\n    \n    int32_t phys_tid_36628;\n    \n    phys_tid_36628 = global_tid_40583;\n    \n    int32_t gtid_36627;\n    \n    gtid_36627 = sext_i64_i32(sext_i32_i64(group_tid_40585) *\n        sext_i32_i64(segmap_group_sizze_36876) + sext_i32_i64(local_tid_40584));\n    if (slt32(gtid_36627, nodes_this_lvl_32221)) {\n        int32_t binop_x_39295 = add32(nodes_this_lvl_32221, gtid_36627);\n        int32_t index_primexp_39296 = sub32(binop_x_39295, 1);\n        int32_t res_36882 = ((__global\n                              int32_t *) mem_39544)[sext_i32_i64(gtid_36627)];\n        bool cond_36883 = index_primexp_39296 == 0;\n        bool cond_36884 = !cond_36883;\n        bool res_36885;\n        int32_t res_36886;\n        int32_t res_36887;\n        bool loop_while_36888;\n        int32_t cur_node_36889;\n        int32_t res_ind_36890;\n        \n        loop_while_36888 = cond_36884;\n        cur_node_36889 = index_primexp_39296;\n        res_ind_36890 = -1;\n        while (loop_while_36888) {\n            int32_t x_36891 = sub32(cur_node_36889, 1);\n            int32_t res_36892 = sdiv32(x_36891, 2);\n            bool x_36893 = sle32(0, res_36892);\n            bool y_36894 = slt32(res_36892, res_32166);\n            bool bounds",
            "_check_36895 = x_36893 && y_36894;\n            bool index_certs_36896;\n            \n            if (!bounds_check_36895) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 15) ==\n                        -1) {\n                        global_failure_args[0] = res_36892;\n                        global_failure_args[1] = res_32166;\n                        ;\n                    }\n                    return;\n                }\n            }\n            \n            int32_t x_36897 = ((__global\n                                int32_t *) mem_39458)[sext_i32_i64(res_36892)];\n            bool cond_36898 = x_36897 == res_36882;\n            int32_t res_ind_36899;\n            \n            if (cond_36898) {\n                res_ind_36899 = res_36892;\n            } else {\n                res_ind_36899 = -1;\n            }\n            \n            bool cond_36900 = res_36892 == 0;\n            bool cond_36901 = !cond_36900;\n            bool eq_x_y_36902 = -1 == res_36892;\n            bool p_and_eq_x_y_36903 = cond_36898 && eq_x_y_36902;\n            bool not_p_36904 = !cond_36898;\n            bool res_36905 = p_and_eq_x_y_36903 || not_p_36904;\n            bool x_36906 = cond_36901 && res_36905;\n            bool loop_while_tmp_40588 = x_36906;\n            int32_t cur_node_tmp_40589 = res_36892;\n            int32_t res_ind_tmp_40590 = res_ind_36899;\n            \n            loop_while_36888 = loop_while_tmp_40588;\n            cur_node_36889 = cur_node_tmp_40589;\n            res_ind_36890 = res_ind_tmp_40590;\n        }\n        res_36885 = loop_while_36888;\n        res_36886 = cur_node_36889;\n        res_36887 = res_ind_36890;\n        ((__global int32_t *) mem_39551)[sext_i32_i64(gtid_36627)] = res_36887;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_36876\n}\n__kernel void buildKDtreezisegmap_36748(__global int *global_failure,\n                                        int failure_is_an_option, __global\n                                   ",
            "     int *global_failure_args,\n                                        int32_t res_32166,\n                                        int32_t conc_tmp_32196, int32_t d_32210,\n                                        int32_t lev_32216,\n                                        int32_t nodes_this_lvl_32221,\n                                        int32_t num_groups_36799, __global\n                                        unsigned char *mem_39449, __global\n                                        unsigned char *mem_39455, __global\n                                        unsigned char *mem_39458, __global\n                                        unsigned char *mem_39515, __global\n                                        unsigned char *mem_39532, __global\n                                        unsigned char *mem_39535)\n{\n    #define segmap_group_sizze_36798 (buildKDtreezisegmap_group_sizze_36751)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40497;\n    int32_t local_tid_40498;\n    int32_t group_sizze_40501;\n    int32_t wave_sizze_40500;\n    int32_t group_tid_40499;\n    \n    global_tid_40497 = get_global_id(0);\n    local_tid_40498 = get_local_id(0);\n    group_sizze_40501 = get_local_size(0);\n    wave_sizze_40500 = LOCKSTEP_WIDTH;\n    group_tid_40499 = get_group_id(0);\n    \n    int32_t phys_tid_36748;\n    \n    phys_tid_36748 = global_tid_40497;\n    \n    int32_t phys_group_id_40502;\n    \n    phys_group_id_40502 = get_group_id(0);\n    for (int32_t i_40503 = 0; i_40503 <\n         sdiv_up32(sdiv_up32(nodes_this_lvl_32221, segmap_group_sizze_36798) -\n                   phys_group_id_40502, num_groups_36799); i_40503++) {\n        int32_t virt_group_id_40504 = phys_group_id_40502 +",
            " i_40503 *\n                num_groups_36799;\n        int32_t gtid_36747 = sext_i64_i32(sext_i32_i64(virt_group_id_40504) *\n                sext_i32_i64(segmap_group_sizze_36798) +\n                sext_i32_i64(local_tid_40498));\n        \n        if (slt32(gtid_36747, nodes_this_lvl_32221)) {\n            int32_t x_36804 = add32(nodes_this_lvl_32221, gtid_36747);\n            int32_t node_ind_36805 = sub32(x_36804, 1);\n            \n            for (int32_t i_40505 = 0; i_40505 < conc_tmp_32196; i_40505++) {\n                ((__global float *) mem_39515)[sext_i32_i64(phys_tid_36748) +\n                                               sext_i32_i64(i_40505) *\n                                               sext_i32_i64(num_groups_36799 *\n                                               segmap_group_sizze_36798)] =\n                    ((__global float *) mem_39449)[sext_i32_i64(i_40505)];\n            }\n            \n            int32_t res_36807;\n            int32_t ancestor_36810 = 0;\n            \n            for (int32_t i_36809 = 0; i_36809 < lev_32216; i_36809++) {\n                int32_t x_36812 = sub32(lev_32216, i_36809);\n                int32_t k_36813 = sub32(x_36812, 1);\n                int32_t tpk_36814 = 1 << k_36813;\n                int32_t x_36815 = sub32(x_36804, tpk_36814);\n                bool zzero_36816 = tpk_36814 == 0;\n                bool nonzzero_36817 = !zzero_36816;\n                bool nonzzero_cert_36818;\n                \n                if (!nonzzero_36817) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 7) ==\n                            -1) {\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int32_t res_36819 = sdiv32(x_36815, tpk_36814);\n                bool x_36820 = sle32(0, ancestor_36810);\n                bool y_36821 = slt32(ancestor_368",
            "10, res_32166);\n                bool bounds_check_36822 = x_36820 && y_36821;\n                bool index_certs_36823;\n                \n                if (!bounds_check_36822) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 8) ==\n                            -1) {\n                            global_failure_args[0] = ancestor_36810;\n                            global_failure_args[1] = res_32166;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int32_t anc_dim_36824 = ((__global\n                                          int32_t *) mem_39458)[sext_i32_i64(ancestor_36810)];\n                int32_t x_36825 = 1 & res_36819;\n                bool cond_36826 = x_36825 == 0;\n                int32_t lub_ind_36827;\n                \n                if (cond_36826) {\n                    lub_ind_36827 = anc_dim_36824;\n                } else {\n                    int32_t res_36828 = add32(d_32210, anc_dim_36824);\n                    \n                    lub_ind_36827 = res_36828;\n                }\n                \n                float anc_med_36829 = ((__global\n                                        float *) mem_39455)[sext_i32_i64(ancestor_36810)];\n                bool res_36830;\n                \n                res_36830 = futrts_isinf32(anc_med_36829);\n                \n                bool cond_36831 = !res_36830;\n                float lw_val_36832;\n                \n                if (cond_36831) {\n                    lw_val_36832 = anc_med_36829;\n                } else {\n                    bool x_36833 = sle32(0, lub_ind_36827);\n                    bool y_36834 = slt32(lub_ind_36827, conc_tmp_32196);\n                    bool bounds_check_36835 = x_36833 && y_36834;\n                    bool index_certs_36836;\n                    \n                    if (!bounds_chec",
            "k_36835) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          9) == -1) {\n                                global_failure_args[0] = lub_ind_36827;\n                                global_failure_args[1] = conc_tmp_32196;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float res_36837 = ((__global\n                                        float *) mem_39515)[sext_i32_i64(phys_tid_36748) +\n                                                            sext_i32_i64(lub_ind_36827) *\n                                                            sext_i32_i64(num_groups_36799 *\n                                                            segmap_group_sizze_36798)];\n                    \n                    lw_val_36832 = res_36837;\n                }\n                \n                bool x_36838 = sle32(0, lub_ind_36827);\n                bool y_36839 = slt32(lub_ind_36827, conc_tmp_32196);\n                bool bounds_check_36840 = x_36838 && y_36839;\n                bool index_certs_36841;\n                \n                if (!bounds_check_36840) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 10) ==\n                            -1) {\n                            global_failure_args[0] = lub_ind_36827;\n                            global_failure_args[1] = conc_tmp_32196;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                ((__global float *) mem_39515)[sext_i32_i64(phys_tid_36748) +\n                                               sext_i32_i64(lub_ind_36827) *\n                                     ",
            "          sext_i32_i64(num_groups_36799 *\n                                               segmap_group_sizze_36798)] =\n                    lw_val_36832;\n                \n                int32_t ancestor_tmp_40506 = res_36819;\n                \n                ancestor_36810 = ancestor_tmp_40506;\n            }\n            res_36807 = ancestor_36810;\n            for (int32_t i_40508 = 0; i_40508 < conc_tmp_32196; i_40508++) {\n                ((__global float *) mem_39532)[sext_i32_i64(i_40508) *\n                                               sext_i32_i64(nodes_this_lvl_32221) +\n                                               sext_i32_i64(gtid_36747)] =\n                    ((__global\n                      float *) mem_39515)[sext_i32_i64(phys_tid_36748) +\n                                          sext_i32_i64(i_40508) *\n                                          sext_i32_i64(num_groups_36799 *\n                                          segmap_group_sizze_36798)];\n            }\n            ((__global int32_t *) mem_39535)[sext_i32_i64(gtid_36747)] =\n                node_ind_36805;\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_36798\n}\n__kernel void buildKDtreezisegmap_36942(__global int *global_failure,\n                                        int failure_is_an_option, __global\n                                        int *global_failure_args,\n                                        int32_t m_32135, int32_t d_32136,\n                                        int32_t res_32168,\n                                        int32_t nodes_this_lvl_32221,\n                                        int32_t pts_per_node_at_lev_32225,\n                                        int32_t iters_32322, int32_t i_32324,\n                                        int32_t num_groups_37068, __global\n                                        unsigned char *input_mem_39418, __global\n                                        unsig",
            "ned char *mem_param_39466, __global\n                                        unsigned char *res_mem_39552, __global\n                                        unsigned char *mem_39556, __global\n                                        unsigned char *mem_39566, __global\n                                        unsigned char *mem_39570, __global\n                                        unsigned char *mem_39597, __global\n                                        unsigned char *mem_39600, __global\n                                        unsigned char *mem_39603, __global\n                                        unsigned char *mem_39606, __global\n                                        unsigned char *mem_39609, __global\n                                        unsigned char *mem_39672, __global\n                                        unsigned char *mem_39675, __global\n                                        unsigned char *mem_39712, __global\n                                        unsigned char *mem_39715, __global\n                                        unsigned char *mem_39744, __global\n                                        unsigned char *mem_39749, __global\n                                        unsigned char *double_buffer_mem_40098,\n                                        __global\n                                        unsigned char *double_buffer_mem_40099)\n{\n    #define segmap_group_sizze_37067 (buildKDtreezisegmap_group_sizze_36945)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40599;\n    int32_t local_tid_40600;\n    int32_t group_sizze_40603;\n    int32_t wave_sizze_40602;\n    int32_t group_tid_40601;\n    \n    global_tid_40599 = get_global_id(0);\n    local_tid_4",
            "0600 = get_local_id(0);\n    group_sizze_40603 = get_local_size(0);\n    wave_sizze_40602 = LOCKSTEP_WIDTH;\n    group_tid_40601 = get_group_id(0);\n    \n    int32_t phys_tid_36942;\n    \n    phys_tid_36942 = global_tid_40599;\n    \n    int32_t phys_group_id_40604;\n    \n    phys_group_id_40604 = get_group_id(0);\n    for (int32_t i_40605 = 0; i_40605 <\n         sdiv_up32(sdiv_up32(nodes_this_lvl_32221, segmap_group_sizze_37067) -\n                   phys_group_id_40604, num_groups_37068); i_40605++) {\n        int32_t virt_group_id_40606 = phys_group_id_40604 + i_40605 *\n                num_groups_37068;\n        int32_t gtid_36941 = sext_i64_i32(sext_i32_i64(virt_group_id_40606) *\n                sext_i32_i64(segmap_group_sizze_37067) +\n                sext_i32_i64(local_tid_40600));\n        \n        if (slt32(gtid_36941, nodes_this_lvl_32221)) {\n            int32_t x_37073 = ((__global\n                                int32_t *) res_mem_39552)[sext_i32_i64(gtid_36941)];\n            bool x_37074 = sle32(0, x_37073);\n            bool y_37075 = slt32(x_37073, d_32136);\n            bool bounds_check_37076 = x_37074 && y_37075;\n            \n            for (int32_t i_39359 = 0; i_39359 < pts_per_node_at_lev_32225;\n                 i_39359++) {\n                int32_t x_37078 = ((__global\n                                    int32_t *) mem_39566)[sext_i32_i64(i_39359) *\n                                                          sext_i32_i64(nodes_this_lvl_32221) +\n                                                          sext_i32_i64(gtid_36941)];\n                bool x_37079 = sle32(0, x_37078);\n                bool y_37080 = slt32(x_37078, res_32168);\n                bool bounds_check_37081 = x_37079 && y_37080;\n                bool index_ok_37082 = bounds_check_37076 && bounds_check_37081;\n                bool index_certs_37083;\n                \n                if (!index_ok_37082) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 1",
            "6) ==\n                            -1) {\n                            global_failure_args[0] = x_37078;\n                            global_failure_args[1] = x_37073;\n                            global_failure_args[2] = res_32168;\n                            global_failure_args[3] = d_32136;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                bool index_concat_cmp_37084 = sle32(m_32135, x_37078);\n                float index_concat_branch_37085;\n                \n                if (index_concat_cmp_37084) {\n                    index_concat_branch_37085 = INFINITY;\n                } else {\n                    float index_concat_37086 = ((__global\n                                                 float *) input_mem_39418)[sext_i32_i64(x_37078) *\n                                                                           sext_i32_i64(d_32136) +\n                                                                           sext_i32_i64(x_37073)];\n                    \n                    index_concat_branch_37085 = index_concat_37086;\n                }\n                ((__global float *) mem_39570)[sext_i32_i64(phys_tid_36942) +\n                                               sext_i32_i64(i_39359) *\n                                               sext_i32_i64(num_groups_37068 *\n                                               segmap_group_sizze_37067)] =\n                    index_concat_branch_37085;\n            }\n            for (int32_t i_40608 = 0; i_40608 < pts_per_node_at_lev_32225;\n                 i_40608++) {\n                ((__global\n                  float *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_36942) +\n                                                    sext_i32_i64(i_40608) *\n                                                    sext_i32_i64(num_groups_37068 *\n                                             ",
            "       segmap_group_sizze_37067)] =\n                    ((__global\n                      float *) mem_39570)[sext_i32_i64(phys_tid_36942) +\n                                          sext_i32_i64(i_40608) *\n                                          sext_i32_i64(num_groups_37068 *\n                                          segmap_group_sizze_37067)];\n            }\n            for (int32_t i_40609 = 0; i_40609 < pts_per_node_at_lev_32225;\n                 i_40609++) {\n                ((__global\n                  int32_t *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_36942) +\n                                                      sext_i32_i64(i_40609) *\n                                                      sext_i32_i64(num_groups_37068 *\n                                                      segmap_group_sizze_37067)] =\n                    ((__global int32_t *) mem_39556)[sext_i32_i64(i_40609)];\n            }\n            for (int32_t i_37090 = 0; i_37090 < iters_32322; i_37090++) {\n                int32_t lifted_2_radix_sort_step_arg_37093 = mul32(2, i_37090);\n                int32_t lifted_0_get_bit_arg_37094 = add32(1,\n                                                           lifted_2_radix_sort_step_arg_37093);\n                bool res_37095 = lifted_0_get_bit_arg_37094 == 31;\n                bool res_37096 = lifted_2_radix_sort_step_arg_37093 == 31;\n                int32_t discard_39381;\n                int32_t discard_39382;\n                int32_t discard_39383;\n                int32_t discard_39384;\n                int32_t scanacc_39366;\n                int32_t scanacc_39367;\n                int32_t scanacc_39368;\n                int32_t scanacc_39369;\n                \n                scanacc_39366 = 0;\n                scanacc_39367 = 0;\n                scanacc_39368 = 0;\n                scanacc_39369 = 0;\n                for (int32_t i_39375 = 0; i_39375 < pts_per_node_at_lev_32225;\n                     i_39375++) {\n                    float x_37114 = ((__globa",
            "l\n                                      float *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_36942) +\n                                                                        sext_i32_i64(i_39375) *\n                                                                        sext_i32_i64(num_groups_37068 *\n                                                                        segmap_group_sizze_37067)];\n                    int32_t i32_arg_37115;\n                    \n                    i32_arg_37115 = futrts_to_bits32(x_37114);\n                    \n                    int32_t unsign_arg_37116 = ashr32(i32_arg_37115,\n                                                      lifted_0_get_bit_arg_37094);\n                    int32_t unsign_arg_37117 = 1 & unsign_arg_37116;\n                    int32_t unsign_arg_37118 = ashr32(i32_arg_37115, 31);\n                    int32_t unsign_arg_37119 = 1 & unsign_arg_37118;\n                    bool cond_37120 = unsign_arg_37119 == 1;\n                    bool x_37121 = !cond_37120;\n                    bool y_37122 = res_37095 && x_37121;\n                    bool cond_37123 = cond_37120 || y_37122;\n                    int32_t res_37124;\n                    \n                    if (cond_37123) {\n                        int32_t res_37125 = 1 ^ unsign_arg_37117;\n                        \n                        res_37124 = res_37125;\n                    } else {\n                        res_37124 = unsign_arg_37117;\n                    }\n                    \n                    int32_t x_37126 = mul32(2, res_37124);\n                    int32_t unsign_arg_37127 = ashr32(i32_arg_37115,\n                                                      lifted_2_radix_sort_step_arg_37093);\n                    int32_t unsign_arg_37128 = 1 & unsign_arg_37127;\n                    bool y_37129 = res_37096 && x_37121;\n                    bool cond_37130 = cond_37120 || y_37129;\n                    int32_t res_37131;\n                    \n                    if (cond",
            "_37130) {\n                        int32_t res_37132 = 1 ^ unsign_arg_37128;\n                        \n                        res_37131 = res_37132;\n                    } else {\n                        res_37131 = unsign_arg_37128;\n                    }\n                    \n                    int32_t res_37133 = add32(x_37126, res_37131);\n                    bool cond_37134 = res_37133 == 0;\n                    int32_t res_37135 = btoi_bool_i32(cond_37134);\n                    int32_t res_37136;\n                    int32_t res_37137;\n                    int32_t res_37138;\n                    \n                    if (cond_37134) {\n                        res_37136 = 0;\n                        res_37137 = 0;\n                        res_37138 = 0;\n                    } else {\n                        bool cond_37139 = res_37133 == 1;\n                        int32_t res_37140 = btoi_bool_i32(cond_37139);\n                        int32_t res_37141;\n                        int32_t res_37142;\n                        \n                        if (cond_37139) {\n                            res_37141 = 0;\n                            res_37142 = 0;\n                        } else {\n                            bool cond_37143 = res_37133 == 2;\n                            int32_t res_37144 = btoi_bool_i32(cond_37143);\n                            bool cond_neg_37145 = !cond_37143;\n                            int32_t res_37146 = btoi_bool_i32(cond_neg_37145);\n                            \n                            res_37141 = res_37144;\n                            res_37142 = res_37146;\n                        }\n                        res_37136 = res_37140;\n                        res_37137 = res_37141;\n                        res_37138 = res_37142;\n                    }\n                    \n                    int32_t res_37110 = add32(res_37135, scanacc_39366);\n                    int32_t res_37111 = add32(res_37136, scanacc_39367);\n                    int32_t res_37112 = add32(res",
            "_37137, scanacc_39368);\n                    int32_t res_37113 = add32(res_37138, scanacc_39369);\n                    \n                    ((__global\n                      int32_t *) mem_39597)[sext_i32_i64(phys_tid_36942) +\n                                            sext_i32_i64(i_39375) *\n                                            sext_i32_i64(num_groups_37068 *\n                                            segmap_group_sizze_37067)] =\n                        res_37110;\n                    ((__global\n                      int32_t *) mem_39600)[sext_i32_i64(phys_tid_36942) +\n                                            sext_i32_i64(i_39375) *\n                                            sext_i32_i64(num_groups_37068 *\n                                            segmap_group_sizze_37067)] =\n                        res_37111;\n                    ((__global\n                      int32_t *) mem_39603)[sext_i32_i64(phys_tid_36942) +\n                                            sext_i32_i64(i_39375) *\n                                            sext_i32_i64(num_groups_37068 *\n                                            segmap_group_sizze_37067)] =\n                        res_37112;\n                    ((__global\n                      int32_t *) mem_39606)[sext_i32_i64(phys_tid_36942) +\n                                            sext_i32_i64(i_39375) *\n                                            sext_i32_i64(num_groups_37068 *\n                                            segmap_group_sizze_37067)] =\n                        res_37113;\n                    ((__global\n                      int32_t *) mem_39609)[sext_i32_i64(phys_tid_36942) +\n                                            sext_i32_i64(i_39375) *\n                                            sext_i32_i64(num_groups_37068 *\n                                            segmap_group_sizze_37067)] =\n                        res_37133;\n                    \n                    int32_t scanacc_tmp_40612 = res_37110;\n            ",
            "        int32_t scanacc_tmp_40613 = res_37111;\n                    int32_t scanacc_tmp_40614 = res_37112;\n                    int32_t scanacc_tmp_40615 = res_37113;\n                    \n                    scanacc_39366 = scanacc_tmp_40612;\n                    scanacc_39367 = scanacc_tmp_40613;\n                    scanacc_39368 = scanacc_tmp_40614;\n                    scanacc_39369 = scanacc_tmp_40615;\n                }\n                discard_39381 = scanacc_39366;\n                discard_39382 = scanacc_39367;\n                discard_39383 = scanacc_39368;\n                discard_39384 = scanacc_39369;\n                \n                int32_t res_37147 = ((__global\n                                      int32_t *) mem_39597)[sext_i32_i64(phys_tid_36942) +\n                                                            sext_i32_i64(i_32324) *\n                                                            sext_i32_i64(num_groups_37068 *\n                                                            segmap_group_sizze_37067)];\n                int32_t res_37148 = ((__global\n                                      int32_t *) mem_39600)[sext_i32_i64(phys_tid_36942) +\n                                                            sext_i32_i64(i_32324) *\n                                                            sext_i32_i64(num_groups_37068 *\n                                                            segmap_group_sizze_37067)];\n                int32_t res_37149 = ((__global\n                                      int32_t *) mem_39603)[sext_i32_i64(phys_tid_36942) +\n                                                            sext_i32_i64(i_32324) *\n                                                            sext_i32_i64(num_groups_37068 *\n                                                            segmap_group_sizze_37067)];\n                \n                for (int32_t i_40621 = 0; i_40621 < pts_per_node_at_lev_32225;\n                     i_40621++) {\n                    ((__global\n    ",
            "                  float *) mem_39672)[sext_i32_i64(phys_tid_36942) +\n                                          sext_i32_i64(i_40621) *\n                                          sext_i32_i64(num_groups_37068 *\n                                          segmap_group_sizze_37067)] =\n                        ((__global\n                          float *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_36942) +\n                                                            sext_i32_i64(i_40621) *\n                                                            sext_i32_i64(num_groups_37068 *\n                                                            segmap_group_sizze_37067)];\n                }\n                for (int32_t i_40622 = 0; i_40622 < pts_per_node_at_lev_32225;\n                     i_40622++) {\n                    ((__global\n                      int32_t *) mem_39675)[sext_i32_i64(phys_tid_36942) +\n                                            sext_i32_i64(i_40622) *\n                                            sext_i32_i64(num_groups_37068 *\n                                            segmap_group_sizze_37067)] =\n                        ((__global\n                          int32_t *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_36942) +\n                                                              sext_i32_i64(i_40622) *\n                                                              sext_i32_i64(num_groups_37068 *\n                                                              segmap_group_sizze_37067)];\n                }\n                for (int32_t write_iter_39385 = 0; write_iter_39385 <\n                     pts_per_node_at_lev_32225; write_iter_39385++) {\n                    int32_t write_iv_39388 = ((__global\n                                               int32_t *) mem_39609)[sext_i32_i64(phys_tid_36942) +\n                                                                     sext_i32_i64(write_iter_39385) *\n                                                              ",
            "       sext_i32_i64(num_groups_37068 *\n                                                                     segmap_group_sizze_37067)];\n                    bool match_lit_37161 = 0 == write_iv_39388;\n                    int32_t res_37162;\n                    \n                    if (match_lit_37161) {\n                        int32_t write_iv_39389 = ((__global\n                                                   int32_t *) mem_39597)[sext_i32_i64(phys_tid_36942) +\n                                                                         sext_i32_i64(write_iter_39385) *\n                                                                         sext_i32_i64(num_groups_37068 *\n                                                                         segmap_group_sizze_37067)];\n                        int32_t res_37163 = sub32(write_iv_39389, 1);\n                        \n                        res_37162 = res_37163;\n                    } else {\n                        int32_t write_iv_39390 = ((__global\n                                                   int32_t *) mem_39600)[sext_i32_i64(phys_tid_36942) +\n                                                                         sext_i32_i64(write_iter_39385) *\n                                                                         sext_i32_i64(num_groups_37068 *\n                                                                         segmap_group_sizze_37067)];\n                        int32_t write_iv_39391 = ((__global\n                                                   int32_t *) mem_39603)[sext_i32_i64(phys_tid_36942) +\n                                                                         sext_i32_i64(write_iter_39385) *\n                                                                         sext_i32_i64(num_groups_37068 *\n                                                                         segmap_group_sizze_37067)];\n                        int32_t write_iv_39392 = ((__global\n                                      ",
            "             int32_t *) mem_39606)[sext_i32_i64(phys_tid_36942) +\n                                                                         sext_i32_i64(write_iter_39385) *\n                                                                         sext_i32_i64(num_groups_37068 *\n                                                                         segmap_group_sizze_37067)];\n                        bool match_lit_37164 = 1 == write_iv_39388;\n                        int32_t x_37165;\n                        \n                        if (match_lit_37164) {\n                            int32_t x_37166 = add32(res_37147, write_iv_39390);\n                            int32_t res_37167 = sub32(x_37166, 1);\n                            \n                            x_37165 = res_37167;\n                        } else {\n                            bool match_lit_37168 = 2 == write_iv_39388;\n                            int32_t x_37169;\n                            \n                            if (match_lit_37168) {\n                                int32_t x_37170 = add32(res_37147, res_37148);\n                                int32_t x_37171 = add32(x_37170,\n                                                        write_iv_39391);\n                                int32_t res_37172 = sub32(x_37171, 1);\n                                \n                                x_37169 = res_37172;\n                            } else {\n                                int32_t x_37173 = add32(res_37147, res_37148);\n                                int32_t x_37174 = add32(res_37149, x_37173);\n                                int32_t x_37175 = add32(x_37174,\n                                                        write_iv_39392);\n                                int32_t res_37176 = sub32(x_37175, 1);\n                                \n                                x_37169 = res_37176;\n                            }\n                            x_37165 = x_37169;\n                        }\n                     ",
            "   res_37162 = x_37165;\n                    }\n                    \n                    bool less_than_zzero_39395 = slt32(res_37162, 0);\n                    bool greater_than_sizze_39396 =\n                         sle32(pts_per_node_at_lev_32225, res_37162);\n                    bool outside_bounds_dim_39397 = less_than_zzero_39395 ||\n                         greater_than_sizze_39396;\n                    \n                    if (!outside_bounds_dim_39397) {\n                        for (int32_t i_40625 = 0; i_40625 < 1; i_40625++) {\n                            ((__global\n                              float *) mem_39672)[sext_i32_i64(phys_tid_36942) +\n                                                  sext_i32_i64(res_37162 +\n                                                  i_40625) *\n                                                  sext_i32_i64(num_groups_37068 *\n                                                  segmap_group_sizze_37067)] =\n                                ((__global\n                                  float *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_36942 +\n                                                                    num_groups_37068 *\n                                                                    segmap_group_sizze_37067 *\n                                                                    write_iter_39385) +\n                                                                    sext_i32_i64(i_40625) *\n                                                                    sext_i32_i64(num_groups_37068 *\n                                                                    segmap_group_sizze_37067)];\n                        }\n                    }\n                    if (!outside_bounds_dim_39397) {\n                        for (int32_t i_40626 = 0; i_40626 < 1; i_40626++) {\n                            ((__global\n                              int32_t *) mem_39675)[sext_i32_i64(phys_tid_36942) +\n                                                ",
            "    sext_i32_i64(res_37162 +\n                                                    i_40626) *\n                                                    sext_i32_i64(num_groups_37068 *\n                                                    segmap_group_sizze_37067)] =\n                                ((__global\n                                  int32_t *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_36942 +\n                                                                      num_groups_37068 *\n                                                                      segmap_group_sizze_37067 *\n                                                                      write_iter_39385) +\n                                                                      sext_i32_i64(i_40626) *\n                                                                      sext_i32_i64(num_groups_37068 *\n                                                                      segmap_group_sizze_37067)];\n                        }\n                    }\n                }\n                for (int32_t i_40627 = 0; i_40627 < pts_per_node_at_lev_32225;\n                     i_40627++) {\n                    ((__global\n                      float *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_36942) +\n                                                        sext_i32_i64(i_40627) *\n                                                        sext_i32_i64(num_groups_37068 *\n                                                        segmap_group_sizze_37067)] =\n                        ((__global\n                          float *) mem_39672)[sext_i32_i64(phys_tid_36942) +\n                                              sext_i32_i64(i_40627) *\n                                              sext_i32_i64(num_groups_37068 *\n                                              segmap_group_sizze_37067)];\n                }\n                for (int32_t i_40628 = 0; i_40628 < pts_per_node_at_lev_32225;\n                     i_40628++) {\n               ",
            "     ((__global\n                      int32_t *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_36942) +\n                                                          sext_i32_i64(i_40628) *\n                                                          sext_i32_i64(num_groups_37068 *\n                                                          segmap_group_sizze_37067)] =\n                        ((__global\n                          int32_t *) mem_39675)[sext_i32_i64(phys_tid_36942) +\n                                                sext_i32_i64(i_40628) *\n                                                sext_i32_i64(num_groups_37068 *\n                                                segmap_group_sizze_37067)];\n                }\n            }\n            \n            int32_t binop_x_39307 = pts_per_node_at_lev_32225 * gtid_36941;\n            \n            for (int32_t i_39411 = 0; i_39411 < pts_per_node_at_lev_32225;\n                 i_39411++) {\n                int32_t x_37179 = ((__global\n                                    int32_t *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_36942) +\n                                                                        sext_i32_i64(i_39411) *\n                                                                        sext_i32_i64(num_groups_37068 *\n                                                                        segmap_group_sizze_37067)];\n                bool x_37180 = sle32(0, x_37179);\n                bool y_37181 = slt32(x_37179, pts_per_node_at_lev_32225);\n                bool bounds_check_37182 = x_37180 && y_37181;\n                bool index_certs_37183;\n                \n                if (!bounds_check_37182) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 17) ==\n                            -1) {\n                            global_failure_args[0] = x_37179;\n                            global_failure_args[1] = pts_per_node_at_lev_32225;\n                            ;\n            ",
            "            }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                bool index_certs_37185;\n                \n                if (!bounds_check_37182) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 18) ==\n                            -1) {\n                            global_failure_args[0] = x_37179;\n                            global_failure_args[1] = pts_per_node_at_lev_32225;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int32_t new_index_39308 = x_37179 + binop_x_39307;\n                \n                for (int32_t i_40631 = 0; i_40631 < 1; i_40631++) {\n                    ((__global\n                      int32_t *) mem_39712)[sext_i32_i64(phys_tid_36942) +\n                                            sext_i32_i64(i_39411 + i_40631) *\n                                            sext_i32_i64(num_groups_37068 *\n                                            segmap_group_sizze_37067)] =\n                        ((__global\n                          int32_t *) mem_param_39466)[sext_i32_i64(new_index_39308) +\n                                                      sext_i32_i64(i_40631)];\n                }\n                for (int32_t i_40632 = 0; i_40632 < 1; i_40632++) {\n                    ((__global\n                      float *) mem_39715)[sext_i32_i64(phys_tid_36942) +\n                                          sext_i32_i64(i_39411 + i_40632) *\n                                          sext_i32_i64(num_groups_37068 *\n                                          segmap_group_sizze_37067)] =\n                        ((__global\n                          float *) mem_39570)[sext_i32_i64(phys_tid_36942 +\n                                              num_groups_37068 ",
            "*\n                                              segmap_group_sizze_37067 *\n                                              x_37179) + sext_i32_i64(i_40632) *\n                                              sext_i32_i64(num_groups_37068 *\n                                              segmap_group_sizze_37067)];\n                }\n            }\n            for (int32_t i_40633 = 0; i_40633 < pts_per_node_at_lev_32225;\n                 i_40633++) {\n                ((__global int32_t *) mem_39744)[sext_i32_i64(i_40633) *\n                                                 sext_i32_i64(nodes_this_lvl_32221) +\n                                                 sext_i32_i64(gtid_36941)] =\n                    ((__global\n                      int32_t *) mem_39712)[sext_i32_i64(phys_tid_36942) +\n                                            sext_i32_i64(i_40633) *\n                                            sext_i32_i64(num_groups_37068 *\n                                            segmap_group_sizze_37067)];\n            }\n            for (int32_t i_40634 = 0; i_40634 < pts_per_node_at_lev_32225;\n                 i_40634++) {\n                ((__global float *) mem_39749)[sext_i32_i64(i_40634) *\n                                               sext_i32_i64(nodes_this_lvl_32221) +\n                                               sext_i32_i64(gtid_36941)] =\n                    ((__global\n                      float *) mem_39715)[sext_i32_i64(phys_tid_36942) +\n                                          sext_i32_i64(i_40634) *\n                                          sext_i32_i64(num_groups_37068 *\n                                          segmap_group_sizze_37067)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_37067\n}\n__kernel void buildKDtreezisegmap_37340(__global int *global_failure,\n                                        int failure_is_an_option, __global\n                                ",
            "        int *global_failure_args,\n                                        int32_t nodes_this_lvl_32221,\n                                        int32_t pts_per_node_at_lev_32225,\n                                        __global unsigned char *mem_param_39466,\n                                        __global unsigned char *mem_39835,\n                                        __global unsigned char *res_r_mem_39958,\n                                        __global unsigned char *mem_39964,\n                                        __global unsigned char *mem_39969)\n{\n    #define segmap_group_sizze_38288 (buildKDtreezisegmap_group_sizze_37345)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40806;\n    int32_t local_tid_40807;\n    int32_t group_sizze_40810;\n    int32_t wave_sizze_40809;\n    int32_t group_tid_40808;\n    \n    global_tid_40806 = get_global_id(0);\n    local_tid_40807 = get_local_id(0);\n    group_sizze_40810 = get_local_size(0);\n    wave_sizze_40809 = LOCKSTEP_WIDTH;\n    group_tid_40808 = get_group_id(0);\n    \n    int32_t phys_tid_37340;\n    \n    phys_tid_37340 = global_tid_40806;\n    \n    int32_t gtid_37338;\n    \n    gtid_37338 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40808) *\n                                      sext_i32_i64(segmap_group_sizze_38288) +\n                                      sext_i32_i64(local_tid_40807),\n                                      sext_i32_i64(pts_per_node_at_lev_32225)));\n    \n    int32_t gtid_37339;\n    \n    gtid_37339 = sext_i64_i32(sext_i32_i64(group_tid_40808) *\n        sext_i32_i64(segmap_group_sizze_38288) + sext_i32_i64(local_tid_40807) -\n        squot64(sext_i32_i64(group_tid_40808) *\n                sext_i32_i64(segmap_group_sizze_38288) +\n                sext_i32_i64(local_tid_40807),\n                sext_i32_i64(pts_per_node_at_lev_32225)) *\n        sext_i32_i64(pts_per_node_at_lev_32225));\n ",
            "   if (slt32(gtid_37338, nodes_this_lvl_32221) && slt32(gtid_37339,\n                                                         pts_per_node_at_lev_32225)) {\n        int32_t x_38296 = ((__global\n                            int32_t *) res_r_mem_39958)[sext_i32_i64(gtid_37338) *\n                                                        sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                        sext_i32_i64(gtid_37339)];\n        bool x_38297 = sle32(0, x_38296);\n        bool y_38298 = slt32(x_38296, pts_per_node_at_lev_32225);\n        bool bounds_check_38299 = x_38297 && y_38298;\n        bool index_certs_38300;\n        \n        if (!bounds_check_38299) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 23) == -1) {\n                    global_failure_args[0] = x_38296;\n                    global_failure_args[1] = pts_per_node_at_lev_32225;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        float res_38301 = ((__global\n                            float *) mem_39835)[sext_i32_i64(gtid_37338) *\n                                                sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                sext_i32_i64(x_38296)];\n        bool index_certs_38302;\n        \n        if (!bounds_check_38299) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 24) == -1) {\n                    global_failure_args[0] = x_38296;\n                    global_failure_args[1] = pts_per_node_at_lev_32225;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        int32_t binop_x_39314 = pts_per_node_at_lev_32225 * gtid_37338;\n        int32_t new_index_39315 = x_38296 + binop_x_39314;\n        int32_t res_38303 = ((__global\n                              int32_t *) mem_param_39466)[sext_i32_i64(new_index_39315)];\n        \n        ((__global int32_t *) mem_39964)[sext_i32_i64(g",
            "tid_37338) *\n                                         sext_i32_i64(pts_per_node_at_lev_32225) +\n                                         sext_i32_i64(gtid_37339)] = res_38303;\n        ((__global float *) mem_39969)[sext_i32_i64(gtid_37338) *\n                                       sext_i32_i64(pts_per_node_at_lev_32225) +\n                                       sext_i32_i64(gtid_37339)] = res_38301;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_38288\n}\n__kernel void buildKDtreezisegmap_37675(__global int *global_failure,\n                                        int32_t nodes_this_lvl_32221,\n                                        int32_t pts_per_node_at_lev_32225,\n                                        int32_t i_32324, __global\n                                        unsigned char *mem_param_39843, __global\n                                        unsigned char *mem_param_39851, __global\n                                        unsigned char *mem_39905, __global\n                                        unsigned char *mem_39910, __global\n                                        unsigned char *mem_39915, __global\n                                        unsigned char *mem_39920, __global\n                                        unsigned char *mem_39925, __global\n                                        unsigned char *mem_39930, __global\n                                        unsigned char *mem_39935)\n{\n    #define segmap_group_sizze_38230 (buildKDtreezisegmap_group_sizze_37680)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40800;\n    int32_t local_tid_40801;\n    int32_t group_sizze_40804;\n    int32_t wave_sizze_40803;\n    int32_t group_tid_40802;\n    \n    global_tid_40800 = get_global_id(0);\n    local_tid_40801 = get_local_id(0);\n    group_sizze_40804 = get_local_size(0);\n    wave_sizze_40803 = LOCKSTEP_WIDTH;\n    group_tid_40802 = ",
            "get_group_id(0);\n    \n    int32_t phys_tid_37675;\n    \n    phys_tid_37675 = global_tid_40800;\n    \n    int32_t gtid_37673;\n    \n    gtid_37673 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40802) *\n                                      sext_i32_i64(segmap_group_sizze_38230) +\n                                      sext_i32_i64(local_tid_40801),\n                                      sext_i32_i64(pts_per_node_at_lev_32225)));\n    \n    int32_t gtid_37674;\n    \n    gtid_37674 = sext_i64_i32(sext_i32_i64(group_tid_40802) *\n        sext_i32_i64(segmap_group_sizze_38230) + sext_i32_i64(local_tid_40801) -\n        squot64(sext_i32_i64(group_tid_40802) *\n                sext_i32_i64(segmap_group_sizze_38230) +\n                sext_i32_i64(local_tid_40801),\n                sext_i32_i64(pts_per_node_at_lev_32225)) *\n        sext_i32_i64(pts_per_node_at_lev_32225));\n    if (slt32(gtid_37673, nodes_this_lvl_32221) && slt32(gtid_37674,\n                                                         pts_per_node_at_lev_32225)) {\n        int32_t x_38248 = ((__global\n                            int32_t *) mem_39925)[sext_i32_i64(gtid_37673) *\n                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(gtid_37674)];\n        float write_value_38253 = ((__global\n                                    float *) mem_param_39843)[sext_i32_i64(gtid_37673) *\n                                                              sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                              sext_i32_i64(gtid_37674)];\n        int32_t write_value_38254 = ((__global\n                                      int32_t *) mem_param_39851)[sext_i32_i64(gtid_37673) *\n                                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                                  sext_i32_i64(gtid_37674)];\n        bool match_lit_38255",
            " = 0 == x_38248;\n        int32_t res_38256;\n        \n        if (match_lit_38255) {\n            int32_t x_38249 = ((__global\n                                int32_t *) mem_39905)[sext_i32_i64(gtid_37673) *\n                                                      sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                      sext_i32_i64(gtid_37674)];\n            int32_t res_38257 = sub32(x_38249, 1);\n            \n            res_38256 = res_38257;\n        } else {\n            int32_t res_38243 = ((__global\n                                  int32_t *) mem_39905)[sext_i32_i64(gtid_37673) *\n                                                        sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                        sext_i32_i64(i_32324)];\n            int32_t res_38244 = ((__global\n                                  int32_t *) mem_39910)[sext_i32_i64(gtid_37673) *\n                                                        sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                        sext_i32_i64(i_32324)];\n            int32_t res_38245 = ((__global\n                                  int32_t *) mem_39915)[sext_i32_i64(gtid_37673) *\n                                                        sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                        sext_i32_i64(i_32324)];\n            int32_t x_38250 = ((__global\n                                int32_t *) mem_39910)[sext_i32_i64(gtid_37673) *\n                                                      sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                      sext_i32_i64(gtid_37674)];\n            int32_t x_38251 = ((__global\n                                int32_t *) mem_39915)[sext_i32_i64(gtid_37673) *\n                                                      sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                      sext_i32_i64(gtid_",
            "37674)];\n            int32_t x_38252 = ((__global\n                                int32_t *) mem_39920)[sext_i32_i64(gtid_37673) *\n                                                      sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                      sext_i32_i64(gtid_37674)];\n            bool match_lit_38258 = 1 == x_38248;\n            int32_t x_38259;\n            \n            if (match_lit_38258) {\n                int32_t x_38260 = add32(res_38243, x_38250);\n                int32_t res_38261 = sub32(x_38260, 1);\n                \n                x_38259 = res_38261;\n            } else {\n                bool match_lit_38262 = 2 == x_38248;\n                int32_t x_38263;\n                \n                if (match_lit_38262) {\n                    int32_t x_38264 = add32(res_38243, res_38244);\n                    int32_t x_38265 = add32(x_38251, x_38264);\n                    int32_t res_38266 = sub32(x_38265, 1);\n                    \n                    x_38263 = res_38266;\n                } else {\n                    int32_t x_38267 = add32(res_38243, res_38244);\n                    int32_t x_38268 = add32(res_38245, x_38267);\n                    int32_t x_38269 = add32(x_38252, x_38268);\n                    int32_t res_38270 = sub32(x_38269, 1);\n                    \n                    x_38263 = res_38270;\n                }\n                x_38259 = x_38263;\n            }\n            res_38256 = x_38259;\n        }\n        if ((sle32(0, gtid_37673) && slt32(gtid_37673, nodes_this_lvl_32221)) &&\n            (sle32(0, res_38256) && slt32(res_38256,\n                                          pts_per_node_at_lev_32225))) {\n            ((__global float *) mem_39930)[sext_i32_i64(gtid_37673) *\n                                           sext_i32_i64(pts_per_node_at_lev_32225) +\n                                           sext_i32_i64(res_38256)] =\n                write_value_38253;\n        }\n        if ((sle32(0, gtid_37673) && slt32(gtid_37673,",
            " nodes_this_lvl_32221)) &&\n            (sle32(0, res_38256) && slt32(res_38256,\n                                          pts_per_node_at_lev_32225))) {\n            ((__global int32_t *) mem_39935)[sext_i32_i64(gtid_37673) *\n                                             sext_i32_i64(pts_per_node_at_lev_32225) +\n                                             sext_i32_i64(res_38256)] =\n                write_value_38254;\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_38230\n}\n__kernel void buildKDtreezisegmap_37946(__global int *global_failure,\n                                        int failure_is_an_option, __global\n                                        int *global_failure_args,\n                                        int32_t m_32135, int32_t d_32136,\n                                        int32_t res_32168,\n                                        int32_t nodes_this_lvl_32221,\n                                        int32_t pts_per_node_at_lev_32225,\n                                        __global unsigned char *input_mem_39418,\n                                        __global unsigned char *mem_param_39466,\n                                        __global unsigned char *res_mem_39552,\n                                        __global unsigned char *mem_39829,\n                                        __global unsigned char *mem_39835)\n{\n    #define segmap_group_sizze_38028 (buildKDtreezisegmap_group_sizze_37951)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40670;\n    int32_t local_tid_40671;\n    int32_t group_sizze_40674;\n    int32_t wave_sizze_40673;\n    int32_t group_tid_40672;\n    \n    global_tid_40670 = get_global_id(0);\n    local_tid_40671 = get_local_id(0);\n    group_sizze_40674 = get_local_size(0);\n    wave_sizze_40673 = LOCKSTEP_WIDTH;\n    group_tid_40672 = get_group_id(0);\n    \n    int32_t phys_tid_37946;\n ",
            "   \n    phys_tid_37946 = global_tid_40670;\n    \n    int32_t gtid_37944;\n    \n    gtid_37944 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40672) *\n                                      sext_i32_i64(segmap_group_sizze_38028) +\n                                      sext_i32_i64(local_tid_40671),\n                                      sext_i32_i64(pts_per_node_at_lev_32225)));\n    \n    int32_t gtid_37945;\n    \n    gtid_37945 = sext_i64_i32(sext_i32_i64(group_tid_40672) *\n        sext_i32_i64(segmap_group_sizze_38028) + sext_i32_i64(local_tid_40671) -\n        squot64(sext_i32_i64(group_tid_40672) *\n                sext_i32_i64(segmap_group_sizze_38028) +\n                sext_i32_i64(local_tid_40671),\n                sext_i32_i64(pts_per_node_at_lev_32225)) *\n        sext_i32_i64(pts_per_node_at_lev_32225));\n    if (slt32(gtid_37944, nodes_this_lvl_32221) && slt32(gtid_37945,\n                                                         pts_per_node_at_lev_32225)) {\n        int32_t x_38033 = ((__global\n                            int32_t *) res_mem_39552)[sext_i32_i64(gtid_37944)];\n        bool bounds_check_38034 = ((__global\n                                    bool *) mem_39829)[sext_i32_i64(gtid_37944)];\n        int32_t binop_x_39297 = pts_per_node_at_lev_32225 * gtid_37944;\n        int32_t new_index_39298 = gtid_37945 + binop_x_39297;\n        int32_t x_38035 = ((__global\n                            int32_t *) mem_param_39466)[sext_i32_i64(new_index_39298)];\n        bool x_38036 = sle32(0, x_38035);\n        bool y_38037 = slt32(x_38035, res_32168);\n        bool bounds_check_38038 = x_38036 && y_38037;\n        bool index_ok_38039 = bounds_check_38034 && bounds_check_38038;\n        bool index_certs_38040;\n        \n        if (!index_ok_38039) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 22) == -1) {\n                    global_failure_args[0] = x_38035;\n                    global_failure_args[1] = x_38033;\n                    global_failure_",
            "args[2] = res_32168;\n                    global_failure_args[3] = d_32136;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        bool index_concat_cmp_38041 = sle32(m_32135, x_38035);\n        float index_concat_branch_38042;\n        \n        if (index_concat_cmp_38041) {\n            index_concat_branch_38042 = INFINITY;\n        } else {\n            float index_concat_38043 = ((__global\n                                         float *) input_mem_39418)[sext_i32_i64(x_38035) *\n                                                                   sext_i32_i64(d_32136) +\n                                                                   sext_i32_i64(x_38033)];\n            \n            index_concat_branch_38042 = index_concat_38043;\n        }\n        \n        float res_38044 = index_concat_branch_38042;\n        \n        ((__global float *) mem_39835)[sext_i32_i64(gtid_37944) *\n                                       sext_i32_i64(pts_per_node_at_lev_32225) +\n                                       sext_i32_i64(gtid_37945)] = res_38044;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_38028\n}\n__kernel void buildKDtreezisegmap_37990(__global int *global_failure,\n                                        int32_t d_32136,\n                                        int32_t nodes_this_lvl_32221, __global\n                                        unsigned char *res_mem_39552, __global\n                                        unsigned char *mem_39829)\n{\n    #define segmap_group_sizze_38004 (buildKDtreezisegmap_group_sizze_37993)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40665;\n    int32_t local_tid_40666;\n    int32_t group_sizze_40669;\n    int32_t wave_sizze_40668;\n    int32_t group_tid_40667;\n    \n    global_tid_40665 = get_global_id(0);\n    local_tid_40666 = get_local_id(0);\n    group_sizze_40669",
            " = get_local_size(0);\n    wave_sizze_40668 = LOCKSTEP_WIDTH;\n    group_tid_40667 = get_group_id(0);\n    \n    int32_t phys_tid_37990;\n    \n    phys_tid_37990 = global_tid_40665;\n    \n    int32_t gtid_37989;\n    \n    gtid_37989 = sext_i64_i32(sext_i32_i64(group_tid_40667) *\n        sext_i32_i64(segmap_group_sizze_38004) + sext_i32_i64(local_tid_40666));\n    if (slt32(gtid_37989, nodes_this_lvl_32221)) {\n        int32_t x_38009 = ((__global\n                            int32_t *) res_mem_39552)[sext_i32_i64(gtid_37989)];\n        bool x_38010 = sle32(0, x_38009);\n        bool y_38011 = slt32(x_38009, d_32136);\n        bool bounds_check_38012 = x_38010 && y_38011;\n        \n        ((__global bool *) mem_39829)[sext_i32_i64(gtid_37989)] =\n            bounds_check_38012;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_38004\n}\n__kernel void buildKDtreezisegmap_38311(__global int *global_failure,\n                                        int32_t res_32166,\n                                        int32_t nodes_this_lvl_32221,\n                                        int32_t pts_per_node_at_lev_32225,\n                                        int32_t mi_32473, int32_t i_32478,\n                                        int32_t y_32643, __global\n                                        unsigned char *mem_39455, __global\n                                        unsigned char *mem_39458, __global\n                                        unsigned char *mem_39461, __global\n                                        unsigned char *res_mem_39552, __global\n                                        unsigned char *res_mem_39553, __global\n                                        unsigned char *res_mem_39985)\n{\n    #define segmap_group_sizze_38315 (buildKDtreezisegmap_group_sizze_38314)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40813;\n    int32_t local_tid_4081",
            "4;\n    int32_t group_sizze_40817;\n    int32_t wave_sizze_40816;\n    int32_t group_tid_40815;\n    \n    global_tid_40813 = get_global_id(0);\n    local_tid_40814 = get_local_id(0);\n    group_sizze_40817 = get_local_size(0);\n    wave_sizze_40816 = LOCKSTEP_WIDTH;\n    group_tid_40815 = get_group_id(0);\n    \n    int32_t phys_tid_38311;\n    \n    phys_tid_38311 = global_tid_40813;\n    \n    int32_t write_i_38310;\n    \n    write_i_38310 = sext_i64_i32(sext_i32_i64(group_tid_40815) *\n        sext_i32_i64(segmap_group_sizze_38315) + sext_i32_i64(local_tid_40814));\n    if (slt32(write_i_38310, nodes_this_lvl_32221)) {\n        int32_t write_value_32649 = ((__global\n                                      int32_t *) res_mem_39552)[sext_i32_i64(write_i_38310)];\n        int32_t write_value_32650 = ((__global\n                                      int32_t *) res_mem_39553)[sext_i32_i64(write_i_38310)];\n        float x_32651 = ((__global\n                          float *) res_mem_39985)[sext_i32_i64(write_i_38310) *\n                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(mi_32473)];\n        float y_32652 = ((__global\n                          float *) res_mem_39985)[sext_i32_i64(write_i_38310) *\n                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(i_32478)];\n        float x_32653 = x_32651 + y_32652;\n        float res_32654 = x_32653 / 2.0F;\n        int32_t res_32655 = add32(y_32643, write_i_38310);\n        \n        if (sle32(0, res_32655) && slt32(res_32655, res_32166)) {\n            ((__global int32_t *) mem_39461)[sext_i32_i64(res_32655)] =\n                write_value_32650;\n        }\n        if (sle32(0, res_32655) && slt32(res_32655, res_32166)) {\n            ((__global float *) mem_39455)[sext_i32_i64(res_32655)] = res_32654;\n        }\n        if (sle32(0, res_32655) && slt32(res_3265",
            "5, res_32166)) {\n            ((__global int32_t *) mem_39458)[sext_i32_i64(res_32655)] =\n                write_value_32649;\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_38315\n}\n__kernel void buildKDtreezisegmap_38398(__global int *global_failure,\n                                        int failure_is_an_option, __global\n                                        int *global_failure_args,\n                                        int32_t d_32136, int32_t res_32168,\n                                        __global unsigned char *input_mem_39418,\n                                        __global unsigned char *res_mem_39993,\n                                        __global unsigned char *mem_40011,\n                                        __global unsigned char *mem_40013,\n                                        __global unsigned char *mem_40019)\n{\n    #define segmap_group_sizze_38483 (buildKDtreezisegmap_group_sizze_38403)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40823;\n    int32_t local_tid_40824;\n    int32_t group_sizze_40827;\n    int32_t wave_sizze_40826;\n    int32_t group_tid_40825;\n    \n    global_tid_40823 = get_global_id(0);\n    local_tid_40824 = get_local_id(0);\n    group_sizze_40827 = get_local_size(0);\n    wave_sizze_40826 = LOCKSTEP_WIDTH;\n    group_tid_40825 = get_group_id(0);\n    \n    int32_t phys_tid_38398;\n    \n    phys_tid_38398 = global_tid_40823;\n    \n    int32_t gtid_38396;\n    \n    gtid_38396 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40825) *\n                                      sext_i32_i64(segmap_group_sizze_38483) +\n                                      sext_i32_i64(local_tid_40824),\n                                      sext_i32_i64(d_32136)));\n    \n    int32_t gtid_38397;\n    \n    gtid_38397 = sext_i64_i32(sext_i32_i64(group_tid_40825) *\n        sext_i32_i64(segmap_group_sizze_38483) + ",
            "sext_i32_i64(local_tid_40824) -\n        squot64(sext_i32_i64(group_tid_40825) *\n                sext_i32_i64(segmap_group_sizze_38483) +\n                sext_i32_i64(local_tid_40824), sext_i32_i64(d_32136)) *\n        sext_i32_i64(d_32136));\n    if (slt32(gtid_38396, res_32168) && slt32(gtid_38397, d_32136)) {\n        int32_t x_38488 = ((__global\n                            int32_t *) res_mem_39993)[sext_i32_i64(gtid_38396)];\n        bool bounds_check_38489 = ((__global\n                                    bool *) mem_40011)[sext_i32_i64(gtid_38396)];\n        bool index_concat_cmp_38490 = ((__global\n                                        bool *) mem_40013)[sext_i32_i64(gtid_38396)];\n        bool index_certs_38496;\n        \n        if (!bounds_check_38489) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 25) == -1) {\n                    global_failure_args[0] = x_38488;\n                    global_failure_args[1] = gtid_38397;\n                    global_failure_args[2] = res_32168;\n                    global_failure_args[3] = d_32136;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        float index_concat_branch_38497;\n        \n        if (index_concat_cmp_38490) {\n            index_concat_branch_38497 = INFINITY;\n        } else {\n            float index_concat_38498 = ((__global\n                                         float *) input_mem_39418)[sext_i32_i64(x_38488) *\n                                                                   sext_i32_i64(d_32136) +\n                                                                   sext_i32_i64(gtid_38397)];\n            \n            index_concat_branch_38497 = index_concat_38498;\n        }\n        \n        float res_38499 = index_concat_branch_38497;\n        \n        ((__global float *) mem_40019)[sext_i32_i64(gtid_38396) *\n                                       sext_i32_i64(d_32136) +\n                                       sext_i32_i64(gtid_3",
            "8397)] = res_38499;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_38483\n}\n__kernel void buildKDtreezisegmap_38442(__global int *global_failure,\n                                        int32_t m_32135, int32_t res_32168,\n                                        __global unsigned char *res_mem_39993,\n                                        __global unsigned char *mem_40011,\n                                        __global unsigned char *mem_40013)\n{\n    #define segmap_group_sizze_38457 (buildKDtreezisegmap_group_sizze_38445)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40818;\n    int32_t local_tid_40819;\n    int32_t group_sizze_40822;\n    int32_t wave_sizze_40821;\n    int32_t group_tid_40820;\n    \n    global_tid_40818 = get_global_id(0);\n    local_tid_40819 = get_local_id(0);\n    group_sizze_40822 = get_local_size(0);\n    wave_sizze_40821 = LOCKSTEP_WIDTH;\n    group_tid_40820 = get_group_id(0);\n    \n    int32_t phys_tid_38442;\n    \n    phys_tid_38442 = global_tid_40818;\n    \n    int32_t gtid_38441;\n    \n    gtid_38441 = sext_i64_i32(sext_i32_i64(group_tid_40820) *\n        sext_i32_i64(segmap_group_sizze_38457) + sext_i32_i64(local_tid_40819));\n    if (slt32(gtid_38441, res_32168)) {\n        int32_t x_38463 = ((__global\n                            int32_t *) res_mem_39993)[sext_i32_i64(gtid_38441)];\n        bool x_38464 = sle32(0, x_38463);\n        bool y_38465 = slt32(x_38463, res_32168);\n        bool bounds_check_38466 = x_38464 && y_38465;\n        bool index_concat_cmp_38467 = sle32(m_32135, x_38463);\n        \n        ((__global bool *) mem_40011)[sext_i32_i64(gtid_38441)] =\n            bounds_check_38466;\n        ((__global bool *) mem_40013)[sext_i32_i64(gtid_38441)] =\n            index_concat_cmp_38467;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_38457\n}\n__kernel void buildKDtreezisegmap_38502(__glob",
            "al int *global_failure,\n                                        int32_t res_32167, int32_t res_32168,\n                                        __global unsigned char *res_mem_39993,\n                                        __global unsigned char *mem_40022)\n{\n    #define segmap_group_sizze_38506 (buildKDtreezisegmap_group_sizze_38505)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40828;\n    int32_t local_tid_40829;\n    int32_t group_sizze_40832;\n    int32_t wave_sizze_40831;\n    int32_t group_tid_40830;\n    \n    global_tid_40828 = get_global_id(0);\n    local_tid_40829 = get_local_id(0);\n    group_sizze_40832 = get_local_size(0);\n    wave_sizze_40831 = LOCKSTEP_WIDTH;\n    group_tid_40830 = get_group_id(0);\n    \n    int32_t phys_tid_38502;\n    \n    phys_tid_38502 = global_tid_40828;\n    \n    int32_t write_i_38501;\n    \n    write_i_38501 = sext_i64_i32(sext_i32_i64(group_tid_40830) *\n        sext_i32_i64(segmap_group_sizze_38506) + sext_i32_i64(local_tid_40829));\n    if (slt32(write_i_38501, res_32168)) {\n        int32_t write_index_32681 = ((__global\n                                      int32_t *) res_mem_39993)[sext_i32_i64(write_i_38501)];\n        int32_t res_32682 = sdiv32(write_i_38501, res_32167);\n        \n        if (sle32(0, write_index_32681) && slt32(write_index_32681,\n                                                 res_32168)) {\n            ((__global int32_t *) mem_40022)[sext_i32_i64(write_index_32681)] =\n                res_32682;\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_38506\n}\n__kernel void buildKDtreezisegmap_intragroup_36940(__global int *global_failure,\n                                                   int failure_is_an_option,\n                                                   __global\n                                                   int *global_failure_args,\n                             ",
            "                      uint mem_39816_backing_offset_0,\n                                                   uint mem_39813_backing_offset_1,\n                                                   uint mem_39787_backing_offset_2,\n                                                   uint double_buffer_mem_40108_backing_offset_3,\n                                                   uint mem_39790_backing_offset_4,\n                                                   uint mem_39784_backing_offset_5,\n                                                   uint mem_39781_backing_offset_6,\n                                                   uint mem_39778_backing_offset_7,\n                                                   uint mem_39775_backing_offset_8,\n                                                   uint mem_39772_backing_offset_9,\n                                                   uint mem_39754_backing_offset_10,\n                                                   int32_t m_32135,\n                                                   int32_t d_32136,\n                                                   int32_t res_32168,\n                                                   int32_t pts_per_node_at_lev_32225,\n                                                   int32_t iters_32322,\n                                                   int32_t i_32324, __global\n                                                   unsigned char *input_mem_39418,\n                                                   __global\n                                                   unsigned char *mem_param_39466,\n                                                   __global\n                                                   unsigned char *res_mem_39552,\n                                                   __global\n                                                   unsigned char *mem_39556,\n                                                   __global\n                                                   unsigned char *mem_39821,\n        ",
            "                                           __global\n                                                   unsigned char *mem_39826,\n                                                   __global\n                                                   unsigned char *double_buffer_mem_40109)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *mem_39816_backing_10 =\n                  &shared_mem[mem_39816_backing_offset_0];\n    volatile char *mem_39813_backing_9 =\n                  &shared_mem[mem_39813_backing_offset_1];\n    volatile char *mem_39787_backing_8 =\n                  &shared_mem[mem_39787_backing_offset_2];\n    volatile char *double_buffer_mem_40108_backing_7 =\n                  &shared_mem[double_buffer_mem_40108_backing_offset_3];\n    volatile char *mem_39790_backing_6 =\n                  &shared_mem[mem_39790_backing_offset_4];\n    volatile char *mem_39784_backing_5 =\n                  &shared_mem[mem_39784_backing_offset_5];\n    volatile char *mem_39781_backing_4 =\n                  &shared_mem[mem_39781_backing_offset_6];\n    volatile char *mem_39778_backing_3 =\n                  &shared_mem[mem_39778_backing_offset_7];\n    volatile char *mem_39775_backing_2 =\n                  &shared_mem[mem_39775_backing_offset_8];\n    volatile char *mem_39772_backing_1 =\n                  &shared_mem[mem_39772_backing_offset_9];\n    volatile char *mem_39754_backing_0 =\n                  &shared_mem[mem_39754_backing_offset_10];\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40635;\n    int32_t local_tid_40636;\n    int32_t group_sizze_40639;\n    int32_t wave_sizze_40638;\n    int32_t group_tid_40637;\n    \n    global_tid_40635 = get_global_id(0);\n    local_tid_40636 = get_local_id(0);\n    group_sizze_40639 ",
            "= get_local_size(0);\n    wave_sizze_40638 = LOCKSTEP_WIDTH;\n    group_tid_40637 = get_group_id(0);\n    \n    int32_t phys_tid_36940;\n    \n    phys_tid_36940 = group_tid_40637;\n    \n    int32_t ltid_pre_40640;\n    \n    ltid_pre_40640 = local_tid_40636;\n    \n    int32_t gtid_36911;\n    \n    gtid_36911 = group_tid_40637;\n    \n    int32_t x_37195;\n    \n    x_37195 = ((__global int32_t *) res_mem_39552)[sext_i32_i64(gtid_36911)];\n    \n    bool x_37196 = sle32(0, x_37195);\n    bool y_37197 = slt32(x_37195, d_32136);\n    bool bounds_check_37198 = x_37196 && y_37197;\n    int32_t binop_x_39309 = pts_per_node_at_lev_32225 * gtid_36911;\n    __local char *mem_39754;\n    \n    mem_39754 = (__local char *) mem_39754_backing_0;\n    \n    int32_t gtid_36914 = ltid_pre_40640;\n    int32_t phys_tid_36915 = local_tid_40636;\n    \n    if (slt32(gtid_36914, pts_per_node_at_lev_32225)) {\n        int32_t new_index_39310 = gtid_36914 + binop_x_39309;\n        int32_t x_37200 = ((__global\n                            int32_t *) mem_param_39466)[sext_i32_i64(new_index_39310)];\n        bool x_37201 = sle32(0, x_37200);\n        bool y_37202 = slt32(x_37200, res_32168);\n        bool bounds_check_37203 = x_37201 && y_37202;\n        bool index_ok_37204 = bounds_check_37198 && bounds_check_37203;\n        bool index_certs_37205;\n        \n        if (!index_ok_37204) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 19) == -1) {\n                    global_failure_args[0] = x_37200;\n                    global_failure_args[1] = x_37195;\n                    global_failure_args[2] = res_32168;\n                    global_failure_args[3] = d_32136;\n                    ;\n                }\n                local_failure = true;\n                goto error_0;\n            }\n        }\n        \n        bool index_concat_cmp_37206 = sle32(m_32135, x_37200);\n        float index_concat_branch_37207;\n        \n        if (index_concat_cmp_37206) {\n            index_concat_branch_37207 = INFINI",
            "TY;\n        } else {\n            float index_concat_37208 = ((__global\n                                         float *) input_mem_39418)[sext_i32_i64(x_37200) *\n                                                                   sext_i32_i64(d_32136) +\n                                                                   sext_i32_i64(x_37195)];\n            \n            index_concat_branch_37207 = index_concat_37208;\n        }\n        \n        float res_37209 = index_concat_branch_37207;\n        \n        ((__local float *) mem_39754)[sext_i32_i64(gtid_36914)] = res_37209;\n    }\n    \n  error_0:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    __local char *mem_39772;\n    \n    mem_39772 = (__local char *) mem_39772_backing_1;\n    \n    __local char *mem_39775;\n    \n    mem_39775 = (__local char *) mem_39775_backing_2;\n    \n    __local char *mem_39778;\n    \n    mem_39778 = (__local char *) mem_39778_backing_3;\n    \n    __local char *mem_39781;\n    \n    mem_39781 = (__local char *) mem_39781_backing_4;\n    \n    __local char *mem_39784;\n    \n    mem_39784 = (__local char *) mem_39784_backing_5;\n    \n    __local char *mem_39790;\n    \n    mem_39790 = (__local char *) mem_39790_backing_6;\n    \n    __local char *double_buffer_mem_40108;\n    \n    double_buffer_mem_40108 = (__local\n                               char *) double_buffer_mem_40108_backing_7;\n    ((__local float *) double_buffer_mem_40108)[sext_i32_i64(local_tid_40636)] =\n        ((__local float *) mem_39754)[sext_i32_i64(local_tid_40636)];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ((__global int32_t *) double_buffer_mem_40109)[sext_i32_i64(phys_tid_36940 *\n                                                   pts_per_node_at_lev_32225) +\n                                                   sext_i32_i64(local_tid_40636)] =\n        ((__global int32_t *) mem_39556)[sext_i32_i64(local_tid_40636)];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    __local char *mem_39787;\n ",
            "   \n    mem_39787 = (__local char *) mem_39787_backing_8;\n    for (int32_t i_37212 = 0; i_37212 < iters_32322; i_37212++) {\n        int32_t lifted_2_radix_sort_step_arg_37215 = mul32(2, i_37212);\n        int32_t lifted_0_get_bit_arg_37216 = add32(1,\n                                                   lifted_2_radix_sort_step_arg_37215);\n        bool res_37217 = lifted_0_get_bit_arg_37216 == 31;\n        bool res_37218 = lifted_2_radix_sort_step_arg_37215 == 31;\n        int32_t gtid_36926 = ltid_pre_40640;\n        int32_t phys_tid_36927 = local_tid_40636;\n        \n        if (slt32(gtid_36926, pts_per_node_at_lev_32225)) {\n            float x_37236 = ((__local\n                              float *) double_buffer_mem_40108)[sext_i32_i64(gtid_36926)];\n            int32_t i32_arg_37237;\n            \n            i32_arg_37237 = futrts_to_bits32(x_37236);\n            \n            int32_t unsign_arg_37238 = ashr32(i32_arg_37237,\n                                              lifted_0_get_bit_arg_37216);\n            int32_t unsign_arg_37239 = 1 & unsign_arg_37238;\n            int32_t unsign_arg_37240 = ashr32(i32_arg_37237, 31);\n            int32_t unsign_arg_37241 = 1 & unsign_arg_37240;\n            bool cond_37242 = unsign_arg_37241 == 1;\n            bool x_37243 = !cond_37242;\n            bool y_37244 = res_37217 && x_37243;\n            bool cond_37245 = cond_37242 || y_37244;\n            int32_t res_37246;\n            \n            if (cond_37245) {\n                int32_t res_37247 = 1 ^ unsign_arg_37239;\n                \n                res_37246 = res_37247;\n            } else {\n                res_37246 = unsign_arg_37239;\n            }\n            \n            int32_t x_37248 = mul32(2, res_37246);\n            int32_t unsign_arg_37249 = ashr32(i32_arg_37237,\n                                              lifted_2_radix_sort_step_arg_37215);\n            int32_t unsign_arg_37250 = 1 & unsign_arg_37249;\n            bool y_37251 = res_37218 && x_37243;\n            bool cond",
            "_37252 = cond_37242 || y_37251;\n            int32_t res_37253;\n            \n            if (cond_37252) {\n                int32_t res_37254 = 1 ^ unsign_arg_37250;\n                \n                res_37253 = res_37254;\n            } else {\n                res_37253 = unsign_arg_37250;\n            }\n            \n            int32_t res_37255 = add32(x_37248, res_37253);\n            bool cond_37256 = res_37255 == 0;\n            int32_t res_37257 = btoi_bool_i32(cond_37256);\n            int32_t res_37258;\n            int32_t res_37259;\n            int32_t res_37260;\n            \n            if (cond_37256) {\n                res_37258 = 0;\n                res_37259 = 0;\n                res_37260 = 0;\n            } else {\n                bool cond_37261 = res_37255 == 1;\n                int32_t res_37262 = btoi_bool_i32(cond_37261);\n                int32_t res_37263;\n                int32_t res_37264;\n                \n                if (cond_37261) {\n                    res_37263 = 0;\n                    res_37264 = 0;\n                } else {\n                    bool cond_37265 = res_37255 == 2;\n                    int32_t res_37266 = btoi_bool_i32(cond_37265);\n                    bool cond_neg_37267 = !cond_37265;\n                    int32_t res_37268 = btoi_bool_i32(cond_neg_37267);\n                    \n                    res_37263 = res_37266;\n                    res_37264 = res_37268;\n                }\n                res_37258 = res_37262;\n                res_37259 = res_37263;\n                res_37260 = res_37264;\n            }\n            ((__local int32_t *) mem_39772)[sext_i32_i64(gtid_36926)] =\n                res_37257;\n            ((__local int32_t *) mem_39775)[sext_i32_i64(gtid_36926)] =\n                res_37258;\n            ((__local int32_t *) mem_39778)[sext_i32_i64(gtid_36926)] =\n                res_37259;\n            ((__local int32_t *) mem_39781)[sext_i32_i64(gtid_36926)] =\n                res_37260;\n            ((__local int32_t *) mem_39784)[",
            "sext_i32_i64(gtid_36926)] =\n                res_37255;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t dims_flat_40643;\n        \n        dims_flat_40643 = pts_per_node_at_lev_32225;\n        \n        int32_t x_37224;\n        int32_t x_37225;\n        int32_t x_37226;\n        int32_t x_37227;\n        int32_t x_37228;\n        int32_t x_37229;\n        int32_t x_37230;\n        int32_t x_37231;\n        int32_t x_40648;\n        int32_t x_40649;\n        int32_t x_40650;\n        int32_t x_40651;\n        int32_t x_40652;\n        int32_t x_40653;\n        int32_t x_40654;\n        int32_t x_40655;\n        int32_t skip_threads_40660;\n        \n        // read input for in-block scan\n        {\n            if (slt32(local_tid_40636, pts_per_node_at_lev_32225)) {\n                x_37228 = ((volatile __local\n                            int32_t *) mem_39772)[sext_i32_i64(local_tid_40636)];\n                x_37229 = ((volatile __local\n                            int32_t *) mem_39775)[sext_i32_i64(local_tid_40636)];\n                x_37230 = ((volatile __local\n                            int32_t *) mem_39778)[sext_i32_i64(local_tid_40636)];\n                x_37231 = ((volatile __local\n                            int32_t *) mem_39781)[sext_i32_i64(local_tid_40636)];\n                if ((local_tid_40636 - squot32(local_tid_40636, 32) * 32) ==\n                    0) {\n                    x_37224 = x_37228;\n                    x_37225 = x_37229;\n                    x_37226 = x_37230;\n                    x_37227 = x_37231;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_40660 = 1;\n            while (slt32(skip_threads_40660, 32)) {\n                if (sle32(skip_threads_40660, local_tid_40636 -\n                          squot32(local_tid_40636, 32) * 32) &&\n                    slt32(local_tid_40636, pts_per_node_at_lev_32225)) {\n                    // read operands\n                    ",
            "{\n                        x_37224 = ((volatile __local\n                                    int32_t *) mem_39772)[sext_i32_i64(local_tid_40636 -\n                                                          skip_threads_40660)];\n                        x_37225 = ((volatile __local\n                                    int32_t *) mem_39775)[sext_i32_i64(local_tid_40636 -\n                                                          skip_threads_40660)];\n                        x_37226 = ((volatile __local\n                                    int32_t *) mem_39778)[sext_i32_i64(local_tid_40636 -\n                                                          skip_threads_40660)];\n                        x_37227 = ((volatile __local\n                                    int32_t *) mem_39781)[sext_i32_i64(local_tid_40636 -\n                                                          skip_threads_40660)];\n                    }\n                    // perform operation\n                    {\n                        bool inactive_40661 = slt32(srem32(local_tid_40636,\n                                                           pts_per_node_at_lev_32225),\n                                                    local_tid_40636 -\n                                                    (local_tid_40636 -\n                                                     skip_threads_40660));\n                        \n                        if (inactive_40661) {\n                            x_37224 = x_37228;\n                            x_37225 = x_37229;\n                            x_37226 = x_37230;\n                            x_37227 = x_37231;\n                        }\n                        if (!inactive_40661) {\n                            int32_t res_37232 = add32(x_37224, x_37228);\n                            int32_t res_37233 = add32(x_37225, x_37229);\n                            int32_t res_37234 = add32(x_37226, x_37230);\n                            int32_t res_37235 = add32(x_37227, x_37231);\n                      ",
            "      \n                            x_37224 = res_37232;\n                            x_37225 = res_37233;\n                            x_37226 = res_37234;\n                            x_37227 = res_37235;\n                        }\n                    }\n                }\n                if (sle32(wave_sizze_40638, skip_threads_40660)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_40660, local_tid_40636 -\n                          squot32(local_tid_40636, 32) * 32) &&\n                    slt32(local_tid_40636, pts_per_node_at_lev_32225)) {\n                    // write result\n                    {\n                        ((volatile __local\n                          int32_t *) mem_39772)[sext_i32_i64(local_tid_40636)] =\n                            x_37224;\n                        x_37228 = x_37224;\n                        ((volatile __local\n                          int32_t *) mem_39775)[sext_i32_i64(local_tid_40636)] =\n                            x_37225;\n                        x_37229 = x_37225;\n                        ((volatile __local\n                          int32_t *) mem_39778)[sext_i32_i64(local_tid_40636)] =\n                            x_37226;\n                        x_37230 = x_37226;\n                        ((volatile __local\n                          int32_t *) mem_39781)[sext_i32_i64(local_tid_40636)] =\n                            x_37227;\n                        x_37231 = x_37227;\n                    }\n                }\n                if (sle32(wave_sizze_40638, skip_threads_40660)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_40660 *= 2;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // last thread of block 'i' writes its result to offset 'i'\n        {\n            if ((local_tid_40636 - squot32(local_tid_40636, 32) * 32) == 31 &&\n                slt32(local_tid_40636, pts_per_node_at_lev_32225)) {\n                (",
            "(volatile __local\n                  int32_t *) mem_39772)[sext_i32_i64(squot32(local_tid_40636,\n                                                             32))] = x_37224;\n                ((volatile __local\n                  int32_t *) mem_39775)[sext_i32_i64(squot32(local_tid_40636,\n                                                             32))] = x_37225;\n                ((volatile __local\n                  int32_t *) mem_39778)[sext_i32_i64(squot32(local_tid_40636,\n                                                             32))] = x_37226;\n                ((volatile __local\n                  int32_t *) mem_39781)[sext_i32_i64(squot32(local_tid_40636,\n                                                             32))] = x_37227;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n        {\n            int32_t skip_threads_40662;\n            \n            // read input for in-block scan\n            {\n                if (squot32(local_tid_40636, 32) == 0 && slt32(local_tid_40636,\n                                                               pts_per_node_at_lev_32225)) {\n                    x_40652 = ((volatile __local\n                                int32_t *) mem_39772)[sext_i32_i64(local_tid_40636)];\n                    x_40653 = ((volatile __local\n                                int32_t *) mem_39775)[sext_i32_i64(local_tid_40636)];\n                    x_40654 = ((volatile __local\n                                int32_t *) mem_39778)[sext_i32_i64(local_tid_40636)];\n                    x_40655 = ((volatile __local\n                                int32_t *) mem_39781)[sext_i32_i64(local_tid_40636)];\n                    if ((local_tid_40636 - squot32(local_tid_40636, 32) * 32) ==\n                        0) {\n                        x_40648 = x_40652;\n                        x_40649 = x_40653;\n                        x_40650 = x_40654;\n                        x_40",
            "651 = x_40655;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_40662 = 1;\n                while (slt32(skip_threads_40662, 32)) {\n                    if (sle32(skip_threads_40662, local_tid_40636 -\n                              squot32(local_tid_40636, 32) * 32) &&\n                        (squot32(local_tid_40636, 32) == 0 &&\n                         slt32(local_tid_40636, pts_per_node_at_lev_32225))) {\n                        // read operands\n                        {\n                            x_40648 = ((volatile __local\n                                        int32_t *) mem_39772)[sext_i32_i64(local_tid_40636 -\n                                                              skip_threads_40662)];\n                            x_40649 = ((volatile __local\n                                        int32_t *) mem_39775)[sext_i32_i64(local_tid_40636 -\n                                                              skip_threads_40662)];\n                            x_40650 = ((volatile __local\n                                        int32_t *) mem_39778)[sext_i32_i64(local_tid_40636 -\n                                                              skip_threads_40662)];\n                            x_40651 = ((volatile __local\n                                        int32_t *) mem_39781)[sext_i32_i64(local_tid_40636 -\n                                                              skip_threads_40662)];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_40663 = slt32(srem32(local_tid_40636 *\n                                                               32 + 32 - 1,\n                                                               pts_per_node_at_lev_32225),\n                                                        local_tid_40636 * 32 +\n                                                        3",
            "2 - 1 -\n                                                        ((local_tid_40636 -\n                                                          skip_threads_40662) *\n                                                         32 + 32 - 1));\n                            \n                            if (inactive_40663) {\n                                x_40648 = x_40652;\n                                x_40649 = x_40653;\n                                x_40650 = x_40654;\n                                x_40651 = x_40655;\n                            }\n                            if (!inactive_40663) {\n                                int32_t res_40656 = add32(x_40648, x_40652);\n                                int32_t res_40657 = add32(x_40649, x_40653);\n                                int32_t res_40658 = add32(x_40650, x_40654);\n                                int32_t res_40659 = add32(x_40651, x_40655);\n                                \n                                x_40648 = res_40656;\n                                x_40649 = res_40657;\n                                x_40650 = res_40658;\n                                x_40651 = res_40659;\n                            }\n                        }\n                    }\n                    if (sle32(wave_sizze_40638, skip_threads_40662)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_40662, local_tid_40636 -\n                              squot32(local_tid_40636, 32) * 32) &&\n                        (squot32(local_tid_40636, 32) == 0 &&\n                         slt32(local_tid_40636, pts_per_node_at_lev_32225))) {\n                        // write result\n                        {\n                            ((volatile __local\n                              int32_t *) mem_39772)[sext_i32_i64(local_tid_40636)] =\n                                x_40648;\n                            x_40652 = x_40648;\n                            ((volatile __local\n            ",
            "                  int32_t *) mem_39775)[sext_i32_i64(local_tid_40636)] =\n                                x_40649;\n                            x_40653 = x_40649;\n                            ((volatile __local\n                              int32_t *) mem_39778)[sext_i32_i64(local_tid_40636)] =\n                                x_40650;\n                            x_40654 = x_40650;\n                            ((volatile __local\n                              int32_t *) mem_39781)[sext_i32_i64(local_tid_40636)] =\n                                x_40651;\n                            x_40655 = x_40651;\n                        }\n                    }\n                    if (sle32(wave_sizze_40638, skip_threads_40662)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_40662 *= 2;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // carry-in for every block except the first\n        {\n            if (!(squot32(local_tid_40636, 32) == 0 || !slt32(local_tid_40636,\n                                                              pts_per_node_at_lev_32225))) {\n                // read operands\n                {\n                    x_37228 = x_37224;\n                    x_37229 = x_37225;\n                    x_37230 = x_37226;\n                    x_37231 = x_37227;\n                    x_37224 = ((__local\n                                int32_t *) mem_39772)[sext_i32_i64(squot32(local_tid_40636,\n                                                                           32) -\n                                                      1)];\n                    x_37225 = ((__local\n                                int32_t *) mem_39775)[sext_i32_i64(squot32(local_tid_40636,\n                                                                           32) -\n                                                      1)];\n                    x_37226 = ((__local\n                                int32_t *) mem_39778)",
            "[sext_i32_i64(squot32(local_tid_40636,\n                                                                           32) -\n                                                      1)];\n                    x_37227 = ((__local\n                                int32_t *) mem_39781)[sext_i32_i64(squot32(local_tid_40636,\n                                                                           32) -\n                                                      1)];\n                }\n                // perform operation\n                {\n                    bool inactive_40664 = slt32(srem32(local_tid_40636,\n                                                       pts_per_node_at_lev_32225),\n                                                local_tid_40636 -\n                                                (squot32(local_tid_40636, 32) *\n                                                 32 - 1));\n                    \n                    if (inactive_40664) {\n                        x_37224 = x_37228;\n                        x_37225 = x_37229;\n                        x_37226 = x_37230;\n                        x_37227 = x_37231;\n                    }\n                    if (!inactive_40664) {\n                        int32_t res_37232 = add32(x_37224, x_37228);\n                        int32_t res_37233 = add32(x_37225, x_37229);\n                        int32_t res_37234 = add32(x_37226, x_37230);\n                        int32_t res_37235 = add32(x_37227, x_37231);\n                        \n                        x_37224 = res_37232;\n                        x_37225 = res_37233;\n                        x_37226 = res_37234;\n                        x_37227 = res_37235;\n                    }\n                }\n                // write final result\n                {\n                    ((__local\n                      int32_t *) mem_39772)[sext_i32_i64(local_tid_40636)] =\n                        x_37224;\n                    ((__local\n                      int32_t *) mem_39775)[sext_i32_i64(local_tid_40",
            "636)] =\n                        x_37225;\n                    ((__local\n                      int32_t *) mem_39778)[sext_i32_i64(local_tid_40636)] =\n                        x_37226;\n                    ((__local\n                      int32_t *) mem_39781)[sext_i32_i64(local_tid_40636)] =\n                        x_37227;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // restore correct values for first block\n        {\n            if (squot32(local_tid_40636, 32) == 0) {\n                ((__local int32_t *) mem_39772)[sext_i32_i64(local_tid_40636)] =\n                    x_37228;\n                ((__local int32_t *) mem_39775)[sext_i32_i64(local_tid_40636)] =\n                    x_37229;\n                ((__local int32_t *) mem_39778)[sext_i32_i64(local_tid_40636)] =\n                    x_37230;\n                ((__local int32_t *) mem_39781)[sext_i32_i64(local_tid_40636)] =\n                    x_37231;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t res_37269 = ((__local\n                              int32_t *) mem_39772)[sext_i32_i64(i_32324)];\n        int32_t res_37270 = ((__local\n                              int32_t *) mem_39775)[sext_i32_i64(i_32324)];\n        int32_t res_37271 = ((__local\n                              int32_t *) mem_39778)[sext_i32_i64(i_32324)];\n        \n        ((__local float *) mem_39787)[sext_i32_i64(local_tid_40636)] = ((__local\n                                                                         float *) double_buffer_mem_40108)[sext_i32_i64(local_tid_40636)];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ((__local int32_t *) mem_39790)[sext_i32_i64(local_tid_40636)] =\n            ((__global\n              int32_t *) double_buffer_mem_40109)[sext_i32_i64(phys_tid_36940 *\n                                                  pts_per_node_at_lev_32225) +\n                                                  sext_i32_i64(local_tid_40636)];\n        barrier(CLK_LOCAL_MEM",
            "_FENCE);\n        \n        int32_t write_i_36928 = ltid_pre_40640;\n        int32_t phys_tid_36929 = local_tid_40636;\n        \n        if (slt32(write_i_36928, pts_per_node_at_lev_32225)) {\n            int32_t x_37276 = ((__local\n                                int32_t *) mem_39784)[sext_i32_i64(write_i_36928)];\n            float write_value_37281 = ((__local\n                                        float *) double_buffer_mem_40108)[sext_i32_i64(write_i_36928)];\n            int32_t write_value_37282 = ((__global\n                                          int32_t *) double_buffer_mem_40109)[sext_i32_i64(phys_tid_36940 *\n                                                                              pts_per_node_at_lev_32225) +\n                                                                              sext_i32_i64(write_i_36928)];\n            bool match_lit_37283 = 0 == x_37276;\n            int32_t res_37284;\n            \n            if (match_lit_37283) {\n                int32_t x_37277 = ((__local\n                                    int32_t *) mem_39772)[sext_i32_i64(write_i_36928)];\n                int32_t res_37285 = sub32(x_37277, 1);\n                \n                res_37284 = res_37285;\n            } else {\n                int32_t x_37278 = ((__local\n                                    int32_t *) mem_39775)[sext_i32_i64(write_i_36928)];\n                int32_t x_37279 = ((__local\n                                    int32_t *) mem_39778)[sext_i32_i64(write_i_36928)];\n                int32_t x_37280 = ((__local\n                                    int32_t *) mem_39781)[sext_i32_i64(write_i_36928)];\n                bool match_lit_37286 = 1 == x_37276;\n                int32_t x_37287;\n                \n                if (match_lit_37286) {\n                    int32_t x_37288 = add32(res_37269, x_37278);\n                    int32_t res_37289 = sub32(x_37288, 1);\n                    \n                    x_37287 = res_37289;\n                } else {\n                    b",
            "ool match_lit_37290 = 2 == x_37276;\n                    int32_t x_37291;\n                    \n                    if (match_lit_37290) {\n                        int32_t x_37292 = add32(res_37269, res_37270);\n                        int32_t x_37293 = add32(x_37279, x_37292);\n                        int32_t res_37294 = sub32(x_37293, 1);\n                        \n                        x_37291 = res_37294;\n                    } else {\n                        int32_t x_37295 = add32(res_37269, res_37270);\n                        int32_t x_37296 = add32(res_37271, x_37295);\n                        int32_t x_37297 = add32(x_37280, x_37296);\n                        int32_t res_37298 = sub32(x_37297, 1);\n                        \n                        x_37291 = res_37298;\n                    }\n                    x_37287 = x_37291;\n                }\n                res_37284 = x_37287;\n            }\n            if (sle32(0, res_37284) && slt32(res_37284,\n                                             pts_per_node_at_lev_32225)) {\n                ((__local float *) mem_39787)[sext_i32_i64(res_37284)] =\n                    write_value_37281;\n            }\n            if (sle32(0, res_37284) && slt32(res_37284,\n                                             pts_per_node_at_lev_32225)) {\n                ((__local int32_t *) mem_39790)[sext_i32_i64(res_37284)] =\n                    write_value_37282;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ((__local\n          float *) double_buffer_mem_40108)[sext_i32_i64(local_tid_40636)] =\n            ((__local float *) mem_39787)[sext_i32_i64(local_tid_40636)];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ((__global\n          int32_t *) double_buffer_mem_40109)[sext_i32_i64(phys_tid_36940 *\n                                              pts_per_node_at_lev_32225) +\n                                              sext_i32_i64(local_tid_40636)] =\n            ((__local int32_t *) mem_39790)[sext_i32_i64(local_tid_40636)",
            "];\n        barrier(CLK_LOCAL_MEM_FENCE);\n    }\n    \n    __local char *mem_39813;\n    \n    mem_39813 = (__local char *) mem_39813_backing_9;\n    \n    __local char *mem_39816;\n    \n    mem_39816 = (__local char *) mem_39816_backing_10;\n    \n    int32_t gtid_36930 = ltid_pre_40640;\n    int32_t phys_tid_36931 = local_tid_40636;\n    \n    if (slt32(gtid_36930, pts_per_node_at_lev_32225)) {\n        int32_t x_37301 = ((__global\n                            int32_t *) double_buffer_mem_40109)[sext_i32_i64(phys_tid_36940 *\n                                                                pts_per_node_at_lev_32225) +\n                                                                sext_i32_i64(gtid_36930)];\n        bool x_37302 = sle32(0, x_37301);\n        bool y_37303 = slt32(x_37301, pts_per_node_at_lev_32225);\n        bool bounds_check_37304 = x_37302 && y_37303;\n        bool index_certs_37305;\n        \n        if (!bounds_check_37304) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 20) == -1) {\n                    global_failure_args[0] = x_37301;\n                    global_failure_args[1] = pts_per_node_at_lev_32225;\n                    ;\n                }\n                local_failure = true;\n                goto error_3;\n            }\n        }\n        \n        float res_37306 = ((__local float *) mem_39754)[sext_i32_i64(x_37301)];\n        bool index_certs_37307;\n        \n        if (!bounds_check_37304) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 21) == -1) {\n                    global_failure_args[0] = x_37301;\n                    global_failure_args[1] = pts_per_node_at_lev_32225;\n                    ;\n                }\n                local_failure = true;\n                goto error_3;\n            }\n        }\n        \n        int32_t new_index_39312 = x_37301 + binop_x_39309;\n        int32_t res_37308 = ((__global\n                              int32_t *) mem_param_39466)[sext_i32_i64(new_index_39312",
            ")];\n        \n        ((__local int32_t *) mem_39813)[sext_i32_i64(gtid_36930)] = res_37308;\n        ((__local float *) mem_39816)[sext_i32_i64(gtid_36930)] = res_37306;\n    }\n    \n  error_3:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ((__global int32_t *) mem_39821)[sext_i32_i64(gtid_36911) *\n                                     sext_i32_i64(pts_per_node_at_lev_32225) +\n                                     sext_i32_i64(local_tid_40636)] = ((__local\n                                                                        int32_t *) mem_39813)[sext_i32_i64(local_tid_40636)];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ((__global float *) mem_39826)[sext_i32_i64(gtid_36911) *\n                                   sext_i32_i64(pts_per_node_at_lev_32225) +\n                                   sext_i32_i64(local_tid_40636)] = ((__local\n                                                                      float *) mem_39816)[sext_i32_i64(local_tid_40636)];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n  error_4:\n    return;\n}\n__kernel void buildKDtreezisegmap_intragroup_37393(__global int *global_failure,\n                                                   uint mem_39888_backing_offset_0,\n                                                   uint mem_39885_backing_offset_1,\n                                                   uint mem_39882_backing_offset_2,\n                                                   uint mem_39879_backing_offset_3,\n                                                   uint mem_39876_backing_offset_4,\n                                                   uint mem_39873_backing_offset_5,\n                                                   uint mem_39870_backing_offset_6,\n                                                   int32_t nodes_this_lvl_32221,\n                                                   int32_t pts_per_node_at_lev_32225,\n                                                   int32_t i_32324,\n            ",
            "                                       int32_t lifted_2_radix_sort_step_arg_38052,\n                                                   int32_t lifted_0_get_bit_arg_38053,\n                                                   unsigned char res_38054,\n                                                   unsigned char res_38055,\n                                                   __global\n                                                   unsigned char *mem_param_39843,\n                                                   __global\n                                                   unsigned char *mem_param_39851,\n                                                   __global\n                                                   unsigned char *mem_39860,\n                                                   __global\n                                                   unsigned char *mem_39865,\n                                                   __global\n                                                   unsigned char *mem_39894,\n                                                   __global\n                                                   unsigned char *mem_39899)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *mem_39888_backing_6 =\n                  &shared_mem[mem_39888_backing_offset_0];\n    volatile char *mem_39885_backing_5 =\n                  &shared_mem[mem_39885_backing_offset_1];\n    volatile char *mem_39882_backing_4 =\n                  &shared_mem[mem_39882_backing_offset_2];\n    volatile char *mem_39879_backing_3 =\n                  &shared_mem[mem_39879_backing_offset_3];\n    volatile char *mem_39876_backing_2 =\n                  &shared_mem[mem_39876_backing_offset_4];\n    volatile char *mem_39873_backing_1 =\n                  &shared_mem[mem_39873_backing_offset_5];\n    volatile char *mem_39870_backing_0 =\n                  &shared_mem[mem_39870_backing_offset_6];\n    \n    if (*global_failure >= 0)\n        return;\n ",
            "   \n    int32_t global_tid_40679;\n    int32_t local_tid_40680;\n    int32_t group_sizze_40683;\n    int32_t wave_sizze_40682;\n    int32_t group_tid_40681;\n    \n    global_tid_40679 = get_global_id(0);\n    local_tid_40680 = get_local_id(0);\n    group_sizze_40683 = get_local_size(0);\n    wave_sizze_40682 = LOCKSTEP_WIDTH;\n    group_tid_40681 = get_group_id(0);\n    \n    int32_t phys_tid_37393;\n    \n    phys_tid_37393 = group_tid_40681;\n    \n    int32_t ltid_pre_40684;\n    \n    ltid_pre_40684 = local_tid_40680;\n    \n    int32_t gtid_37386;\n    \n    gtid_37386 = group_tid_40681;\n    \n    __local char *mem_39870;\n    \n    mem_39870 = (__local char *) mem_39870_backing_0;\n    \n    __local char *mem_39873;\n    \n    mem_39873 = (__local char *) mem_39873_backing_1;\n    \n    __local char *mem_39876;\n    \n    mem_39876 = (__local char *) mem_39876_backing_2;\n    \n    __local char *mem_39879;\n    \n    mem_39879 = (__local char *) mem_39879_backing_3;\n    \n    __local char *mem_39882;\n    \n    mem_39882 = (__local char *) mem_39882_backing_4;\n    \n    int32_t gtid_37389 = ltid_pre_40684;\n    int32_t phys_tid_37390 = local_tid_40680;\n    \n    if (slt32(gtid_37389, pts_per_node_at_lev_32225)) {\n        float x_38088 = ((__global\n                          float *) mem_param_39843)[sext_i32_i64(gtid_37386) *\n                                                    sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                    sext_i32_i64(gtid_37389)];\n        int32_t i32_arg_38089;\n        \n        i32_arg_38089 = futrts_to_bits32(x_38088);\n        \n        int32_t unsign_arg_38090 = ashr32(i32_arg_38089,\n                                          lifted_0_get_bit_arg_38053);\n        int32_t unsign_arg_38091 = 1 & unsign_arg_38090;\n        int32_t unsign_arg_38092 = ashr32(i32_arg_38089, 31);\n        int32_t unsign_arg_38093 = 1 & unsign_arg_38092;\n        bool cond_38094 = unsign_arg_38093 == 1;\n        bool x_38095 = !cond_38094;\n        bool y_38096 = res_",
            "38054 && x_38095;\n        bool cond_38097 = cond_38094 || y_38096;\n        int32_t res_38098;\n        \n        if (cond_38097) {\n            int32_t res_38099 = 1 ^ unsign_arg_38091;\n            \n            res_38098 = res_38099;\n        } else {\n            res_38098 = unsign_arg_38091;\n        }\n        \n        int32_t x_38100 = mul32(2, res_38098);\n        int32_t unsign_arg_38101 = ashr32(i32_arg_38089,\n                                          lifted_2_radix_sort_step_arg_38052);\n        int32_t unsign_arg_38102 = 1 & unsign_arg_38101;\n        bool y_38103 = res_38055 && x_38095;\n        bool cond_38104 = cond_38094 || y_38103;\n        int32_t res_38105;\n        \n        if (cond_38104) {\n            int32_t res_38106 = 1 ^ unsign_arg_38102;\n            \n            res_38105 = res_38106;\n        } else {\n            res_38105 = unsign_arg_38102;\n        }\n        \n        int32_t res_38107 = add32(x_38100, res_38105);\n        bool cond_38108 = res_38107 == 0;\n        int32_t res_38109 = btoi_bool_i32(cond_38108);\n        int32_t res_38110;\n        int32_t res_38111;\n        int32_t res_38112;\n        \n        if (cond_38108) {\n            res_38110 = 0;\n            res_38111 = 0;\n            res_38112 = 0;\n        } else {\n            bool cond_38113 = res_38107 == 1;\n            int32_t res_38114 = btoi_bool_i32(cond_38113);\n            int32_t res_38115;\n            int32_t res_38116;\n            \n            if (cond_38113) {\n                res_38115 = 0;\n                res_38116 = 0;\n            } else {\n                bool cond_38117 = res_38107 == 2;\n                int32_t res_38118 = btoi_bool_i32(cond_38117);\n                bool cond_neg_38119 = !cond_38117;\n                int32_t res_38120 = btoi_bool_i32(cond_neg_38119);\n                \n                res_38115 = res_38118;\n                res_38116 = res_38120;\n            }\n            res_38110 = res_38114;\n            res_38111 = res_38115;\n            res_38112 = res_38116;\n        }\n ",
            "       ((__local int32_t *) mem_39870)[sext_i32_i64(gtid_37389)] = res_38109;\n        ((__local int32_t *) mem_39873)[sext_i32_i64(gtid_37389)] = res_38110;\n        ((__local int32_t *) mem_39876)[sext_i32_i64(gtid_37389)] = res_38111;\n        ((__local int32_t *) mem_39879)[sext_i32_i64(gtid_37389)] = res_38112;\n        ((__local int32_t *) mem_39882)[sext_i32_i64(gtid_37389)] = res_38107;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t dims_flat_40685;\n    \n    dims_flat_40685 = pts_per_node_at_lev_32225;\n    \n    int32_t x_38076;\n    int32_t x_38077;\n    int32_t x_38078;\n    int32_t x_38079;\n    int32_t x_38080;\n    int32_t x_38081;\n    int32_t x_38082;\n    int32_t x_38083;\n    int32_t x_40690;\n    int32_t x_40691;\n    int32_t x_40692;\n    int32_t x_40693;\n    int32_t x_40694;\n    int32_t x_40695;\n    int32_t x_40696;\n    int32_t x_40697;\n    int32_t skip_threads_40702;\n    \n    // read input for in-block scan\n    {\n        if (slt32(local_tid_40680, pts_per_node_at_lev_32225)) {\n            x_38080 = ((volatile __local\n                        int32_t *) mem_39870)[sext_i32_i64(local_tid_40680)];\n            x_38081 = ((volatile __local\n                        int32_t *) mem_39873)[sext_i32_i64(local_tid_40680)];\n            x_38082 = ((volatile __local\n                        int32_t *) mem_39876)[sext_i32_i64(local_tid_40680)];\n            x_38083 = ((volatile __local\n                        int32_t *) mem_39879)[sext_i32_i64(local_tid_40680)];\n            if ((local_tid_40680 - squot32(local_tid_40680, 32) * 32) == 0) {\n                x_38076 = x_38080;\n                x_38077 = x_38081;\n                x_38078 = x_38082;\n                x_38079 = x_38083;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_40702 = 1;\n        while (slt32(skip_threads_40702, 32)) {\n            if (sle32(skip_threads_40702, local_tid_40680 -\n                      squot32(local_tid_40680, 32) * 32) &&\n           ",
            "     slt32(local_tid_40680, pts_per_node_at_lev_32225)) {\n                // read operands\n                {\n                    x_38076 = ((volatile __local\n                                int32_t *) mem_39870)[sext_i32_i64(local_tid_40680 -\n                                                      skip_threads_40702)];\n                    x_38077 = ((volatile __local\n                                int32_t *) mem_39873)[sext_i32_i64(local_tid_40680 -\n                                                      skip_threads_40702)];\n                    x_38078 = ((volatile __local\n                                int32_t *) mem_39876)[sext_i32_i64(local_tid_40680 -\n                                                      skip_threads_40702)];\n                    x_38079 = ((volatile __local\n                                int32_t *) mem_39879)[sext_i32_i64(local_tid_40680 -\n                                                      skip_threads_40702)];\n                }\n                // perform operation\n                {\n                    bool inactive_40703 = slt32(srem32(local_tid_40680,\n                                                       pts_per_node_at_lev_32225),\n                                                local_tid_40680 -\n                                                (local_tid_40680 -\n                                                 skip_threads_40702));\n                    \n                    if (inactive_40703) {\n                        x_38076 = x_38080;\n                        x_38077 = x_38081;\n                        x_38078 = x_38082;\n                        x_38079 = x_38083;\n                    }\n                    if (!inactive_40703) {\n                        int32_t res_38084 = add32(x_38076, x_38080);\n                        int32_t res_38085 = add32(x_38077, x_38081);\n                        int32_t res_38086 = add32(x_38078, x_38082);\n                        int32_t res_38087 = add32(x_38079, x_38083);\n                        \n                  ",
            "      x_38076 = res_38084;\n                        x_38077 = res_38085;\n                        x_38078 = res_38086;\n                        x_38079 = res_38087;\n                    }\n                }\n            }\n            if (sle32(wave_sizze_40682, skip_threads_40702)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_40702, local_tid_40680 -\n                      squot32(local_tid_40680, 32) * 32) &&\n                slt32(local_tid_40680, pts_per_node_at_lev_32225)) {\n                // write result\n                {\n                    ((volatile __local\n                      int32_t *) mem_39870)[sext_i32_i64(local_tid_40680)] =\n                        x_38076;\n                    x_38080 = x_38076;\n                    ((volatile __local\n                      int32_t *) mem_39873)[sext_i32_i64(local_tid_40680)] =\n                        x_38077;\n                    x_38081 = x_38077;\n                    ((volatile __local\n                      int32_t *) mem_39876)[sext_i32_i64(local_tid_40680)] =\n                        x_38078;\n                    x_38082 = x_38078;\n                    ((volatile __local\n                      int32_t *) mem_39879)[sext_i32_i64(local_tid_40680)] =\n                        x_38079;\n                    x_38083 = x_38079;\n                }\n            }\n            if (sle32(wave_sizze_40682, skip_threads_40702)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_40702 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_40680 - squot32(local_tid_40680, 32) * 32) == 31 &&\n            slt32(local_tid_40680, pts_per_node_at_lev_32225)) {\n            ((volatile __local\n              int32_t *) mem_39870)[sext_i32_i64(squot32(local_tid_40680,\n                                                         32))] = x_38076;\n            ((volatile __local\n        ",
            "      int32_t *) mem_39873)[sext_i32_i64(squot32(local_tid_40680,\n                                                         32))] = x_38077;\n            ((volatile __local\n              int32_t *) mem_39876)[sext_i32_i64(squot32(local_tid_40680,\n                                                         32))] = x_38078;\n            ((volatile __local\n              int32_t *) mem_39879)[sext_i32_i64(squot32(local_tid_40680,\n                                                         32))] = x_38079;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_40704;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_40680, 32) == 0 && slt32(local_tid_40680,\n                                                           pts_per_node_at_lev_32225)) {\n                x_40694 = ((volatile __local\n                            int32_t *) mem_39870)[sext_i32_i64(local_tid_40680)];\n                x_40695 = ((volatile __local\n                            int32_t *) mem_39873)[sext_i32_i64(local_tid_40680)];\n                x_40696 = ((volatile __local\n                            int32_t *) mem_39876)[sext_i32_i64(local_tid_40680)];\n                x_40697 = ((volatile __local\n                            int32_t *) mem_39879)[sext_i32_i64(local_tid_40680)];\n                if ((local_tid_40680 - squot32(local_tid_40680, 32) * 32) ==\n                    0) {\n                    x_40690 = x_40694;\n                    x_40691 = x_40695;\n                    x_40692 = x_40696;\n                    x_40693 = x_40697;\n                }\n            }\n        }\n        // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_40704 = 1;\n            while (slt32(skip_threads_40704, 32)) {\n                if (sle32(skip_threads_40704, local_tid_40680 -\n                          squot32(local_tid_40680, 32) * 32) &&\n          ",
            "          (squot32(local_tid_40680, 32) == 0 && slt32(local_tid_40680,\n                                                                pts_per_node_at_lev_32225))) {\n                    // read operands\n                    {\n                        x_40690 = ((volatile __local\n                                    int32_t *) mem_39870)[sext_i32_i64(local_tid_40680 -\n                                                          skip_threads_40704)];\n                        x_40691 = ((volatile __local\n                                    int32_t *) mem_39873)[sext_i32_i64(local_tid_40680 -\n                                                          skip_threads_40704)];\n                        x_40692 = ((volatile __local\n                                    int32_t *) mem_39876)[sext_i32_i64(local_tid_40680 -\n                                                          skip_threads_40704)];\n                        x_40693 = ((volatile __local\n                                    int32_t *) mem_39879)[sext_i32_i64(local_tid_40680 -\n                                                          skip_threads_40704)];\n                    }\n                    // perform operation\n                    {\n                        bool inactive_40705 = slt32(srem32(local_tid_40680 *\n                                                           32 + 32 - 1,\n                                                           pts_per_node_at_lev_32225),\n                                                    local_tid_40680 * 32 + 32 -\n                                                    1 - ((local_tid_40680 -\n                                                          skip_threads_40704) *\n                                                         32 + 32 - 1));\n                        \n                        if (inactive_40705) {\n                            x_40690 = x_40694;\n                            x_40691 = x_40695;\n                            x_40692 = x_40696;\n                            x_40693 = x_40697;",
            "\n                        }\n                        if (!inactive_40705) {\n                            int32_t res_40698 = add32(x_40690, x_40694);\n                            int32_t res_40699 = add32(x_40691, x_40695);\n                            int32_t res_40700 = add32(x_40692, x_40696);\n                            int32_t res_40701 = add32(x_40693, x_40697);\n                            \n                            x_40690 = res_40698;\n                            x_40691 = res_40699;\n                            x_40692 = res_40700;\n                            x_40693 = res_40701;\n                        }\n                    }\n                }\n                if (sle32(wave_sizze_40682, skip_threads_40704)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_40704, local_tid_40680 -\n                          squot32(local_tid_40680, 32) * 32) &&\n                    (squot32(local_tid_40680, 32) == 0 && slt32(local_tid_40680,\n                                                                pts_per_node_at_lev_32225))) {\n                    // write result\n                    {\n                        ((volatile __local\n                          int32_t *) mem_39870)[sext_i32_i64(local_tid_40680)] =\n                            x_40690;\n                        x_40694 = x_40690;\n                        ((volatile __local\n                          int32_t *) mem_39873)[sext_i32_i64(local_tid_40680)] =\n                            x_40691;\n                        x_40695 = x_40691;\n                        ((volatile __local\n                          int32_t *) mem_39876)[sext_i32_i64(local_tid_40680)] =\n                            x_40692;\n                        x_40696 = x_40692;\n                        ((volatile __local\n                          int32_t *) mem_39879)[sext_i32_i64(local_tid_40680)] =\n                            x_40693;\n                        x_40697 = x_40693;\n                    }\n        ",
            "        }\n                if (sle32(wave_sizze_40682, skip_threads_40704)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_40704 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_40680, 32) == 0 || !slt32(local_tid_40680,\n                                                          pts_per_node_at_lev_32225))) {\n            // read operands\n            {\n                x_38080 = x_38076;\n                x_38081 = x_38077;\n                x_38082 = x_38078;\n                x_38083 = x_38079;\n                x_38076 = ((__local\n                            int32_t *) mem_39870)[sext_i32_i64(squot32(local_tid_40680,\n                                                                       32) -\n                                                  1)];\n                x_38077 = ((__local\n                            int32_t *) mem_39873)[sext_i32_i64(squot32(local_tid_40680,\n                                                                       32) -\n                                                  1)];\n                x_38078 = ((__local\n                            int32_t *) mem_39876)[sext_i32_i64(squot32(local_tid_40680,\n                                                                       32) -\n                                                  1)];\n                x_38079 = ((__local\n                            int32_t *) mem_39879)[sext_i32_i64(squot32(local_tid_40680,\n                                                                       32) -\n                                                  1)];\n            }\n            // perform operation\n            {\n                bool inactive_40706 = slt32(srem32(local_tid_40680,\n                                                   pts_per_node_at_lev_32225),\n                                            local_tid_40680 -\n                                            (squot32(l",
            "ocal_tid_40680, 32) * 32 -\n                                             1));\n                \n                if (inactive_40706) {\n                    x_38076 = x_38080;\n                    x_38077 = x_38081;\n                    x_38078 = x_38082;\n                    x_38079 = x_38083;\n                }\n                if (!inactive_40706) {\n                    int32_t res_38084 = add32(x_38076, x_38080);\n                    int32_t res_38085 = add32(x_38077, x_38081);\n                    int32_t res_38086 = add32(x_38078, x_38082);\n                    int32_t res_38087 = add32(x_38079, x_38083);\n                    \n                    x_38076 = res_38084;\n                    x_38077 = res_38085;\n                    x_38078 = res_38086;\n                    x_38079 = res_38087;\n                }\n            }\n            // write final result\n            {\n                ((__local int32_t *) mem_39870)[sext_i32_i64(local_tid_40680)] =\n                    x_38076;\n                ((__local int32_t *) mem_39873)[sext_i32_i64(local_tid_40680)] =\n                    x_38077;\n                ((__local int32_t *) mem_39876)[sext_i32_i64(local_tid_40680)] =\n                    x_38078;\n                ((__local int32_t *) mem_39879)[sext_i32_i64(local_tid_40680)] =\n                    x_38079;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_40680, 32) == 0) {\n            ((__local int32_t *) mem_39870)[sext_i32_i64(local_tid_40680)] =\n                x_38080;\n            ((__local int32_t *) mem_39873)[sext_i32_i64(local_tid_40680)] =\n                x_38081;\n            ((__local int32_t *) mem_39876)[sext_i32_i64(local_tid_40680)] =\n                x_38082;\n            ((__local int32_t *) mem_39879)[sext_i32_i64(local_tid_40680)] =\n                x_38083;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t res_38121 = ((__local int32_t *) mem_39870)[sext_i",
            "32_i64(i_32324)];\n    int32_t res_38122 = ((__local int32_t *) mem_39873)[sext_i32_i64(i_32324)];\n    int32_t res_38123 = ((__local int32_t *) mem_39876)[sext_i32_i64(i_32324)];\n    __local char *mem_39885;\n    \n    mem_39885 = (__local char *) mem_39885_backing_5;\n    ((__local float *) mem_39885)[sext_i32_i64(local_tid_40680)] = ((__global\n                                                                     float *) mem_39860)[sext_i32_i64(gtid_37386) +\n                                                                                         sext_i32_i64(local_tid_40680) *\n                                                                                         sext_i32_i64(nodes_this_lvl_32221)];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    __local char *mem_39888;\n    \n    mem_39888 = (__local char *) mem_39888_backing_6;\n    ((__local int32_t *) mem_39888)[sext_i32_i64(local_tid_40680)] = ((__global\n                                                                       int32_t *) mem_39865)[sext_i32_i64(gtid_37386) +\n                                                                                             sext_i32_i64(local_tid_40680) *\n                                                                                             sext_i32_i64(nodes_this_lvl_32221)];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t write_i_37391 = ltid_pre_40684;\n    int32_t phys_tid_37392 = local_tid_40680;\n    \n    if (slt32(write_i_37391, pts_per_node_at_lev_32225)) {\n        int32_t x_38128 = ((__local\n                            int32_t *) mem_39882)[sext_i32_i64(write_i_37391)];\n        float write_value_38133 = ((__global\n                                    float *) mem_param_39843)[sext_i32_i64(gtid_37386) *\n                                                              sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                              sext_i32_i64(write_i_37391)];\n        int32_t write_value_38134 = ((__global\n                         ",
            "             int32_t *) mem_param_39851)[sext_i32_i64(gtid_37386) *\n                                                                  sext_i32_i64(pts_per_node_at_lev_32225) +\n                                                                  sext_i32_i64(write_i_37391)];\n        bool match_lit_38135 = 0 == x_38128;\n        int32_t res_38136;\n        \n        if (match_lit_38135) {\n            int32_t x_38129 = ((__local\n                                int32_t *) mem_39870)[sext_i32_i64(write_i_37391)];\n            int32_t res_38137 = sub32(x_38129, 1);\n            \n            res_38136 = res_38137;\n        } else {\n            int32_t x_38130 = ((__local\n                                int32_t *) mem_39873)[sext_i32_i64(write_i_37391)];\n            int32_t x_38131 = ((__local\n                                int32_t *) mem_39876)[sext_i32_i64(write_i_37391)];\n            int32_t x_38132 = ((__local\n                                int32_t *) mem_39879)[sext_i32_i64(write_i_37391)];\n            bool match_lit_38138 = 1 == x_38128;\n            int32_t x_38139;\n            \n            if (match_lit_38138) {\n                int32_t x_38140 = add32(res_38121, x_38130);\n                int32_t res_38141 = sub32(x_38140, 1);\n                \n                x_38139 = res_38141;\n            } else {\n                bool match_lit_38142 = 2 == x_38128;\n                int32_t x_38143;\n                \n                if (match_lit_38142) {\n                    int32_t x_38144 = add32(res_38121, res_38122);\n                    int32_t x_38145 = add32(x_38131, x_38144);\n                    int32_t res_38146 = sub32(x_38145, 1);\n                    \n                    x_38143 = res_38146;\n                } else {\n                    int32_t x_38147 = add32(res_38121, res_38122);\n                    int32_t x_38148 = add32(res_38123, x_38147);\n                    int32_t x_38149 = add32(x_38132, x_38148);\n                    int32_t res_38150 = sub32(x_38149, 1);\n               ",
            "     \n                    x_38143 = res_38150;\n                }\n                x_38139 = x_38143;\n            }\n            res_38136 = x_38139;\n        }\n        if (sle32(0, res_38136) && slt32(res_38136,\n                                         pts_per_node_at_lev_32225)) {\n            ((__local float *) mem_39885)[sext_i32_i64(res_38136)] =\n                write_value_38133;\n        }\n        if (sle32(0, res_38136) && slt32(res_38136,\n                                         pts_per_node_at_lev_32225)) {\n            ((__local int32_t *) mem_39888)[sext_i32_i64(res_38136)] =\n                write_value_38134;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ((__global float *) mem_39894)[sext_i32_i64(gtid_37386) *\n                                   sext_i32_i64(pts_per_node_at_lev_32225) +\n                                   sext_i32_i64(local_tid_40680)] = ((__local\n                                                                      float *) mem_39885)[sext_i32_i64(local_tid_40680)];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ((__global int32_t *) mem_39899)[sext_i32_i64(gtid_37386) *\n                                     sext_i32_i64(pts_per_node_at_lev_32225) +\n                                     sext_i32_i64(local_tid_40680)] = ((__local\n                                                                        int32_t *) mem_39888)[sext_i32_i64(local_tid_40680)];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n  error_2:\n    return;\n}\n__kernel void buildKDtreezisegred_large_36352(__global int *global_failure,\n                                              uint sync_arr_mem_40357_backing_offset_0,\n                                              uint red_arr_mem_40355_backing_offset_1,\n                                              int32_t m_32135,\n                                              int32_t num_groups_36363, __global\n                                              unsigned char *mem_39427, __global\n                                              unsigned char *mem_",
            "39431,\n                                              int32_t groups_per_segment_40341,\n                                              int32_t elements_per_thread_40342,\n                                              int32_t virt_num_groups_40343,\n                                              int32_t threads_per_segment_40345,\n                                              __global\n                                              unsigned char *group_res_arr_mem_40346,\n                                              __global\n                                              unsigned char *buildKDtreezicounter_mem_40348)\n{\n    #define segred_group_sizze_36362 (buildKDtreezisegred_group_sizze_36346)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *sync_arr_mem_40357_backing_1 =\n                  &shared_mem[sync_arr_mem_40357_backing_offset_0];\n    volatile char *red_arr_mem_40355_backing_0 =\n                  &shared_mem[red_arr_mem_40355_backing_offset_1];\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40350;\n    int32_t local_tid_40351;\n    int32_t group_sizze_40354;\n    int32_t wave_sizze_40353;\n    int32_t group_tid_40352;\n    \n    global_tid_40350 = get_global_id(0);\n    local_tid_40351 = get_local_id(0);\n    group_sizze_40354 = get_local_size(0);\n    wave_sizze_40353 = LOCKSTEP_WIDTH;\n    group_tid_40352 = get_group_id(0);\n    \n    int32_t phys_tid_36352;\n    \n    phys_tid_36352 = global_tid_40350;\n    \n    __local char *red_arr_mem_40355;\n    \n    red_arr_mem_40355 = (__local char *) red_arr_mem_40355_backing_0;\n    \n    __local char *sync_arr_mem_40357;\n    \n    sync_arr_mem_40357 = (__local char *) sync_arr_mem_40357_backing_1;\n    \n    int32_t phys_group_id_40359;\n    \n    phys_group_id_40359 = get_group_id(0);\n    for (int32_t i_40360 = 0; i_40360 < sdiv_up32(virt_num_groups_40343 -\n                                                  phys_group_id_40359,\n                     ",
            "                             num_groups_36363);\n         i_40360++) {\n        int32_t virt_group_id_40361 = phys_group_id_40359 + i_40360 *\n                num_groups_36363;\n        int32_t flat_segment_id_40362 = squot32(virt_group_id_40361,\n                                                groups_per_segment_40341);\n        int32_t global_tid_40363 = srem32(virt_group_id_40361 *\n                                          segred_group_sizze_36362 +\n                                          local_tid_40351,\n                                          segred_group_sizze_36362 *\n                                          groups_per_segment_40341);\n        int32_t gtid_36341 = flat_segment_id_40362;\n        int32_t gtid_36351;\n        float x_acc_40364;\n        int32_t chunk_sizze_40365;\n        \n        chunk_sizze_40365 = smin32(elements_per_thread_40342,\n                                   sdiv_up32(m_32135 - global_tid_40363,\n                                             threads_per_segment_40345));\n        \n        float x_36366;\n        float x_36367;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_40364 = INFINITY;\n        }\n        for (int32_t i_40369 = 0; i_40369 < chunk_sizze_40365; i_40369++) {\n            gtid_36351 = global_tid_40363 + threads_per_segment_40345 * i_40369;\n            // apply map function\n            {\n                float x_36370 = ((__global\n                                  float *) mem_39427)[sext_i32_i64(gtid_36341) *\n                                                      sext_i32_i64(m_32135) +\n                                                      sext_i32_i64(gtid_36351)];\n                \n                // save map-out results\n                { }\n                // load accumulator\n                {\n                    x_36366 = x_acc_40364;\n                }\n                // load new values\n                {\n                    x_36367 = x_36370;\n                }\n                // apply reduction ",
            "operator\n                {\n                    float res_36368 = fmin32(x_36366, x_36367);\n                    \n                    // store in accumulator\n                    {\n                        x_acc_40364 = res_36368;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_36366 = x_acc_40364;\n            ((__local\n              float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351)] =\n                x_36366;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_40370;\n        int32_t skip_waves_40371;\n        float x_40366;\n        float x_40367;\n        \n        offset_40370 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_40351, segred_group_sizze_36362)) {\n                x_40366 = ((__local\n                            float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351 +\n                                                        offset_40370)];\n            }\n        }\n        offset_40370 = 1;\n        while (slt32(offset_40370, wave_sizze_40353)) {\n            if (slt32(local_tid_40351 + offset_40370,\n                      segred_group_sizze_36362) && ((local_tid_40351 -\n                                                     squot32(local_tid_40351,\n                                                             wave_sizze_40353) *\n                                                     wave_sizze_40353) & (2 *\n                                                                          offset_40370 -\n                                                                          1)) ==\n                0) {\n                // read array element\n                {\n                    x_40367 = ((volatile __local\n                                float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351 +\n                                                            offset_40370)];\n         ",
            "       }\n                // apply reduction operation\n                {\n                    float res_40368 = fmin32(x_40366, x_40367);\n                    \n                    x_40366 = res_40368;\n                }\n                // write result of operation\n                {\n                    ((volatile __local\n                      float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351)] =\n                        x_40366;\n                }\n            }\n            offset_40370 *= 2;\n        }\n        skip_waves_40371 = 1;\n        while (slt32(skip_waves_40371, squot32(segred_group_sizze_36362 +\n                                               wave_sizze_40353 - 1,\n                                               wave_sizze_40353))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_40370 = skip_waves_40371 * wave_sizze_40353;\n            if (slt32(local_tid_40351 + offset_40370,\n                      segred_group_sizze_36362) && ((local_tid_40351 -\n                                                     squot32(local_tid_40351,\n                                                             wave_sizze_40353) *\n                                                     wave_sizze_40353) == 0 &&\n                                                    (squot32(local_tid_40351,\n                                                             wave_sizze_40353) &\n                                                     (2 * skip_waves_40371 -\n                                                      1)) == 0)) {\n                // read array element\n                {\n                    x_40367 = ((__local\n                                float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351 +\n                                                            offset_40370)];\n                }\n                // apply reduction operation\n                {\n                    float res_40368 = fmin32(x_40366, x_40367);\n                    \n                    x_40366 = res_40368;\n         ",
            "       }\n                // write result of operation\n                {\n                    ((__local\n                      float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351)] =\n                        x_40366;\n                }\n            }\n            skip_waves_40371 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (local_tid_40351 == 0) {\n                x_acc_40364 = x_40366;\n            }\n        }\n        if (groups_per_segment_40341 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_40351 == 0) {\n                    ((__global float *) mem_39431)[sext_i32_i64(gtid_36341)] =\n                        x_acc_40364;\n                }\n            }\n        } else {\n            int32_t old_counter_40372;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_40351 == 0) {\n                    ((__global\n                      float *) group_res_arr_mem_40346)[sext_i32_i64(virt_group_id_40361) *\n                                                        sext_i32_i64(segred_group_sizze_36362)] =\n                        x_acc_40364;\n                    mem_fence_global();\n                    old_counter_40372 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) buildKDtreezicounter_mem_40348)[sext_i64_i32(sext_i32_i64(srem32(flat_segment_id_40362,\n                                                                                                                         10240)))],\n                                              (int) 1);\n                    ((__local bool *) sync_arr_mem_40357)[0] =\n                        old_counter_40372 == groups_per_segment_40341 - 1;\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n         ",
            "   \n            bool is_last_group_40373;\n            \n            is_last_group_40373 = ((__local bool *) sync_arr_mem_40357)[0];\n            if (is_last_group_40373) {\n                if (local_tid_40351 == 0) {\n                    old_counter_40372 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) buildKDtreezicounter_mem_40348)[sext_i64_i32(sext_i32_i64(srem32(flat_segment_id_40362,\n                                                                                                                         10240)))],\n                                              (int) (0 -\n                                                     groups_per_segment_40341));\n                }\n                // read in the per-group-results\n                {\n                    int32_t read_per_thread_40374 =\n                            sdiv_up32(groups_per_segment_40341,\n                                      segred_group_sizze_36362);\n                    \n                    x_36366 = INFINITY;\n                    for (int32_t i_40375 = 0; i_40375 < read_per_thread_40374;\n                         i_40375++) {\n                        int32_t group_res_id_40376 = local_tid_40351 *\n                                read_per_thread_40374 + i_40375;\n                        int32_t index_of_group_res_40377 =\n                                flat_segment_id_40362 *\n                                groups_per_segment_40341 + group_res_id_40376;\n                        \n                        if (slt32(group_res_id_40376,\n                                  groups_per_segment_40341)) {\n                            x_36367 = ((__global\n                                        float *) group_res_arr_mem_40346)[sext_i32_i64(index_of_group_res_40377) *\n                                                                          sext_i32_i64(segred_group_sizze_36362)];\n                            \n                            float res_363",
            "68;\n                            \n                            res_36368 = fmin32(x_36366, x_36367);\n                            x_36366 = res_36368;\n                        }\n                    }\n                }\n                ((__local\n                  float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351)] =\n                    x_36366;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-group results\n                {\n                    int32_t offset_40378;\n                    int32_t skip_waves_40379;\n                    float x_40366;\n                    float x_40367;\n                    \n                    offset_40378 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_40351, segred_group_sizze_36362)) {\n                            x_40366 = ((__local\n                                        float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351 +\n                                                                    offset_40378)];\n                        }\n                    }\n                    offset_40378 = 1;\n                    while (slt32(offset_40378, wave_sizze_40353)) {\n                        if (slt32(local_tid_40351 + offset_40378,\n                                  segred_group_sizze_36362) &&\n                            ((local_tid_40351 - squot32(local_tid_40351,\n                                                        wave_sizze_40353) *\n                              wave_sizze_40353) & (2 * offset_40378 - 1)) ==\n                            0) {\n                            // read array element\n                            {\n                                x_40367 = ((volatile __local\n                                            float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351 +\n                                                                        offset_40378)];\n                            }\n                ",
            "            // apply reduction operation\n                            {\n                                float res_40368 = fmin32(x_40366, x_40367);\n                                \n                                x_40366 = res_40368;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351)] =\n                                    x_40366;\n                            }\n                        }\n                        offset_40378 *= 2;\n                    }\n                    skip_waves_40379 = 1;\n                    while (slt32(skip_waves_40379,\n                                 squot32(segred_group_sizze_36362 +\n                                         wave_sizze_40353 - 1,\n                                         wave_sizze_40353))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_40378 = skip_waves_40379 * wave_sizze_40353;\n                        if (slt32(local_tid_40351 + offset_40378,\n                                  segred_group_sizze_36362) &&\n                            ((local_tid_40351 - squot32(local_tid_40351,\n                                                        wave_sizze_40353) *\n                              wave_sizze_40353) == 0 &&\n                             (squot32(local_tid_40351, wave_sizze_40353) & (2 *\n                                                                            skip_waves_40379 -\n                                                                            1)) ==\n                             0)) {\n                            // read array element\n                            {\n                                x_40367 = ((__local\n                                            float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351 +\n                                                           ",
            "             offset_40378)];\n                            }\n                            // apply reduction operation\n                            {\n                                float res_40368 = fmin32(x_40366, x_40367);\n                                \n                                x_40366 = res_40368;\n                            }\n                            // write result of operation\n                            {\n                                ((__local\n                                  float *) red_arr_mem_40355)[sext_i32_i64(local_tid_40351)] =\n                                    x_40366;\n                            }\n                        }\n                        skip_waves_40379 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_40351 == 0) {\n                            ((__global\n                              float *) mem_39431)[sext_i32_i64(gtid_36341)] =\n                                x_40366;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_36362\n}\n__kernel void buildKDtreezisegred_large_36413(__global int *global_failure,\n                                              uint sync_arr_mem_40424_backing_offset_0,\n                                              uint red_arr_mem_40422_backing_offset_1,\n                                              int32_t m_32135,\n                                              int32_t num_groups_36424, __global\n                                              unsigned char *mem_39441, __global\n                                              unsigned char *mem_39445,\n                                              int32_t groups_per_segment_40408,\n                                              int32_t elements_per_thread_40409,\n                                        ",
            "      int32_t virt_num_groups_40410,\n                                              int32_t threads_per_segment_40412,\n                                              __global\n                                              unsigned char *group_res_arr_mem_40413,\n                                              __global\n                                              unsigned char *buildKDtreezicounter_mem_40415)\n{\n    #define segred_group_sizze_36423 (buildKDtreezisegred_group_sizze_36407)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *sync_arr_mem_40424_backing_1 =\n                  &shared_mem[sync_arr_mem_40424_backing_offset_0];\n    volatile char *red_arr_mem_40422_backing_0 =\n                  &shared_mem[red_arr_mem_40422_backing_offset_1];\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40417;\n    int32_t local_tid_40418;\n    int32_t group_sizze_40421;\n    int32_t wave_sizze_40420;\n    int32_t group_tid_40419;\n    \n    global_tid_40417 = get_global_id(0);\n    local_tid_40418 = get_local_id(0);\n    group_sizze_40421 = get_local_size(0);\n    wave_sizze_40420 = LOCKSTEP_WIDTH;\n    group_tid_40419 = get_group_id(0);\n    \n    int32_t phys_tid_36413;\n    \n    phys_tid_36413 = global_tid_40417;\n    \n    __local char *red_arr_mem_40422;\n    \n    red_arr_mem_40422 = (__local char *) red_arr_mem_40422_backing_0;\n    \n    __local char *sync_arr_mem_40424;\n    \n    sync_arr_mem_40424 = (__local char *) sync_arr_mem_40424_backing_1;\n    \n    int32_t phys_group_id_40426;\n    \n    phys_group_id_40426 = get_group_id(0);\n    for (int32_t i_40427 = 0; i_40427 < sdiv_up32(virt_num_groups_40410 -\n                                                  phys_group_id_40426,\n                                                  num_groups_36424);\n         i_40427++) {\n        int32_t virt_group_id_40428 = phys_group_id_40426 + i_40427 *\n                num_groups_36424;\n        int32_t flat_segment_id_40",
            "429 = squot32(virt_group_id_40428,\n                                                groups_per_segment_40408);\n        int32_t global_tid_40430 = srem32(virt_group_id_40428 *\n                                          segred_group_sizze_36423 +\n                                          local_tid_40418,\n                                          segred_group_sizze_36423 *\n                                          groups_per_segment_40408);\n        int32_t gtid_36402 = flat_segment_id_40429;\n        int32_t gtid_36412;\n        float x_acc_40431;\n        int32_t chunk_sizze_40432;\n        \n        chunk_sizze_40432 = smin32(elements_per_thread_40409,\n                                   sdiv_up32(m_32135 - global_tid_40430,\n                                             threads_per_segment_40412));\n        \n        float x_36427;\n        float x_36428;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_40431 = -INFINITY;\n        }\n        for (int32_t i_40436 = 0; i_40436 < chunk_sizze_40432; i_40436++) {\n            gtid_36412 = global_tid_40430 + threads_per_segment_40412 * i_40436;\n            // apply map function\n            {\n                float x_36431 = ((__global\n                                  float *) mem_39441)[sext_i32_i64(gtid_36402) *\n                                                      sext_i32_i64(m_32135) +\n                                                      sext_i32_i64(gtid_36412)];\n                \n                // save map-out results\n                { }\n                // load accumulator\n                {\n                    x_36427 = x_acc_40431;\n                }\n                // load new values\n                {\n                    x_36428 = x_36431;\n                }\n                // apply reduction operator\n                {\n                    float res_36429 = fmax32(x_36427, x_36428);\n                    \n                    // store in accumulator\n                    {\n                        x_acc",
            "_40431 = res_36429;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_36427 = x_acc_40431;\n            ((__local\n              float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418)] =\n                x_36427;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_40437;\n        int32_t skip_waves_40438;\n        float x_40433;\n        float x_40434;\n        \n        offset_40437 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_40418, segred_group_sizze_36423)) {\n                x_40433 = ((__local\n                            float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418 +\n                                                        offset_40437)];\n            }\n        }\n        offset_40437 = 1;\n        while (slt32(offset_40437, wave_sizze_40420)) {\n            if (slt32(local_tid_40418 + offset_40437,\n                      segred_group_sizze_36423) && ((local_tid_40418 -\n                                                     squot32(local_tid_40418,\n                                                             wave_sizze_40420) *\n                                                     wave_sizze_40420) & (2 *\n                                                                          offset_40437 -\n                                                                          1)) ==\n                0) {\n                // read array element\n                {\n                    x_40434 = ((volatile __local\n                                float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418 +\n                                                            offset_40437)];\n                }\n                // apply reduction operation\n                {\n                    float res_40435 = fmax32(x_40433, x_40434);\n                    \n                    x_40433 = res_40435;\n         ",
            "       }\n                // write result of operation\n                {\n                    ((volatile __local\n                      float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418)] =\n                        x_40433;\n                }\n            }\n            offset_40437 *= 2;\n        }\n        skip_waves_40438 = 1;\n        while (slt32(skip_waves_40438, squot32(segred_group_sizze_36423 +\n                                               wave_sizze_40420 - 1,\n                                               wave_sizze_40420))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_40437 = skip_waves_40438 * wave_sizze_40420;\n            if (slt32(local_tid_40418 + offset_40437,\n                      segred_group_sizze_36423) && ((local_tid_40418 -\n                                                     squot32(local_tid_40418,\n                                                             wave_sizze_40420) *\n                                                     wave_sizze_40420) == 0 &&\n                                                    (squot32(local_tid_40418,\n                                                             wave_sizze_40420) &\n                                                     (2 * skip_waves_40438 -\n                                                      1)) == 0)) {\n                // read array element\n                {\n                    x_40434 = ((__local\n                                float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418 +\n                                                            offset_40437)];\n                }\n                // apply reduction operation\n                {\n                    float res_40435 = fmax32(x_40433, x_40434);\n                    \n                    x_40433 = res_40435;\n                }\n                // write result of operation\n                {\n                    ((__local\n                      float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418)] =\n                      ",
            "  x_40433;\n                }\n            }\n            skip_waves_40438 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (local_tid_40418 == 0) {\n                x_acc_40431 = x_40433;\n            }\n        }\n        if (groups_per_segment_40408 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_40418 == 0) {\n                    ((__global float *) mem_39445)[sext_i32_i64(gtid_36402)] =\n                        x_acc_40431;\n                }\n            }\n        } else {\n            int32_t old_counter_40439;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_40418 == 0) {\n                    ((__global\n                      float *) group_res_arr_mem_40413)[sext_i32_i64(virt_group_id_40428) *\n                                                        sext_i32_i64(segred_group_sizze_36423)] =\n                        x_acc_40431;\n                    mem_fence_global();\n                    old_counter_40439 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) buildKDtreezicounter_mem_40415)[sext_i64_i32(sext_i32_i64(srem32(flat_segment_id_40429,\n                                                                                                                         10240)))],\n                                              (int) 1);\n                    ((__local bool *) sync_arr_mem_40424)[0] =\n                        old_counter_40439 == groups_per_segment_40408 - 1;\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            \n            bool is_last_group_40440;\n            \n            is_last_group_40440 = ((__local bool *) sync_arr_mem_40424)[0];\n            if (is_last_group_40440) {\n                if (local_tid_40418 =",
            "= 0) {\n                    old_counter_40439 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) buildKDtreezicounter_mem_40415)[sext_i64_i32(sext_i32_i64(srem32(flat_segment_id_40429,\n                                                                                                                         10240)))],\n                                              (int) (0 -\n                                                     groups_per_segment_40408));\n                }\n                // read in the per-group-results\n                {\n                    int32_t read_per_thread_40441 =\n                            sdiv_up32(groups_per_segment_40408,\n                                      segred_group_sizze_36423);\n                    \n                    x_36427 = -INFINITY;\n                    for (int32_t i_40442 = 0; i_40442 < read_per_thread_40441;\n                         i_40442++) {\n                        int32_t group_res_id_40443 = local_tid_40418 *\n                                read_per_thread_40441 + i_40442;\n                        int32_t index_of_group_res_40444 =\n                                flat_segment_id_40429 *\n                                groups_per_segment_40408 + group_res_id_40443;\n                        \n                        if (slt32(group_res_id_40443,\n                                  groups_per_segment_40408)) {\n                            x_36428 = ((__global\n                                        float *) group_res_arr_mem_40413)[sext_i32_i64(index_of_group_res_40444) *\n                                                                          sext_i32_i64(segred_group_sizze_36423)];\n                            \n                            float res_36429;\n                            \n                            res_36429 = fmax32(x_36427, x_36428);\n                            x_36427 = res_36429;\n                        }\n                    }\n          ",
            "      }\n                ((__local\n                  float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418)] =\n                    x_36427;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-group results\n                {\n                    int32_t offset_40445;\n                    int32_t skip_waves_40446;\n                    float x_40433;\n                    float x_40434;\n                    \n                    offset_40445 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_40418, segred_group_sizze_36423)) {\n                            x_40433 = ((__local\n                                        float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418 +\n                                                                    offset_40445)];\n                        }\n                    }\n                    offset_40445 = 1;\n                    while (slt32(offset_40445, wave_sizze_40420)) {\n                        if (slt32(local_tid_40418 + offset_40445,\n                                  segred_group_sizze_36423) &&\n                            ((local_tid_40418 - squot32(local_tid_40418,\n                                                        wave_sizze_40420) *\n                              wave_sizze_40420) & (2 * offset_40445 - 1)) ==\n                            0) {\n                            // read array element\n                            {\n                                x_40434 = ((volatile __local\n                                            float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418 +\n                                                                        offset_40445)];\n                            }\n                            // apply reduction operation\n                            {\n                                float res_40435 = fmax32(x_40433, x_40434);\n                                \n                          ",
            "      x_40433 = res_40435;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418)] =\n                                    x_40433;\n                            }\n                        }\n                        offset_40445 *= 2;\n                    }\n                    skip_waves_40446 = 1;\n                    while (slt32(skip_waves_40446,\n                                 squot32(segred_group_sizze_36423 +\n                                         wave_sizze_40420 - 1,\n                                         wave_sizze_40420))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_40445 = skip_waves_40446 * wave_sizze_40420;\n                        if (slt32(local_tid_40418 + offset_40445,\n                                  segred_group_sizze_36423) &&\n                            ((local_tid_40418 - squot32(local_tid_40418,\n                                                        wave_sizze_40420) *\n                              wave_sizze_40420) == 0 &&\n                             (squot32(local_tid_40418, wave_sizze_40420) & (2 *\n                                                                            skip_waves_40446 -\n                                                                            1)) ==\n                             0)) {\n                            // read array element\n                            {\n                                x_40434 = ((__local\n                                            float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418 +\n                                                                        offset_40445)];\n                            }\n                            // apply reduction operation\n                            {\n                                float res_40435 = fmax32(x_4",
            "0433, x_40434);\n                                \n                                x_40433 = res_40435;\n                            }\n                            // write result of operation\n                            {\n                                ((__local\n                                  float *) red_arr_mem_40422)[sext_i32_i64(local_tid_40418)] =\n                                    x_40433;\n                            }\n                        }\n                        skip_waves_40446 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_40418 == 0) {\n                            ((__global\n                              float *) mem_39445)[sext_i32_i64(gtid_36402)] =\n                                x_40433;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_36423\n}\n__kernel void buildKDtreezisegred_large_36675(__global int *global_failure,\n                                              int failure_is_an_option, __global\n                                              int *global_failure_args,\n                                              uint sync_arr_mem_40555_backing_offset_0,\n                                              uint red_arr_mem_40553_backing_offset_1,\n                                              uint red_arr_mem_40551_backing_offset_2,\n                                              int32_t d_32136,\n                                              int32_t conc_tmp_32196,\n                                              int32_t nodes_this_lvl_32221,\n                                              int32_t num_groups_36848, __global\n                                              unsigned char *mem_39532, __global\n                                              unsigned char *mem_39540, __global\n            ",
            "                                  unsigned char *mem_39544, __global\n                                              unsigned char *mem_39547,\n                                              int32_t groups_per_segment_40535,\n                                              int32_t elements_per_thread_40536,\n                                              int32_t virt_num_groups_40537,\n                                              int32_t threads_per_segment_40539,\n                                              __global\n                                              unsigned char *group_res_arr_mem_40540,\n                                              __global\n                                              unsigned char *group_res_arr_mem_40542,\n                                              __global\n                                              unsigned char *buildKDtreezicounter_mem_40544)\n{\n    #define segred_group_sizze_36847 (buildKDtreezisegred_group_sizze_36669)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *sync_arr_mem_40555_backing_2 =\n                  &shared_mem[sync_arr_mem_40555_backing_offset_0];\n    volatile char *red_arr_mem_40553_backing_1 =\n                  &shared_mem[red_arr_mem_40553_backing_offset_1];\n    volatile char *red_arr_mem_40551_backing_0 =\n                  &shared_mem[red_arr_mem_40551_backing_offset_2];\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40546;\n    int32_t local_tid_40547;\n    int32_t group_sizze_40550;\n    int32_t wave_sizze_40549;\n    int32_t group_tid_40548;\n    \n    global_tid_40546 = get_global_id(0);\n    local_tid_40547 = get_local_id(0);\n    group_sizze_40550 = get_local_size(0);\n    wave_sizze_40549 = LOCKSTEP_WIDTH;\n    group_tid_40548 = get_gr",
            "oup_id(0);\n    \n    int32_t phys_tid_36675;\n    \n    phys_tid_36675 = global_tid_40546;\n    \n    __local char *red_arr_mem_40551;\n    \n    red_arr_mem_40551 = (__local char *) red_arr_mem_40551_backing_0;\n    \n    __local char *red_arr_mem_40553;\n    \n    red_arr_mem_40553 = (__local char *) red_arr_mem_40553_backing_1;\n    \n    __local char *sync_arr_mem_40555;\n    \n    sync_arr_mem_40555 = (__local char *) sync_arr_mem_40555_backing_2;\n    \n    int32_t phys_group_id_40557;\n    \n    phys_group_id_40557 = get_group_id(0);\n    for (int32_t i_40558 = 0; i_40558 < sdiv_up32(virt_num_groups_40537 -\n                                                  phys_group_id_40557,\n                                                  num_groups_36848);\n         i_40558++) {\n        int32_t virt_group_id_40559 = phys_group_id_40557 + i_40558 *\n                num_groups_36848;\n        int32_t flat_segment_id_40560 = squot32(virt_group_id_40559,\n                                                groups_per_segment_40535);\n        int32_t global_tid_40561 = srem32(virt_group_id_40559 *\n                                          segred_group_sizze_36847 +\n                                          local_tid_40547,\n                                          segred_group_sizze_36847 *\n                                          groups_per_segment_40535);\n        int32_t gtid_36664 = flat_segment_id_40560;\n        int32_t gtid_36674;\n        int32_t x_acc_40562;\n        float x_acc_40563;\n        int32_t chunk_sizze_40564;\n        \n        chunk_sizze_40564 = smin32(elements_per_thread_40536,\n                                   sdiv_up32(d_32136 - global_tid_40561,\n                                             threads_per_segment_40539));\n        \n        int32_t x_36852;\n        float x_36853;\n        int32_t x_36854;\n        float x_36855;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_40562 = -1;\n            x_acc_40563 = -INFINITY;\n        }\n        for (int32_t ",
            "i_40572 = 0; i_40572 < chunk_sizze_40564; i_40572++) {\n            gtid_36674 = global_tid_40561 + threads_per_segment_40539 * i_40572;\n            // apply map function\n            {\n                int32_t i_36861 = add32(d_32136, gtid_36674);\n                bool x_36862 = sle32(0, i_36861);\n                bool y_36863 = slt32(i_36861, conc_tmp_32196);\n                bool bounds_check_36864 = x_36862 && y_36863;\n                bool index_certs_36865;\n                \n                if (!bounds_check_36864) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 13) ==\n                            -1) {\n                            global_failure_args[0] = i_36861;\n                            global_failure_args[1] = conc_tmp_32196;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                float x_36866 = ((__global\n                                  float *) mem_39540)[sext_i32_i64(gtid_36664) *\n                                                      sext_i32_i64(conc_tmp_32196) +\n                                                      sext_i32_i64(i_36861)];\n                bool y_36868 = slt32(gtid_36674, conc_tmp_32196);\n                bool index_certs_36870;\n                \n                if (!y_36868) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 14) ==\n                            -1) {\n                            global_failure_args[0] = gtid_36674;\n                            global_failure_args[1] = conc_tmp_32196;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                float y_36871 = ((__global\n                                  float *) mem_39532)[sext_i3",
            "2_i64(gtid_36674) *\n                                                      sext_i32_i64(nodes_this_lvl_32221) +\n                                                      sext_i32_i64(gtid_36664)];\n                float abs_arg_36872 = x_36866 - y_36871;\n                float res_36873 = (float) fabs(abs_arg_36872);\n                \n                // save map-out results\n                { }\n                // load accumulator\n                {\n                    x_36852 = x_acc_40562;\n                    x_36853 = x_acc_40563;\n                }\n                // load new values\n                {\n                    x_36854 = gtid_36674;\n                    x_36855 = res_36873;\n                }\n                // apply reduction operator\n                {\n                    bool cond_36856 = x_36855 <= x_36853;\n                    int32_t res_36857;\n                    \n                    if (cond_36856) {\n                        res_36857 = x_36852;\n                    } else {\n                        res_36857 = x_36854;\n                    }\n                    \n                    float res_36858;\n                    \n                    if (cond_36856) {\n                        res_36858 = x_36853;\n                    } else {\n                        res_36858 = x_36855;\n                    }\n                    // store in accumulator\n                    {\n                        x_acc_40562 = res_36857;\n                        x_acc_40563 = res_36858;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_36852 = x_acc_40562;\n            x_36853 = x_acc_40563;\n            ((__local\n              int32_t *) red_arr_mem_40551)[sext_i32_i64(local_tid_40547)] =\n                x_36852;\n            ((__local\n              float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547)] =\n                x_36853;\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL",
            "_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_40573;\n        int32_t skip_waves_40574;\n        int32_t x_40565;\n        float x_40566;\n        int32_t x_40567;\n        float x_40568;\n        \n        offset_40573 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_40547, segred_group_sizze_36847)) {\n                x_40565 = ((__local\n                            int32_t *) red_arr_mem_40551)[sext_i32_i64(local_tid_40547 +\n                                                          offset_40573)];\n                x_40566 = ((__local\n                            float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547 +\n                                                        offset_40573)];\n            }\n        }\n        offset_40573 = 1;\n        while (slt32(offset_40573, wave_sizze_40549)) {\n            if (slt32(local_tid_40547 + offset_40573,\n                      segred_group_sizze_36847) && ((local_tid_40547 -\n                                                     squot32(local_tid_40547,\n                                                             wave_sizze_40549) *\n                                                     wave_sizze_40549) & (2 *\n                                                                          offset_40573 -\n                                                                          1)) ==\n                0) {\n                // read array element\n                {\n                    x_40567 = ((volatile __local\n                                int32_t *) red_arr_mem_40551)[sext_i32_i64(local_tid_40547 +\n                                                              offset_40573)];\n                    x_40568 = ((volatile __local\n                                float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547 +\n                                                            offset_40573)];\n                }",
            "\n                // apply reduction operation\n                {\n                    bool cond_40569 = x_40568 <= x_40566;\n                    int32_t res_40570;\n                    \n                    if (cond_40569) {\n                        res_40570 = x_40565;\n                    } else {\n                        res_40570 = x_40567;\n                    }\n                    \n                    float res_40571;\n                    \n                    if (cond_40569) {\n                        res_40571 = x_40566;\n                    } else {\n                        res_40571 = x_40568;\n                    }\n                    x_40565 = res_40570;\n                    x_40566 = res_40571;\n                }\n                // write result of operation\n                {\n                    ((volatile __local\n                      int32_t *) red_arr_mem_40551)[sext_i32_i64(local_tid_40547)] =\n                        x_40565;\n                    ((volatile __local\n                      float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547)] =\n                        x_40566;\n                }\n            }\n            offset_40573 *= 2;\n        }\n        skip_waves_40574 = 1;\n        while (slt32(skip_waves_40574, squot32(segred_group_sizze_36847 +\n                                               wave_sizze_40549 - 1,\n                                               wave_sizze_40549))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_40573 = skip_waves_40574 * wave_sizze_40549;\n            if (slt32(local_tid_40547 + offset_40573,\n                      segred_group_sizze_36847) && ((local_tid_40547 -\n                                                     squot32(local_tid_40547,\n                                                             wave_sizze_40549) *\n                                                     wave_sizze_40549) == 0 &&\n                                                    (squot32(local_tid_40547,\n                                            ",
            "                 wave_sizze_40549) &\n                                                     (2 * skip_waves_40574 -\n                                                      1)) == 0)) {\n                // read array element\n                {\n                    x_40567 = ((__local\n                                int32_t *) red_arr_mem_40551)[sext_i32_i64(local_tid_40547 +\n                                                              offset_40573)];\n                    x_40568 = ((__local\n                                float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547 +\n                                                            offset_40573)];\n                }\n                // apply reduction operation\n                {\n                    bool cond_40569 = x_40568 <= x_40566;\n                    int32_t res_40570;\n                    \n                    if (cond_40569) {\n                        res_40570 = x_40565;\n                    } else {\n                        res_40570 = x_40567;\n                    }\n                    \n                    float res_40571;\n                    \n                    if (cond_40569) {\n                        res_40571 = x_40566;\n                    } else {\n                        res_40571 = x_40568;\n                    }\n                    x_40565 = res_40570;\n                    x_40566 = res_40571;\n                }\n                // write result of operation\n                {\n                    ((__local\n                      int32_t *) red_arr_mem_40551)[sext_i32_i64(local_tid_40547)] =\n                        x_40565;\n                    ((__local\n                      float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547)] =\n                        x_40566;\n                }\n            }\n            skip_waves_40574 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (local_tid_40547 == 0) {\n                x_acc_40562 = x",
            "_40565;\n                x_acc_40563 = x_40566;\n            }\n        }\n        if (groups_per_segment_40535 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_40547 == 0) {\n                    ((__global int32_t *) mem_39544)[sext_i32_i64(gtid_36664)] =\n                        x_acc_40562;\n                    ((__global float *) mem_39547)[sext_i32_i64(gtid_36664)] =\n                        x_acc_40563;\n                }\n            }\n        } else {\n            int32_t old_counter_40575;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_40547 == 0) {\n                    ((__global\n                      int32_t *) group_res_arr_mem_40540)[sext_i32_i64(virt_group_id_40559) *\n                                                          sext_i32_i64(segred_group_sizze_36847)] =\n                        x_acc_40562;\n                    ((__global\n                      float *) group_res_arr_mem_40542)[sext_i32_i64(virt_group_id_40559) *\n                                                        sext_i32_i64(segred_group_sizze_36847)] =\n                        x_acc_40563;\n                    mem_fence_global();\n                    old_counter_40575 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) buildKDtreezicounter_mem_40544)[sext_i64_i32(sext_i32_i64(srem32(flat_segment_id_40560,\n                                                                                                                         10240)))],\n                                              (int) 1);\n                    ((__local bool *) sync_arr_mem_40555)[0] =\n                        old_counter_40575 == groups_per_segment_40535 - 1;\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            \n            bool is_last_group_40576;\n         ",
            "   \n            is_last_group_40576 = ((__local bool *) sync_arr_mem_40555)[0];\n            if (is_last_group_40576) {\n                if (local_tid_40547 == 0) {\n                    old_counter_40575 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) buildKDtreezicounter_mem_40544)[sext_i64_i32(sext_i32_i64(srem32(flat_segment_id_40560,\n                                                                                                                         10240)))],\n                                              (int) (0 -\n                                                     groups_per_segment_40535));\n                }\n                // read in the per-group-results\n                {\n                    int32_t read_per_thread_40577 =\n                            sdiv_up32(groups_per_segment_40535,\n                                      segred_group_sizze_36847);\n                    \n                    x_36852 = -1;\n                    x_36853 = -INFINITY;\n                    for (int32_t i_40578 = 0; i_40578 < read_per_thread_40577;\n                         i_40578++) {\n                        int32_t group_res_id_40579 = local_tid_40547 *\n                                read_per_thread_40577 + i_40578;\n                        int32_t index_of_group_res_40580 =\n                                flat_segment_id_40560 *\n                                groups_per_segment_40535 + group_res_id_40579;\n                        \n                        if (slt32(group_res_id_40579,\n                                  groups_per_segment_40535)) {\n                            x_36854 = ((__global\n                                        int32_t *) group_res_arr_mem_40540)[sext_i32_i64(index_of_group_res_40580) *\n                                                                            sext_i32_i64(segred_group_sizze_36847)];\n                            x_36855 = ((__global\n                                 ",
            "       float *) group_res_arr_mem_40542)[sext_i32_i64(index_of_group_res_40580) *\n                                                                          sext_i32_i64(segred_group_sizze_36847)];\n                            \n                            bool cond_36856;\n                            \n                            cond_36856 = x_36855 <= x_36853;\n                            \n                            int32_t res_36857;\n                            \n                            if (cond_36856) {\n                                res_36857 = x_36852;\n                            } else {\n                                res_36857 = x_36854;\n                            }\n                            \n                            float res_36858;\n                            \n                            if (cond_36856) {\n                                res_36858 = x_36853;\n                            } else {\n                                res_36858 = x_36855;\n                            }\n                            x_36852 = res_36857;\n                            x_36853 = res_36858;\n                        }\n                    }\n                }\n                ((__local\n                  int32_t *) red_arr_mem_40551)[sext_i32_i64(local_tid_40547)] =\n                    x_36852;\n                ((__local\n                  float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547)] =\n                    x_36853;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-group results\n                {\n                    int32_t offset_40581;\n                    int32_t skip_waves_40582;\n                    int32_t x_40565;\n                    float x_40566;\n                    int32_t x_40567;\n                    float x_40568;\n                    \n                    offset_40581 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_40547, segred_group_",
            "sizze_36847)) {\n                            x_40565 = ((__local\n                                        int32_t *) red_arr_mem_40551)[sext_i32_i64(local_tid_40547 +\n                                                                      offset_40581)];\n                            x_40566 = ((__local\n                                        float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547 +\n                                                                    offset_40581)];\n                        }\n                    }\n                    offset_40581 = 1;\n                    while (slt32(offset_40581, wave_sizze_40549)) {\n                        if (slt32(local_tid_40547 + offset_40581,\n                                  segred_group_sizze_36847) &&\n                            ((local_tid_40547 - squot32(local_tid_40547,\n                                                        wave_sizze_40549) *\n                              wave_sizze_40549) & (2 * offset_40581 - 1)) ==\n                            0) {\n                            // read array element\n                            {\n                                x_40567 = ((volatile __local\n                                            int32_t *) red_arr_mem_40551)[sext_i32_i64(local_tid_40547 +\n                                                                          offset_40581)];\n                                x_40568 = ((volatile __local\n                                            float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547 +\n                                                                        offset_40581)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool cond_40569 = x_40568 <= x_40566;\n                                int32_t res_40570;\n                                \n                                if (cond_40569) {\n                                    res_40570 = x_40565;\n          ",
            "                      } else {\n                                    res_40570 = x_40567;\n                                }\n                                \n                                float res_40571;\n                                \n                                if (cond_40569) {\n                                    res_40571 = x_40566;\n                                } else {\n                                    res_40571 = x_40568;\n                                }\n                                x_40565 = res_40570;\n                                x_40566 = res_40571;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local\n                                  int32_t *) red_arr_mem_40551)[sext_i32_i64(local_tid_40547)] =\n                                    x_40565;\n                                ((volatile __local\n                                  float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547)] =\n                                    x_40566;\n                            }\n                        }\n                        offset_40581 *= 2;\n                    }\n                    skip_waves_40582 = 1;\n                    while (slt32(skip_waves_40582,\n                                 squot32(segred_group_sizze_36847 +\n                                         wave_sizze_40549 - 1,\n                                         wave_sizze_40549))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_40581 = skip_waves_40582 * wave_sizze_40549;\n                        if (slt32(local_tid_40547 + offset_40581,\n                                  segred_group_sizze_36847) &&\n                            ((local_tid_40547 - squot32(local_tid_40547,\n                                                        wave_sizze_40549) *\n                              wave_sizze_40549) == 0 &&\n                             (squot32(local_t",
            "id_40547, wave_sizze_40549) & (2 *\n                                                                            skip_waves_40582 -\n                                                                            1)) ==\n                             0)) {\n                            // read array element\n                            {\n                                x_40567 = ((__local\n                                            int32_t *) red_arr_mem_40551)[sext_i32_i64(local_tid_40547 +\n                                                                          offset_40581)];\n                                x_40568 = ((__local\n                                            float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547 +\n                                                                        offset_40581)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool cond_40569 = x_40568 <= x_40566;\n                                int32_t res_40570;\n                                \n                                if (cond_40569) {\n                                    res_40570 = x_40565;\n                                } else {\n                                    res_40570 = x_40567;\n                                }\n                                \n                                float res_40571;\n                                \n                                if (cond_40569) {\n                                    res_40571 = x_40566;\n                                } else {\n                                    res_40571 = x_40568;\n                                }\n                                x_40565 = res_40570;\n                                x_40566 = res_40571;\n                            }\n                            // write result of operation\n                            {\n                                ((__local\n                                  int32_t *) red_arr_",
            "mem_40551)[sext_i32_i64(local_tid_40547)] =\n                                    x_40565;\n                                ((__local\n                                  float *) red_arr_mem_40553)[sext_i32_i64(local_tid_40547)] =\n                                    x_40566;\n                            }\n                        }\n                        skip_waves_40582 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_40547 == 0) {\n                            ((__global\n                              int32_t *) mem_39544)[sext_i32_i64(gtid_36664)] =\n                                x_40565;\n                            ((__global\n                              float *) mem_39547)[sext_i32_i64(gtid_36664)] =\n                                x_40566;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_36847\n}\n__kernel void buildKDtreezisegred_small_36352(__global int *global_failure,\n                                              uint red_arr_mem_40328_backing_offset_0,\n                                              int32_t m_32135, int32_t d_32136,\n                                              int32_t num_groups_36363, __global\n                                              unsigned char *mem_39427, __global\n                                              unsigned char *mem_39431,\n                                              int32_t segment_sizze_nonzzero_40321)\n{\n    #define segred_group_sizze_36362 (buildKDtreezisegred_group_sizze_36346)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *red_arr_mem_40328_backing_0 =\n                  &shared_mem[red_arr_mem_40328_backing_offset_0];\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global",
            "_tid_40323;\n    int32_t local_tid_40324;\n    int32_t group_sizze_40327;\n    int32_t wave_sizze_40326;\n    int32_t group_tid_40325;\n    \n    global_tid_40323 = get_global_id(0);\n    local_tid_40324 = get_local_id(0);\n    group_sizze_40327 = get_local_size(0);\n    wave_sizze_40326 = LOCKSTEP_WIDTH;\n    group_tid_40325 = get_group_id(0);\n    \n    int32_t phys_tid_36352;\n    \n    phys_tid_36352 = global_tid_40323;\n    \n    __local char *red_arr_mem_40328;\n    \n    red_arr_mem_40328 = (__local char *) red_arr_mem_40328_backing_0;\n    \n    int32_t phys_group_id_40330;\n    \n    phys_group_id_40330 = get_group_id(0);\n    for (int32_t i_40331 = 0; i_40331 < sdiv_up32(sdiv_up32(d_32136,\n                                                            squot32(segred_group_sizze_36362,\n                                                                    segment_sizze_nonzzero_40321)) -\n                                                  phys_group_id_40330,\n                                                  num_groups_36363);\n         i_40331++) {\n        int32_t virt_group_id_40332 = phys_group_id_40330 + i_40331 *\n                num_groups_36363;\n        int32_t gtid_36341 = squot32(local_tid_40324,\n                                     segment_sizze_nonzzero_40321) +\n                virt_group_id_40332 * squot32(segred_group_sizze_36362,\n                                              segment_sizze_nonzzero_40321);\n        int32_t gtid_36351 = srem32(local_tid_40324, m_32135);\n        \n        // apply map function if in bounds\n        {\n            if (slt32(0, m_32135) && (slt32(gtid_36341, d_32136) &&\n                                      slt32(local_tid_40324, m_32135 *\n                                            squot32(segred_group_sizze_36362,\n                                                    segment_sizze_nonzzero_40321)))) {\n                float x_36370 = ((__global\n                                  float *) mem_39427)[sext_i32_i64(gtid_36341) *\n                            ",
            "                          sext_i32_i64(m_32135) +\n                                                      sext_i32_i64(gtid_36351)];\n                \n                // save map-out results\n                { }\n                // save results to be reduced\n                {\n                    ((__local\n                      float *) red_arr_mem_40328)[sext_i32_i64(local_tid_40324)] =\n                        x_36370;\n                }\n            } else {\n                ((__local\n                  float *) red_arr_mem_40328)[sext_i32_i64(local_tid_40324)] =\n                    INFINITY;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt32(0, m_32135)) {\n            // perform segmented scan to imitate reduction\n            {\n                float x_36366;\n                float x_36367;\n                float x_40333;\n                float x_40334;\n                int32_t skip_threads_40336;\n                \n                // read input for in-block scan\n                {\n                    if (slt32(local_tid_40324, m_32135 *\n                              squot32(segred_group_sizze_36362,\n                                      segment_sizze_nonzzero_40321))) {\n                        x_36367 = ((volatile __local\n                                    float *) red_arr_mem_40328)[sext_i32_i64(local_tid_40324)];\n                        if ((local_tid_40324 - squot32(local_tid_40324, 32) *\n                             32) == 0) {\n                            x_36366 = x_36367;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_40336 = 1;\n                    while (slt32(skip_threads_40336, 32)) {\n                        if (sle32(skip_threads_40336, local_tid_40324 -\n                                  squot32(local_tid_40324, 32) * 32) &&\n                            slt32(local_tid_40324, m_32135 *\n                        ",
            "          squot32(segred_group_sizze_36362,\n                                          segment_sizze_nonzzero_40321))) {\n                            // read operands\n                            {\n                                x_36366 = ((volatile __local\n                                            float *) red_arr_mem_40328)[sext_i32_i64(local_tid_40324 -\n                                                                        skip_threads_40336)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_40337 =\n                                     slt32(srem32(local_tid_40324, m_32135),\n                                           local_tid_40324 - (local_tid_40324 -\n                                                              skip_threads_40336));\n                                \n                                if (inactive_40337) {\n                                    x_36366 = x_36367;\n                                }\n                                if (!inactive_40337) {\n                                    float res_36368 = fmin32(x_36366, x_36367);\n                                    \n                                    x_36366 = res_36368;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_40326, skip_threads_40336)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_40336, local_tid_40324 -\n                                  squot32(local_tid_40324, 32) * 32) &&\n                            slt32(local_tid_40324, m_32135 *\n                                  squot32(segred_group_sizze_36362,\n                                          segment_sizze_nonzzero_40321))) {\n                            // write result\n                            {\n                                ((volatile __local\n               ",
            "                   float *) red_arr_mem_40328)[sext_i32_i64(local_tid_40324)] =\n                                    x_36366;\n                                x_36367 = x_36366;\n                            }\n                        }\n                        if (sle32(wave_sizze_40326, skip_threads_40336)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_40336 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_40324 - squot32(local_tid_40324, 32) * 32) ==\n                        31 && slt32(local_tid_40324, m_32135 *\n                                    squot32(segred_group_sizze_36362,\n                                            segment_sizze_nonzzero_40321))) {\n                        ((volatile __local\n                          float *) red_arr_mem_40328)[sext_i32_i64(squot32(local_tid_40324,\n                                                                           32))] =\n                            x_36366;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_40338;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_40324, 32) == 0 &&\n                            slt32(local_tid_40324, m_32135 *\n                                  squot32(segred_group_sizze_36362,\n                                          segment_sizze_nonzzero_40321))) {\n                            x_40334 = ((volatile __local\n                                        float *) red_arr_mem_40328)[sext_i32_i64(local_tid_40324)];\n                            if ((local_tid_40324 - squot32(lo",
            "cal_tid_40324,\n                                                           32) * 32) == 0) {\n                                x_40333 = x_40334;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_40338 = 1;\n                        while (slt32(skip_threads_40338, 32)) {\n                            if (sle32(skip_threads_40338, local_tid_40324 -\n                                      squot32(local_tid_40324, 32) * 32) &&\n                                (squot32(local_tid_40324, 32) == 0 &&\n                                 slt32(local_tid_40324, m_32135 *\n                                       squot32(segred_group_sizze_36362,\n                                               segment_sizze_nonzzero_40321)))) {\n                                // read operands\n                                {\n                                    x_40333 = ((volatile __local\n                                                float *) red_arr_mem_40328)[sext_i32_i64(local_tid_40324 -\n                                                                            skip_threads_40338)];\n                                }\n                                // perform operation\n                                {\n                                    bool inactive_40339 =\n                                         slt32(srem32(local_tid_40324 * 32 +\n                                                      32 - 1, m_32135),\n                                               local_tid_40324 * 32 + 32 - 1 -\n                                               ((local_tid_40324 -\n                                                 skip_threads_40338) * 32 + 32 -\n                                                1));\n                                    \n                                    if (inactive_40339) {\n                                        x_40333 = x_40334;\n                   ",
            "                 }\n                                    if (!inactive_40339) {\n                                        float res_40335 = fmin32(x_40333,\n                                                                 x_40334);\n                                        \n                                        x_40333 = res_40335;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_40326, skip_threads_40338)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_40338, local_tid_40324 -\n                                      squot32(local_tid_40324, 32) * 32) &&\n                                (squot32(local_tid_40324, 32) == 0 &&\n                                 slt32(local_tid_40324, m_32135 *\n                                       squot32(segred_group_sizze_36362,\n                                               segment_sizze_nonzzero_40321)))) {\n                                // write result\n                                {\n                                    ((volatile __local\n                                      float *) red_arr_mem_40328)[sext_i32_i64(local_tid_40324)] =\n                                        x_40333;\n                                    x_40334 = x_40333;\n                                }\n                            }\n                            if (sle32(wave_sizze_40326, skip_threads_40338)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_40338 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_40324, 32) == 0 ||\n                          !slt32(local_tid_40324, m_32135 *\n             ",
            "                    squot32(segred_group_sizze_36362,\n                                         segment_sizze_nonzzero_40321)))) {\n                        // read operands\n                        {\n                            x_36367 = x_36366;\n                            x_36366 = ((__local\n                                        float *) red_arr_mem_40328)[sext_i32_i64(squot32(local_tid_40324,\n                                                                                         32) -\n                                                                    1)];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_40340 = slt32(srem32(local_tid_40324,\n                                                               m_32135),\n                                                        local_tid_40324 -\n                                                        (squot32(local_tid_40324,\n                                                                 32) * 32 - 1));\n                            \n                            if (inactive_40340) {\n                                x_36366 = x_36367;\n                            }\n                            if (!inactive_40340) {\n                                float res_36368 = fmin32(x_36366, x_36367);\n                                \n                                x_36366 = res_36368;\n                            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              float *) red_arr_mem_40328)[sext_i32_i64(local_tid_40324)] =\n                                x_36366;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_40324, 32) == 0) {\n                        ((_",
            "_local\n                          float *) red_arr_mem_40328)[sext_i32_i64(local_tid_40324)] =\n                            x_36367;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt32(virt_group_id_40332 * squot32(segred_group_sizze_36362,\n                                                    segment_sizze_nonzzero_40321) +\n                      local_tid_40324, d_32136) && slt32(local_tid_40324,\n                                                         squot32(segred_group_sizze_36362,\n                                                                 segment_sizze_nonzzero_40321))) {\n                ((__global\n                  float *) mem_39431)[sext_i32_i64(virt_group_id_40332 *\n                                      squot32(segred_group_sizze_36362,\n                                              segment_sizze_nonzzero_40321) +\n                                      local_tid_40324)] = ((__local\n                                                            float *) red_arr_mem_40328)[sext_i32_i64((local_tid_40324 +\n                                                                                                      1) *\n                                                                                        segment_sizze_nonzzero_40321 -\n                                                                                        1)];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_36362\n}\n__kernel void buildKDtreezisegred_small_36413(__global int *global_failure,\n                                              uint red_arr_mem_40395_backing_offset_0,\n                                              int32_t m_32135, int32_t d_32136,\n                                              int",
            "32_t num_groups_36424, __global\n                                              unsigned char *mem_39441, __global\n                                              unsigned char *mem_39445,\n                                              int32_t segment_sizze_nonzzero_40388)\n{\n    #define segred_group_sizze_36423 (buildKDtreezisegred_group_sizze_36407)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *red_arr_mem_40395_backing_0 =\n                  &shared_mem[red_arr_mem_40395_backing_offset_0];\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40390;\n    int32_t local_tid_40391;\n    int32_t group_sizze_40394;\n    int32_t wave_sizze_40393;\n    int32_t group_tid_40392;\n    \n    global_tid_40390 = get_global_id(0);\n    local_tid_40391 = get_local_id(0);\n    group_sizze_40394 = get_local_size(0);\n    wave_sizze_40393 = LOCKSTEP_WIDTH;\n    group_tid_40392 = get_group_id(0);\n    \n    int32_t phys_tid_36413;\n    \n    phys_tid_36413 = global_tid_40390;\n    \n    __local char *red_arr_mem_40395;\n    \n    red_arr_mem_40395 = (__local char *) red_arr_mem_40395_backing_0;\n    \n    int32_t phys_group_id_40397;\n    \n    phys_group_id_40397 = get_group_id(0);\n    for (int32_t i_40398 = 0; i_40398 < sdiv_up32(sdiv_up32(d_32136,\n                                                            squot32(segred_group_sizze_36423,\n                                                                    segment_sizze_nonzzero_40388)) -\n                                                  phys_group_id_40397,\n                                                  num_groups_36424);\n         i_40398++) {\n        int32_t virt_group_id_40399 = phys_group_id_40397 + i_40398 *\n                num_groups_36424;\n        int32_t gtid_36402 = squot32(local_tid_40391,\n                                     segment_sizze_nonzzero_40388) +\n                virt_group_id_40399 * squot32(segred_group_sizze_36423,\n                         ",
            "                     segment_sizze_nonzzero_40388);\n        int32_t gtid_36412 = srem32(local_tid_40391, m_32135);\n        \n        // apply map function if in bounds\n        {\n            if (slt32(0, m_32135) && (slt32(gtid_36402, d_32136) &&\n                                      slt32(local_tid_40391, m_32135 *\n                                            squot32(segred_group_sizze_36423,\n                                                    segment_sizze_nonzzero_40388)))) {\n                float x_36431 = ((__global\n                                  float *) mem_39441)[sext_i32_i64(gtid_36402) *\n                                                      sext_i32_i64(m_32135) +\n                                                      sext_i32_i64(gtid_36412)];\n                \n                // save map-out results\n                { }\n                // save results to be reduced\n                {\n                    ((__local\n                      float *) red_arr_mem_40395)[sext_i32_i64(local_tid_40391)] =\n                        x_36431;\n                }\n            } else {\n                ((__local\n                  float *) red_arr_mem_40395)[sext_i32_i64(local_tid_40391)] =\n                    -INFINITY;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt32(0, m_32135)) {\n            // perform segmented scan to imitate reduction\n            {\n                float x_36427;\n                float x_36428;\n                float x_40400;\n                float x_40401;\n                int32_t skip_threads_40403;\n                \n                // read input for in-block scan\n                {\n                    if (slt32(local_tid_40391, m_32135 *\n                              squot32(segred_group_sizze_36423,\n                                      segment_sizze_nonzzero_40388))) {\n                        x_36428 = ((volatile __local\n                                    float *) red_arr_mem_40395)[sext_i32_i64(local_tid_40391)];\n             ",
            "           if ((local_tid_40391 - squot32(local_tid_40391, 32) *\n                             32) == 0) {\n                            x_36427 = x_36428;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_40403 = 1;\n                    while (slt32(skip_threads_40403, 32)) {\n                        if (sle32(skip_threads_40403, local_tid_40391 -\n                                  squot32(local_tid_40391, 32) * 32) &&\n                            slt32(local_tid_40391, m_32135 *\n                                  squot32(segred_group_sizze_36423,\n                                          segment_sizze_nonzzero_40388))) {\n                            // read operands\n                            {\n                                x_36427 = ((volatile __local\n                                            float *) red_arr_mem_40395)[sext_i32_i64(local_tid_40391 -\n                                                                        skip_threads_40403)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_40404 =\n                                     slt32(srem32(local_tid_40391, m_32135),\n                                           local_tid_40391 - (local_tid_40391 -\n                                                              skip_threads_40403));\n                                \n                                if (inactive_40404) {\n                                    x_36427 = x_36428;\n                                }\n                                if (!inactive_40404) {\n                                    float res_36429 = fmax32(x_36427, x_36428);\n                                    \n                                    x_36427 = res_36429;\n                                }\n                            }\n                        }\n              ",
            "          if (sle32(wave_sizze_40393, skip_threads_40403)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_40403, local_tid_40391 -\n                                  squot32(local_tid_40391, 32) * 32) &&\n                            slt32(local_tid_40391, m_32135 *\n                                  squot32(segred_group_sizze_36423,\n                                          segment_sizze_nonzzero_40388))) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_40395)[sext_i32_i64(local_tid_40391)] =\n                                    x_36427;\n                                x_36428 = x_36427;\n                            }\n                        }\n                        if (sle32(wave_sizze_40393, skip_threads_40403)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_40403 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_40391 - squot32(local_tid_40391, 32) * 32) ==\n                        31 && slt32(local_tid_40391, m_32135 *\n                                    squot32(segred_group_sizze_36423,\n                                            segment_sizze_nonzzero_40388))) {\n                        ((volatile __local\n                          float *) red_arr_mem_40395)[sext_i32_i64(squot32(local_tid_40391,\n                                                                           32))] =\n                            x_36427;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n               ",
            " {\n                    int32_t skip_threads_40405;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_40391, 32) == 0 &&\n                            slt32(local_tid_40391, m_32135 *\n                                  squot32(segred_group_sizze_36423,\n                                          segment_sizze_nonzzero_40388))) {\n                            x_40401 = ((volatile __local\n                                        float *) red_arr_mem_40395)[sext_i32_i64(local_tid_40391)];\n                            if ((local_tid_40391 - squot32(local_tid_40391,\n                                                           32) * 32) == 0) {\n                                x_40400 = x_40401;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_40405 = 1;\n                        while (slt32(skip_threads_40405, 32)) {\n                            if (sle32(skip_threads_40405, local_tid_40391 -\n                                      squot32(local_tid_40391, 32) * 32) &&\n                                (squot32(local_tid_40391, 32) == 0 &&\n                                 slt32(local_tid_40391, m_32135 *\n                                       squot32(segred_group_sizze_36423,\n                                               segment_sizze_nonzzero_40388)))) {\n                                // read operands\n                                {\n                                    x_40400 = ((volatile __local\n                                                float *) red_arr_mem_40395)[sext_i32_i64(local_tid_40391 -\n                                                                            skip_threads_40405)];\n                                }\n                                // perform operation\n                                {\n                          ",
            "          bool inactive_40406 =\n                                         slt32(srem32(local_tid_40391 * 32 +\n                                                      32 - 1, m_32135),\n                                               local_tid_40391 * 32 + 32 - 1 -\n                                               ((local_tid_40391 -\n                                                 skip_threads_40405) * 32 + 32 -\n                                                1));\n                                    \n                                    if (inactive_40406) {\n                                        x_40400 = x_40401;\n                                    }\n                                    if (!inactive_40406) {\n                                        float res_40402 = fmax32(x_40400,\n                                                                 x_40401);\n                                        \n                                        x_40400 = res_40402;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_40393, skip_threads_40405)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_40405, local_tid_40391 -\n                                      squot32(local_tid_40391, 32) * 32) &&\n                                (squot32(local_tid_40391, 32) == 0 &&\n                                 slt32(local_tid_40391, m_32135 *\n                                       squot32(segred_group_sizze_36423,\n                                               segment_sizze_nonzzero_40388)))) {\n                                // write result\n                                {\n                                    ((volatile __local\n                                      float *) red_arr_mem_40395)[sext_i32_i64(local_tid_40391)] =\n                                        x_40400;\n                                    ",
            "x_40401 = x_40400;\n                                }\n                            }\n                            if (sle32(wave_sizze_40393, skip_threads_40405)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_40405 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_40391, 32) == 0 ||\n                          !slt32(local_tid_40391, m_32135 *\n                                 squot32(segred_group_sizze_36423,\n                                         segment_sizze_nonzzero_40388)))) {\n                        // read operands\n                        {\n                            x_36428 = x_36427;\n                            x_36427 = ((__local\n                                        float *) red_arr_mem_40395)[sext_i32_i64(squot32(local_tid_40391,\n                                                                                         32) -\n                                                                    1)];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_40407 = slt32(srem32(local_tid_40391,\n                                                               m_32135),\n                                                        local_tid_40391 -\n                                                        (squot32(local_tid_40391,\n                                                                 32) * 32 - 1));\n                            \n                            if (inactive_40407) {\n                                x_36427 = x_36428;\n                            }\n                            if (!inactive_40407) {\n                                float res_36429 = fmax32(x_36427, x_36428);\n                          ",
            "      \n                                x_36427 = res_36429;\n                            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              float *) red_arr_mem_40395)[sext_i32_i64(local_tid_40391)] =\n                                x_36427;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_40391, 32) == 0) {\n                        ((__local\n                          float *) red_arr_mem_40395)[sext_i32_i64(local_tid_40391)] =\n                            x_36428;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt32(virt_group_id_40399 * squot32(segred_group_sizze_36423,\n                                                    segment_sizze_nonzzero_40388) +\n                      local_tid_40391, d_32136) && slt32(local_tid_40391,\n                                                         squot32(segred_group_sizze_36423,\n                                                                 segment_sizze_nonzzero_40388))) {\n                ((__global\n                  float *) mem_39445)[sext_i32_i64(virt_group_id_40399 *\n                                      squot32(segred_group_sizze_36423,\n                                              segment_sizze_nonzzero_40388) +\n                                      local_tid_40391)] = ((__local\n                                                            float *) red_arr_mem_40395)[sext_i32_i64((local_tid_40391 +\n                                                                                                      1) *\n                                                                 ",
            "                       segment_sizze_nonzzero_40388 -\n                                                                                        1)];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_36423\n}\n__kernel void buildKDtreezisegred_small_36675(__global int *global_failure,\n                                              int failure_is_an_option, __global\n                                              int *global_failure_args,\n                                              uint red_arr_mem_40518_backing_offset_0,\n                                              uint red_arr_mem_40516_backing_offset_1,\n                                              int32_t d_32136,\n                                              int32_t conc_tmp_32196,\n                                              int32_t nodes_this_lvl_32221,\n                                              int32_t num_groups_36848, __global\n                                              unsigned char *mem_39532, __global\n                                              unsigned char *mem_39540, __global\n                                              unsigned char *mem_39544, __global\n                                              unsigned char *mem_39547,\n                                              int32_t segment_sizze_nonzzero_40509)\n{\n    #define segred_group_sizze_36847 (buildKDtreezisegred_group_sizze_36669)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *red_arr_mem_40518_backing_1 =\n                  &shared_mem[red_arr_mem_40518_backing_offset_0];\n    volatile char *red_arr_mem_40516_backing_0 =\n                  &shared_mem[red_arr_mem_40516_backing_offset_1];\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n          ",
            "  return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40511;\n    int32_t local_tid_40512;\n    int32_t group_sizze_40515;\n    int32_t wave_sizze_40514;\n    int32_t group_tid_40513;\n    \n    global_tid_40511 = get_global_id(0);\n    local_tid_40512 = get_local_id(0);\n    group_sizze_40515 = get_local_size(0);\n    wave_sizze_40514 = LOCKSTEP_WIDTH;\n    group_tid_40513 = get_group_id(0);\n    \n    int32_t phys_tid_36675;\n    \n    phys_tid_36675 = global_tid_40511;\n    \n    __local char *red_arr_mem_40516;\n    \n    red_arr_mem_40516 = (__local char *) red_arr_mem_40516_backing_0;\n    \n    __local char *red_arr_mem_40518;\n    \n    red_arr_mem_40518 = (__local char *) red_arr_mem_40518_backing_1;\n    \n    int32_t phys_group_id_40520;\n    \n    phys_group_id_40520 = get_group_id(0);\n    for (int32_t i_40521 = 0; i_40521 <\n         sdiv_up32(sdiv_up32(nodes_this_lvl_32221,\n                             squot32(segred_group_sizze_36847,\n                                     segment_sizze_nonzzero_40509)) -\n                   phys_group_id_40520, num_groups_36848); i_40521++) {\n        int32_t virt_group_id_40522 = phys_group_id_40520 + i_40521 *\n                num_groups_36848;\n        int32_t gtid_36664 = squot32(local_tid_40512,\n                                     segment_sizze_nonzzero_40509) +\n                virt_group_id_40522 * squot32(segred_group_sizze_36847,\n                                              segment_sizze_nonzzero_40509);\n        int32_t gtid_36674 = srem32(local_tid_40512, d_32136);\n        \n        // apply map function if in bounds\n        {\n            if (slt32(0, d_32136) && (slt32(gtid_36664, nodes_this_lvl_32221) &&\n                                      slt32(local_tid_40512, d_32136 *\n                                            squot32(segred_group_sizze_36847,\n                                                    segment_sizze_nonzzero_40509)))) {\n                int32_t i_36861 = add32(d_32136, gti",
            "d_36674);\n                bool x_36862 = sle32(0, i_36861);\n                bool y_36863 = slt32(i_36861, conc_tmp_32196);\n                bool bounds_check_36864 = x_36862 && y_36863;\n                bool index_certs_36865;\n                \n                if (!bounds_check_36864) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 11) ==\n                            -1) {\n                            global_failure_args[0] = i_36861;\n                            global_failure_args[1] = conc_tmp_32196;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                float x_36866 = ((__global\n                                  float *) mem_39540)[sext_i32_i64(gtid_36664) *\n                                                      sext_i32_i64(conc_tmp_32196) +\n                                                      sext_i32_i64(i_36861)];\n                bool y_36868 = slt32(gtid_36674, conc_tmp_32196);\n                bool index_certs_36870;\n                \n                if (!y_36868) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 12) ==\n                            -1) {\n                            global_failure_args[0] = gtid_36674;\n                            global_failure_args[1] = conc_tmp_32196;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                float y_36871 = ((__global\n                                  float *) mem_39532)[sext_i32_i64(gtid_36674) *\n                                                      sext_i32_i64(nodes_this_lvl_32221) +\n                                                      sext_i32_i64(gtid_36664)];\n                float abs_arg_36872 = x_3686",
            "6 - y_36871;\n                float res_36873 = (float) fabs(abs_arg_36872);\n                \n                // save map-out results\n                { }\n                // save results to be reduced\n                {\n                    ((__local\n                      int32_t *) red_arr_mem_40516)[sext_i32_i64(local_tid_40512)] =\n                        gtid_36674;\n                    ((__local\n                      float *) red_arr_mem_40518)[sext_i32_i64(local_tid_40512)] =\n                        res_36873;\n                }\n            } else {\n                ((__local\n                  int32_t *) red_arr_mem_40516)[sext_i32_i64(local_tid_40512)] =\n                    -1;\n                ((__local\n                  float *) red_arr_mem_40518)[sext_i32_i64(local_tid_40512)] =\n                    -INFINITY;\n            }\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt32(0, d_32136)) {\n            // perform segmented scan to imitate reduction\n            {\n                int32_t x_36852;\n                float x_36853;\n                int32_t x_36854;\n                float x_36855;\n                int32_t x_40523;\n                float x_40524;\n                int32_t x_40525;\n                float x_40526;\n                int32_t skip_threads_40530;\n                \n                // read input for in-block scan\n                {\n                    if (slt32(local_tid_40512, d_32136 *\n                              squot32(segred_group_sizze_36847,\n                                      segment_sizze_nonzzero_40509))) {\n                        x_36854 = ((volatile __local\n                                    int32_t *) red_arr_mem_40516)[sext_i32_i64(local_tid_40512)];\n                        x_36855 = ((volatile __local\n                                    float *) red_arr_mem_40518)[sext_i32_i64(local_tid_40512)];\n                        i",
            "f ((local_tid_40512 - squot32(local_tid_40512, 32) *\n                             32) == 0) {\n                            x_36852 = x_36854;\n                            x_36853 = x_36855;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_40530 = 1;\n                    while (slt32(skip_threads_40530, 32)) {\n                        if (sle32(skip_threads_40530, local_tid_40512 -\n                                  squot32(local_tid_40512, 32) * 32) &&\n                            slt32(local_tid_40512, d_32136 *\n                                  squot32(segred_group_sizze_36847,\n                                          segment_sizze_nonzzero_40509))) {\n                            // read operands\n                            {\n                                x_36852 = ((volatile __local\n                                            int32_t *) red_arr_mem_40516)[sext_i32_i64(local_tid_40512 -\n                                                                          skip_threads_40530)];\n                                x_36853 = ((volatile __local\n                                            float *) red_arr_mem_40518)[sext_i32_i64(local_tid_40512 -\n                                                                        skip_threads_40530)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_40531 =\n                                     slt32(srem32(local_tid_40512, d_32136),\n                                           local_tid_40512 - (local_tid_40512 -\n                                                              skip_threads_40530));\n                                \n                                if (inactive_40531) {\n                                    x_36852 = x_36854;\n                                    x_36853 = x_36855;\n               ",
            "                 }\n                                if (!inactive_40531) {\n                                    bool cond_36856 = x_36855 <= x_36853;\n                                    int32_t res_36857;\n                                    \n                                    if (cond_36856) {\n                                        res_36857 = x_36852;\n                                    } else {\n                                        res_36857 = x_36854;\n                                    }\n                                    \n                                    float res_36858;\n                                    \n                                    if (cond_36856) {\n                                        res_36858 = x_36853;\n                                    } else {\n                                        res_36858 = x_36855;\n                                    }\n                                    x_36852 = res_36857;\n                                    x_36853 = res_36858;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_40514, skip_threads_40530)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_40530, local_tid_40512 -\n                                  squot32(local_tid_40512, 32) * 32) &&\n                            slt32(local_tid_40512, d_32136 *\n                                  squot32(segred_group_sizze_36847,\n                                          segment_sizze_nonzzero_40509))) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int32_t *) red_arr_mem_40516)[sext_i32_i64(local_tid_40512)] =\n                                    x_36852;\n                                x_36854 = x_36852;\n                                ((volatile __local\n                                  ",
            "float *) red_arr_mem_40518)[sext_i32_i64(local_tid_40512)] =\n                                    x_36853;\n                                x_36855 = x_36853;\n                            }\n                        }\n                        if (sle32(wave_sizze_40514, skip_threads_40530)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_40530 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_40512 - squot32(local_tid_40512, 32) * 32) ==\n                        31 && slt32(local_tid_40512, d_32136 *\n                                    squot32(segred_group_sizze_36847,\n                                            segment_sizze_nonzzero_40509))) {\n                        ((volatile __local\n                          int32_t *) red_arr_mem_40516)[sext_i32_i64(squot32(local_tid_40512,\n                                                                             32))] =\n                            x_36852;\n                        ((volatile __local\n                          float *) red_arr_mem_40518)[sext_i32_i64(squot32(local_tid_40512,\n                                                                           32))] =\n                            x_36853;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_40532;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_40512, 32) == 0 &&\n                            slt32(local_tid_40512, d_32136 *\n                                  squot32(segred_group_sizze_36847,\n                                          segment_sizz",
            "e_nonzzero_40509))) {\n                            x_40525 = ((volatile __local\n                                        int32_t *) red_arr_mem_40516)[sext_i32_i64(local_tid_40512)];\n                            x_40526 = ((volatile __local\n                                        float *) red_arr_mem_40518)[sext_i32_i64(local_tid_40512)];\n                            if ((local_tid_40512 - squot32(local_tid_40512,\n                                                           32) * 32) == 0) {\n                                x_40523 = x_40525;\n                                x_40524 = x_40526;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_40532 = 1;\n                        while (slt32(skip_threads_40532, 32)) {\n                            if (sle32(skip_threads_40532, local_tid_40512 -\n                                      squot32(local_tid_40512, 32) * 32) &&\n                                (squot32(local_tid_40512, 32) == 0 &&\n                                 slt32(local_tid_40512, d_32136 *\n                                       squot32(segred_group_sizze_36847,\n                                               segment_sizze_nonzzero_40509)))) {\n                                // read operands\n                                {\n                                    x_40523 = ((volatile __local\n                                                int32_t *) red_arr_mem_40516)[sext_i32_i64(local_tid_40512 -\n                                                                              skip_threads_40532)];\n                                    x_40524 = ((volatile __local\n                                                float *) red_arr_mem_40518)[sext_i32_i64(local_tid_40512 -\n                                                                            skip_threads_40532)];\n                                }\n                       ",
            "         // perform operation\n                                {\n                                    bool inactive_40533 =\n                                         slt32(srem32(local_tid_40512 * 32 +\n                                                      32 - 1, d_32136),\n                                               local_tid_40512 * 32 + 32 - 1 -\n                                               ((local_tid_40512 -\n                                                 skip_threads_40532) * 32 + 32 -\n                                                1));\n                                    \n                                    if (inactive_40533) {\n                                        x_40523 = x_40525;\n                                        x_40524 = x_40526;\n                                    }\n                                    if (!inactive_40533) {\n                                        bool cond_40527 = x_40526 <= x_40524;\n                                        int32_t res_40528;\n                                        \n                                        if (cond_40527) {\n                                            res_40528 = x_40523;\n                                        } else {\n                                            res_40528 = x_40525;\n                                        }\n                                        \n                                        float res_40529;\n                                        \n                                        if (cond_40527) {\n                                            res_40529 = x_40524;\n                                        } else {\n                                            res_40529 = x_40526;\n                                        }\n                                        x_40523 = res_40528;\n                                        x_40524 = res_40529;\n                                    }\n                                }\n                            }\n                            if (sle32(wa",
            "ve_sizze_40514, skip_threads_40532)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_40532, local_tid_40512 -\n                                      squot32(local_tid_40512, 32) * 32) &&\n                                (squot32(local_tid_40512, 32) == 0 &&\n                                 slt32(local_tid_40512, d_32136 *\n                                       squot32(segred_group_sizze_36847,\n                                               segment_sizze_nonzzero_40509)))) {\n                                // write result\n                                {\n                                    ((volatile __local\n                                      int32_t *) red_arr_mem_40516)[sext_i32_i64(local_tid_40512)] =\n                                        x_40523;\n                                    x_40525 = x_40523;\n                                    ((volatile __local\n                                      float *) red_arr_mem_40518)[sext_i32_i64(local_tid_40512)] =\n                                        x_40524;\n                                    x_40526 = x_40524;\n                                }\n                            }\n                            if (sle32(wave_sizze_40514, skip_threads_40532)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_40532 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_40512, 32) == 0 ||\n                          !slt32(local_tid_40512, d_32136 *\n                                 squot32(segred_group_sizze_36847,\n                                         segment_sizze_nonzzero_40509)))) {\n                        // read operands\n                        {\n              ",
            "              x_36854 = x_36852;\n                            x_36855 = x_36853;\n                            x_36852 = ((__local\n                                        int32_t *) red_arr_mem_40516)[sext_i32_i64(squot32(local_tid_40512,\n                                                                                           32) -\n                                                                      1)];\n                            x_36853 = ((__local\n                                        float *) red_arr_mem_40518)[sext_i32_i64(squot32(local_tid_40512,\n                                                                                         32) -\n                                                                    1)];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_40534 = slt32(srem32(local_tid_40512,\n                                                               d_32136),\n                                                        local_tid_40512 -\n                                                        (squot32(local_tid_40512,\n                                                                 32) * 32 - 1));\n                            \n                            if (inactive_40534) {\n                                x_36852 = x_36854;\n                                x_36853 = x_36855;\n                            }\n                            if (!inactive_40534) {\n                                bool cond_36856 = x_36855 <= x_36853;\n                                int32_t res_36857;\n                                \n                                if (cond_36856) {\n                                    res_36857 = x_36852;\n                                } else {\n                                    res_36857 = x_36854;\n                                }\n                                \n                                float res_36858;\n                                \n             ",
            "                   if (cond_36856) {\n                                    res_36858 = x_36853;\n                                } else {\n                                    res_36858 = x_36855;\n                                }\n                                x_36852 = res_36857;\n                                x_36853 = res_36858;\n                            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              int32_t *) red_arr_mem_40516)[sext_i32_i64(local_tid_40512)] =\n                                x_36852;\n                            ((__local\n                              float *) red_arr_mem_40518)[sext_i32_i64(local_tid_40512)] =\n                                x_36853;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_40512, 32) == 0) {\n                        ((__local\n                          int32_t *) red_arr_mem_40516)[sext_i32_i64(local_tid_40512)] =\n                            x_36854;\n                        ((__local\n                          float *) red_arr_mem_40518)[sext_i32_i64(local_tid_40512)] =\n                            x_36855;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt32(virt_group_id_40522 * squot32(segred_group_sizze_36847,\n                                                    segment_sizze_nonzzero_40509) +\n                      local_tid_40512, nodes_this_lvl_32221) &&\n                slt32(local_tid_40512, squot32(segred_group_sizze_36847,\n                                               segment_sizze_nonzzero_40509))) {\n                ((__global\n                  int32_t",
            " *) mem_39544)[sext_i32_i64(virt_group_id_40522 *\n                                        squot32(segred_group_sizze_36847,\n                                                segment_sizze_nonzzero_40509) +\n                                        local_tid_40512)] = ((__local\n                                                              int32_t *) red_arr_mem_40516)[sext_i32_i64((local_tid_40512 +\n                                                                                                          1) *\n                                                                                            segment_sizze_nonzzero_40509 -\n                                                                                            1)];\n                ((__global\n                  float *) mem_39547)[sext_i32_i64(virt_group_id_40522 *\n                                      squot32(segred_group_sizze_36847,\n                                              segment_sizze_nonzzero_40509) +\n                                      local_tid_40512)] = ((__local\n                                                            float *) red_arr_mem_40518)[sext_i32_i64((local_tid_40512 +\n                                                                                                      1) *\n                                                                                        segment_sizze_nonzzero_40509 -\n                                                                                        1)];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_36847\n}\n__kernel void builtinzhiota_i32ziiota_i32_40454(__global\n                                                unsigned char *mem_40449,\n                                                int32_t n_40450,\n                                                int32_t x_40451,\n                                                int32_t s_",
            "40452)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t iota_gtid_40454;\n    int32_t iota_ltid_40455;\n    int32_t iota_gid_40456;\n    \n    iota_gtid_40454 = get_global_id(0);\n    iota_ltid_40455 = get_local_id(0);\n    iota_gid_40456 = get_group_id(0);\n    if (slt64(iota_gtid_40454, sext_i32_i64(n_40450))) {\n        ((__global int32_t *) mem_40449)[sext_i32_i64(iota_gtid_40454)] =\n            add32(mul32(iota_gtid_40454, s_40452), x_40451);\n    }\n    \n  error_0:\n    return;\n}\n__kernel void builtinzhreplicate_f32zireplicate_40463(__global\n                                                      unsigned char *mem_40459,\n                                                      int32_t num_elems_40460,\n                                                      float val_40461)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t replicate_gtid_40463;\n    int32_t replicate_ltid_40464;\n    int32_t replicate_gid_40465;\n    \n    replicate_gtid_40463 = get_global_id(0);\n    replicate_ltid_40464 = get_local_id(0);\n    replicate_gid_40465 = get_group_id(0);\n    if (slt64(replicate_gtid_40463, sext_i32_i64(num_elems_40460))) {\n        ((__global float *) mem_40459)[sext_i32_i64(replicate_gtid_40463)] =\n            val_40461;\n    }\n    \n  error_0:\n    return;\n}\n__kernel void builtinzhreplicate_i32zireplicate_40472(__global\n                                                      unsigned char *mem_40468,\n                                                      int32_t num_elems_40469,\n                                                      int32_t val_40470)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t replicate_gtid_40472;\n    int32_t replicate_ltid_40473;\n    int32_t replicate_gid_40474;\n    \n    replicate_gtid_40472 = get_global_id(0);\n    replicate_ltid_40473 = get_local_id(0);\n    replicate_gid_40474 = get_group_id(0);\n    if (slt",
            "64(replicate_gtid_40472, sext_i32_i64(num_elems_40469))) {\n        ((__global int32_t *) mem_40468)[sext_i32_i64(replicate_gtid_40472)] =\n            val_40470;\n    }\n    \n  error_0:\n    return;\n}\n__kernel void exactKnnFixKzicopy_40302(int32_t kk_31030, int32_t s_31037,\n                                       __global unsigned char *knn_is_mem_39424,\n                                       __global unsigned char *mem_39429)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_40302;\n    int32_t copy_ltid_40303;\n    int32_t copy_gid_40304;\n    \n    copy_gtid_40302 = get_global_id(0);\n    copy_ltid_40303 = get_local_id(0);\n    copy_gid_40304 = get_group_id(0);\n    if (slt32(copy_gtid_40302, sext_i64_i32(sext_i32_i64(s_31037) * 8))) {\n        ((__global int32_t *) mem_39429)[sext_i32_i64(squot32(copy_gtid_40302,\n                                                              8)) * 8 +\n                                         sext_i32_i64(copy_gtid_40302 -\n                                         squot32(copy_gtid_40302, 8) * 8)] =\n            ((__global\n              int32_t *) knn_is_mem_39424)[sext_i32_i64(squot32(copy_gtid_40302,\n                                                                8)) *\n                                           sext_i32_i64(kk_31030) +\n                                           sext_i32_i64(copy_gtid_40302 -\n                                           squot32(copy_gtid_40302, 8) * 8)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void exactKnnFixKzicopy_40307(int32_t kk_31032, int32_t s_31037,\n                                       __global unsigned char *knn_vs_mem_39425,\n                                       __global unsigned char *mem_39433)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_40307;\n    int32_t copy_ltid_40308;\n    int32_t copy_gid_40309;\n    \n    copy_gtid_40307 = get_global_id(0);\n    copy_ltid_403",
            "08 = get_local_id(0);\n    copy_gid_40309 = get_group_id(0);\n    if (slt32(copy_gtid_40307, sext_i64_i32(sext_i32_i64(s_31037) * 8))) {\n        ((__global float *) mem_39433)[sext_i32_i64(squot32(copy_gtid_40307,\n                                                            8)) * 8 +\n                                       sext_i32_i64(copy_gtid_40307 -\n                                       squot32(copy_gtid_40307, 8) * 8)] =\n            ((__global\n              float *) knn_vs_mem_39425)[sext_i32_i64(squot32(copy_gtid_40307,\n                                                              8)) *\n                                         sext_i32_i64(kk_31032) +\n                                         sext_i32_i64(copy_gtid_40307 -\n                                         squot32(copy_gtid_40307, 8) * 8)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void exactKnnFixKzisegmap_33962(__global int *global_failure,\n                                         int failure_is_an_option, __global\n                                         int *global_failure_args,\n                                         int32_t d_31022, int32_t n_31026,\n                                         int32_t s_31037,\n                                         int32_t num_leaves_31075,\n                                         int32_t ppl_31090,\n                                         int32_t num_groups_34084, __global\n                                         unsigned char *mem_39444, __global\n                                         unsigned char *mem_39451, __global\n                                         unsigned char *mem_39504, __global\n                                         unsigned char *mem_39514, __global\n                                         unsigned char *mem_39518, __global\n                                         unsigned char *mem_39556, __global\n                                         unsigned char *mem_39666, __global\n                                         unsigned char *mem_39670, __gl",
            "obal\n                                         unsigned char *double_buffer_mem_40098,\n                                         __global\n                                         unsigned char *double_buffer_mem_40099)\n{\n    #define segmap_group_sizze_34083 (exactKnnFixKzisegmap_group_sizze_33965)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40395;\n    int32_t local_tid_40396;\n    int32_t group_sizze_40399;\n    int32_t wave_sizze_40398;\n    int32_t group_tid_40397;\n    \n    global_tid_40395 = get_global_id(0);\n    local_tid_40396 = get_local_id(0);\n    group_sizze_40399 = get_local_size(0);\n    wave_sizze_40398 = LOCKSTEP_WIDTH;\n    group_tid_40397 = get_group_id(0);\n    \n    int32_t phys_tid_33962;\n    \n    phys_tid_33962 = global_tid_40395;\n    \n    int32_t phys_group_id_40400;\n    \n    phys_group_id_40400 = get_group_id(0);\n    for (int32_t i_40401 = 0; i_40401 < sdiv_up32(sdiv_up32(s_31037,\n                                                            segmap_group_sizze_34083) -\n                                                  phys_group_id_40400,\n                                                  num_groups_34084);\n         i_40401++) {\n        int32_t virt_group_id_40402 = phys_group_id_40400 + i_40401 *\n                num_groups_34084;\n        int32_t gtid_33961 = sext_i64_i32(sext_i32_i64(virt_group_id_40402) *\n                sext_i32_i64(segmap_group_sizze_34083) +\n                sext_i32_i64(local_tid_40396));\n        \n        if (slt32(gtid_33961, s_31037)) {\n            int32_t x_34091 = ((__global\n                                int32_t *) mem_39504)[sext_i32_i64(gtid_33961)];\n            bool cond_34092 = slt32(x_34091, num_leaves_31075);\n     ",
            "       int32_t count_34093 = btoi_bool_i32(cond_34092);\n            bool loop_nonempty_34094 = slt32(0, count_34093);\n            int32_t bruteForcePar_arg_34095 = mul32(ppl_31090, x_34091);\n            bool x_34096 = sle32(0, x_34091);\n            bool bounds_check_34097 = cond_34092 && x_34096;\n            bool loop_not_taken_34098 = !loop_nonempty_34094;\n            bool protect_assert_disj_34099 = bounds_check_34097 ||\n                 loop_not_taken_34098;\n            bool index_certs_34100;\n            \n            if (!protect_assert_disj_34099) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 32) ==\n                        -1) {\n                        global_failure_args[0] = x_34091;\n                        global_failure_args[1] = num_leaves_31075;\n                        ;\n                    }\n                    local_failure = true;\n                    goto error_0;\n                }\n            }\n            \n            int32_t mem_39551[8];\n            float mem_39553[8];\n            int32_t mem_39608[8];\n            float mem_39610[8];\n            \n            for (int32_t i_40403 = 0; i_40403 < 8; i_40403++) {\n                ((__global\n                  int32_t *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_33962) +\n                                                      sext_i32_i64(i_40403) *\n                                                      sext_i32_i64(num_groups_34084 *\n                                                      segmap_group_sizze_34083)] =\n                    ((__global int32_t *) mem_39514)[sext_i32_i64(gtid_33961) +\n                                                     sext_i32_i64(i_40403) *\n                                                     sext_i32_i64(s_31037)];\n            }\n            for (int32_t i_40404 = 0; i_40404 < 8; i_40404++) {\n                ((__global\n                  float *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_33962) +\n                              ",
            "                      sext_i32_i64(i_40404) *\n                                                    sext_i32_i64(num_groups_34084 *\n                                                    segmap_group_sizze_34083)] =\n                    ((__global float *) mem_39518)[sext_i32_i64(gtid_33961) +\n                                                   sext_i32_i64(i_40404) *\n                                                   sext_i32_i64(s_31037)];\n            }\n            for (int32_t _j_34103 = 0; _j_34103 < count_34093; _j_34103++) {\n                for (int32_t i_40407 = 0; i_40407 < 8; i_40407++) {\n                    mem_39551[sext_i32_i64(i_40407)] = ((__global\n                                                         int32_t *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_33962) +\n                                                                                             sext_i32_i64(i_40407) *\n                                                                                             sext_i32_i64(num_groups_34084 *\n                                                                                             segmap_group_sizze_34083)];\n                }\n                for (int32_t i_40408 = 0; i_40408 < 8; i_40408++) {\n                    mem_39553[sext_i32_i64(i_40408)] = ((__global\n                                                         float *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_33962) +\n                                                                                           sext_i32_i64(i_40408) *\n                                                                                           sext_i32_i64(num_groups_34084 *\n                                                                                           segmap_group_sizze_34083)];\n                }\n                for (int32_t i_39355 = 0; i_39355 < ppl_31090; i_39355++) {\n                    float res_34111;\n                    float res_34113 = 0.0F;\n                    float x_34114;\n        ",
            "            float y_34115;\n                    \n                    for (int32_t i_34112 = 0; i_34112 < d_31022; i_34112++) {\n                        x_34114 = ((__global\n                                    float *) mem_39444)[sext_i32_i64(gtid_33961) +\n                                                        sext_i32_i64(i_34112) *\n                                                        sext_i32_i64(n_31026)];\n                        y_34115 = ((__global\n                                    float *) mem_39451)[sext_i32_i64(i_39355 *\n                                                        (num_leaves_31075 *\n                                                         d_31022) + x_34091) +\n                                                        sext_i32_i64(i_34112) *\n                                                        sext_i32_i64(num_leaves_31075)];\n                        \n                        float zz_34116;\n                        \n                        zz_34116 = x_34114 - y_34115;\n                        \n                        float y_34117 = zz_34116 * zz_34116;\n                        float loopres_34118 = res_34113 + y_34117;\n                        float res_tmp_40410 = loopres_34118;\n                        \n                        res_34113 = res_tmp_40410;\n                    }\n                    res_34111 = res_34113;\n                    ((__global\n                      float *) mem_39556)[sext_i32_i64(phys_tid_33962) +\n                                          sext_i32_i64(i_39355) *\n                                          sext_i32_i64(num_groups_34084 *\n                                          segmap_group_sizze_34083)] =\n                        res_34111;\n                }\n                \n                bool knn_34119;\n                int32_t knn_34123;\n                bool loop_while_34124;\n                int32_t j_34128;\n                \n                loop_while_34124 = 1;\n                j_34128 = 0;\n                while (loop_whi",
            "le_34124) {\n                    int32_t res_34129;\n                    float res_34130;\n                    int32_t redout_39357;\n                    float redout_39358;\n                    \n                    redout_39357 = ppl_31090;\n                    redout_39358 = INFINITY;\n                    for (int32_t i_39359 = 0; i_39359 < ppl_31090; i_39359++) {\n                        float x_34144 = ((__global\n                                          float *) mem_39556)[sext_i32_i64(phys_tid_33962) +\n                                                              sext_i32_i64(i_39359) *\n                                                              sext_i32_i64(num_groups_34084 *\n                                                              segmap_group_sizze_34083)];\n                        bool cond_34135 = redout_39358 < x_34144;\n                        int32_t res_34136;\n                        float res_34137;\n                        \n                        if (cond_34135) {\n                            res_34136 = redout_39357;\n                            res_34137 = redout_39358;\n                        } else {\n                            bool cond_34138 = x_34144 < redout_39358;\n                            float res_34139;\n                            \n                            if (cond_34138) {\n                                res_34139 = x_34144;\n                            } else {\n                                res_34139 = redout_39358;\n                            }\n                            \n                            int32_t res_34140;\n                            \n                            if (cond_34138) {\n                                res_34140 = i_39359;\n                            } else {\n                                bool cond_34141 = sle32(redout_39357, i_39359);\n                                int32_t res_34142;\n                                \n                                if (cond_34141) {\n                                    res_341",
            "42 = redout_39357;\n                                } else {\n                                    res_34142 = i_39359;\n                                }\n                                res_34140 = res_34142;\n                            }\n                            res_34136 = res_34140;\n                            res_34137 = res_34139;\n                        }\n                        \n                        int32_t redout_tmp_40416 = res_34136;\n                        float redout_tmp_40417 = res_34137;\n                        \n                        redout_39357 = redout_tmp_40416;\n                        redout_39358 = redout_tmp_40417;\n                    }\n                    res_34129 = redout_39357;\n                    res_34130 = redout_39358;\n                    \n                    int32_t i_34145 = sub32(7, j_34128);\n                    bool x_34146 = sle32(0, i_34145);\n                    bool y_34147 = slt32(i_34145, 8);\n                    bool bounds_check_34148 = x_34146 && y_34147;\n                    bool index_certs_34149;\n                    \n                    if (!bounds_check_34148) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          33) == -1) {\n                                global_failure_args[0] = i_34145;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float y_34150 = mem_39553[sext_i32_i64(i_34145)];\n                    bool cond_34151 = res_34130 < y_34150;\n                    int32_t loopres_34155;\n                    \n                    if (cond_34151) {\n                        bool x_34156 = sle32(0, res_34129);\n                        bool y_34157 = slt32(res_34129,",
            " ppl_31090);\n                        bool bounds_check_34158 = x_34156 && y_34157;\n                        bool index_certs_34159;\n                        \n                        if (!bounds_check_34158) {\n                            {\n                                if (atomic_cmpxchg_i32_global(global_failure,\n                                                              -1, 34) == -1) {\n                                    global_failure_args[0] = res_34129;\n                                    global_failure_args[1] = ppl_31090;\n                                    ;\n                                }\n                                local_failure = true;\n                                goto error_0;\n                            }\n                        }\n                        ((__global\n                          float *) mem_39556)[sext_i32_i64(phys_tid_33962) +\n                                              sext_i32_i64(res_34129) *\n                                              sext_i32_i64(num_groups_34084 *\n                                              segmap_group_sizze_34083)] =\n                            INFINITY;\n                        \n                        int32_t lw_val_34161 = add32(bruteForcePar_arg_34095,\n                                                     res_34129);\n                        \n                        mem_39551[sext_i32_i64(i_34145)] = lw_val_34161;\n                        mem_39553[sext_i32_i64(i_34145)] = res_34130;\n                        \n                        int32_t res_34164 = add32(1, j_34128);\n                        \n                        loopres_34155 = res_34164;\n                    } else {\n                        loopres_34155 = j_34128;\n                    }\n                    \n                    bool res_34165 = slt32(loopres_34155, 8);\n                    bool x_34166 = cond_34151 && res_34165;\n                    bool loop_while_tmp_40411 = x_34166;\n                    int32_t j_tmp_40415 = loopres_34155;\n  ",
            "                  \n                    loop_while_34124 = loop_while_tmp_40411;\n                    j_34128 = j_tmp_40415;\n                }\n                knn_34119 = loop_while_34124;\n                knn_34123 = j_34128;\n                for (int32_t i_40418 = 0; i_40418 < 8; i_40418++) {\n                    mem_39608[sext_i32_i64(i_40418)] = -1;\n                }\n                for (int32_t i_40419 = 0; i_40419 < 8; i_40419++) {\n                    mem_39610[sext_i32_i64(i_40419)] = INFINITY;\n                }\n                \n                int32_t res_34171;\n                int32_t res_34172;\n                int32_t beg_34176;\n                int32_t end_34177;\n                \n                beg_34176 = 0;\n                end_34177 = 7;\n                for (int32_t i_34173 = 0; i_34173 < 8; i_34173++) {\n                    bool x_34178 = sle32(0, beg_34176);\n                    bool y_34179 = slt32(beg_34176, 8);\n                    bool bounds_check_34180 = x_34178 && y_34179;\n                    bool index_certs_34181;\n                    \n                    if (!bounds_check_34180) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          35) == -1) {\n                                global_failure_args[0] = beg_34176;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float x_34182 = mem_39553[sext_i32_i64(beg_34176)];\n                    bool x_34183 = sle32(0, end_34177);\n                    bool y_34184 = slt32(end_34177, 8);\n                    bool bounds_check_34185 = x_34183 && y_34184;\n                    bool index_certs_34186;\n                    \n                    if (!bounds_check_34185",
            ") {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          36) == -1) {\n                                global_failure_args[0] = end_34177;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float y_34187 = mem_39553[sext_i32_i64(end_34177)];\n                    bool cond_34188 = x_34182 < y_34187;\n                    float loopres_34189;\n                    \n                    if (cond_34188) {\n                        loopres_34189 = x_34182;\n                    } else {\n                        loopres_34189 = y_34187;\n                    }\n                    \n                    int32_t loopres_34190;\n                    int32_t loopres_34191;\n                    int32_t loopres_34192;\n                    \n                    if (cond_34188) {\n                        int32_t res_34193 = mem_39551[sext_i32_i64(beg_34176)];\n                        int32_t res_34194 = add32(1, beg_34176);\n                        \n                        loopres_34190 = res_34193;\n                        loopres_34191 = res_34194;\n                        loopres_34192 = end_34177;\n                    } else {\n                        int32_t res_34195 = mem_39551[sext_i32_i64(end_34177)];\n                        int32_t res_34196 = sub32(end_34177, 1);\n                        \n                        loopres_34190 = res_34195;\n                        loopres_34191 = beg_34176;\n                        loopres_34192 = res_34196;\n                    }\n                    mem_39608[sext_i32_i64(i_34173)] = loopres_34190;\n                    mem_39610[sext_i32_i64(i_34173)] = loopres_34189;\n                    \n                    int",
            "32_t beg_tmp_40422 = loopres_34191;\n                    int32_t end_tmp_40423 = loopres_34192;\n                    \n                    beg_34176 = beg_tmp_40422;\n                    end_34177 = end_tmp_40423;\n                }\n                res_34171 = beg_34176;\n                res_34172 = end_34177;\n                for (int32_t i_40424 = 0; i_40424 < 8; i_40424++) {\n                    ((__global\n                      int32_t *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_33962) +\n                                                          sext_i32_i64(i_40424) *\n                                                          sext_i32_i64(num_groups_34084 *\n                                                          segmap_group_sizze_34083)] =\n                        mem_39608[sext_i32_i64(i_40424)];\n                }\n                for (int32_t i_40425 = 0; i_40425 < 8; i_40425++) {\n                    ((__global\n                      float *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_33962) +\n                                                        sext_i32_i64(i_40425) *\n                                                        sext_i32_i64(num_groups_34084 *\n                                                        segmap_group_sizze_34083)] =\n                        mem_39610[sext_i32_i64(i_40425)];\n                }\n            }\n            for (int32_t i_40426 = 0; i_40426 < 8; i_40426++) {\n                ((__global int32_t *) mem_39666)[sext_i32_i64(i_40426) *\n                                                 sext_i32_i64(s_31037) +\n                                                 sext_i32_i64(gtid_33961)] =\n                    ((__global\n                      int32_t *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_33962) +\n                                                          sext_i32_i64(i_40426) *\n                                                          sext_i32_i64(num_groups_34084 *\n                                                          segma",
            "p_group_sizze_34083)];\n            }\n            for (int32_t i_40427 = 0; i_40427 < 8; i_40427++) {\n                ((__global float *) mem_39670)[sext_i32_i64(i_40427) *\n                                               sext_i32_i64(s_31037) +\n                                               sext_i32_i64(gtid_33961)] =\n                    ((__global\n                      float *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_33962) +\n                                                        sext_i32_i64(i_40427) *\n                                                        sext_i32_i64(num_groups_34084 *\n                                                        segmap_group_sizze_34083)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_34083\n}\n__kernel void exactKnnFixKzisegmap_34321(__global int *global_failure,\n                                         int failure_is_an_option, __global\n                                         int *global_failure_args,\n                                         int32_t d_31022, int32_t n_31026,\n                                         int32_t s_31037,\n                                         int32_t num_leaves_31075,\n                                         int32_t ppl_31090,\n                                         int32_t num_groups_34443, __global\n                                         unsigned char *mem_39444, __global\n                                         unsigned char *mem_39451, __global\n                                         unsigned char *mem_39504, __global\n                                         unsigned char *mem_39826, __global\n                                         unsigned char *mem_39830, __global\n                                         unsigned char *mem_39868, __global\n                                         unsigned char *mem_39978, __global\n                                         unsigned char *mem_39982, __glob",
            "al\n                                         unsigned char *double_buffer_mem_40110,\n                                         __global\n                                         unsigned char *double_buffer_mem_40111)\n{\n    #define segmap_group_sizze_34442 (exactKnnFixKzisegmap_group_sizze_34324)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40462;\n    int32_t local_tid_40463;\n    int32_t group_sizze_40466;\n    int32_t wave_sizze_40465;\n    int32_t group_tid_40464;\n    \n    global_tid_40462 = get_global_id(0);\n    local_tid_40463 = get_local_id(0);\n    group_sizze_40466 = get_local_size(0);\n    wave_sizze_40465 = LOCKSTEP_WIDTH;\n    group_tid_40464 = get_group_id(0);\n    \n    int32_t phys_tid_34321;\n    \n    phys_tid_34321 = global_tid_40462;\n    \n    int32_t phys_group_id_40467;\n    \n    phys_group_id_40467 = get_group_id(0);\n    for (int32_t i_40468 = 0; i_40468 < sdiv_up32(sdiv_up32(s_31037,\n                                                            segmap_group_sizze_34442) -\n                                                  phys_group_id_40467,\n                                                  num_groups_34443);\n         i_40468++) {\n        int32_t virt_group_id_40469 = phys_group_id_40467 + i_40468 *\n                num_groups_34443;\n        int32_t gtid_34320 = sext_i64_i32(sext_i32_i64(virt_group_id_40469) *\n                sext_i32_i64(segmap_group_sizze_34442) +\n                sext_i32_i64(local_tid_40463));\n        \n        if (slt32(gtid_34320, s_31037)) {\n            int32_t x_34450 = ((__global\n                                int32_t *) mem_39504)[sext_i32_i64(gtid_34320)];\n            bool cond_34451 = slt32(x_34450, num_leaves_31075);\n       ",
            "     int32_t count_34452 = btoi_bool_i32(cond_34451);\n            bool loop_nonempty_34453 = slt32(0, count_34452);\n            int32_t bruteForcePar_arg_34454 = mul32(ppl_31090, x_34450);\n            bool x_34455 = sle32(0, x_34450);\n            bool bounds_check_34456 = cond_34451 && x_34455;\n            bool loop_not_taken_34457 = !loop_nonempty_34453;\n            bool protect_assert_disj_34458 = bounds_check_34456 ||\n                 loop_not_taken_34457;\n            bool index_certs_34459;\n            \n            if (!protect_assert_disj_34458) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 42) ==\n                        -1) {\n                        global_failure_args[0] = x_34450;\n                        global_failure_args[1] = num_leaves_31075;\n                        ;\n                    }\n                    local_failure = true;\n                    goto error_0;\n                }\n            }\n            \n            int32_t mem_39863[8];\n            float mem_39865[8];\n            int32_t mem_39920[8];\n            float mem_39922[8];\n            \n            for (int32_t i_40470 = 0; i_40470 < 8; i_40470++) {\n                ((__global\n                  int32_t *) double_buffer_mem_40110)[sext_i32_i64(phys_tid_34321) +\n                                                      sext_i32_i64(i_40470) *\n                                                      sext_i32_i64(num_groups_34443 *\n                                                      segmap_group_sizze_34442)] =\n                    ((__global int32_t *) mem_39826)[sext_i32_i64(gtid_34320) +\n                                                     sext_i32_i64(i_40470) *\n                                                     sext_i32_i64(s_31037)];\n            }\n            for (int32_t i_40471 = 0; i_40471 < 8; i_40471++) {\n                ((__global\n                  float *) double_buffer_mem_40111)[sext_i32_i64(phys_tid_34321) +\n                                ",
            "                    sext_i32_i64(i_40471) *\n                                                    sext_i32_i64(num_groups_34443 *\n                                                    segmap_group_sizze_34442)] =\n                    ((__global float *) mem_39830)[sext_i32_i64(gtid_34320) +\n                                                   sext_i32_i64(i_40471) *\n                                                   sext_i32_i64(s_31037)];\n            }\n            for (int32_t _j_34462 = 0; _j_34462 < count_34452; _j_34462++) {\n                for (int32_t i_40474 = 0; i_40474 < 8; i_40474++) {\n                    mem_39863[sext_i32_i64(i_40474)] = ((__global\n                                                         int32_t *) double_buffer_mem_40110)[sext_i32_i64(phys_tid_34321) +\n                                                                                             sext_i32_i64(i_40474) *\n                                                                                             sext_i32_i64(num_groups_34443 *\n                                                                                             segmap_group_sizze_34442)];\n                }\n                for (int32_t i_40475 = 0; i_40475 < 8; i_40475++) {\n                    mem_39865[sext_i32_i64(i_40475)] = ((__global\n                                                         float *) double_buffer_mem_40111)[sext_i32_i64(phys_tid_34321) +\n                                                                                           sext_i32_i64(i_40475) *\n                                                                                           sext_i32_i64(num_groups_34443 *\n                                                                                           segmap_group_sizze_34442)];\n                }\n                for (int32_t i_39362 = 0; i_39362 < ppl_31090; i_39362++) {\n                    float res_34470;\n                    float res_34472 = 0.0F;\n                    float x_34473;\n          ",
            "          float y_34474;\n                    \n                    for (int32_t i_34471 = 0; i_34471 < d_31022; i_34471++) {\n                        x_34473 = ((__global\n                                    float *) mem_39444)[sext_i32_i64(gtid_34320) +\n                                                        sext_i32_i64(i_34471) *\n                                                        sext_i32_i64(n_31026)];\n                        y_34474 = ((__global\n                                    float *) mem_39451)[sext_i32_i64(i_39362 *\n                                                        (num_leaves_31075 *\n                                                         d_31022) + x_34450) +\n                                                        sext_i32_i64(i_34471) *\n                                                        sext_i32_i64(num_leaves_31075)];\n                        \n                        float zz_34475;\n                        \n                        zz_34475 = x_34473 - y_34474;\n                        \n                        float y_34476 = zz_34475 * zz_34475;\n                        float loopres_34477 = res_34472 + y_34476;\n                        float res_tmp_40477 = loopres_34477;\n                        \n                        res_34472 = res_tmp_40477;\n                    }\n                    res_34470 = res_34472;\n                    ((__global\n                      float *) mem_39868)[sext_i32_i64(phys_tid_34321) +\n                                          sext_i32_i64(i_39362) *\n                                          sext_i32_i64(num_groups_34443 *\n                                          segmap_group_sizze_34442)] =\n                        res_34470;\n                }\n                \n                bool knn_34478;\n                int32_t knn_34482;\n                bool loop_while_34483;\n                int32_t j_34487;\n                \n                loop_while_34483 = 1;\n                j_34487 = 0;\n                while (loop_while",
            "_34483) {\n                    int32_t res_34488;\n                    float res_34489;\n                    int32_t redout_39364;\n                    float redout_39365;\n                    \n                    redout_39364 = ppl_31090;\n                    redout_39365 = INFINITY;\n                    for (int32_t i_39366 = 0; i_39366 < ppl_31090; i_39366++) {\n                        float x_34503 = ((__global\n                                          float *) mem_39868)[sext_i32_i64(phys_tid_34321) +\n                                                              sext_i32_i64(i_39366) *\n                                                              sext_i32_i64(num_groups_34443 *\n                                                              segmap_group_sizze_34442)];\n                        bool cond_34494 = redout_39365 < x_34503;\n                        int32_t res_34495;\n                        float res_34496;\n                        \n                        if (cond_34494) {\n                            res_34495 = redout_39364;\n                            res_34496 = redout_39365;\n                        } else {\n                            bool cond_34497 = x_34503 < redout_39365;\n                            float res_34498;\n                            \n                            if (cond_34497) {\n                                res_34498 = x_34503;\n                            } else {\n                                res_34498 = redout_39365;\n                            }\n                            \n                            int32_t res_34499;\n                            \n                            if (cond_34497) {\n                                res_34499 = i_39366;\n                            } else {\n                                bool cond_34500 = sle32(redout_39364, i_39366);\n                                int32_t res_34501;\n                                \n                                if (cond_34500) {\n                                    res_34501",
            " = redout_39364;\n                                } else {\n                                    res_34501 = i_39366;\n                                }\n                                res_34499 = res_34501;\n                            }\n                            res_34495 = res_34499;\n                            res_34496 = res_34498;\n                        }\n                        \n                        int32_t redout_tmp_40483 = res_34495;\n                        float redout_tmp_40484 = res_34496;\n                        \n                        redout_39364 = redout_tmp_40483;\n                        redout_39365 = redout_tmp_40484;\n                    }\n                    res_34488 = redout_39364;\n                    res_34489 = redout_39365;\n                    \n                    int32_t i_34504 = sub32(7, j_34487);\n                    bool x_34505 = sle32(0, i_34504);\n                    bool y_34506 = slt32(i_34504, 8);\n                    bool bounds_check_34507 = x_34505 && y_34506;\n                    bool index_certs_34508;\n                    \n                    if (!bounds_check_34507) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          43) == -1) {\n                                global_failure_args[0] = i_34504;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float y_34509 = mem_39865[sext_i32_i64(i_34504)];\n                    bool cond_34510 = res_34489 < y_34509;\n                    int32_t loopres_34514;\n                    \n                    if (cond_34510) {\n                        bool x_34515 = sle32(0, res_34488);\n                        bool y_34516 = slt32(res_34488, p",
            "pl_31090);\n                        bool bounds_check_34517 = x_34515 && y_34516;\n                        bool index_certs_34518;\n                        \n                        if (!bounds_check_34517) {\n                            {\n                                if (atomic_cmpxchg_i32_global(global_failure,\n                                                              -1, 44) == -1) {\n                                    global_failure_args[0] = res_34488;\n                                    global_failure_args[1] = ppl_31090;\n                                    ;\n                                }\n                                local_failure = true;\n                                goto error_0;\n                            }\n                        }\n                        ((__global\n                          float *) mem_39868)[sext_i32_i64(phys_tid_34321) +\n                                              sext_i32_i64(res_34488) *\n                                              sext_i32_i64(num_groups_34443 *\n                                              segmap_group_sizze_34442)] =\n                            INFINITY;\n                        \n                        int32_t lw_val_34520 = add32(bruteForcePar_arg_34454,\n                                                     res_34488);\n                        \n                        mem_39863[sext_i32_i64(i_34504)] = lw_val_34520;\n                        mem_39865[sext_i32_i64(i_34504)] = res_34489;\n                        \n                        int32_t res_34523 = add32(1, j_34487);\n                        \n                        loopres_34514 = res_34523;\n                    } else {\n                        loopres_34514 = j_34487;\n                    }\n                    \n                    bool res_34524 = slt32(loopres_34514, 8);\n                    bool x_34525 = cond_34510 && res_34524;\n                    bool loop_while_tmp_40478 = x_34525;\n                    int32_t j_tmp_40482 = loopres_34514;\n    ",
            "                \n                    loop_while_34483 = loop_while_tmp_40478;\n                    j_34487 = j_tmp_40482;\n                }\n                knn_34478 = loop_while_34483;\n                knn_34482 = j_34487;\n                for (int32_t i_40485 = 0; i_40485 < 8; i_40485++) {\n                    mem_39920[sext_i32_i64(i_40485)] = -1;\n                }\n                for (int32_t i_40486 = 0; i_40486 < 8; i_40486++) {\n                    mem_39922[sext_i32_i64(i_40486)] = INFINITY;\n                }\n                \n                int32_t res_34530;\n                int32_t res_34531;\n                int32_t beg_34535;\n                int32_t end_34536;\n                \n                beg_34535 = 0;\n                end_34536 = 7;\n                for (int32_t i_34532 = 0; i_34532 < 8; i_34532++) {\n                    bool x_34537 = sle32(0, beg_34535);\n                    bool y_34538 = slt32(beg_34535, 8);\n                    bool bounds_check_34539 = x_34537 && y_34538;\n                    bool index_certs_34540;\n                    \n                    if (!bounds_check_34539) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          45) == -1) {\n                                global_failure_args[0] = beg_34535;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float x_34541 = mem_39865[sext_i32_i64(beg_34535)];\n                    bool x_34542 = sle32(0, end_34536);\n                    bool y_34543 = slt32(end_34536, 8);\n                    bool bounds_check_34544 = x_34542 && y_34543;\n                    bool index_certs_34545;\n                    \n                    if (!bounds_check_34544) ",
            "{\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          46) == -1) {\n                                global_failure_args[0] = end_34536;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float y_34546 = mem_39865[sext_i32_i64(end_34536)];\n                    bool cond_34547 = x_34541 < y_34546;\n                    float loopres_34548;\n                    \n                    if (cond_34547) {\n                        loopres_34548 = x_34541;\n                    } else {\n                        loopres_34548 = y_34546;\n                    }\n                    \n                    int32_t loopres_34549;\n                    int32_t loopres_34550;\n                    int32_t loopres_34551;\n                    \n                    if (cond_34547) {\n                        int32_t res_34552 = mem_39863[sext_i32_i64(beg_34535)];\n                        int32_t res_34553 = add32(1, beg_34535);\n                        \n                        loopres_34549 = res_34552;\n                        loopres_34550 = res_34553;\n                        loopres_34551 = end_34536;\n                    } else {\n                        int32_t res_34554 = mem_39863[sext_i32_i64(end_34536)];\n                        int32_t res_34555 = sub32(end_34536, 1);\n                        \n                        loopres_34549 = res_34554;\n                        loopres_34550 = beg_34535;\n                        loopres_34551 = res_34555;\n                    }\n                    mem_39920[sext_i32_i64(i_34532)] = loopres_34549;\n                    mem_39922[sext_i32_i64(i_34532)] = loopres_34548;\n                    \n                    int32",
            "_t beg_tmp_40489 = loopres_34550;\n                    int32_t end_tmp_40490 = loopres_34551;\n                    \n                    beg_34535 = beg_tmp_40489;\n                    end_34536 = end_tmp_40490;\n                }\n                res_34530 = beg_34535;\n                res_34531 = end_34536;\n                for (int32_t i_40491 = 0; i_40491 < 8; i_40491++) {\n                    ((__global\n                      int32_t *) double_buffer_mem_40110)[sext_i32_i64(phys_tid_34321) +\n                                                          sext_i32_i64(i_40491) *\n                                                          sext_i32_i64(num_groups_34443 *\n                                                          segmap_group_sizze_34442)] =\n                        mem_39920[sext_i32_i64(i_40491)];\n                }\n                for (int32_t i_40492 = 0; i_40492 < 8; i_40492++) {\n                    ((__global\n                      float *) double_buffer_mem_40111)[sext_i32_i64(phys_tid_34321) +\n                                                        sext_i32_i64(i_40492) *\n                                                        sext_i32_i64(num_groups_34443 *\n                                                        segmap_group_sizze_34442)] =\n                        mem_39922[sext_i32_i64(i_40492)];\n                }\n            }\n            for (int32_t i_40493 = 0; i_40493 < 8; i_40493++) {\n                ((__global int32_t *) mem_39978)[sext_i32_i64(i_40493) *\n                                                 sext_i32_i64(s_31037) +\n                                                 sext_i32_i64(gtid_34320)] =\n                    ((__global\n                      int32_t *) double_buffer_mem_40110)[sext_i32_i64(phys_tid_34321) +\n                                                          sext_i32_i64(i_40493) *\n                                                          sext_i32_i64(num_groups_34443 *\n                                                          segmap_",
            "group_sizze_34442)];\n            }\n            for (int32_t i_40494 = 0; i_40494 < 8; i_40494++) {\n                ((__global float *) mem_39982)[sext_i32_i64(i_40494) *\n                                               sext_i32_i64(s_31037) +\n                                               sext_i32_i64(gtid_34320)] =\n                    ((__global\n                      float *) double_buffer_mem_40111)[sext_i32_i64(phys_tid_34321) +\n                                                        sext_i32_i64(i_40494) *\n                                                        sext_i32_i64(num_groups_34443 *\n                                                        segmap_group_sizze_34442)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_34442\n}\n__kernel void exactKnnFixKzisegmap_intragroup_33960(__global\n                                                    int *global_failure,\n                                                    int failure_is_an_option,\n                                                    __global\n                                                    int *global_failure_args,\n                                                    uint red_arr_mem_40448_backing_offset_0,\n                                                    uint red_arr_mem_40446_backing_offset_1,\n                                                    uint mem_39762_backing_offset_2,\n                                                    uint mem_39760_backing_offset_3,\n                                                    uint mem_39717_backing_offset_4,\n                                                    uint mem_39713_backing_offset_5,\n                                                    uint mem_39711_backing_offset_6,\n                                                    int32_t d_31022,\n                                                    int32_t n_31026,\n                                                    int32",
            "_t s_31037,\n                                                    int32_t num_leaves_31075,\n                                                    int32_t ppl_31090, __global\n                                                    unsigned char *ref_pts_mem_39418,\n                                                    __global\n                                                    unsigned char *mem_39444,\n                                                    __global\n                                                    unsigned char *mem_39504,\n                                                    __global\n                                                    unsigned char *mem_39674,\n                                                    __global\n                                                    unsigned char *mem_39678,\n                                                    __global\n                                                    unsigned char *mem_39818,\n                                                    __global\n                                                    unsigned char *mem_39822,\n                                                    __global\n                                                    unsigned char *double_buffer_mem_40104,\n                                                    __global\n                                                    unsigned char *double_buffer_mem_40105)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *red_arr_mem_40448_backing_6 =\n                  &shared_mem[red_arr_mem_40448_backing_offset_0];\n    volatile char *red_arr_mem_40446_backing_5 =\n                  &shared_mem[red_arr_mem_40446_backing_offset_1];\n    volatile char *mem_39762_backing_4 =\n                  &shared_mem[mem_39762_backing_offset_2];\n    volatile char *mem_39760_backing_3 =\n                  &shared_mem[mem_39760_backing_offset_3];\n    volatile char *mem_39717_backing_2 =\n                  &shared_mem[mem_39717",
            "_backing_offset_4];\n    volatile char *mem_39713_backing_1 =\n                  &shared_mem[mem_39713_backing_offset_5];\n    volatile char *mem_39711_backing_0 =\n                  &shared_mem[mem_39711_backing_offset_6];\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40428;\n    int32_t local_tid_40429;\n    int32_t group_sizze_40432;\n    int32_t wave_sizze_40431;\n    int32_t group_tid_40430;\n    \n    global_tid_40428 = get_global_id(0);\n    local_tid_40429 = get_local_id(0);\n    group_sizze_40432 = get_local_size(0);\n    wave_sizze_40431 = LOCKSTEP_WIDTH;\n    group_tid_40430 = get_group_id(0);\n    \n    int32_t phys_tid_33960;\n    \n    phys_tid_33960 = group_tid_40430;\n    \n    int32_t ltid_pre_40433;\n    \n    ltid_pre_40433 = local_tid_40429;\n    \n    int32_t gtid_33944;\n    \n    gtid_33944 = group_tid_40430;\n    \n    int32_t x_34209 = ((__global\n                        int32_t *) mem_39504)[sext_i32_i64(gtid_33944)];\n    bool cond_34210 = slt32(x_34209, num_leaves_31075);\n    int32_t count_34211 = btoi_bool_i32(cond_34210);\n    bool loop_nonempty_34212 = slt32(0, count_34211);\n    int32_t bruteForcePar_arg_34213 = mul32(ppl_31090, x_34209);\n    bool x_34214 = sle32(0, x_34209);\n    bool bounds_check_34215 = cond_34210 && x_34214;\n    bool loop_not_taken_34216 = !loop_nonempty_34212;\n    bool protect_assert_disj_34217 = bounds_check_34215 || loop_not_taken_34216;\n    bool index_certs_34218;\n    \n    if (!protect_assert_disj_34217) {\n        {\n            if (atomic_cmpxchg_i32_global(global_failure, -1, 37) == -1) {\n                global_failure_args[0] = x_34209;\n                global_failure_args[1] = num_leaves_31075;\n                ;\n            }\n            local_failure = true;\n            goto error_0;\n        }\n    }\n    \n    __local char *me",
            "m_39711;\n    \n    mem_39711 = (__local char *) mem_39711_backing_0;\n    \n    __local char *mem_39713;\n    \n    mem_39713 = (__local char *) mem_39713_backing_1;\n    \n    __local char *mem_39717;\n    \n    mem_39717 = (__local char *) mem_39717_backing_2;\n    \n    __local char *mem_39760;\n    \n    mem_39760 = (__local char *) mem_39760_backing_3;\n    \n    __local char *mem_39762;\n    \n    mem_39762 = (__local char *) mem_39762_backing_4;\n    for (int32_t i_40434 = 0; i_40434 < sdiv_up32(8 - local_tid_40429,\n                                                  ppl_31090); i_40434++) {\n        ((__global\n          int32_t *) double_buffer_mem_40104)[sext_i32_i64(phys_tid_33960 * 8) +\n                                              sext_i32_i64(i_40434 * ppl_31090 +\n                                              local_tid_40429)] = ((__global\n                                                                    int32_t *) mem_39674)[sext_i32_i64(gtid_33944) +\n                                                                                          sext_i32_i64(i_40434 *\n                                                                                          ppl_31090 +\n                                                                                          local_tid_40429) *\n                                                                                          sext_i32_i64(s_31037)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_40435 = 0; i_40435 < sdiv_up32(8 - local_tid_40429,\n                                                  ppl_31090); i_40435++) {\n        ((__global\n          float *) double_buffer_mem_40105)[sext_i32_i64(phys_tid_33960 * 8) +\n                                            sext_i32_i64(i_40435 * ppl_31090 +\n                                            local_tid_40429)] = ((__global\n                                                                  float *) mem_39678)[sext_i32_i64(gtid_33944) +\n                                                  ",
            "                                    sext_i32_i64(i_40435 *\n                                                                                      ppl_31090 +\n                                                                                      local_tid_40429) *\n                                                                                      sext_i32_i64(s_31037)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t _j_34221 = 0; _j_34221 < count_34211; _j_34221++) {\n        for (int32_t i_40438 = 0; i_40438 < sdiv_up32(8 - local_tid_40429,\n                                                      ppl_31090); i_40438++) {\n            ((__local int32_t *) mem_39711)[sext_i32_i64(i_40438 * ppl_31090 +\n                                            local_tid_40429)] = ((__global\n                                                                  int32_t *) double_buffer_mem_40104)[sext_i32_i64(phys_tid_33960 *\n                                                                                                      8) +\n                                                                                                      sext_i32_i64(i_40438 *\n                                                                                                      ppl_31090 +\n                                                                                                      local_tid_40429)];\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_40439 = 0; i_40439 < sdiv_up32(8 - local_tid_40429,\n                                                      ppl_31090); i_40439++) {\n            ((__local float *) mem_39713)[sext_i32_i64(i_40439 * ppl_31090 +\n                                          local_tid_40429)] = ((__global\n                                                                float *) double_buffer_mem_40105)[sext_i32_i64(phys_tid_33960 *\n                                                                                                  8) +\n                             ",
            "                                                                     sext_i32_i64(i_40439 *\n                                                                                                  ppl_31090 +\n                                                                                                  local_tid_40429)];\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t gtid_33947 = ltid_pre_40433;\n        int32_t phys_tid_33948 = local_tid_40429;\n        \n        if (slt32(gtid_33947, ppl_31090)) {\n            float res_34229;\n            float res_34231 = 0.0F;\n            float x_34232;\n            float y_34233;\n            \n            for (int32_t i_34230 = 0; i_34230 < d_31022; i_34230++) {\n                x_34232 = ((__global\n                            float *) mem_39444)[sext_i32_i64(gtid_33944) +\n                                                sext_i32_i64(i_34230) *\n                                                sext_i32_i64(n_31026)];\n                y_34233 = ((__global\n                            float *) ref_pts_mem_39418)[sext_i32_i64(x_34209 *\n                                                        (d_31022 * ppl_31090) +\n                                                        gtid_33947 * d_31022) +\n                                                        sext_i32_i64(i_34230)];\n                \n                float zz_34234;\n                \n                zz_34234 = x_34232 - y_34233;\n                \n                float y_34235 = zz_34234 * zz_34234;\n                float loopres_34236 = res_34231 + y_34235;\n                float res_tmp_40440 = loopres_34236;\n                \n                res_34231 = res_tmp_40440;\n            }\n            res_34229 = res_34231;\n            ((__local float *) mem_39717)[sext_i32_i64(gtid_33947)] = res_34229;\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        bool",
            " knn_34237;\n        int32_t knn_34241;\n        bool loop_while_34242;\n        int32_t j_34246;\n        \n        loop_while_34242 = 1;\n        j_34246 = 0;\n        while (loop_while_34242) {\n            int32_t res_34247;\n            float res_34248;\n            int32_t gtid_33958 = ltid_pre_40433;\n            int32_t phys_tid_33959 = local_tid_40429;\n            __local char *red_arr_mem_40446;\n            \n            red_arr_mem_40446 = (__local char *) red_arr_mem_40446_backing_5;\n            \n            __local char *red_arr_mem_40448;\n            \n            red_arr_mem_40448 = (__local char *) red_arr_mem_40448_backing_6;\n            if (slt32(gtid_33958, ppl_31090)) {\n                float x_34262 = ((__local\n                                  float *) mem_39717)[sext_i32_i64(gtid_33958)];\n                \n                ((__local\n                  int32_t *) red_arr_mem_40446)[sext_i32_i64(gtid_33958)] =\n                    gtid_33958;\n                ((__local\n                  float *) red_arr_mem_40448)[sext_i32_i64(gtid_33958)] =\n                    x_34262;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int32_t offset_40450;\n            int32_t skip_waves_40451;\n            int32_t x_34249;\n            float x_34250;\n            int32_t x_34251;\n            float x_34252;\n            \n            offset_40450 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_40429, ppl_31090)) {\n                    x_34249 = ((__local\n                                int32_t *) red_arr_mem_40446)[sext_i32_i64(local_tid_40429 +\n                                                              offset_40450)];\n                    x_34250 = ((__local\n                                float *) red_arr_mem_40448)[sext_i32_i64(local_tid_40429 +\n                                                            offset_40450)];\n                }\n            }\n            offset_40450 = 1;\n  ",
            "          while (slt32(offset_40450, wave_sizze_40431)) {\n                if (slt32(local_tid_40429 + offset_40450, ppl_31090) &&\n                    ((local_tid_40429 - squot32(local_tid_40429,\n                                                wave_sizze_40431) *\n                      wave_sizze_40431) & (2 * offset_40450 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_34251 = ((volatile __local\n                                    int32_t *) red_arr_mem_40446)[sext_i32_i64(local_tid_40429 +\n                                                                  offset_40450)];\n                        x_34252 = ((volatile __local\n                                    float *) red_arr_mem_40448)[sext_i32_i64(local_tid_40429 +\n                                                                offset_40450)];\n                    }\n                    // apply reduction operation\n                    {\n                        bool cond_34253 = x_34250 < x_34252;\n                        int32_t res_34254;\n                        float res_34255;\n                        \n                        if (cond_34253) {\n                            res_34254 = x_34249;\n                            res_34255 = x_34250;\n                        } else {\n                            bool cond_34256 = x_34252 < x_34250;\n                            float res_34257;\n                            \n                            if (cond_34256) {\n                                res_34257 = x_34252;\n                            } else {\n                                res_34257 = x_34250;\n                            }\n                            \n                            int32_t res_34258;\n                            \n                            if (cond_34256) {\n                                res_34258 = x_34251;\n                            } else {\n                                bool cond_34259 = sle32(x_34249, x_34251);\n                             ",
            "   int32_t res_34260;\n                                \n                                if (cond_34259) {\n                                    res_34260 = x_34249;\n                                } else {\n                                    res_34260 = x_34251;\n                                }\n                                res_34258 = res_34260;\n                            }\n                            res_34254 = res_34258;\n                            res_34255 = res_34257;\n                        }\n                        x_34249 = res_34254;\n                        x_34250 = res_34255;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          int32_t *) red_arr_mem_40446)[sext_i32_i64(local_tid_40429)] =\n                            x_34249;\n                        ((volatile __local\n                          float *) red_arr_mem_40448)[sext_i32_i64(local_tid_40429)] =\n                            x_34250;\n                    }\n                }\n                offset_40450 *= 2;\n            }\n            skip_waves_40451 = 1;\n            while (slt32(skip_waves_40451, squot32(ppl_31090 +\n                                                   wave_sizze_40431 - 1,\n                                                   wave_sizze_40431))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_40450 = skip_waves_40451 * wave_sizze_40431;\n                if (slt32(local_tid_40429 + offset_40450, ppl_31090) &&\n                    ((local_tid_40429 - squot32(local_tid_40429,\n                                                wave_sizze_40431) *\n                      wave_sizze_40431) == 0 && (squot32(local_tid_40429,\n                                                         wave_sizze_40431) &\n                                                 (2 * skip_waves_40451 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n ",
            "                       x_34251 = ((__local\n                                    int32_t *) red_arr_mem_40446)[sext_i32_i64(local_tid_40429 +\n                                                                  offset_40450)];\n                        x_34252 = ((__local\n                                    float *) red_arr_mem_40448)[sext_i32_i64(local_tid_40429 +\n                                                                offset_40450)];\n                    }\n                    // apply reduction operation\n                    {\n                        bool cond_34253 = x_34250 < x_34252;\n                        int32_t res_34254;\n                        float res_34255;\n                        \n                        if (cond_34253) {\n                            res_34254 = x_34249;\n                            res_34255 = x_34250;\n                        } else {\n                            bool cond_34256 = x_34252 < x_34250;\n                            float res_34257;\n                            \n                            if (cond_34256) {\n                                res_34257 = x_34252;\n                            } else {\n                                res_34257 = x_34250;\n                            }\n                            \n                            int32_t res_34258;\n                            \n                            if (cond_34256) {\n                                res_34258 = x_34251;\n                            } else {\n                                bool cond_34259 = sle32(x_34249, x_34251);\n                                int32_t res_34260;\n                                \n                                if (cond_34259) {\n                                    res_34260 = x_34249;\n                                } else {\n                                    res_34260 = x_34251;\n                                }\n                                res_34258 = res_34260;\n                            }\n                            res_34254 = r",
            "es_34258;\n                            res_34255 = res_34257;\n                        }\n                        x_34249 = res_34254;\n                        x_34250 = res_34255;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          int32_t *) red_arr_mem_40446)[sext_i32_i64(local_tid_40429)] =\n                            x_34249;\n                        ((__local\n                          float *) red_arr_mem_40448)[sext_i32_i64(local_tid_40429)] =\n                            x_34250;\n                    }\n                }\n                skip_waves_40451 *= 2;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            res_34247 = ((__local int32_t *) red_arr_mem_40446)[0];\n            res_34248 = ((__local float *) red_arr_mem_40448)[0];\n            \n            int32_t i_34263 = sub32(7, j_34246);\n            bool x_34264 = sle32(0, i_34263);\n            bool y_34265 = slt32(i_34263, 8);\n            bool bounds_check_34266 = x_34264 && y_34265;\n            bool index_certs_34267;\n            \n            if (!bounds_check_34266) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 38) ==\n                        -1) {\n                        global_failure_args[0] = i_34263;\n                        global_failure_args[1] = 8;\n                        ;\n                    }\n                    local_failure = true;\n                    goto error_3;\n                }\n            }\n            \n            float y_34268 = ((__local\n                              float *) mem_39713)[sext_i32_i64(i_34263)];\n            bool cond_34269 = res_34248 < y_34268;\n            int32_t loopres_34273;\n            \n            if (cond_34269) {\n                bool x_34274 = sle32(0, res_34247);\n                bool y_34275 = slt32(res_34247, ppl_31090);\n                bool bounds_check_34276 = x_34274 && y_34275;\n                bool ind",
            "ex_certs_34277;\n                \n                if (!bounds_check_34276) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 39) ==\n                            -1) {\n                            global_failure_args[0] = res_34247;\n                            global_failure_args[1] = ppl_31090;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_3;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                if (local_tid_40429 == 0) {\n                    ((__local float *) mem_39717)[sext_i32_i64(res_34247)] =\n                        INFINITY;\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                int32_t lw_val_34279 = add32(bruteForcePar_arg_34213,\n                                             res_34247);\n                \n                barrier(CLK_LOCAL_MEM_FENCE);\n                if (local_tid_40429 == 0) {\n                    ((__local int32_t *) mem_39711)[sext_i32_i64(i_34263)] =\n                        lw_val_34279;\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                barrier(CLK_LOCAL_MEM_FENCE);\n                if (local_tid_40429 == 0) {\n                    ((__local float *) mem_39713)[sext_i32_i64(i_34263)] =\n                        res_34248;\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                int32_t res_34282 = add32(1, j_34246);\n                \n                loopres_34273 = res_34282;\n            } else {\n                loopres_34273 = j_34246;\n            }\n            \n            bool res_34283 = slt32(loopres_34273, 8);\n            bool x_34284 = cond_34269 && res_34283;\n            bool loop_while_tmp_40441 = x_34284;\n            int32_t j_tmp_40445 = loopres_34273;\n            \n            loop_while_34242 = loop_while_tmp_40441;\n            j_34246 = j_tmp_4",
            "0445;\n        }\n        knn_34237 = loop_while_34242;\n        knn_34241 = j_34246;\n        for (int32_t i_40452 = 0; i_40452 < sdiv_up32(8 - local_tid_40429,\n                                                      ppl_31090); i_40452++) {\n            ((__local int32_t *) mem_39760)[sext_i32_i64(i_40452 * ppl_31090 +\n                                            local_tid_40429)] = -1;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_40453 = 0; i_40453 < sdiv_up32(8 - local_tid_40429,\n                                                      ppl_31090); i_40453++) {\n            ((__local float *) mem_39762)[sext_i32_i64(i_40453 * ppl_31090 +\n                                          local_tid_40429)] = INFINITY;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t res_34289;\n        int32_t res_34290;\n        int32_t beg_34294;\n        int32_t end_34295;\n        \n        beg_34294 = 0;\n        end_34295 = 7;\n        for (int32_t i_34291 = 0; i_34291 < 8; i_34291++) {\n            bool x_34296 = sle32(0, beg_34294);\n            bool y_34297 = slt32(beg_34294, 8);\n            bool bounds_check_34298 = x_34296 && y_34297;\n            bool index_certs_34299;\n            \n            if (!bounds_check_34298) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 40) ==\n                        -1) {\n                        global_failure_args[0] = beg_34294;\n                        global_failure_args[1] = 8;\n                        ;\n                    }\n                    local_failure = true;\n                    goto error_3;\n                }\n            }\n            \n            float x_34300 = ((__local\n                              float *) mem_39713)[sext_i32_i64(beg_34294)];\n            bool x_34301 = sle32(0, end_34295);\n            bool y_34302 = slt32(end_34295, 8);\n            bool bounds_check_34303 = x_34301 && y_34302;\n            bool index_certs_34304;\n            \n            if (!bou",
            "nds_check_34303) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 41) ==\n                        -1) {\n                        global_failure_args[0] = end_34295;\n                        global_failure_args[1] = 8;\n                        ;\n                    }\n                    local_failure = true;\n                    goto error_3;\n                }\n            }\n            \n            float y_34305 = ((__local\n                              float *) mem_39713)[sext_i32_i64(end_34295)];\n            bool cond_34306 = x_34300 < y_34305;\n            float loopres_34307;\n            \n            if (cond_34306) {\n                loopres_34307 = x_34300;\n            } else {\n                loopres_34307 = y_34305;\n            }\n            \n            int32_t loopres_34308;\n            int32_t loopres_34309;\n            int32_t loopres_34310;\n            \n            if (cond_34306) {\n                int32_t res_34311 = ((__local\n                                      int32_t *) mem_39711)[sext_i32_i64(beg_34294)];\n                int32_t res_34312 = add32(1, beg_34294);\n                \n                loopres_34308 = res_34311;\n                loopres_34309 = res_34312;\n                loopres_34310 = end_34295;\n            } else {\n                int32_t res_34313 = ((__local\n                                      int32_t *) mem_39711)[sext_i32_i64(end_34295)];\n                int32_t res_34314 = sub32(end_34295, 1);\n                \n                loopres_34308 = res_34313;\n                loopres_34309 = beg_34294;\n                loopres_34310 = res_34314;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_40429 == 0) {\n                ((__local int32_t *) mem_39760)[sext_i32_i64(i_34291)] =\n                    loopres_34308;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_40429 == 0) {\n                ((__local",
            " float *) mem_39762)[sext_i32_i64(i_34291)] =\n                    loopres_34307;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int32_t beg_tmp_40456 = loopres_34309;\n            int32_t end_tmp_40457 = loopres_34310;\n            \n            beg_34294 = beg_tmp_40456;\n            end_34295 = end_tmp_40457;\n        }\n        res_34289 = beg_34294;\n        res_34290 = end_34295;\n        for (int32_t i_40458 = 0; i_40458 < sdiv_up32(8 - local_tid_40429,\n                                                      ppl_31090); i_40458++) {\n            ((__global\n              int32_t *) double_buffer_mem_40104)[sext_i32_i64(phys_tid_33960 *\n                                                  8) + sext_i32_i64(i_40458 *\n                                                  ppl_31090 +\n                                                  local_tid_40429)] = ((__local\n                                                                        int32_t *) mem_39760)[sext_i32_i64(i_40458 *\n                                                                                              ppl_31090 +\n                                                                                              local_tid_40429)];\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_40459 = 0; i_40459 < sdiv_up32(8 - local_tid_40429,\n                                                      ppl_31090); i_40459++) {\n            ((__global\n              float *) double_buffer_mem_40105)[sext_i32_i64(phys_tid_33960 *\n                                                8) + sext_i32_i64(i_40459 *\n                                                ppl_31090 + local_tid_40429)] =\n                ((__local float *) mem_39762)[sext_i32_i64(i_40459 * ppl_31090 +\n                                              local_tid_40429)];\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n    }\n    if (local_tid_40429 == 0) {\n        for (int32_t i_40460 = 0; i_40460 < 8; i_40460++) {\n            ((__globa",
            "l int32_t *) mem_39818)[sext_i32_i64(gtid_33944) * 8 +\n                                             sext_i32_i64(i_40460)] = ((__global\n                                                                        int32_t *) double_buffer_mem_40104)[sext_i32_i64(phys_tid_33960 *\n                                                                                                            8) +\n                                                                                                            sext_i32_i64(i_40460)];\n        }\n    }\n    if (local_tid_40429 == 0) {\n        for (int32_t i_40461 = 0; i_40461 < 8; i_40461++) {\n            ((__global float *) mem_39822)[sext_i32_i64(gtid_33944) * 8 +\n                                           sext_i32_i64(i_40461)] = ((__global\n                                                                      float *) double_buffer_mem_40105)[sext_i32_i64(phys_tid_33960 *\n                                                                                                        8) +\n                                                                                                        sext_i32_i64(i_40461)];\n        }\n    }\n    \n  error_3:\n    return;\n}\n__kernel void exactKnnFixKzisegred_nonseg_33941(__global int *global_failure,\n                                                int failure_is_an_option,\n                                                __global\n                                                int *global_failure_args,\n                                                uint red_arr_mem_40361_backing_offset_0,\n                                                uint sync_arr_mem_40359_backing_offset_1,\n                                                int32_t d_31022,\n                                                int32_t q_31023,\n                                                int32_t n_31026,\n                                                int32_t s_31037,\n                                                int32_t num_leaves_31075,\n       ",
            "                                         int32_t res_31079,\n                                                int32_t h_31086,\n                                                int32_t num_groups_33933,\n                                                __global\n                                                unsigned char *median_dims_mem_39419,\n                                                __global\n                                                unsigned char *median_vals_mem_39420,\n                                                __global\n                                                unsigned char *prev_eqdims_mem_39421,\n                                                __global\n                                                unsigned char *mem_39444,\n                                                __global\n                                                unsigned char *mem_param_39467,\n                                                __global\n                                                unsigned char *mem_param_39472,\n                                                __global\n                                                unsigned char *mem_param_39477,\n                                                __global\n                                                unsigned char *mem_param_39482,\n                                                __global\n                                                unsigned char *mem_39501,\n                                                __global\n                                                unsigned char *mem_39504,\n                                                __global\n                                                unsigned char *mem_39507,\n                                                __global\n                                                unsigned char *mem_39510,\n                                                __global\n                                                unsigned char *exactKnnFixKzicounter_mem_40349,\n                ",
            "                                __global\n                                                unsigned char *group_res_arr_mem_40351,\n                                                int32_t num_threads_40353)\n{\n    #define segred_group_sizze_33931 (exactKnnFixKzisegred_group_sizze_33930)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *red_arr_mem_40361_backing_1 =\n                  &shared_mem[red_arr_mem_40361_backing_offset_0];\n    volatile char *sync_arr_mem_40359_backing_0 =\n                  &shared_mem[sync_arr_mem_40359_backing_offset_1];\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40354;\n    int32_t local_tid_40355;\n    int32_t group_sizze_40358;\n    int32_t wave_sizze_40357;\n    int32_t group_tid_40356;\n    \n    global_tid_40354 = get_global_id(0);\n    local_tid_40355 = get_local_id(0);\n    group_sizze_40358 = get_local_size(0);\n    wave_sizze_40357 = LOCKSTEP_WIDTH;\n    group_tid_40356 = get_group_id(0);\n    \n    int32_t phys_tid_33941;\n    \n    phys_tid_33941 = global_tid_40354;\n    \n    __local char *sync_arr_mem_40359;\n    \n    sync_arr_mem_40359 = (__local char *) sync_arr_mem_40359_backing_0;\n    \n    __local char *red_arr_mem_40361;\n    \n    red_arr_mem_40361 = (__local char *) red_arr_mem_40361_backing_1;\n    \n    int32_t dummy_33939;\n    \n    dummy_33939 = 0;\n    \n    int32_t gtid_33940;\n    \n    gtid_33940 = 0;\n    \n    int32_t x_acc_40363;\n    int32_t chunk_sizze_40364;\n    \n    chunk_sizze_40364 = smin32(sdiv_up32(s_31037, segred_group_sizze_33931 *\n                                         num_groups_33933), sdiv_up32(s_31037 -\n                                                                      phys_tid_33941,\n                                                         ",
            "             num_threads_40353));\n    \n    int32_t x_31283;\n    int32_t x_31284;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_40363 = 0;\n    }\n    for (int32_t i_40368 = 0; i_40368 < chunk_sizze_40364; i_40368++) {\n        gtid_33940 = phys_tid_33941 + num_threads_40353 * i_40368;\n        // apply map function\n        {\n            int32_t x_31288 = ((__global\n                                int32_t *) mem_param_39472)[sext_i32_i64(gtid_33940)];\n            int32_t x_31289 = ((__global\n                                int32_t *) mem_param_39477)[sext_i32_i64(gtid_33940)];\n            float x_31290 = ((__global\n                              float *) mem_param_39482)[sext_i32_i64(gtid_33940)];\n            bool cond_31291 = sle32(num_leaves_31075, x_31288);\n            int32_t res_31292;\n            int32_t res_31293;\n            float res_31294;\n            \n            if (cond_31291) {\n                res_31292 = num_leaves_31075;\n                res_31293 = x_31289;\n                res_31294 = x_31290;\n            } else {\n                float x_31287 = ((__global\n                                  float *) mem_param_39467)[sext_i32_i64(gtid_33940) *\n                                                            8 + 7];\n                int32_t last_leaf_31295 = add32(q_31023, x_31288);\n                int32_t x_31296 = mul32(2, q_31023);\n                int32_t no_leaf_31297 = add32(1, x_31296);\n                bool cond_31298 = last_leaf_31295 == 0;\n                bool cond_31299 = !cond_31298;\n                bool res_31300;\n                int32_t res_31301;\n                int32_t res_31302;\n                int32_t res_31303;\n                float res_31304;\n                int32_t res_31305;\n                bool loop_while_31306;\n                int32_t node_index_31307;\n                int32_t stack_31308;\n                int32_t count_31309;\n                float dist_31310;\n                int32_t rec_node_31311;\n                \n       ",
            "         loop_while_31306 = cond_31299;\n                node_index_31307 = last_leaf_31295;\n                stack_31308 = x_31289;\n                count_31309 = h_31086;\n                dist_31310 = x_31290;\n                rec_node_31311 = -1;\n                while (loop_while_31306) {\n                    int32_t x_31312 = sub32(node_index_31307, 1);\n                    int32_t res_31313 = sdiv32(x_31312, 2);\n                    int32_t y_31314 = 1 << count_31309;\n                    int32_t b_31315 = stack_31308 & y_31314;\n                    bool res_31316 = b_31315 == 0;\n                    bool res_31317 = !res_31316;\n                    bool x_31318 = sle32(0, res_31313);\n                    bool y_31319 = slt32(res_31313, q_31023);\n                    bool bounds_check_31320 = x_31318 && y_31319;\n                    bool index_certs_31321;\n                    \n                    if (!bounds_check_31320) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          26) == -1) {\n                                global_failure_args[0] = res_31313;\n                                global_failure_args[1] = q_31023;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    int32_t i_31322 = ((__global\n                                        int32_t *) median_dims_mem_39419)[sext_i32_i64(res_31313)];\n                    bool x_31323 = sle32(0, i_31322);\n                    bool y_31324 = slt32(i_31322, d_31022);\n                    bool bounds_check_31325 = x_31323 && y_31324;\n                    bool index_certs_31326;\n                    \n                    if (!bounds_check_31325) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure",
            ", -1,\n                                                          27) == -1) {\n                                global_failure_args[0] = i_31322;\n                                global_failure_args[1] = d_31022;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float q_m_d_31327 = ((__global\n                                          float *) mem_39444)[sext_i32_i64(i_31322) *\n                                                              sext_i32_i64(n_31026) +\n                                                              sext_i32_i64(gtid_33940)];\n                    float x_31328 = ((__global\n                                      float *) median_vals_mem_39420)[sext_i32_i64(res_31313)];\n                    float cur_med_dst_31329 = x_31328 - q_m_d_31327;\n                    float cur_med_sqr_31330 = cur_med_dst_31329 *\n                          cur_med_dst_31329;\n                    bool res_31331;\n                    int32_t res_31332;\n                    float res_31333;\n                    bool loop_while_31334;\n                    int32_t idx_31335;\n                    float res_31336;\n                    \n                    loop_while_31334 = x_31318;\n                    idx_31335 = res_31313;\n                    res_31336 = 0.0F;\n                    while (loop_while_31334) {\n                        bool x_31337 = sle32(0, idx_31335);\n                        bool y_31338 = slt32(idx_31335, q_31023);\n                        bool bounds_check_31339 = x_31337 && y_31338;\n                        bool index_certs_31340;\n                        \n                        if (!bounds_check_31339) {\n                            {\n                                if (atomic_cmpxchg_i32_global(global_failure,\n                                                              -1, 28) == -1",
            ") {\n                                    global_failure_args[0] = idx_31335;\n                                    global_failure_args[1] = q_31023;\n                                    ;\n                                }\n                                local_failure = true;\n                                goto error_0;\n                            }\n                        }\n                        \n                        int32_t anc_31341 = ((__global\n                                              int32_t *) prev_eqdims_mem_39421)[sext_i32_i64(idx_31335)];\n                        bool cond_31342 = anc_31341 == -1;\n                        int32_t loopres_31343;\n                        float loopres_31344;\n                        \n                        if (cond_31342) {\n                            loopres_31343 = -1;\n                            loopres_31344 = 0.0F;\n                        } else {\n                            int32_t log2_arg_31345 = add32(1, anc_31341);\n                            bool loop_cond_31346 = slt32(1, log2_arg_31345);\n                            bool res_31347;\n                            int32_t res_31348;\n                            int32_t res_31349;\n                            bool loop_while_31350;\n                            int32_t y_31351;\n                            int32_t c_31352;\n                            \n                            loop_while_31350 = loop_cond_31346;\n                            y_31351 = log2_arg_31345;\n                            c_31352 = 0;\n                            while (loop_while_31350) {\n                                int32_t loopres_31353 = ashr32(y_31351, 1);\n                                int32_t loopres_31354 = add32(1, c_31352);\n                                bool loop_cond_31355 = slt32(1, loopres_31353);\n                                bool loop_while_tmp_40378 = loop_cond_31355;\n                                int32_t y_tmp_40379 = loopres_31353;\n                                int32_t c",
            "_tmp_40380 = loopres_31354;\n                                \n                                loop_while_31350 = loop_while_tmp_40378;\n                                y_31351 = y_tmp_40379;\n                                c_31352 = c_tmp_40380;\n                            }\n                            res_31347 = loop_while_31350;\n                            res_31348 = y_31351;\n                            res_31349 = c_31352;\n                            \n                            int32_t y_31356 = 1 << res_31349;\n                            int32_t b_31357 = stack_31308 & y_31356;\n                            bool res_31358 = b_31357 == 0;\n                            int32_t res_31359;\n                            \n                            if (res_31358) {\n                                res_31359 = anc_31341;\n                            } else {\n                                res_31359 = -1;\n                            }\n                            \n                            float res_31360;\n                            \n                            if (res_31358) {\n                                res_31360 = res_31336;\n                            } else {\n                                bool x_31361 = sle32(0, anc_31341);\n                                bool y_31362 = slt32(anc_31341, q_31023);\n                                bool bounds_check_31363 = x_31361 && y_31362;\n                                bool index_certs_31364;\n                                \n                                if (!bounds_check_31363) {\n                                    {\n                                        if (atomic_cmpxchg_i32_global(global_failure,\n                                                                      -1, 29) ==\n                                            -1) {\n                                            global_failure_args[0] = anc_31341;\n                                            global_failure_args[1] = q_31023;\n                                       ",
            "     ;\n                                        }\n                                        local_failure = true;\n                                        goto error_0;\n                                    }\n                                }\n                                \n                                float x_31365 = ((__global\n                                                  float *) median_vals_mem_39420)[sext_i32_i64(anc_31341)];\n                                float res_31366 = x_31365 - q_m_d_31327;\n                                \n                                res_31360 = res_31366;\n                            }\n                            loopres_31343 = res_31359;\n                            loopres_31344 = res_31360;\n                        }\n                        \n                        bool loop_cond_31367 = sle32(0, loopres_31343);\n                        bool loop_while_tmp_40375 = loop_cond_31367;\n                        int32_t idx_tmp_40376 = loopres_31343;\n                        float res_tmp_40377 = loopres_31344;\n                        \n                        loop_while_31334 = loop_while_tmp_40375;\n                        idx_31335 = idx_tmp_40376;\n                        res_31336 = res_tmp_40377;\n                    }\n                    res_31331 = loop_while_31334;\n                    res_31332 = idx_31335;\n                    res_31333 = res_31336;\n                    \n                    float prv_med_sqr_31368 = res_31333 * res_31333;\n                    float x_31369 = dist_31310 - cur_med_sqr_31330;\n                    float abs_arg_31370 = prv_med_sqr_31368 + x_31369;\n                    float res_31371 = (float) fabs(abs_arg_31370);\n                    float x_31372 = dist_31310 - prv_med_sqr_31368;\n                    float abs_arg_31373 = cur_med_sqr_31330 + x_31372;\n                    float res_31374 = (float) fabs(abs_arg_31373);\n                    int32_t loopres_31375;\n                    int32_t loopres_31376;\n        ",
            "            float loopres_31377;\n                    int32_t loopres_31378;\n                    \n                    if (res_31317) {\n                        int32_t res_31379 = sub32(count_31309, 1);\n                        \n                        loopres_31375 = stack_31308;\n                        loopres_31376 = res_31379;\n                        loopres_31377 = res_31371;\n                        loopres_31378 = -1;\n                    } else {\n                        bool to_visit_31380 = res_31374 < x_31287;\n                        bool cond_31381 = !to_visit_31380;\n                        float res_31382;\n                        \n                        if (cond_31381) {\n                            res_31382 = dist_31310;\n                        } else {\n                            res_31382 = res_31374;\n                        }\n                        \n                        int32_t res_31383;\n                        int32_t res_31384;\n                        int32_t res_31385;\n                        \n                        if (cond_31381) {\n                            int32_t res_31386 = sub32(count_31309, 1);\n                            \n                            res_31383 = stack_31308;\n                            res_31384 = res_31386;\n                            res_31385 = -1;\n                        } else {\n                            int32_t x_31387 = smod32(node_index_31307, 2);\n                            bool cond_31388 = x_31387 == 0;\n                            int32_t snd_node_31389;\n                            \n                            if (cond_31388) {\n                                snd_node_31389 = x_31312;\n                            } else {\n                                int32_t res_31390 = add32(1, node_index_31307);\n                                \n                                snd_node_31389 = res_31390;\n                            }\n                            \n                            int32_t y_31391 = sub32(y_31314",
            ", 1);\n                            int32_t fst_31392 = stack_31308 & y_31391;\n                            int32_t y_31393 = add32(1, count_31309);\n                            int32_t x_31394 = ashr32(stack_31308, y_31393);\n                            int32_t snd_31395 = x_31394 << y_31393;\n                            int32_t x_31396 = fst_31392 | snd_31395;\n                            int32_t res_31397 = y_31314 | x_31396;\n                            \n                            res_31383 = res_31397;\n                            res_31384 = count_31309;\n                            res_31385 = snd_node_31389;\n                        }\n                        loopres_31375 = res_31383;\n                        loopres_31376 = res_31384;\n                        loopres_31377 = res_31382;\n                        loopres_31378 = res_31385;\n                    }\n                    \n                    bool cond_31398 = res_31313 == 0;\n                    bool cond_31399 = !cond_31398;\n                    bool res_31400 = slt32(loopres_31378, 0);\n                    bool x_31401 = cond_31399 && res_31400;\n                    bool loop_while_tmp_40369 = x_31401;\n                    int32_t node_index_tmp_40370 = res_31313;\n                    int32_t stack_tmp_40371 = loopres_31375;\n                    int32_t count_tmp_40372 = loopres_31376;\n                    float dist_tmp_40373 = loopres_31377;\n                    int32_t rec_node_tmp_40374 = loopres_31378;\n                    \n                    loop_while_31306 = loop_while_tmp_40369;\n                    node_index_31307 = node_index_tmp_40370;\n                    stack_31308 = stack_tmp_40371;\n                    count_31309 = count_tmp_40372;\n                    dist_31310 = dist_tmp_40373;\n                    rec_node_31311 = rec_node_tmp_40374;\n                }\n                res_31300 = loop_while_31306;\n                res_31301 = node_index_31307;\n                res_31302 = stack_31308;\n                res_",
            "31303 = count_31309;\n                res_31304 = dist_31310;\n                res_31305 = rec_node_31311;\n                \n                bool cond_31402 = res_31301 == 0;\n                bool res_31403 = res_31305 == -1;\n                bool x_31404 = cond_31402 && res_31403;\n                int32_t res_31405;\n                int32_t res_31406;\n                \n                if (x_31404) {\n                    res_31405 = no_leaf_31297;\n                    res_31406 = res_31302;\n                } else {\n                    int32_t x_31407 = 1 << res_31079;\n                    int32_t y_31408 = sub32(x_31407, 1);\n                    bool res_31409 = sle32(y_31408, res_31305);\n                    bool loop_cond_31410 = !res_31409;\n                    bool res_31411;\n                    int32_t res_31412;\n                    int32_t res_31413;\n                    int32_t res_31414;\n                    bool loop_while_31415;\n                    int32_t node_index_31416;\n                    int32_t stack_31417;\n                    int32_t count_31418;\n                    \n                    loop_while_31415 = loop_cond_31410;\n                    node_index_31416 = res_31305;\n                    stack_31417 = res_31302;\n                    count_31418 = res_31303;\n                    while (loop_while_31415) {\n                        int32_t count_31419 = add32(1, count_31418);\n                        int32_t x_31420 = 1 << count_31419;\n                        int32_t y_31421 = sub32(x_31420, 1);\n                        int32_t fst_31422 = stack_31417 & y_31421;\n                        int32_t y_31423 = add32(1, count_31419);\n                        int32_t x_31424 = ashr32(stack_31417, y_31423);\n                        int32_t snd_31425 = x_31424 << y_31423;\n                        int32_t x_31426 = fst_31422 | snd_31425;\n                        bool x_31427 = sle32(0, node_index_31416);\n                        bool y_31428 = slt32(node_index_31416, q_31023);\n        ",
            "                bool bounds_check_31429 = x_31427 && y_31428;\n                        bool index_certs_31430;\n                        \n                        if (!bounds_check_31429) {\n                            {\n                                if (atomic_cmpxchg_i32_global(global_failure,\n                                                              -1, 30) == -1) {\n                                    global_failure_args[0] = node_index_31416;\n                                    global_failure_args[1] = q_31023;\n                                    ;\n                                }\n                                local_failure = true;\n                                goto error_0;\n                            }\n                        }\n                        \n                        int32_t i_31431 = ((__global\n                                            int32_t *) median_dims_mem_39419)[sext_i32_i64(node_index_31416)];\n                        bool x_31432 = sle32(0, i_31431);\n                        bool y_31433 = slt32(i_31431, d_31022);\n                        bool bounds_check_31434 = x_31432 && y_31433;\n                        bool index_certs_31435;\n                        \n                        if (!bounds_check_31434) {\n                            {\n                                if (atomic_cmpxchg_i32_global(global_failure,\n                                                              -1, 31) == -1) {\n                                    global_failure_args[0] = i_31431;\n                                    global_failure_args[1] = d_31022;\n                                    ;\n                                }\n                                local_failure = true;\n                                goto error_0;\n                            }\n                        }\n                        \n                        float x_31436 = ((__global\n                                          float *) mem_39444)[sext_i32_i64(i_31431) *\n                            ",
            "                                  sext_i32_i64(n_31026) +\n                                                              sext_i32_i64(gtid_33940)];\n                        float y_31437 = ((__global\n                                          float *) median_vals_mem_39420)[sext_i32_i64(node_index_31416)];\n                        bool cond_31438 = x_31436 <= y_31437;\n                        int32_t node_index_31439;\n                        \n                        if (cond_31438) {\n                            int32_t x_31440 = add32(1, node_index_31416);\n                            int32_t x_31441 = mul32(2, x_31440);\n                            int32_t res_31442 = sub32(x_31441, 1);\n                            \n                            node_index_31439 = res_31442;\n                        } else {\n                            int32_t x_31443 = add32(1, node_index_31416);\n                            int32_t res_31444 = mul32(2, x_31443);\n                            \n                            node_index_31439 = res_31444;\n                        }\n                        \n                        bool res_31445 = sle32(y_31408, node_index_31439);\n                        bool loop_cond_31446 = !res_31445;\n                        bool loop_while_tmp_40381 = loop_cond_31446;\n                        int32_t node_index_tmp_40382 = node_index_31439;\n                        int32_t stack_tmp_40383 = x_31426;\n                        int32_t count_tmp_40384 = count_31419;\n                        \n                        loop_while_31415 = loop_while_tmp_40381;\n                        node_index_31416 = node_index_tmp_40382;\n                        stack_31417 = stack_tmp_40383;\n                        count_31418 = count_tmp_40384;\n                    }\n                    res_31411 = loop_while_31415;\n                    res_31412 = node_index_31416;\n                    res_31413 = stack_31417;\n                    res_31414 = count_31418;\n                    res_31405 = res_",
            "31412;\n                    res_31406 = res_31413;\n                }\n                \n                int32_t res_31447 = sub32(res_31405, q_31023);\n                \n                res_31292 = res_31447;\n                res_31293 = res_31406;\n                res_31294 = res_31304;\n            }\n            \n            bool cond_31448 = slt32(res_31292, num_leaves_31075);\n            int32_t res_31449 = btoi_bool_i32(cond_31448);\n            \n            // save map-out results\n            {\n                ((__global int32_t *) mem_39504)[sext_i32_i64(dummy_33939) *\n                                                 sext_i32_i64(s_31037) +\n                                                 sext_i32_i64(gtid_33940)] =\n                    res_31292;\n                ((__global int32_t *) mem_39507)[sext_i32_i64(dummy_33939) *\n                                                 sext_i32_i64(s_31037) +\n                                                 sext_i32_i64(gtid_33940)] =\n                    res_31293;\n                ((__global float *) mem_39510)[sext_i32_i64(dummy_33939) *\n                                               sext_i32_i64(s_31037) +\n                                               sext_i32_i64(gtid_33940)] =\n                    res_31294;\n            }\n            // load accumulator\n            {\n                x_31283 = x_acc_40363;\n            }\n            // load new values\n            {\n                x_31284 = res_31449;\n            }\n            // apply reduction operator\n            {\n                int32_t res_31285 = add32(x_31283, x_31284);\n                \n                // store in accumulator\n                {\n                    x_acc_40363 = res_31285;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_31283 = x_acc_40363;\n        ((__local int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355)] =\n            x_31283;\n    }\n    \n  error_0:\n    barrier(CLK_L",
            "OCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_40385;\n    int32_t skip_waves_40386;\n    int32_t x_40365;\n    int32_t x_40366;\n    \n    offset_40385 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_40355, segred_group_sizze_33931)) {\n            x_40365 = ((__local\n                        int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355 +\n                                                      offset_40385)];\n        }\n    }\n    offset_40385 = 1;\n    while (slt32(offset_40385, wave_sizze_40357)) {\n        if (slt32(local_tid_40355 + offset_40385, segred_group_sizze_33931) &&\n            ((local_tid_40355 - squot32(local_tid_40355, wave_sizze_40357) *\n              wave_sizze_40357) & (2 * offset_40385 - 1)) == 0) {\n            // read array element\n            {\n                x_40366 = ((volatile __local\n                            int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355 +\n                                                          offset_40385)];\n            }\n            // apply reduction operation\n            {\n                int32_t res_40367 = add32(x_40365, x_40366);\n                \n                x_40365 = res_40367;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355)] =\n                    x_40365;\n            }\n        }\n        offset_40385 *= 2;\n    }\n    skip_waves_40386 = 1;\n    while (slt32(skip_waves_40386, squot32(segred_group_sizze_33931 +\n                                           wave_sizze_40357 - 1,\n                                           wave_sizze_40357))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_40385 = skip_waves_40386 * wave_sizze_40357;\n        if (slt32(local_tid_40355 + offset_40385, segred_group_sizze_33931) &&\n            ((local_tid_40355 - squot32(loc",
            "al_tid_40355, wave_sizze_40357) *\n              wave_sizze_40357) == 0 && (squot32(local_tid_40355,\n                                                 wave_sizze_40357) & (2 *\n                                                                      skip_waves_40386 -\n                                                                      1)) ==\n             0)) {\n            // read array element\n            {\n                x_40366 = ((__local\n                            int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355 +\n                                                          offset_40385)];\n            }\n            // apply reduction operation\n            {\n                int32_t res_40367 = add32(x_40365, x_40366);\n                \n                x_40365 = res_40367;\n            }\n            // write result of operation\n            {\n                ((__local\n                  int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355)] =\n                    x_40365;\n            }\n        }\n        skip_waves_40386 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (local_tid_40355 == 0) {\n            x_acc_40363 = x_40365;\n        }\n    }\n    \n    int32_t old_counter_40387;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_40355 == 0) {\n            ((__global\n              int32_t *) group_res_arr_mem_40351)[sext_i32_i64(group_tid_40356) *\n                                                  sext_i32_i64(segred_group_sizze_33931)] =\n                x_acc_40363;\n            mem_fence_global();\n            old_counter_40387 = atomic_add_i32_global(&((volatile __global\n                                                         int *) exactKnnFixKzicounter_mem_40349)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_40359)[0] = old_counter_40387 ==\n                num_groups_33933 - 1;\n     ",
            "   }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_40388;\n    \n    is_last_group_40388 = ((__local bool *) sync_arr_mem_40359)[0];\n    if (is_last_group_40388) {\n        if (local_tid_40355 == 0) {\n            old_counter_40387 = atomic_add_i32_global(&((volatile __global\n                                                         int *) exactKnnFixKzicounter_mem_40349)[0],\n                                                      (int) (0 -\n                                                             num_groups_33933));\n        }\n        // read in the per-group-results\n        {\n            int32_t read_per_thread_40389 = sdiv_up32(num_groups_33933,\n                                                      segred_group_sizze_33931);\n            \n            x_31283 = 0;\n            for (int32_t i_40390 = 0; i_40390 < read_per_thread_40389;\n                 i_40390++) {\n                int32_t group_res_id_40391 = local_tid_40355 *\n                        read_per_thread_40389 + i_40390;\n                int32_t index_of_group_res_40392 = group_res_id_40391;\n                \n                if (slt32(group_res_id_40391, num_groups_33933)) {\n                    x_31284 = ((__global\n                                int32_t *) group_res_arr_mem_40351)[sext_i32_i64(index_of_group_res_40392) *\n                                                                    sext_i32_i64(segred_group_sizze_33931)];\n                    \n                    int32_t res_31285;\n                    \n                    res_31285 = add32(x_31283, x_31284);\n                    x_31283 = res_31285;\n                }\n            }\n        }\n        ((__local int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355)] =\n            x_31283;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_40393;\n            int32_t skip_waves_40394;\n            int32_t x_40365;\n            int32_t x_40366;\n       ",
            "     \n            offset_40393 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_40355, segred_group_sizze_33931)) {\n                    x_40365 = ((__local\n                                int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355 +\n                                                              offset_40393)];\n                }\n            }\n            offset_40393 = 1;\n            while (slt32(offset_40393, wave_sizze_40357)) {\n                if (slt32(local_tid_40355 + offset_40393,\n                          segred_group_sizze_33931) && ((local_tid_40355 -\n                                                         squot32(local_tid_40355,\n                                                                 wave_sizze_40357) *\n                                                         wave_sizze_40357) &\n                                                        (2 * offset_40393 -\n                                                         1)) == 0) {\n                    // read array element\n                    {\n                        x_40366 = ((volatile __local\n                                    int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355 +\n                                                                  offset_40393)];\n                    }\n                    // apply reduction operation\n                    {\n                        int32_t res_40367 = add32(x_40365, x_40366);\n                        \n                        x_40365 = res_40367;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355)] =\n                            x_40365;\n                    }\n                }\n                offset_40393 *= 2;\n            }\n            skip_waves_40394 = 1;\n            while (slt32(skip_waves_40394, squot",
            "32(segred_group_sizze_33931 +\n                                                   wave_sizze_40357 - 1,\n                                                   wave_sizze_40357))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_40393 = skip_waves_40394 * wave_sizze_40357;\n                if (slt32(local_tid_40355 + offset_40393,\n                          segred_group_sizze_33931) && ((local_tid_40355 -\n                                                         squot32(local_tid_40355,\n                                                                 wave_sizze_40357) *\n                                                         wave_sizze_40357) ==\n                                                        0 &&\n                                                        (squot32(local_tid_40355,\n                                                                 wave_sizze_40357) &\n                                                         (2 * skip_waves_40394 -\n                                                          1)) == 0)) {\n                    // read array element\n                    {\n                        x_40366 = ((__local\n                                    int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355 +\n                                                                  offset_40393)];\n                    }\n                    // apply reduction operation\n                    {\n                        int32_t res_40367 = add32(x_40365, x_40366);\n                        \n                        x_40365 = res_40367;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          int32_t *) red_arr_mem_40361)[sext_i32_i64(local_tid_40355)] =\n                            x_40365;\n                    }\n                }\n                skip_waves_40394 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                i",
            "f (local_tid_40355 == 0) {\n                    ((__global int32_t *) mem_39501)[0] = x_40365;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_33931\n}\n__kernel void findNaturalLeavesFixKziscan_stage1_35797(__global\n                                                       int *global_failure,\n                                                       uint scan_arr_mem_40342_backing_offset_0,\n                                                       uint scan_arr_mem_40340_backing_offset_1,\n                                                       uint scan_arr_mem_40338_backing_offset_2,\n                                                       uint scan_arr_mem_40336_backing_offset_3,\n                                                       int32_t n_31866,\n                                                       int32_t lifted_2_radix_sort_step_arg_31946,\n                                                       int32_t lifted_0_get_bit_arg_31947,\n                                                       __global\n                                                       unsigned char *mem_param_39438,\n                                                       __global\n                                                       unsigned char *mem_39451,\n                                                       __global\n                                                       unsigned char *mem_39454,\n                                                       __global\n                                                       unsigned char *mem_39457,\n                                                       __global\n                                                       unsigned char *mem_39460,\n                                                       __global\n                                                       unsigned char *mem_39463,\n                                                       int32_t num_threads_40330)\n{\n    #define segscan_group_sizze_35792 (fin",
            "dNaturalLeavesFixKzisegscan_group_sizze_35791)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *scan_arr_mem_40342_backing_3 =\n                  &shared_mem[scan_arr_mem_40342_backing_offset_0];\n    volatile char *scan_arr_mem_40340_backing_2 =\n                  &shared_mem[scan_arr_mem_40340_backing_offset_1];\n    volatile char *scan_arr_mem_40338_backing_1 =\n                  &shared_mem[scan_arr_mem_40338_backing_offset_2];\n    volatile char *scan_arr_mem_40336_backing_0 =\n                  &shared_mem[scan_arr_mem_40336_backing_offset_3];\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40331;\n    int32_t local_tid_40332;\n    int32_t group_sizze_40335;\n    int32_t wave_sizze_40334;\n    int32_t group_tid_40333;\n    \n    global_tid_40331 = get_global_id(0);\n    local_tid_40332 = get_local_id(0);\n    group_sizze_40335 = get_local_size(0);\n    wave_sizze_40334 = LOCKSTEP_WIDTH;\n    group_tid_40333 = get_group_id(0);\n    \n    int32_t phys_tid_35797;\n    \n    phys_tid_35797 = global_tid_40331;\n    \n    __local char *scan_arr_mem_40336;\n    __local char *scan_arr_mem_40338;\n    __local char *scan_arr_mem_40340;\n    __local char *scan_arr_mem_40342;\n    \n    scan_arr_mem_40336 = (__local char *) scan_arr_mem_40336_backing_0;\n    scan_arr_mem_40338 = (__local char *) scan_arr_mem_40338_backing_1;\n    scan_arr_mem_40340 = (__local char *) scan_arr_mem_40340_backing_2;\n    scan_arr_mem_40342 = (__local char *) scan_arr_mem_40342_backing_3;\n    \n    int32_t x_31961;\n    int32_t x_31962;\n    int32_t x_31963;\n    int32_t x_31964;\n    int32_t x_31965;\n    int32_t x_31966;\n    int32_t x_31967;\n    int32_t x_31968;\n    \n    x_31961 = 0;\n    x_31962 = 0;\n    x_31963 = 0;\n    x_31964 = 0;\n    for (int32_t j_40344 = 0; j_40344 < sdiv_up32(n_31866, num_threads_40330);\n         j_40344++) {\n        int32_t chunk_offset_40345 = segscan_group_sizze_35792 * j_40344 +\n                group_tid_",
            "40333 * (segscan_group_sizze_35792 *\n                                   sdiv_up32(n_31866, num_threads_40330));\n        int32_t flat_idx_40346 = chunk_offset_40345 + local_tid_40332;\n        int32_t gtid_35796 = flat_idx_40346;\n        \n        // threads in bounds read input\n        {\n            if (slt32(gtid_35796, n_31866)) {\n                int32_t x_31973 = ((__global\n                                    int32_t *) mem_param_39438)[sext_i32_i64(gtid_35796)];\n                int32_t res_31974 = ashr32(x_31973, lifted_0_get_bit_arg_31947);\n                int32_t res_31975 = 1 & res_31974;\n                int32_t x_31976 = mul32(2, res_31975);\n                int32_t res_31977 = ashr32(x_31973,\n                                           lifted_2_radix_sort_step_arg_31946);\n                int32_t res_31978 = 1 & res_31977;\n                int32_t res_31979 = add32(x_31976, res_31978);\n                bool cond_31980 = res_31979 == 0;\n                int32_t res_31981 = btoi_bool_i32(cond_31980);\n                int32_t res_31982;\n                int32_t res_31983;\n                int32_t res_31984;\n                \n                if (cond_31980) {\n                    res_31982 = 0;\n                    res_31983 = 0;\n                    res_31984 = 0;\n                } else {\n                    bool cond_31985 = res_31979 == 1;\n                    int32_t res_31986 = btoi_bool_i32(cond_31985);\n                    int32_t res_31987;\n                    int32_t res_31988;\n                    \n                    if (cond_31985) {\n                        res_31987 = 0;\n                        res_31988 = 0;\n                    } else {\n                        bool cond_31989 = res_31979 == 2;\n                        int32_t res_31990 = btoi_bool_i32(cond_31989);\n                        bool cond_neg_31991 = !cond_31989;\n                        int32_t res_31992 = btoi_bool_i32(cond_neg_31991);\n                        \n                        res_31987 = res_31990;",
            "\n                        res_31988 = res_31992;\n                    }\n                    res_31982 = res_31986;\n                    res_31983 = res_31987;\n                    res_31984 = res_31988;\n                }\n                // write to-scan values to parameters\n                {\n                    x_31965 = res_31981;\n                    x_31966 = res_31982;\n                    x_31967 = res_31983;\n                    x_31968 = res_31984;\n                }\n                // write mapped values results to global memory\n                {\n                    ((__global int32_t *) mem_39463)[sext_i32_i64(gtid_35796)] =\n                        res_31979;\n                }\n            }\n        }\n        // do one intra-group scan operation\n        {\n            // maybe restore some to-scan values to parameters, or read neutral\n            {\n                if (!slt32(gtid_35796, n_31866)) {\n                    x_31965 = 0;\n                    x_31966 = 0;\n                    x_31967 = 0;\n                    x_31968 = 0;\n                }\n            }\n            // combine with carry and write to local memory\n            {\n                int32_t res_31969 = add32(x_31961, x_31965);\n                int32_t res_31970 = add32(x_31962, x_31966);\n                int32_t res_31971 = add32(x_31963, x_31967);\n                int32_t res_31972 = add32(x_31964, x_31968);\n                \n                ((__local\n                  int32_t *) scan_arr_mem_40336)[sext_i32_i64(local_tid_40332)] =\n                    res_31969;\n                ((__local\n                  int32_t *) scan_arr_mem_40338)[sext_i32_i64(local_tid_40332)] =\n                    res_31970;\n                ((__local\n                  int32_t *) scan_arr_mem_40340)[sext_i32_i64(local_tid_40332)] =\n                    res_31971;\n                ((__local\n                  int32_t *) scan_arr_mem_40342)[sext_i32_i64(local_tid_40332)] =\n                    res_31972;\n            }\n            barrier(",
            "CLK_LOCAL_MEM_FENCE);\n            \n            int32_t x_40347;\n            int32_t x_40348;\n            int32_t x_40349;\n            int32_t x_40350;\n            int32_t x_40351;\n            int32_t x_40352;\n            int32_t x_40353;\n            int32_t x_40354;\n            int32_t x_40359;\n            int32_t x_40360;\n            int32_t x_40361;\n            int32_t x_40362;\n            int32_t x_40363;\n            int32_t x_40364;\n            int32_t x_40365;\n            int32_t x_40366;\n            int32_t skip_threads_40371;\n            \n            // read input for in-block scan\n            {\n                if (slt32(local_tid_40332, segscan_group_sizze_35792)) {\n                    x_40351 = ((volatile __local\n                                int32_t *) scan_arr_mem_40336)[sext_i32_i64(local_tid_40332)];\n                    x_40352 = ((volatile __local\n                                int32_t *) scan_arr_mem_40338)[sext_i32_i64(local_tid_40332)];\n                    x_40353 = ((volatile __local\n                                int32_t *) scan_arr_mem_40340)[sext_i32_i64(local_tid_40332)];\n                    x_40354 = ((volatile __local\n                                int32_t *) scan_arr_mem_40342)[sext_i32_i64(local_tid_40332)];\n                    if ((local_tid_40332 - squot32(local_tid_40332, 32) * 32) ==\n                        0) {\n                        x_40347 = x_40351;\n                        x_40348 = x_40352;\n                        x_40349 = x_40353;\n                        x_40350 = x_40354;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_40371 = 1;\n                while (slt32(skip_threads_40371, 32)) {\n                    if (sle32(skip_threads_40371, local_tid_40332 -\n                              squot32(local_tid_40332, 32) * 32) &&\n                        slt32(local_tid_40332, segscan_group_sizze_35792)) {\n                      ",
            "  // read operands\n                        {\n                            x_40347 = ((volatile __local\n                                        int32_t *) scan_arr_mem_40336)[sext_i32_i64(local_tid_40332 -\n                                                                       skip_threads_40371)];\n                            x_40348 = ((volatile __local\n                                        int32_t *) scan_arr_mem_40338)[sext_i32_i64(local_tid_40332 -\n                                                                       skip_threads_40371)];\n                            x_40349 = ((volatile __local\n                                        int32_t *) scan_arr_mem_40340)[sext_i32_i64(local_tid_40332 -\n                                                                       skip_threads_40371)];\n                            x_40350 = ((volatile __local\n                                        int32_t *) scan_arr_mem_40342)[sext_i32_i64(local_tid_40332 -\n                                                                       skip_threads_40371)];\n                        }\n                        // perform operation\n                        {\n                            int32_t res_40355 = add32(x_40347, x_40351);\n                            int32_t res_40356 = add32(x_40348, x_40352);\n                            int32_t res_40357 = add32(x_40349, x_40353);\n                            int32_t res_40358 = add32(x_40350, x_40354);\n                            \n                            x_40347 = res_40355;\n                            x_40348 = res_40356;\n                            x_40349 = res_40357;\n                            x_40350 = res_40358;\n                        }\n                    }\n                    if (sle32(wave_sizze_40334, skip_threads_40371)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (sle32(skip_threads_40371, local_tid_40332 -\n                              squot32(local_tid_40332, 32) * 32) &&\n  ",
            "                      slt32(local_tid_40332, segscan_group_sizze_35792)) {\n                        // write result\n                        {\n                            ((volatile __local\n                              int32_t *) scan_arr_mem_40336)[sext_i32_i64(local_tid_40332)] =\n                                x_40347;\n                            x_40351 = x_40347;\n                            ((volatile __local\n                              int32_t *) scan_arr_mem_40338)[sext_i32_i64(local_tid_40332)] =\n                                x_40348;\n                            x_40352 = x_40348;\n                            ((volatile __local\n                              int32_t *) scan_arr_mem_40340)[sext_i32_i64(local_tid_40332)] =\n                                x_40349;\n                            x_40353 = x_40349;\n                            ((volatile __local\n                              int32_t *) scan_arr_mem_40342)[sext_i32_i64(local_tid_40332)] =\n                                x_40350;\n                            x_40354 = x_40350;\n                        }\n                    }\n                    if (sle32(wave_sizze_40334, skip_threads_40371)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_40371 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_40332 - squot32(local_tid_40332, 32) * 32) ==\n                    31 && slt32(local_tid_40332, segscan_group_sizze_35792)) {\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40336)[sext_i32_i64(squot32(local_tid_40332,\n                                                                          32))] =\n                        x_40347;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40338)[sext_i32_i64(squot32(local_tid_40332,\n            ",
            "                                                              32))] =\n                        x_40348;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40340)[sext_i32_i64(squot32(local_tid_40332,\n                                                                          32))] =\n                        x_40349;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40342)[sext_i32_i64(squot32(local_tid_40332,\n                                                                          32))] =\n                        x_40350;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_40372;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_40332, 32) == 0 &&\n                        slt32(local_tid_40332, segscan_group_sizze_35792)) {\n                        x_40363 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40336)[sext_i32_i64(local_tid_40332)];\n                        x_40364 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40338)[sext_i32_i64(local_tid_40332)];\n                        x_40365 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40340)[sext_i32_i64(local_tid_40332)];\n                        x_40366 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40342)[sext_i32_i64(local_tid_40332)];\n                        if ((local_tid_40332 - squot32(local_tid_40332, 32) *\n                             32) == 0) {\n                            x_40359 = x_40363;\n                            x_40360 = x_40364;\n                            x_40361 = x_40365;\n                            x_40362 = x_40366;\n                        }\n                   ",
            " }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_40372 = 1;\n                    while (slt32(skip_threads_40372, 32)) {\n                        if (sle32(skip_threads_40372, local_tid_40332 -\n                                  squot32(local_tid_40332, 32) * 32) &&\n                            (squot32(local_tid_40332, 32) == 0 &&\n                             slt32(local_tid_40332,\n                                   segscan_group_sizze_35792))) {\n                            // read operands\n                            {\n                                x_40359 = ((volatile __local\n                                            int32_t *) scan_arr_mem_40336)[sext_i32_i64(local_tid_40332 -\n                                                                           skip_threads_40372)];\n                                x_40360 = ((volatile __local\n                                            int32_t *) scan_arr_mem_40338)[sext_i32_i64(local_tid_40332 -\n                                                                           skip_threads_40372)];\n                                x_40361 = ((volatile __local\n                                            int32_t *) scan_arr_mem_40340)[sext_i32_i64(local_tid_40332 -\n                                                                           skip_threads_40372)];\n                                x_40362 = ((volatile __local\n                                            int32_t *) scan_arr_mem_40342)[sext_i32_i64(local_tid_40332 -\n                                                                           skip_threads_40372)];\n                            }\n                            // perform operation\n                            {\n                                int32_t res_40367 = add32(x_40359, x_40363);\n                                int32_t res_40368 = add32(x_40360, x_40364);\n                                int32_t res_40369 = add32(x_40361, x_40",
            "365);\n                                int32_t res_40370 = add32(x_40362, x_40366);\n                                \n                                x_40359 = res_40367;\n                                x_40360 = res_40368;\n                                x_40361 = res_40369;\n                                x_40362 = res_40370;\n                            }\n                        }\n                        if (sle32(wave_sizze_40334, skip_threads_40372)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_40372, local_tid_40332 -\n                                  squot32(local_tid_40332, 32) * 32) &&\n                            (squot32(local_tid_40332, 32) == 0 &&\n                             slt32(local_tid_40332,\n                                   segscan_group_sizze_35792))) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  int32_t *) scan_arr_mem_40336)[sext_i32_i64(local_tid_40332)] =\n                                    x_40359;\n                                x_40363 = x_40359;\n                                ((volatile __local\n                                  int32_t *) scan_arr_mem_40338)[sext_i32_i64(local_tid_40332)] =\n                                    x_40360;\n                                x_40364 = x_40360;\n                                ((volatile __local\n                                  int32_t *) scan_arr_mem_40340)[sext_i32_i64(local_tid_40332)] =\n                                    x_40361;\n                                x_40365 = x_40361;\n                                ((volatile __local\n                                  int32_t *) scan_arr_mem_40342)[sext_i32_i64(local_tid_40332)] =\n                                    x_40362;\n                                x_40366 = x_40362;\n                            }\n                        }\n                   ",
            "     if (sle32(wave_sizze_40334, skip_threads_40372)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_40372 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // carry-in for every block except the first\n            {\n                if (!(squot32(local_tid_40332, 32) == 0 ||\n                      !slt32(local_tid_40332, segscan_group_sizze_35792))) {\n                    // read operands\n                    {\n                        x_40351 = x_40347;\n                        x_40352 = x_40348;\n                        x_40353 = x_40349;\n                        x_40354 = x_40350;\n                        x_40347 = ((__local\n                                    int32_t *) scan_arr_mem_40336)[sext_i32_i64(squot32(local_tid_40332,\n                                                                                        32) -\n                                                                   1)];\n                        x_40348 = ((__local\n                                    int32_t *) scan_arr_mem_40338)[sext_i32_i64(squot32(local_tid_40332,\n                                                                                        32) -\n                                                                   1)];\n                        x_40349 = ((__local\n                                    int32_t *) scan_arr_mem_40340)[sext_i32_i64(squot32(local_tid_40332,\n                                                                                        32) -\n                                                                   1)];\n                        x_40350 = ((__local\n                                    int32_t *) scan_arr_mem_40342)[sext_i32_i64(squot32(local_tid_40332,\n                                                                                        32) -\n                                                                   1)];\n                 ",
            "   }\n                    // perform operation\n                    {\n                        int32_t res_40355 = add32(x_40347, x_40351);\n                        int32_t res_40356 = add32(x_40348, x_40352);\n                        int32_t res_40357 = add32(x_40349, x_40353);\n                        int32_t res_40358 = add32(x_40350, x_40354);\n                        \n                        x_40347 = res_40355;\n                        x_40348 = res_40356;\n                        x_40349 = res_40357;\n                        x_40350 = res_40358;\n                    }\n                    // write final result\n                    {\n                        ((__local\n                          int32_t *) scan_arr_mem_40336)[sext_i32_i64(local_tid_40332)] =\n                            x_40347;\n                        ((__local\n                          int32_t *) scan_arr_mem_40338)[sext_i32_i64(local_tid_40332)] =\n                            x_40348;\n                        ((__local\n                          int32_t *) scan_arr_mem_40340)[sext_i32_i64(local_tid_40332)] =\n                            x_40349;\n                        ((__local\n                          int32_t *) scan_arr_mem_40342)[sext_i32_i64(local_tid_40332)] =\n                            x_40350;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_40332, 32) == 0) {\n                    ((__local\n                      int32_t *) scan_arr_mem_40336)[sext_i32_i64(local_tid_40332)] =\n                        x_40351;\n                    ((__local\n                      int32_t *) scan_arr_mem_40338)[sext_i32_i64(local_tid_40332)] =\n                        x_40352;\n                    ((__local\n                      int32_t *) scan_arr_mem_40340)[sext_i32_i64(local_tid_40332)] =\n                        x_40353;\n                    ((__local\n                      i",
            "nt32_t *) scan_arr_mem_40342)[sext_i32_i64(local_tid_40332)] =\n                        x_40354;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // threads in bounds write partial scan result\n            {\n                if (slt32(gtid_35796, n_31866)) {\n                    ((__global int32_t *) mem_39451)[sext_i32_i64(gtid_35796)] =\n                        ((__local\n                          int32_t *) scan_arr_mem_40336)[sext_i32_i64(local_tid_40332)];\n                    ((__global int32_t *) mem_39454)[sext_i32_i64(gtid_35796)] =\n                        ((__local\n                          int32_t *) scan_arr_mem_40338)[sext_i32_i64(local_tid_40332)];\n                    ((__global int32_t *) mem_39457)[sext_i32_i64(gtid_35796)] =\n                        ((__local\n                          int32_t *) scan_arr_mem_40340)[sext_i32_i64(local_tid_40332)];\n                    ((__global int32_t *) mem_39460)[sext_i32_i64(gtid_35796)] =\n                        ((__local\n                          int32_t *) scan_arr_mem_40342)[sext_i32_i64(local_tid_40332)];\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // first thread reads last element as carry-in for next iteration\n            {\n                bool crosses_segment_40373 = 0;\n                bool should_load_carry_40374 = local_tid_40332 == 0 &&\n                     !crosses_segment_40373;\n                \n                if (should_load_carry_40374) {\n                    x_31961 = ((__local\n                                int32_t *) scan_arr_mem_40336)[sext_i32_i64(segscan_group_sizze_35792 -\n                                                               1)];\n                    x_31962 = ((__local\n                                int32_t *) scan_arr_mem_40338)[sext_i32_i64(segscan_group_sizze_35792 -\n                                                               1)];\n                    x_31963 = ((__local\n                                i",
            "nt32_t *) scan_arr_mem_40340)[sext_i32_i64(segscan_group_sizze_35792 -\n                                                               1)];\n                    x_31964 = ((__local\n                                int32_t *) scan_arr_mem_40342)[sext_i32_i64(segscan_group_sizze_35792 -\n                                                               1)];\n                }\n                if (!should_load_carry_40374) {\n                    x_31961 = 0;\n                    x_31962 = 0;\n                    x_31963 = 0;\n                    x_31964 = 0;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segscan_group_sizze_35792\n}\n__kernel void findNaturalLeavesFixKziscan_stage2_35797(__global\n                                                       int *global_failure,\n                                                       uint scan_arr_mem_40386_backing_offset_0,\n                                                       uint scan_arr_mem_40384_backing_offset_1,\n                                                       uint scan_arr_mem_40382_backing_offset_2,\n                                                       uint scan_arr_mem_40380_backing_offset_3,\n                                                       int32_t n_31866, __global\n                                                       unsigned char *mem_39451,\n                                                       __global\n                                                       unsigned char *mem_39454,\n                                                       __global\n                                                       unsigned char *mem_39457,\n                                                       __global\n                                                       unsigned char *mem_39460,\n                                                       int32_t stage1_num_groups_40329,\n                                                       int32_t num_threads_40330)",
            "\n{\n    #define segscan_group_sizze_35792 (findNaturalLeavesFixKzisegscan_group_sizze_35791)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *scan_arr_mem_40386_backing_3 =\n                  &shared_mem[scan_arr_mem_40386_backing_offset_0];\n    volatile char *scan_arr_mem_40384_backing_2 =\n                  &shared_mem[scan_arr_mem_40384_backing_offset_1];\n    volatile char *scan_arr_mem_40382_backing_1 =\n                  &shared_mem[scan_arr_mem_40382_backing_offset_2];\n    volatile char *scan_arr_mem_40380_backing_0 =\n                  &shared_mem[scan_arr_mem_40380_backing_offset_3];\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40375;\n    int32_t local_tid_40376;\n    int32_t group_sizze_40379;\n    int32_t wave_sizze_40378;\n    int32_t group_tid_40377;\n    \n    global_tid_40375 = get_global_id(0);\n    local_tid_40376 = get_local_id(0);\n    group_sizze_40379 = get_local_size(0);\n    wave_sizze_40378 = LOCKSTEP_WIDTH;\n    group_tid_40377 = get_group_id(0);\n    \n    int32_t phys_tid_35797;\n    \n    phys_tid_35797 = global_tid_40375;\n    \n    __local char *scan_arr_mem_40380;\n    __local char *scan_arr_mem_40382;\n    __local char *scan_arr_mem_40384;\n    __local char *scan_arr_mem_40386;\n    \n    scan_arr_mem_40380 = (__local char *) scan_arr_mem_40380_backing_0;\n    scan_arr_mem_40382 = (__local char *) scan_arr_mem_40382_backing_1;\n    scan_arr_mem_40384 = (__local char *) scan_arr_mem_40384_backing_2;\n    scan_arr_mem_40386 = (__local char *) scan_arr_mem_40386_backing_3;\n    \n    int32_t flat_idx_40388;\n    \n    flat_idx_40388 = (local_tid_40376 + 1) * (segscan_group_sizze_35792 *\n                                              sdiv_up32(n_31866,\n                                                        num_threads_40330)) - 1;\n    \n    int32_t gtid_35796;\n    \n    gtid_35796 = flat_idx_40388;\n    // threads in bound read carries; others get neutral element\n    {\n       ",
            " if (slt32(gtid_35796, n_31866)) {\n            ((__local\n              int32_t *) scan_arr_mem_40380)[sext_i32_i64(local_tid_40376)] =\n                ((__global int32_t *) mem_39451)[sext_i32_i64(gtid_35796)];\n            ((__local\n              int32_t *) scan_arr_mem_40382)[sext_i32_i64(local_tid_40376)] =\n                ((__global int32_t *) mem_39454)[sext_i32_i64(gtid_35796)];\n            ((__local\n              int32_t *) scan_arr_mem_40384)[sext_i32_i64(local_tid_40376)] =\n                ((__global int32_t *) mem_39457)[sext_i32_i64(gtid_35796)];\n            ((__local\n              int32_t *) scan_arr_mem_40386)[sext_i32_i64(local_tid_40376)] =\n                ((__global int32_t *) mem_39460)[sext_i32_i64(gtid_35796)];\n        } else {\n            ((__local\n              int32_t *) scan_arr_mem_40380)[sext_i32_i64(local_tid_40376)] = 0;\n            ((__local\n              int32_t *) scan_arr_mem_40382)[sext_i32_i64(local_tid_40376)] = 0;\n            ((__local\n              int32_t *) scan_arr_mem_40384)[sext_i32_i64(local_tid_40376)] = 0;\n            ((__local\n              int32_t *) scan_arr_mem_40386)[sext_i32_i64(local_tid_40376)] = 0;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t x_31961;\n    int32_t x_31962;\n    int32_t x_31963;\n    int32_t x_31964;\n    int32_t x_31965;\n    int32_t x_31966;\n    int32_t x_31967;\n    int32_t x_31968;\n    int32_t x_40389;\n    int32_t x_40390;\n    int32_t x_40391;\n    int32_t x_40392;\n    int32_t x_40393;\n    int32_t x_40394;\n    int32_t x_40395;\n    int32_t x_40396;\n    int32_t skip_threads_40401;\n    \n    // read input for in-block scan\n    {\n        if (slt32(local_tid_40376, stage1_num_groups_40329)) {\n            x_31965 = ((volatile __local\n                        int32_t *) scan_arr_mem_40380)[sext_i32_i64(local_tid_40376)];\n            x_31966 = ((volatile __local\n                        int32_t *) scan_arr_mem_40382)[sext_i32_i64(local_tid_40376)];\n            x_31967 = ((volatile __local\n  ",
            "                      int32_t *) scan_arr_mem_40384)[sext_i32_i64(local_tid_40376)];\n            x_31968 = ((volatile __local\n                        int32_t *) scan_arr_mem_40386)[sext_i32_i64(local_tid_40376)];\n            if ((local_tid_40376 - squot32(local_tid_40376, 32) * 32) == 0) {\n                x_31961 = x_31965;\n                x_31962 = x_31966;\n                x_31963 = x_31967;\n                x_31964 = x_31968;\n            }\n        }\n    }\n    // in-block scan (hopefully no barriers needed)\n    {\n        skip_threads_40401 = 1;\n        while (slt32(skip_threads_40401, 32)) {\n            if (sle32(skip_threads_40401, local_tid_40376 -\n                      squot32(local_tid_40376, 32) * 32) &&\n                slt32(local_tid_40376, stage1_num_groups_40329)) {\n                // read operands\n                {\n                    x_31961 = ((volatile __local\n                                int32_t *) scan_arr_mem_40380)[sext_i32_i64(local_tid_40376 -\n                                                               skip_threads_40401)];\n                    x_31962 = ((volatile __local\n                                int32_t *) scan_arr_mem_40382)[sext_i32_i64(local_tid_40376 -\n                                                               skip_threads_40401)];\n                    x_31963 = ((volatile __local\n                                int32_t *) scan_arr_mem_40384)[sext_i32_i64(local_tid_40376 -\n                                                               skip_threads_40401)];\n                    x_31964 = ((volatile __local\n                                int32_t *) scan_arr_mem_40386)[sext_i32_i64(local_tid_40376 -\n                                                               skip_threads_40401)];\n                }\n                // perform operation\n                {\n                    int32_t res_31969 = add32(x_31961, x_31965);\n                    int32_t res_31970 = add32(x_31962, x_31966);\n                    int32_t res_31971 = add32(x_",
            "31963, x_31967);\n                    int32_t res_31972 = add32(x_31964, x_31968);\n                    \n                    x_31961 = res_31969;\n                    x_31962 = res_31970;\n                    x_31963 = res_31971;\n                    x_31964 = res_31972;\n                }\n            }\n            if (sle32(wave_sizze_40378, skip_threads_40401)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            if (sle32(skip_threads_40401, local_tid_40376 -\n                      squot32(local_tid_40376, 32) * 32) &&\n                slt32(local_tid_40376, stage1_num_groups_40329)) {\n                // write result\n                {\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40380)[sext_i32_i64(local_tid_40376)] =\n                        x_31961;\n                    x_31965 = x_31961;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40382)[sext_i32_i64(local_tid_40376)] =\n                        x_31962;\n                    x_31966 = x_31962;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40384)[sext_i32_i64(local_tid_40376)] =\n                        x_31963;\n                    x_31967 = x_31963;\n                    ((volatile __local\n                      int32_t *) scan_arr_mem_40386)[sext_i32_i64(local_tid_40376)] =\n                        x_31964;\n                    x_31968 = x_31964;\n                }\n            }\n            if (sle32(wave_sizze_40378, skip_threads_40401)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n            skip_threads_40401 *= 2;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // last thread of block 'i' writes its result to offset 'i'\n    {\n        if ((local_tid_40376 - squot32(local_tid_40376, 32) * 32) == 31 &&\n            slt32(local_tid_40376, stage1_num_groups_40329)) {\n            ((volatile __local\n              int32_t *) scan_arr_mem_40380)[sext_i32_i64(squot32(local_",
            "tid_40376,\n                                                                  32))] =\n                x_31961;\n            ((volatile __local\n              int32_t *) scan_arr_mem_40382)[sext_i32_i64(squot32(local_tid_40376,\n                                                                  32))] =\n                x_31962;\n            ((volatile __local\n              int32_t *) scan_arr_mem_40384)[sext_i32_i64(squot32(local_tid_40376,\n                                                                  32))] =\n                x_31963;\n            ((volatile __local\n              int32_t *) scan_arr_mem_40386)[sext_i32_i64(squot32(local_tid_40376,\n                                                                  32))] =\n                x_31964;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n    {\n        int32_t skip_threads_40402;\n        \n        // read input for in-block scan\n        {\n            if (squot32(local_tid_40376, 32) == 0 && slt32(local_tid_40376,\n                                                           stage1_num_groups_40329)) {\n                x_40393 = ((volatile __local\n                            int32_t *) scan_arr_mem_40380)[sext_i32_i64(local_tid_40376)];\n                x_40394 = ((volatile __local\n                            int32_t *) scan_arr_mem_40382)[sext_i32_i64(local_tid_40376)];\n                x_40395 = ((volatile __local\n                            int32_t *) scan_arr_mem_40384)[sext_i32_i64(local_tid_40376)];\n                x_40396 = ((volatile __local\n                            int32_t *) scan_arr_mem_40386)[sext_i32_i64(local_tid_40376)];\n                if ((local_tid_40376 - squot32(local_tid_40376, 32) * 32) ==\n                    0) {\n                    x_40389 = x_40393;\n                    x_40390 = x_40394;\n                    x_40391 = x_40395;\n                    x_40392 = x_40396;\n                }\n            }\n        }\n       ",
            " // in-block scan (hopefully no barriers needed)\n        {\n            skip_threads_40402 = 1;\n            while (slt32(skip_threads_40402, 32)) {\n                if (sle32(skip_threads_40402, local_tid_40376 -\n                          squot32(local_tid_40376, 32) * 32) &&\n                    (squot32(local_tid_40376, 32) == 0 && slt32(local_tid_40376,\n                                                                stage1_num_groups_40329))) {\n                    // read operands\n                    {\n                        x_40389 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40380)[sext_i32_i64(local_tid_40376 -\n                                                                   skip_threads_40402)];\n                        x_40390 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40382)[sext_i32_i64(local_tid_40376 -\n                                                                   skip_threads_40402)];\n                        x_40391 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40384)[sext_i32_i64(local_tid_40376 -\n                                                                   skip_threads_40402)];\n                        x_40392 = ((volatile __local\n                                    int32_t *) scan_arr_mem_40386)[sext_i32_i64(local_tid_40376 -\n                                                                   skip_threads_40402)];\n                    }\n                    // perform operation\n                    {\n                        int32_t res_40397 = add32(x_40389, x_40393);\n                        int32_t res_40398 = add32(x_40390, x_40394);\n                        int32_t res_40399 = add32(x_40391, x_40395);\n                        int32_t res_40400 = add32(x_40392, x_40396);\n                        \n                        x_40389 = res_40397;\n                        x_40390 = res_40398;\n                        x_40391 = res_40399;\n           ",
            "             x_40392 = res_40400;\n                    }\n                }\n                if (sle32(wave_sizze_40378, skip_threads_40402)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                if (sle32(skip_threads_40402, local_tid_40376 -\n                          squot32(local_tid_40376, 32) * 32) &&\n                    (squot32(local_tid_40376, 32) == 0 && slt32(local_tid_40376,\n                                                                stage1_num_groups_40329))) {\n                    // write result\n                    {\n                        ((volatile __local\n                          int32_t *) scan_arr_mem_40380)[sext_i32_i64(local_tid_40376)] =\n                            x_40389;\n                        x_40393 = x_40389;\n                        ((volatile __local\n                          int32_t *) scan_arr_mem_40382)[sext_i32_i64(local_tid_40376)] =\n                            x_40390;\n                        x_40394 = x_40390;\n                        ((volatile __local\n                          int32_t *) scan_arr_mem_40384)[sext_i32_i64(local_tid_40376)] =\n                            x_40391;\n                        x_40395 = x_40391;\n                        ((volatile __local\n                          int32_t *) scan_arr_mem_40386)[sext_i32_i64(local_tid_40376)] =\n                            x_40392;\n                        x_40396 = x_40392;\n                    }\n                }\n                if (sle32(wave_sizze_40378, skip_threads_40402)) {\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                }\n                skip_threads_40402 *= 2;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // carry-in for every block except the first\n    {\n        if (!(squot32(local_tid_40376, 32) == 0 || !slt32(local_tid_40376,\n                                                          stage1_num_groups_40329))) {\n            // read operands\n            {\n                x_31965 = x_31961;\n    ",
            "            x_31966 = x_31962;\n                x_31967 = x_31963;\n                x_31968 = x_31964;\n                x_31961 = ((__local\n                            int32_t *) scan_arr_mem_40380)[sext_i32_i64(squot32(local_tid_40376,\n                                                                                32) -\n                                                           1)];\n                x_31962 = ((__local\n                            int32_t *) scan_arr_mem_40382)[sext_i32_i64(squot32(local_tid_40376,\n                                                                                32) -\n                                                           1)];\n                x_31963 = ((__local\n                            int32_t *) scan_arr_mem_40384)[sext_i32_i64(squot32(local_tid_40376,\n                                                                                32) -\n                                                           1)];\n                x_31964 = ((__local\n                            int32_t *) scan_arr_mem_40386)[sext_i32_i64(squot32(local_tid_40376,\n                                                                                32) -\n                                                           1)];\n            }\n            // perform operation\n            {\n                int32_t res_31969 = add32(x_31961, x_31965);\n                int32_t res_31970 = add32(x_31962, x_31966);\n                int32_t res_31971 = add32(x_31963, x_31967);\n                int32_t res_31972 = add32(x_31964, x_31968);\n                \n                x_31961 = res_31969;\n                x_31962 = res_31970;\n                x_31963 = res_31971;\n                x_31964 = res_31972;\n            }\n            // write final result\n            {\n                ((__local\n                  int32_t *) scan_arr_mem_40380)[sext_i32_i64(local_tid_40376)] =\n                    x_31961;\n                ((__local\n                  int32_t *) scan_arr_mem_40382)[sext_i32_i64(local_tid_",
            "40376)] =\n                    x_31962;\n                ((__local\n                  int32_t *) scan_arr_mem_40384)[sext_i32_i64(local_tid_40376)] =\n                    x_31963;\n                ((__local\n                  int32_t *) scan_arr_mem_40386)[sext_i32_i64(local_tid_40376)] =\n                    x_31964;\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // restore correct values for first block\n    {\n        if (squot32(local_tid_40376, 32) == 0) {\n            ((__local\n              int32_t *) scan_arr_mem_40380)[sext_i32_i64(local_tid_40376)] =\n                x_31965;\n            ((__local\n              int32_t *) scan_arr_mem_40382)[sext_i32_i64(local_tid_40376)] =\n                x_31966;\n            ((__local\n              int32_t *) scan_arr_mem_40384)[sext_i32_i64(local_tid_40376)] =\n                x_31967;\n            ((__local\n              int32_t *) scan_arr_mem_40386)[sext_i32_i64(local_tid_40376)] =\n                x_31968;\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // threads in bounds write scanned carries\n    {\n        if (slt32(gtid_35796, n_31866)) {\n            ((__global int32_t *) mem_39451)[sext_i32_i64(gtid_35796)] =\n                ((__local\n                  int32_t *) scan_arr_mem_40380)[sext_i32_i64(local_tid_40376)];\n            ((__global int32_t *) mem_39454)[sext_i32_i64(gtid_35796)] =\n                ((__local\n                  int32_t *) scan_arr_mem_40382)[sext_i32_i64(local_tid_40376)];\n            ((__global int32_t *) mem_39457)[sext_i32_i64(gtid_35796)] =\n                ((__local\n                  int32_t *) scan_arr_mem_40384)[sext_i32_i64(local_tid_40376)];\n            ((__global int32_t *) mem_39460)[sext_i32_i64(gtid_35796)] =\n                ((__local\n                  int32_t *) scan_arr_mem_40386)[sext_i32_i64(local_tid_40376)];\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_35792\n}\n__kernel void findNaturalLeavesFixKziscan_stage3_35797(__global\n          ",
            "                                             int *global_failure,\n                                                       int32_t n_31866,\n                                                       int32_t num_groups_35794,\n                                                       __global\n                                                       unsigned char *mem_39451,\n                                                       __global\n                                                       unsigned char *mem_39454,\n                                                       __global\n                                                       unsigned char *mem_39457,\n                                                       __global\n                                                       unsigned char *mem_39460,\n                                                       int32_t num_threads_40330,\n                                                       int32_t required_groups_40403)\n{\n    #define segscan_group_sizze_35792 (findNaturalLeavesFixKzisegscan_group_sizze_35791)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40404;\n    int32_t local_tid_40405;\n    int32_t group_sizze_40408;\n    int32_t wave_sizze_40407;\n    int32_t group_tid_40406;\n    \n    global_tid_40404 = get_global_id(0);\n    local_tid_40405 = get_local_id(0);\n    group_sizze_40408 = get_local_size(0);\n    wave_sizze_40407 = LOCKSTEP_WIDTH;\n    group_tid_40406 = get_group_id(0);\n    \n    int32_t phys_tid_35797;\n    \n    phys_tid_35797 = global_tid_40404;\n    \n    int32_t phys_group_id_40409;\n    \n    phys_group_id_40409 = get_group_id(0);\n    for (int32_t i_40410 = 0; i_40410 < sdiv_up32(required_groups_40403 -\n                                                  phys_group_id_40409,\n                                                  num_groups_35794);\n         i_40410++) {\n        int32_t virt_group_id_40411 =",
            " phys_group_id_40409 + i_40410 *\n                num_groups_35794;\n        int32_t flat_idx_40412 = virt_group_id_40411 *\n                segscan_group_sizze_35792 + local_tid_40405;\n        int32_t gtid_35796 = flat_idx_40412;\n        int32_t orig_group_40413 = squot32(flat_idx_40412,\n                                           segscan_group_sizze_35792 *\n                                           sdiv_up32(n_31866,\n                                                     num_threads_40330));\n        int32_t carry_in_flat_idx_40414 = orig_group_40413 *\n                (segscan_group_sizze_35792 * sdiv_up32(n_31866,\n                                                       num_threads_40330)) - 1;\n        \n        if (slt32(gtid_35796, n_31866)) {\n            if (!(orig_group_40413 == 0 || flat_idx_40412 == (orig_group_40413 +\n                                                              1) *\n                  (segscan_group_sizze_35792 * sdiv_up32(n_31866,\n                                                         num_threads_40330)) -\n                  1)) {\n                int32_t x_31961;\n                int32_t x_31962;\n                int32_t x_31963;\n                int32_t x_31964;\n                int32_t x_31965;\n                int32_t x_31966;\n                int32_t x_31967;\n                int32_t x_31968;\n                \n                x_31961 = ((__global\n                            int32_t *) mem_39451)[sext_i32_i64(carry_in_flat_idx_40414)];\n                x_31962 = ((__global\n                            int32_t *) mem_39454)[sext_i32_i64(carry_in_flat_idx_40414)];\n                x_31963 = ((__global\n                            int32_t *) mem_39457)[sext_i32_i64(carry_in_flat_idx_40414)];\n                x_31964 = ((__global\n                            int32_t *) mem_39460)[sext_i32_i64(carry_in_flat_idx_40414)];\n                x_31965 = ((__global\n                            int32_t *) mem_39451)[sext_i32_i64(gtid_35796)];\n                x_31966 = ((__",
            "global\n                            int32_t *) mem_39454)[sext_i32_i64(gtid_35796)];\n                x_31967 = ((__global\n                            int32_t *) mem_39457)[sext_i32_i64(gtid_35796)];\n                x_31968 = ((__global\n                            int32_t *) mem_39460)[sext_i32_i64(gtid_35796)];\n                \n                int32_t res_31969;\n                \n                res_31969 = add32(x_31961, x_31965);\n                \n                int32_t res_31970 = add32(x_31962, x_31966);\n                int32_t res_31971 = add32(x_31963, x_31967);\n                int32_t res_31972 = add32(x_31964, x_31968);\n                \n                x_31961 = res_31969;\n                x_31962 = res_31970;\n                x_31963 = res_31971;\n                x_31964 = res_31972;\n                ((__global int32_t *) mem_39451)[sext_i32_i64(gtid_35796)] =\n                    x_31961;\n                ((__global int32_t *) mem_39454)[sext_i32_i64(gtid_35796)] =\n                    x_31962;\n                ((__global int32_t *) mem_39457)[sext_i32_i64(gtid_35796)] =\n                    x_31963;\n                ((__global int32_t *) mem_39460)[sext_i32_i64(gtid_35796)] =\n                    x_31964;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segscan_group_sizze_35792\n}\n__kernel void findNaturalLeavesFixKzisegmap_35722(__global int *global_failure,\n                                                  int failure_is_an_option,\n                                                  __global\n                                                  int *global_failure_args,\n                                                  int32_t d_31863,\n                                                  int32_t q_31864,\n                                                  int32_t n_31866,\n                                                  int32_t y_31897,\n                                                  unsigned c",
            "har loop_cond_31899,\n                                                  __global\n                                                  unsigned char *median_dims_mem_39419,\n                                                  __global\n                                                  unsigned char *median_vals_mem_39420,\n                                                  __global\n                                                  unsigned char *mem_39426,\n                                                  __global\n                                                  unsigned char *mem_39430)\n{\n    #define segmap_group_sizze_35758 (findNaturalLeavesFixKzisegmap_group_sizze_35725)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40306;\n    int32_t local_tid_40307;\n    int32_t group_sizze_40310;\n    int32_t wave_sizze_40309;\n    int32_t group_tid_40308;\n    \n    global_tid_40306 = get_global_id(0);\n    local_tid_40307 = get_local_id(0);\n    group_sizze_40310 = get_local_size(0);\n    wave_sizze_40309 = LOCKSTEP_WIDTH;\n    group_tid_40308 = get_group_id(0);\n    \n    int32_t phys_tid_35722;\n    \n    phys_tid_35722 = global_tid_40306;\n    \n    int32_t gtid_35721;\n    \n    gtid_35721 = sext_i64_i32(sext_i32_i64(group_tid_40308) *\n        sext_i32_i64(segmap_group_sizze_35758) + sext_i32_i64(local_tid_40307));\n    if (slt32(gtid_35721, n_31866)) {\n        bool leaf_35764;\n        int32_t leaf_35765;\n        bool loop_while_35766;\n        int32_t node_index_35767;\n        \n        loop_while_35766 = loop_cond_31899;\n        node_index_35767 = 0;\n        while (loop_while_35766) {\n            bool x_35768 = sle32(0, node_index_35767);\n            bool y_35769 = slt32(node_index_35767, q_31864);\n            bool bounds_check_35770 = x_35768 && y_35769;\n            bool index_certs_35771;\n            \n            if (!bounds_check_35770) {\n                {\n            ",
            "        if (atomic_cmpxchg_i32_global(global_failure, -1, 47) ==\n                        -1) {\n                        global_failure_args[0] = node_index_35767;\n                        global_failure_args[1] = q_31864;\n                        ;\n                    }\n                    return;\n                }\n            }\n            \n            int32_t i_35772 = ((__global\n                                int32_t *) median_dims_mem_39419)[sext_i32_i64(node_index_35767)];\n            bool x_35773 = sle32(0, i_35772);\n            bool y_35774 = slt32(i_35772, d_31863);\n            bool bounds_check_35775 = x_35773 && y_35774;\n            bool index_certs_35776;\n            \n            if (!bounds_check_35775) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 48) ==\n                        -1) {\n                        global_failure_args[0] = i_35772;\n                        global_failure_args[1] = d_31863;\n                        ;\n                    }\n                    return;\n                }\n            }\n            \n            float x_35777 = ((__global\n                              float *) mem_39426)[sext_i32_i64(i_35772) *\n                                                  sext_i32_i64(n_31866) +\n                                                  sext_i32_i64(gtid_35721)];\n            float y_35778 = ((__global\n                              float *) median_vals_mem_39420)[sext_i32_i64(node_index_35767)];\n            bool cond_35779 = x_35777 <= y_35778;\n            int32_t loopres_35780;\n            \n            if (cond_35779) {\n                int32_t x_35781 = add32(1, node_index_35767);\n                int32_t x_35782 = mul32(2, x_35781);\n                int32_t res_35783 = sub32(x_35782, 1);\n                \n                loopres_35780 = res_35783;\n            } else {\n                int32_t x_35784 = add32(1, node_index_35767);\n                int32_t res_35785 = mul32(2, x_35784);\n                \n  ",
            "              loopres_35780 = res_35785;\n            }\n            \n            bool res_35786 = sle32(y_31897, loopres_35780);\n            bool loop_cond_35787 = !res_35786;\n            bool loop_while_tmp_40311 = loop_cond_35787;\n            int32_t node_index_tmp_40312 = loopres_35780;\n            \n            loop_while_35766 = loop_while_tmp_40311;\n            node_index_35767 = node_index_tmp_40312;\n        }\n        leaf_35764 = loop_while_35766;\n        leaf_35765 = node_index_35767;\n        \n        int32_t res_35788 = sub32(leaf_35765, q_31864);\n        \n        ((__global int32_t *) mem_39430)[sext_i32_i64(gtid_35721)] = res_35788;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_35758\n}\n__kernel void findNaturalLeavesFixKzisegmap_35799(__global int *global_failure,\n                                                  int32_t n_31866,\n                                                  int32_t res_31998,\n                                                  int32_t res_31999,\n                                                  int32_t res_32000, __global\n                                                  unsigned char *mem_param_39438,\n                                                  __global\n                                                  unsigned char *mem_param_39443,\n                                                  __global\n                                                  unsigned char *mem_39451,\n                                                  __global\n                                                  unsigned char *mem_39454,\n                                                  __global\n                                                  unsigned char *mem_39457,\n                                                  __global\n                                                  unsigned char *mem_39460,\n                                                  __global\n                                                  unsigned char *mem_39463,\n                ",
            "                                  __global\n                                                  unsigned char *mem_39466,\n                                                  __global\n                                                  unsigned char *mem_39469)\n{\n    #define segmap_group_sizze_35803 (findNaturalLeavesFixKzisegmap_group_sizze_35802)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40415;\n    int32_t local_tid_40416;\n    int32_t group_sizze_40419;\n    int32_t wave_sizze_40418;\n    int32_t group_tid_40417;\n    \n    global_tid_40415 = get_global_id(0);\n    local_tid_40416 = get_local_id(0);\n    group_sizze_40419 = get_local_size(0);\n    wave_sizze_40418 = LOCKSTEP_WIDTH;\n    group_tid_40417 = get_group_id(0);\n    \n    int32_t phys_tid_35799;\n    \n    phys_tid_35799 = global_tid_40415;\n    \n    int32_t write_i_35798;\n    \n    write_i_35798 = sext_i64_i32(sext_i32_i64(group_tid_40417) *\n        sext_i32_i64(segmap_group_sizze_35803) + sext_i32_i64(local_tid_40416));\n    if (slt32(write_i_35798, n_31866)) {\n        int32_t x_32005 = ((__global\n                            int32_t *) mem_39463)[sext_i32_i64(write_i_35798)];\n        int32_t write_value_32010 = ((__global\n                                      int32_t *) mem_param_39438)[sext_i32_i64(write_i_35798)];\n        int32_t write_value_32011 = ((__global\n                                      int32_t *) mem_param_39443)[sext_i32_i64(write_i_35798)];\n        bool match_lit_32012 = 0 == x_32005;\n        int32_t res_32013;\n        \n        if (match_lit_32012) {\n            int32_t x_32006 = ((__global\n                                int32_t *) mem_39451)[sext_i32_i64(write_i_35798)];\n            int32_t res_32014 = sub32(x_32006, 1);\n            \n            res_32013 = res_32014;\n        } else {\n            int32_t x_32007 = ((__global\n                                int32_t *) mem_39454)",
            "[sext_i32_i64(write_i_35798)];\n            int32_t x_32008 = ((__global\n                                int32_t *) mem_39457)[sext_i32_i64(write_i_35798)];\n            int32_t x_32009 = ((__global\n                                int32_t *) mem_39460)[sext_i32_i64(write_i_35798)];\n            bool match_lit_32015 = 1 == x_32005;\n            int32_t x_32016;\n            \n            if (match_lit_32015) {\n                int32_t x_32017 = add32(res_31998, x_32007);\n                int32_t res_32018 = sub32(x_32017, 1);\n                \n                x_32016 = res_32018;\n            } else {\n                bool match_lit_32019 = 2 == x_32005;\n                int32_t x_32020;\n                \n                if (match_lit_32019) {\n                    int32_t x_32021 = add32(res_31998, res_31999);\n                    int32_t x_32022 = add32(x_32008, x_32021);\n                    int32_t res_32023 = sub32(x_32022, 1);\n                    \n                    x_32020 = res_32023;\n                } else {\n                    int32_t x_32024 = add32(res_31998, res_31999);\n                    int32_t x_32025 = add32(res_32000, x_32024);\n                    int32_t x_32026 = add32(x_32009, x_32025);\n                    int32_t res_32027 = sub32(x_32026, 1);\n                    \n                    x_32020 = res_32027;\n                }\n                x_32016 = x_32020;\n            }\n            res_32013 = x_32016;\n        }\n        if (sle32(0, res_32013) && slt32(res_32013, n_31866)) {\n            ((__global int32_t *) mem_39466)[sext_i32_i64(res_32013)] =\n                write_value_32010;\n        }\n        if (sle32(0, res_32013) && slt32(res_32013, n_31866)) {\n            ((__global int32_t *) mem_39469)[sext_i32_i64(res_32013)] =\n                write_value_32011;\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_35803\n}\n__kernel void findNaturalLeavesFixKzisegmap_36062(__global int *global_failure,\n                                            ",
            "      int failure_is_an_option,\n                                                  __global\n                                                  int *global_failure_args,\n                                                  int32_t d_31863,\n                                                  int32_t n_31866,\n                                                  int32_t num_leaves_31877,\n                                                  int32_t ppl_31891,\n                                                  int32_t num_groups_36252,\n                                                  __global\n                                                  unsigned char *mem_39486,\n                                                  __global\n                                                  unsigned char *mem_39488,\n                                                  __global\n                                                  unsigned char *mem_39496,\n                                                  __global\n                                                  unsigned char *mem_39510,\n                                                  __global\n                                                  unsigned char *mem_39517,\n                                                  __global\n                                                  unsigned char *mem_39584,\n                                                  __global\n                                                  unsigned char *mem_39588)\n{\n    #define segmap_group_sizze_36251 (findNaturalLeavesFixKzisegmap_group_sizze_36065)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40449;\n    int32_t local_tid_40450;\n    int32_t group_sizze_40453;\n    int32_t wave_",
            "sizze_40452;\n    int32_t group_tid_40451;\n    \n    global_tid_40449 = get_global_id(0);\n    local_tid_40450 = get_local_id(0);\n    group_sizze_40453 = get_local_size(0);\n    wave_sizze_40452 = LOCKSTEP_WIDTH;\n    group_tid_40451 = get_group_id(0);\n    \n    int32_t phys_tid_36062;\n    \n    phys_tid_36062 = global_tid_40449;\n    \n    int32_t phys_group_id_40454;\n    \n    phys_group_id_40454 = get_group_id(0);\n    for (int32_t i_40455 = 0; i_40455 < sdiv_up32(sdiv_up32(n_31866,\n                                                            segmap_group_sizze_36251) -\n                                                  phys_group_id_40454,\n                                                  num_groups_36252);\n         i_40455++) {\n        int32_t virt_group_id_40456 = phys_group_id_40454 + i_40455 *\n                num_groups_36252;\n        int32_t gtid_36061 = sext_i64_i32(sext_i32_i64(virt_group_id_40456) *\n                sext_i32_i64(segmap_group_sizze_36251) +\n                sext_i32_i64(local_tid_40450));\n        \n        if (slt32(gtid_36061, n_31866)) {\n            int32_t res_36256 = ((__global\n                                  int32_t *) mem_39496)[sext_i32_i64(gtid_36061)];\n            int32_t bruteForce_arg_36258 = mul32(ppl_31891, res_36256);\n            bool x_36259 = sle32(0, res_36256);\n            bool y_36260 = slt32(res_36256, num_leaves_31877);\n            bool bounds_check_36261 = x_36259 && y_36260;\n            bool index_certs_36262;\n            \n            if (!bounds_check_36261) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 51) ==\n                        -1) {\n                        global_failure_args[0] = res_36256;\n                        global_failure_args[1] = num_leaves_31877;\n                        ;\n                    }\n                    local_failure = true;\n                    goto error_0;\n                }\n            }\n            \n            int32_t double_buffer_mem_40098[8];\n        ",
            "    float double_buffer_mem_40099[8];\n            \n            for (int32_t i_40457 = 0; i_40457 < 8; i_40457++) {\n                double_buffer_mem_40098[sext_i32_i64(i_40457)] = ((__global\n                                                                   int32_t *) mem_39486)[sext_i32_i64(i_40457)];\n            }\n            for (int32_t i_40458 = 0; i_40458 < 8; i_40458++) {\n                double_buffer_mem_40099[sext_i32_i64(i_40458)] = ((__global\n                                                                   float *) mem_39488)[sext_i32_i64(i_40458)];\n            }\n            \n            float mem_40084[8];\n            int32_t mem_40087[8];\n            \n            for (int32_t i_36267 = 0; i_36267 < ppl_31891; i_36267++) {\n                float res_36271;\n                float res_36273 = 0.0F;\n                float x_36274;\n                float y_36275;\n                \n                for (int32_t i_36272 = 0; i_36272 < d_31863; i_36272++) {\n                    x_36274 = ((__global\n                                float *) mem_39510)[sext_i32_i64(gtid_36061) +\n                                                    sext_i32_i64(i_36272) *\n                                                    sext_i32_i64(n_31866)];\n                    y_36275 = ((__global\n                                float *) mem_39517)[sext_i32_i64(res_36256 *\n                                                    ppl_31891 + i_36267) +\n                                                    sext_i32_i64(i_36272) *\n                                                    sext_i32_i64(ppl_31891 *\n                                                    num_leaves_31877)];\n                    \n                    float zz_36276;\n                    \n                    zz_36276 = x_36274 - y_36275;\n                    \n                    float y_36277 = zz_36276 * zz_36276;\n                    float loopres_36278 = res_36273 + y_36277;\n                    float res_tmp_40461 = loopres_36278;\n           ",
            "         \n                    res_36273 = res_tmp_40461;\n                }\n                res_36271 = res_36273;\n                \n                float y_36279 = double_buffer_mem_40099[7];\n                bool cond_36280 = y_36279 < res_36271;\n                \n                if (cond_36280) {\n                    for (int32_t i_40462 = 0; i_40462 < 8; i_40462++) {\n                        mem_40087[sext_i32_i64(i_40462)] =\n                            double_buffer_mem_40098[sext_i32_i64(i_40462)];\n                    }\n                    for (int32_t i_40463 = 0; i_40463 < 8; i_40463++) {\n                        mem_40084[sext_i32_i64(i_40463)] =\n                            double_buffer_mem_40099[sext_i32_i64(i_40463)];\n                    }\n                } else {\n                    int32_t ref_ind_36283 = add32(bruteForce_arg_36258,\n                                                  i_36267);\n                    float knnszq_36284;\n                    int32_t knnszq_36285;\n                    float dist_36289;\n                    int32_t ref_ind_36290;\n                    \n                    dist_36289 = res_36271;\n                    ref_ind_36290 = ref_ind_36283;\n                    for (int32_t j_36288 = 0; j_36288 < 8; j_36288++) {\n                        float cur_nn_36293 =\n                              double_buffer_mem_40099[sext_i32_i64(j_36288)];\n                        bool cond_36294 = cur_nn_36293 <= dist_36289;\n                        float loopres_36295;\n                        \n                        if (cond_36294) {\n                            loopres_36295 = dist_36289;\n                        } else {\n                            loopres_36295 = cur_nn_36293;\n                        }\n                        \n                        int32_t loopres_36296;\n                        \n                        if (cond_36294) {\n                            loopres_36296 = ref_ind_36290;\n                        } else {\n                            ",
            "int32_t tmp_ind_36299 =\n                                    double_buffer_mem_40098[sext_i32_i64(j_36288)];\n                            \n                            double_buffer_mem_40098[sext_i32_i64(j_36288)] =\n                                ref_ind_36290;\n                            double_buffer_mem_40099[sext_i32_i64(j_36288)] =\n                                dist_36289;\n                            loopres_36296 = tmp_ind_36299;\n                        }\n                        \n                        float dist_tmp_40464 = loopres_36295;\n                        int32_t ref_ind_tmp_40465 = loopres_36296;\n                        \n                        dist_36289 = dist_tmp_40464;\n                        ref_ind_36290 = ref_ind_tmp_40465;\n                    }\n                    knnszq_36284 = dist_36289;\n                    knnszq_36285 = ref_ind_36290;\n                    for (int32_t i_40468 = 0; i_40468 < 8; i_40468++) {\n                        mem_40087[sext_i32_i64(i_40468)] =\n                            double_buffer_mem_40098[sext_i32_i64(i_40468)];\n                    }\n                    for (int32_t i_40469 = 0; i_40469 < 8; i_40469++) {\n                        mem_40084[sext_i32_i64(i_40469)] =\n                            double_buffer_mem_40099[sext_i32_i64(i_40469)];\n                    }\n                }\n                for (int32_t i_40470 = 0; i_40470 < 8; i_40470++) {\n                    double_buffer_mem_40098[sext_i32_i64(i_40470)] =\n                        mem_40087[sext_i32_i64(i_40470)];\n                }\n                for (int32_t i_40471 = 0; i_40471 < 8; i_40471++) {\n                    double_buffer_mem_40099[sext_i32_i64(i_40471)] =\n                        mem_40084[sext_i32_i64(i_40471)];\n                }\n            }\n            for (int32_t i_40472 = 0; i_40472 < 8; i_40472++) {\n                ((__global int32_t *) mem_39584)[sext_i32_i64(i_40472) *\n                                                 sext_i32_i64(n_31866)",
            " +\n                                                 sext_i32_i64(gtid_36061)] =\n                    double_buffer_mem_40098[sext_i32_i64(i_40472)];\n            }\n            for (int32_t i_40473 = 0; i_40473 < 8; i_40473++) {\n                ((__global float *) mem_39588)[sext_i32_i64(i_40473) *\n                                               sext_i32_i64(n_31866) +\n                                               sext_i32_i64(gtid_36061)] =\n                    double_buffer_mem_40099[sext_i32_i64(i_40473)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_36251\n}\n__kernel void findNaturalLeavesFixKzisegmap_36146(__global int *global_failure,\n                                                  int failure_is_an_option,\n                                                  __global\n                                                  int *global_failure_args,\n                                                  int32_t d_31863,\n                                                  int32_t n_31866,\n                                                  int32_t d_31867, __global\n                                                  unsigned char *queries_mem_39421,\n                                                  __global\n                                                  unsigned char *res_mem_39484,\n                                                  __global\n                                                  unsigned char *mem_39491,\n                                                  __global\n                                                  unsigned char *mem_39493,\n                                                  __global\n                                                  unsigned char *mem_39505)\n{\n    #define segmap_group_sizze_36233 (findNaturalLeavesFixKzisegmap_group_sizze_36151)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*globa",
            "l_failure >= 0)\n        return;\n    \n    int32_t global_tid_40443;\n    int32_t local_tid_40444;\n    int32_t group_sizze_40447;\n    int32_t wave_sizze_40446;\n    int32_t group_tid_40445;\n    \n    global_tid_40443 = get_global_id(0);\n    local_tid_40444 = get_local_id(0);\n    group_sizze_40447 = get_local_size(0);\n    wave_sizze_40446 = LOCKSTEP_WIDTH;\n    group_tid_40445 = get_group_id(0);\n    \n    int32_t phys_tid_36146;\n    \n    phys_tid_36146 = global_tid_40443;\n    \n    int32_t gtid_36144;\n    \n    gtid_36144 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40445) *\n                                      sext_i32_i64(segmap_group_sizze_36233) +\n                                      sext_i32_i64(local_tid_40444),\n                                      sext_i32_i64(d_31863)));\n    \n    int32_t gtid_36145;\n    \n    gtid_36145 = sext_i64_i32(sext_i32_i64(group_tid_40445) *\n        sext_i32_i64(segmap_group_sizze_36233) + sext_i32_i64(local_tid_40444) -\n        squot64(sext_i32_i64(group_tid_40445) *\n                sext_i32_i64(segmap_group_sizze_36233) +\n                sext_i32_i64(local_tid_40444), sext_i32_i64(d_31863)) *\n        sext_i32_i64(d_31863));\n    if (slt32(gtid_36144, n_31866) && slt32(gtid_36145, d_31863)) {\n        int32_t x_36238 = ((__global\n                            int32_t *) res_mem_39484)[sext_i32_i64(gtid_36144)];\n        bool bounds_check_36239 = ((__global\n                                    bool *) mem_39491)[sext_i32_i64(gtid_36144)];\n        bool index_certs_36240 = ((__global\n                                   bool *) mem_39493)[sext_i32_i64(gtid_36144)];\n        bool index_certs_36246;\n        \n        if (!bounds_check_36239) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 50) == -1) {\n                    global_failure_args[0] = x_36238;\n                    global_failure_args[1] = gtid_36145;\n                    global_failure_args[2] = n_31866;\n                    global_failure_args[3] = d_31863;\n    ",
            "                ;\n                }\n                return;\n            }\n        }\n        \n        float res_36247 = ((__global\n                            float *) queries_mem_39421)[sext_i32_i64(x_36238) *\n                                                        sext_i32_i64(d_31867) +\n                                                        sext_i32_i64(gtid_36145)];\n        \n        ((__global float *) mem_39505)[sext_i32_i64(gtid_36144) *\n                                       sext_i32_i64(d_31863) +\n                                       sext_i32_i64(gtid_36145)] = res_36247;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_36233\n}\n__kernel void findNaturalLeavesFixKzisegmap_36186(__global int *global_failure,\n                                                  int failure_is_an_option,\n                                                  __global\n                                                  int *global_failure_args,\n                                                  int32_t n_31866, __global\n                                                  unsigned char *mem_39430,\n                                                  __global\n                                                  unsigned char *res_mem_39484,\n                                                  __global\n                                                  unsigned char *mem_39491,\n                                                  __global\n                                                  unsigned char *mem_39493,\n                                                  __global\n                                                  unsigned char *mem_39496,\n                                                  __global\n                                                  unsigned char *mem_39499)\n{\n    #define segmap_group_sizze_36203 (findNaturalLeavesFixKzisegmap_group_sizze_36189)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0",
            ")\n        return;\n    \n    int32_t global_tid_40438;\n    int32_t local_tid_40439;\n    int32_t group_sizze_40442;\n    int32_t wave_sizze_40441;\n    int32_t group_tid_40440;\n    \n    global_tid_40438 = get_global_id(0);\n    local_tid_40439 = get_local_id(0);\n    group_sizze_40442 = get_local_size(0);\n    wave_sizze_40441 = LOCKSTEP_WIDTH;\n    group_tid_40440 = get_group_id(0);\n    \n    int32_t phys_tid_36186;\n    \n    phys_tid_36186 = global_tid_40438;\n    \n    int32_t gtid_36185;\n    \n    gtid_36185 = sext_i64_i32(sext_i32_i64(group_tid_40440) *\n        sext_i32_i64(segmap_group_sizze_36203) + sext_i32_i64(local_tid_40439));\n    if (slt32(gtid_36185, n_31866)) {\n        int32_t x_36211 = ((__global\n                            int32_t *) res_mem_39484)[sext_i32_i64(gtid_36185)];\n        bool x_36212 = sle32(0, x_36211);\n        bool y_36213 = slt32(x_36211, n_31866);\n        bool bounds_check_36214 = x_36212 && y_36213;\n        bool index_certs_36215;\n        \n        if (!bounds_check_36214) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 49) == -1) {\n                    global_failure_args[0] = x_36211;\n                    global_failure_args[1] = n_31866;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        int32_t res_36216 = ((__global\n                              int32_t *) mem_39430)[sext_i32_i64(x_36211)];\n        int32_t x_36217 = x_36211;\n        \n        ((__global bool *) mem_39491)[sext_i32_i64(gtid_36185)] =\n            bounds_check_36214;\n        ((__global bool *) mem_39493)[sext_i32_i64(gtid_36185)] =\n            index_certs_36215;\n        ((__global int32_t *) mem_39496)[sext_i32_i64(gtid_36185)] = res_36216;\n        ((__global int32_t *) mem_39499)[sext_i32_i64(gtid_36185)] = x_36217;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_36203\n}\n__kernel void findNaturalLeavesFixKzisegmap_36303(__global int *global_failure,\n                              ",
            "                    int failure_is_an_option,\n                                                  __global\n                                                  int *global_failure_args,\n                                                  int32_t n_31866,\n                                                  int32_t nk_32108, __global\n                                                  unsigned char *mem_39499,\n                                                  __global\n                                                  unsigned char *mem_39591,\n                                                  __global\n                                                  unsigned char *mem_39594,\n                                                  __global\n                                                  unsigned char *mem_39598,\n                                                  __global\n                                                  unsigned char *mem_39602)\n{\n    #define segmap_group_sizze_36307 (findNaturalLeavesFixKzisegmap_group_sizze_36306)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40474;\n    int32_t local_tid_40475;\n    int32_t group_sizze_40478;\n    int32_t wave_sizze_40477;\n    int32_t group_tid_40476;\n    \n    global_tid_40474 = get_global_id(0);\n    local_tid_40475 = get_local_id(0);\n    group_sizze_40478 = get_local_size(0);\n    wave_sizze_40477 = LOCKSTEP_WIDTH;\n    group_tid_40476 = get_group_id(0);\n    \n    int32_t phys_tid_36303;\n    \n    phys_tid_36303 = global_tid_40474;\n    \n    int32_t write_i_36302;\n    \n    write_i_36302 = sext_i64_i32(sext_i32_i64(group_tid_40476) *\n        sext_i32_i64(segmap_group_sizze_36307) + sext_i32_i64(local_tid_40475));\n    if (slt32(write_i_36302, nk_32108)) {\n        int32_t new_index_39287 = squot32(write_i_36302, 8);\n        int32_t binop_y_39289 = 8 * new_index_39287;\n        int32_t new_index_39290 = write_i_36302 ",
            "- binop_y_39289;\n        int32_t write_value_32120 = ((__global\n                                      int32_t *) mem_39598)[sext_i32_i64(new_index_39287) *\n                                                            8 +\n                                                            sext_i32_i64(new_index_39290)];\n        float write_value_32121 = ((__global\n                                    float *) mem_39602)[sext_i32_i64(new_index_39287) *\n                                                        8 +\n                                                        sext_i32_i64(new_index_39290)];\n        int32_t res_32122 = sdiv32(write_i_36302, 8);\n        int32_t res_32123 = smod32(write_i_36302, 8);\n        bool x_32124 = sle32(0, res_32122);\n        bool y_32125 = slt32(res_32122, n_31866);\n        bool bounds_check_32126 = x_32124 && y_32125;\n        bool index_certs_32127;\n        \n        if (!bounds_check_32126) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 52) == -1) {\n                    global_failure_args[0] = res_32122;\n                    global_failure_args[1] = n_31866;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        int32_t x_32128 = ((__global\n                            int32_t *) mem_39499)[sext_i32_i64(res_32122)];\n        int32_t x_32129 = mul32(8, x_32128);\n        int32_t res_32130 = add32(res_32123, x_32129);\n        \n        if (sle32(0, res_32130) && slt32(res_32130, nk_32108)) {\n            ((__global int32_t *) mem_39591)[sext_i32_i64(res_32130)] =\n                write_value_32120;\n        }\n        if (sle32(0, res_32130) && slt32(res_32130, nk_32108)) {\n            ((__global float *) mem_39594)[sext_i32_i64(res_32130)] =\n                write_value_32121;\n        }\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_36307\n}\n__kernel void gpu_map_transpose_f32(const int block_dim0, const int block_dim1,\n                                    con",
            "st int block_dim2,\n                                    uint block_9_backing_offset_0,\n                                    int32_t destoffset_1, int32_t srcoffset_3,\n                                    int32_t num_arrays_4, int32_t x_elems_5,\n                                    int32_t y_elems_6, int32_t mulx_7,\n                                    int32_t muly_8, __global\n                                    unsigned char *destmem_0, __global\n                                    unsigned char *srcmem_2)\n{\n    volatile char *block_9_backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_global_id_0_37;\n    int32_t y_index_32 = get_group_id_1_41 * 32 + get_local_id_1_39;\n    \n    if (slt32(x_index_31, x_elems_5)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_in_35 = (y_index_32 + j_43 * 8) * x_elems_5 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, y_elems_6)) {\n                ((__local float *) block_9)[sext_i32_i64((get_local_id_1_39 +\n                                                          j_43 * 8) * 33 +\n                                            get_local_id_0_38",
            ")] = ((__global\n                                                                    float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                       index_in_35)];\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 32 + get_local_id_0_38;\n    y_index_32 = get_group_id_0_40 * 32 + get_local_id_1_39;\n    if (slt32(x_index_31, y_elems_6)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_out_36 = (y_index_32 + j_43 * 8) * y_elems_6 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, x_elems_5)) {\n                ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                               index_out_36)] = ((__local\n                                                                  float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                                    33 +\n                                                                                    get_local_id_1_39 +\n                                                                                    j_43 *\n                                                                                    8)];\n            }\n        }\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_low_height(const int block_dim0, const\n                                               int block_dim1, const\n                                               int block_dim2,\n                                               uint block_9_backing_offset_0,\n                                               int32_t destoffset_1,\n                                               int32_t srcoffset_3,\n                                               int32_t num_arrays_4,\n                                               int32_t x_elems_5,\n                                               int3",
            "2_t y_elems_6,\n                                               int32_t mulx_7, int32_t muly_8,\n                                               __global\n                                               unsigned char *destmem_0,\n                                               __global unsigned char *srcmem_2)\n{\n    volatile char *block_9_backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_0_38 +\n            srem32(get_local_id_1_39, mulx_7) * 16;\n    int32_t y_index_32 = get_group_id_1_41 * 16 + squot32(get_local_id_1_39,\n                                                          mulx_7);\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local float *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                    get_local_id_0_38)] = ((__global\n                                                            float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                               index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n",
            "    x_index_31 = get_group_id_1_41 * 16 + squot32(get_local_id_0_38, mulx_7);\n    y_index_32 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_1_39 +\n        srem32(get_local_id_0_38, mulx_7) * 16;\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                       index_out_36)] = ((__local\n                                                          float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                            17 +\n                                                                            get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_low_width(const int block_dim0, const\n                                              int block_dim1, const\n                                              int block_dim2,\n                                              uint block_9_backing_offset_0,\n                                              int32_t destoffset_1,\n                                              int32_t srcoffset_3,\n                                              int32_t num_arrays_4,\n                                              int32_t x_elems_5,\n                                              int32_t y_elems_6, int32_t mulx_7,\n                                              int32_t muly_8, __global\n                                              unsigned char *destmem_0, __global\n                                              unsigned char *srcmem_2)\n{\n    volatile char *block_9_backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t",
            " get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 + squot32(get_local_id_0_38,\n                                                          muly_8);\n    int32_t y_index_32 = get_group_id_1_41 * 16 * muly_8 + get_local_id_1_39 +\n            srem32(get_local_id_0_38, muly_8) * 16;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local float *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                    get_local_id_0_38)] = ((__global\n                                                            float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                               index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 * muly_8 + get_local_id_0_38 +\n        srem32(get_local_id_1_39, muly_8) * 16;\n    y_index_32 = get_group_id_0_40 * 16 + squot32(get_local_id_1_39, muly_8);\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                       index_out_36)] = ((__local\n                                                          float *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                             ",
            "               17 +\n                                                                            get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_f32_small(uint block_9_backing_offset_0,\n                                          int32_t destoffset_1,\n                                          int32_t srcoffset_3,\n                                          int32_t num_arrays_4,\n                                          int32_t x_elems_5, int32_t y_elems_6,\n                                          int32_t mulx_7, int32_t muly_8,\n                                          __global unsigned char *destmem_0,\n                                          __global unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *block_9_backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = squot32(get_global_id_0_37, y_elems_6 *\n                                          x_elems_5) * (y_elems_6 * x_elems_5);\n    int32_t x_index_31 = squot32(srem32(get_global_id_0_37, y_elems_6 *\n                                        x_elems_5), y_elems_6);\n    int32_t y_index_32 = srem32(get_global_id_0_37, y_elems_6);\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t ind",
            "ex_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    int32_t index_out_36 = x_index_31 * y_elems_6 + y_index_32;\n    \n    if (slt32(get_global_id_0_37, x_elems_5 * y_elems_6 * num_arrays_4)) {\n        ((__global float *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                       index_out_36)] = ((__global\n                                                          float *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                             index_in_35)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_i32(const int block_dim0, const int block_dim1,\n                                    const int block_dim2,\n                                    uint block_9_backing_offset_0,\n                                    int32_t destoffset_1, int32_t srcoffset_3,\n                                    int32_t num_arrays_4, int32_t x_elems_5,\n                                    int32_t y_elems_6, int32_t mulx_7,\n                                    int32_t muly_8, __global\n                                    unsigned char *destmem_0, __global\n                                    unsigned char *srcmem_2)\n{\n    volatile char *block_9_backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offs",
            "et_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_global_id_0_37;\n    int32_t y_index_32 = get_group_id_1_41 * 32 + get_local_id_1_39;\n    \n    if (slt32(x_index_31, x_elems_5)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_in_35 = (y_index_32 + j_43 * 8) * x_elems_5 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, y_elems_6)) {\n                ((__local int32_t *) block_9)[sext_i32_i64((get_local_id_1_39 +\n                                                            j_43 * 8) * 33 +\n                                              get_local_id_0_38)] = ((__global\n                                                                      int32_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                           index_in_35)];\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 32 + get_local_id_0_38;\n    y_index_32 = get_group_id_0_40 * 32 + get_local_id_1_39;\n    if (slt32(x_index_31, y_elems_6)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_out_36 = (y_index_32 + j_43 * 8) * y_elems_6 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, x_elems_5)) {\n                ((__global int32_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                                 index_out_36)] = ((__local\n                                                                    int32_t *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                                        33 +\n                                                                                        get_local_id_1_39 +\n                                                                                        j_43 *\n                                       ",
            "                                                 8)];\n            }\n        }\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_i32_low_height(const int block_dim0, const\n                                               int block_dim1, const\n                                               int block_dim2,\n                                               uint block_9_backing_offset_0,\n                                               int32_t destoffset_1,\n                                               int32_t srcoffset_3,\n                                               int32_t num_arrays_4,\n                                               int32_t x_elems_5,\n                                               int32_t y_elems_6,\n                                               int32_t mulx_7, int32_t muly_8,\n                                               __global\n                                               unsigned char *destmem_0,\n                                               __global unsigned char *srcmem_2)\n{\n    volatile char *block_9_backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_0_38 +\n ",
            "           srem32(get_local_id_1_39, mulx_7) * 16;\n    int32_t y_index_32 = get_group_id_1_41 * 16 + squot32(get_local_id_1_39,\n                                                          mulx_7);\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local int32_t *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                      get_local_id_0_38)] = ((__global\n                                                              int32_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                   index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 + squot32(get_local_id_0_38, mulx_7);\n    y_index_32 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_1_39 +\n        srem32(get_local_id_0_38, mulx_7) * 16;\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global int32_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                         index_out_36)] = ((__local\n                                                            int32_t *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                                17 +\n                                                                                get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_i32_low_width(const int block_dim0, const\n                                              int block_dim1, const\n                                              int block_dim2,\n                                              uint block_9_backing_offset_0,\n                                              int32_t destoffset_1,\n                                              int32_t srcoffset_3,\n                                ",
            "              int32_t num_arrays_4,\n                                              int32_t x_elems_5,\n                                              int32_t y_elems_6, int32_t mulx_7,\n                                              int32_t muly_8, __global\n                                              unsigned char *destmem_0, __global\n                                              unsigned char *srcmem_2)\n{\n    volatile char *block_9_backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 + squot32(get_local_id_0_38,\n                                                          muly_8);\n    int32_t y_index_32 = get_group_id_1_41 * 16 * muly_8 + get_local_id_1_39 +\n            srem32(get_local_id_0_38, muly_8) * 16;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local int32_t *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                      get_local_id_0_38)] = ((__global\n                                                              int32_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                         ",
            "                                                          index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 * muly_8 + get_local_id_0_38 +\n        srem32(get_local_id_1_39, muly_8) * 16;\n    y_index_32 = get_group_id_0_40 * 16 + squot32(get_local_id_1_39, muly_8);\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global int32_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                         index_out_36)] = ((__local\n                                                            int32_t *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                                17 +\n                                                                                get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_i32_small(uint block_9_backing_offset_0,\n                                          int32_t destoffset_1,\n                                          int32_t srcoffset_3,\n                                          int32_t num_arrays_4,\n                                          int32_t x_elems_5, int32_t y_elems_6,\n                                          int32_t mulx_7, int32_t muly_8,\n                                          __global unsigned char *destmem_0,\n                                          __global unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *block_9_backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1",
            ");\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = squot32(get_global_id_0_37, y_elems_6 *\n                                          x_elems_5) * (y_elems_6 * x_elems_5);\n    int32_t x_index_31 = squot32(srem32(get_global_id_0_37, y_elems_6 *\n                                        x_elems_5), y_elems_6);\n    int32_t y_index_32 = srem32(get_global_id_0_37, y_elems_6);\n    int32_t odata_offset_33 = squot32(destoffset_1, 4) + our_array_offset_30;\n    int32_t idata_offset_34 = squot32(srcoffset_3, 4) + our_array_offset_30;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    int32_t index_out_36 = x_index_31 * y_elems_6 + y_index_32;\n    \n    if (slt32(get_global_id_0_37, x_elems_5 * y_elems_6 * num_arrays_4)) {\n        ((__global int32_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                         index_out_36)] = ((__global\n                                                            int32_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                 index_in_35)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_i8(const int block_dim0, const int block_dim1,\n                                   const int block_dim2,\n                                   uint block_9_backing_offset_0,\n                                   int32_t destoffset_1, int32_t srcoffset_3,\n                                   int32_t num_arrays_4, int32_t x_elems_5,\n                                   int32_t y_elems_6, int32_t mulx_7,\n                                   int32_t muly_8, __global\n                                   unsigned char *destmem_0, __global\n                                   unsigned char *srcmem_2)\n{\n    volatile char *block_9_",
            "backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = destoffset_1 + our_array_offset_30;\n    int32_t idata_offset_34 = srcoffset_3 + our_array_offset_30;\n    int32_t x_index_31 = get_global_id_0_37;\n    int32_t y_index_32 = get_group_id_1_41 * 32 + get_local_id_1_39;\n    \n    if (slt32(x_index_31, x_elems_5)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_in_35 = (y_index_32 + j_43 * 8) * x_elems_5 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, y_elems_6)) {\n                ((__local int8_t *) block_9)[sext_i32_i64((get_local_id_1_39 +\n                                                           j_43 * 8) * 33 +\n                                             get_local_id_0_38)] = ((__global\n                                                                     int8_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                         index_in_35)];\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 32 + get_local_id_0_38;\n    y_index_32 = get_group_id_0_40 * 32 + get_local_id_1_39;\n    if (slt32(x_index_31, y_elems_6)) {\n        for (int32_t j_43 = 0; j_43 < 4; j_43++) {\n            int32_t index_out_36 = (y_i",
            "ndex_32 + j_43 * 8) * y_elems_6 +\n                    x_index_31;\n            \n            if (slt32(y_index_32 + j_43 * 8, x_elems_5)) {\n                ((__global int8_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                                index_out_36)] = ((__local\n                                                                   int8_t *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                                      33 +\n                                                                                      get_local_id_1_39 +\n                                                                                      j_43 *\n                                                                                      8)];\n            }\n        }\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_i8_low_height(const int block_dim0, const\n                                              int block_dim1, const\n                                              int block_dim2,\n                                              uint block_9_backing_offset_0,\n                                              int32_t destoffset_1,\n                                              int32_t srcoffset_3,\n                                              int32_t num_arrays_4,\n                                              int32_t x_elems_5,\n                                              int32_t y_elems_6, int32_t mulx_7,\n                                              int32_t muly_8, __global\n                                              unsigned char *destmem_0, __global\n                                              unsigned char *srcmem_2)\n{\n    volatile char *block_9_backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get",
            "_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = destoffset_1 + our_array_offset_30;\n    int32_t idata_offset_34 = srcoffset_3 + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_0_38 +\n            srem32(get_local_id_1_39, mulx_7) * 16;\n    int32_t y_index_32 = get_group_id_1_41 * 16 + squot32(get_local_id_1_39,\n                                                          mulx_7);\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local int8_t *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                     get_local_id_0_38)] = ((__global\n                                                             int8_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                 index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 + squot32(get_local_id_0_38, mulx_7);\n    y_index_32 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_1_39 +\n        srem32(get_local_id_0_38, mulx_7) * 16;\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global int8_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                        index_out_36)] = ((__local\n                                                           int8_t *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                         ",
            "                                                     17 +\n                                                                              get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_i8_low_width(const int block_dim0, const\n                                             int block_dim1, const\n                                             int block_dim2,\n                                             uint block_9_backing_offset_0,\n                                             int32_t destoffset_1,\n                                             int32_t srcoffset_3,\n                                             int32_t num_arrays_4,\n                                             int32_t x_elems_5,\n                                             int32_t y_elems_6, int32_t mulx_7,\n                                             int32_t muly_8, __global\n                                             unsigned char *destmem_0, __global\n                                             unsigned char *srcmem_2)\n{\n    volatile char *block_9_backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;\n    int32_t odata_offset_33 = destoffset_1 + our_array_offset_30;\n    int32_t idata_offset_34 = srcoffset_3 + our_array_offset_30;\n    int32_t x_index_31 = get_group_id_0_40 * 16 + squot32(get_local_id_0_38,\n                   ",
            "                                       muly_8);\n    int32_t y_index_32 = get_group_id_1_41 * 16 * muly_8 + get_local_id_1_39 +\n            srem32(get_local_id_0_38, muly_8) * 16;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    \n    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {\n        ((__local int8_t *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +\n                                     get_local_id_0_38)] = ((__global\n                                                             int8_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                                 index_in_35)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    x_index_31 = get_group_id_1_41 * 16 * muly_8 + get_local_id_0_38 +\n        srem32(get_local_id_1_39, muly_8) * 16;\n    y_index_32 = get_group_id_0_40 * 16 + squot32(get_local_id_1_39, muly_8);\n    \n    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;\n    \n    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {\n        ((__global int8_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                        index_out_36)] = ((__local\n                                                           int8_t *) block_9)[sext_i32_i64(get_local_id_0_38 *\n                                                                              17 +\n                                                                              get_local_id_1_39)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void gpu_map_transpose_i8_small(uint block_9_backing_offset_0,\n                                         int32_t destoffset_1,\n                                         int32_t srcoffset_3,\n                                         int32_t num_arrays_4,\n                                         int32_t x_elems_5, int32_t y_elems_6,\n                                         int32_t mulx_7, int32_t muly_8,\n                                         __global unsigned char *d",
            "estmem_0,\n                                         __global unsigned char *srcmem_2)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *block_9_backing_0 = &shared_mem[block_9_backing_offset_0];\n    __local char *block_9;\n    \n    block_9 = (__local char *) block_9_backing_0;\n    \n    int32_t get_global_id_0_37;\n    \n    get_global_id_0_37 = get_global_id(0);\n    \n    int32_t get_local_id_0_38;\n    \n    get_local_id_0_38 = get_local_id(0);\n    \n    int32_t get_local_id_1_39;\n    \n    get_local_id_1_39 = get_local_id(1);\n    \n    int32_t get_group_id_0_40;\n    \n    get_group_id_0_40 = get_group_id(0);\n    \n    int32_t get_group_id_1_41;\n    \n    get_group_id_1_41 = get_group_id(1);\n    \n    int32_t get_group_id_2_42;\n    \n    get_group_id_2_42 = get_group_id(2);\n    \n    int32_t our_array_offset_30 = squot32(get_global_id_0_37, y_elems_6 *\n                                          x_elems_5) * (y_elems_6 * x_elems_5);\n    int32_t x_index_31 = squot32(srem32(get_global_id_0_37, y_elems_6 *\n                                        x_elems_5), y_elems_6);\n    int32_t y_index_32 = srem32(get_global_id_0_37, y_elems_6);\n    int32_t odata_offset_33 = destoffset_1 + our_array_offset_30;\n    int32_t idata_offset_34 = srcoffset_3 + our_array_offset_30;\n    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;\n    int32_t index_out_36 = x_index_31 * y_elems_6 + y_index_32;\n    \n    if (slt32(get_global_id_0_37, x_elems_5 * y_elems_6 * num_arrays_4)) {\n        ((__global int8_t *) destmem_0)[sext_i32_i64(odata_offset_33 +\n                                        index_out_36)] = ((__global\n                                                           int8_t *) srcmem_2)[sext_i32_i64(idata_offset_34 +\n                                                                               index_in_35)];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void mkImgPatcheszisegmap_38762(__global int *global_failure,\n                     ",
            "                    int failure_is_an_option, __global\n                                         int *global_failure_args,\n                                         int32_t h_32683, int32_t w_32684,\n                                         int32_t c_32685, int32_t p_32686,\n                                         int32_t n_cols_32689,\n                                         int32_t n_rows_32691, __global\n                                         unsigned char *img_mem_39418, __global\n                                         unsigned char *mem_39429)\n{\n    #define segmap_group_sizze_39262 (mkImgPatcheszisegmap_group_sizze_38773)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40298;\n    int32_t local_tid_40299;\n    int32_t group_sizze_40302;\n    int32_t wave_sizze_40301;\n    int32_t group_tid_40300;\n    \n    global_tid_40298 = get_global_id(0);\n    local_tid_40299 = get_local_id(0);\n    group_sizze_40302 = get_local_size(0);\n    wave_sizze_40301 = LOCKSTEP_WIDTH;\n    group_tid_40300 = get_group_id(0);\n    \n    int32_t phys_tid_38762;\n    \n    phys_tid_38762 = global_tid_40298;\n    \n    int32_t gtid_38757;\n    \n    gtid_38757 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40300) *\n                                      sext_i32_i64(segmap_group_sizze_39262) +\n                                      sext_i32_i64(local_tid_40299),\n                                      sext_i32_i64(n_cols_32689) *\n                                      sext_i32_i64(p_32686) *\n                                      sext_i32_i64(p_32686) *\n                                      sext_i32_i64(c_32685)));\n    \n    int32_t gtid_38758;\n    \n    gtid_38758 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40300) *\n                                      sext_i32_i64(segmap_group_sizze_39262) +\n                                      sext_i32_i64(local_tid_40299) -\n                        ",
            "              squot64(sext_i32_i64(group_tid_40300) *\n                                              sext_i32_i64(segmap_group_sizze_39262) +\n                                              sext_i32_i64(local_tid_40299),\n                                              sext_i32_i64(n_cols_32689) *\n                                              sext_i32_i64(p_32686) *\n                                              sext_i32_i64(p_32686) *\n                                              sext_i32_i64(c_32685)) *\n                                      (sext_i32_i64(n_cols_32689) *\n                                       sext_i32_i64(p_32686) *\n                                       sext_i32_i64(p_32686) *\n                                       sext_i32_i64(c_32685)),\n                                      sext_i32_i64(p_32686) *\n                                      sext_i32_i64(p_32686) *\n                                      sext_i32_i64(c_32685)));\n    \n    int32_t gtid_38759;\n    \n    gtid_38759 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40300) *\n                                      sext_i32_i64(segmap_group_sizze_39262) +\n                                      sext_i32_i64(local_tid_40299) -\n                                      squot64(sext_i32_i64(group_tid_40300) *\n                                              sext_i32_i64(segmap_group_sizze_39262) +\n                                              sext_i32_i64(local_tid_40299),\n                                              sext_i32_i64(n_cols_32689) *\n                                              sext_i32_i64(p_32686) *\n                                              sext_i32_i64(p_32686) *\n                                              sext_i32_i64(c_32685)) *\n                                      (sext_i32_i64(n_cols_32689) *\n                                       sext_i32_i64(p_32686) *\n                                       sext_i32_i64(p_32686) *\n                                       sext_i32_i64(c_32685)) -\n             ",
            "                         squot64(sext_i32_i64(group_tid_40300) *\n                                              sext_i32_i64(segmap_group_sizze_39262) +\n                                              sext_i32_i64(local_tid_40299) -\n                                              squot64(sext_i32_i64(group_tid_40300) *\n                                                      sext_i32_i64(segmap_group_sizze_39262) +\n                                                      sext_i32_i64(local_tid_40299),\n                                                      sext_i32_i64(n_cols_32689) *\n                                                      sext_i32_i64(p_32686) *\n                                                      sext_i32_i64(p_32686) *\n                                                      sext_i32_i64(c_32685)) *\n                                              (sext_i32_i64(n_cols_32689) *\n                                               sext_i32_i64(p_32686) *\n                                               sext_i32_i64(p_32686) *\n                                               sext_i32_i64(c_32685)),\n                                              sext_i32_i64(p_32686) *\n                                              sext_i32_i64(p_32686) *\n                                              sext_i32_i64(c_32685)) *\n                                      (sext_i32_i64(p_32686) *\n                                       sext_i32_i64(p_32686) *\n                                       sext_i32_i64(c_32685)),\n                                      sext_i32_i64(p_32686) *\n                                      sext_i32_i64(c_32685)));\n    \n    int32_t gtid_38760;\n    \n    gtid_38760 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40300) *\n                                      sext_i32_i64(segmap_group_sizze_39262) +\n                                      sext_i32_i64(local_tid_40299) -\n                                      squot64(sext_i32_i64(group_tid_40300) *\n                                         ",
            "     sext_i32_i64(segmap_group_sizze_39262) +\n                                              sext_i32_i64(local_tid_40299),\n                                              sext_i32_i64(n_cols_32689) *\n                                              sext_i32_i64(p_32686) *\n                                              sext_i32_i64(p_32686) *\n                                              sext_i32_i64(c_32685)) *\n                                      (sext_i32_i64(n_cols_32689) *\n                                       sext_i32_i64(p_32686) *\n                                       sext_i32_i64(p_32686) *\n                                       sext_i32_i64(c_32685)) -\n                                      squot64(sext_i32_i64(group_tid_40300) *\n                                              sext_i32_i64(segmap_group_sizze_39262) +\n                                              sext_i32_i64(local_tid_40299) -\n                                              squot64(sext_i32_i64(group_tid_40300) *\n                                                      sext_i32_i64(segmap_group_sizze_39262) +\n                                                      sext_i32_i64(local_tid_40299),\n                                                      sext_i32_i64(n_cols_32689) *\n                                                      sext_i32_i64(p_32686) *\n                                                      sext_i32_i64(p_32686) *\n                                                      sext_i32_i64(c_32685)) *\n                                              (sext_i32_i64(n_cols_32689) *\n                                               sext_i32_i64(p_32686) *\n                                               sext_i32_i64(p_32686) *\n                                               sext_i32_i64(c_32685)),\n                                              sext_i32_i64(p_32686) *\n                                              sext_i32_i64(p_32686) *\n                                              sext_i32_i64(c_32685)) *\n      ",
            "                                (sext_i32_i64(p_32686) *\n                                       sext_i32_i64(p_32686) *\n                                       sext_i32_i64(c_32685)) -\n                                      squot64(sext_i32_i64(group_tid_40300) *\n                                              sext_i32_i64(segmap_group_sizze_39262) +\n                                              sext_i32_i64(local_tid_40299) -\n                                              squot64(sext_i32_i64(group_tid_40300) *\n                                                      sext_i32_i64(segmap_group_sizze_39262) +\n                                                      sext_i32_i64(local_tid_40299),\n                                                      sext_i32_i64(n_cols_32689) *\n                                                      sext_i32_i64(p_32686) *\n                                                      sext_i32_i64(p_32686) *\n                                                      sext_i32_i64(c_32685)) *\n                                              (sext_i32_i64(n_cols_32689) *\n                                               sext_i32_i64(p_32686) *\n                                               sext_i32_i64(p_32686) *\n                                               sext_i32_i64(c_32685)) -\n                                              squot64(sext_i32_i64(group_tid_40300) *\n                                                      sext_i32_i64(segmap_group_sizze_39262) +\n                                                      sext_i32_i64(local_tid_40299) -\n                                                      squot64(sext_i32_i64(group_tid_40300) *\n                                                              sext_i32_i64(segmap_group_sizze_39262) +\n                                                              sext_i32_i64(local_tid_40299),\n                                                              sext_i32_i64(n_cols_32689) *\n                                                   ",
            "           sext_i32_i64(p_32686) *\n                                                              sext_i32_i64(p_32686) *\n                                                              sext_i32_i64(c_32685)) *\n                                                      (sext_i32_i64(n_cols_32689) *\n                                                       sext_i32_i64(p_32686) *\n                                                       sext_i32_i64(p_32686) *\n                                                       sext_i32_i64(c_32685)),\n                                                      sext_i32_i64(p_32686) *\n                                                      sext_i32_i64(p_32686) *\n                                                      sext_i32_i64(c_32685)) *\n                                              (sext_i32_i64(p_32686) *\n                                               sext_i32_i64(p_32686) *\n                                               sext_i32_i64(c_32685)),\n                                              sext_i32_i64(p_32686) *\n                                              sext_i32_i64(c_32685)) *\n                                      (sext_i32_i64(p_32686) *\n                                       sext_i32_i64(c_32685)),\n                                      sext_i32_i64(c_32685)));\n    \n    int32_t gtid_38761;\n    \n    gtid_38761 = sext_i64_i32(sext_i32_i64(group_tid_40300) *\n        sext_i32_i64(segmap_group_sizze_39262) + sext_i32_i64(local_tid_40299) -\n        squot64(sext_i32_i64(group_tid_40300) *\n                sext_i32_i64(segmap_group_sizze_39262) +\n                sext_i32_i64(local_tid_40299), sext_i32_i64(n_cols_32689) *\n                sext_i32_i64(p_32686) * sext_i32_i64(p_32686) *\n                sext_i32_i64(c_32685)) * (sext_i32_i64(n_cols_32689) *\n                                          sext_i32_i64(p_32686) *\n                                          sext_i32_i64(p_32686) *\n                                          sext_i32_i64(c_32685)) -\n ",
            "       squot64(sext_i32_i64(group_tid_40300) *\n                sext_i32_i64(segmap_group_sizze_39262) +\n                sext_i32_i64(local_tid_40299) -\n                squot64(sext_i32_i64(group_tid_40300) *\n                        sext_i32_i64(segmap_group_sizze_39262) +\n                        sext_i32_i64(local_tid_40299),\n                        sext_i32_i64(n_cols_32689) * sext_i32_i64(p_32686) *\n                        sext_i32_i64(p_32686) * sext_i32_i64(c_32685)) *\n                (sext_i32_i64(n_cols_32689) * sext_i32_i64(p_32686) *\n                 sext_i32_i64(p_32686) * sext_i32_i64(c_32685)),\n                sext_i32_i64(p_32686) * sext_i32_i64(p_32686) *\n                sext_i32_i64(c_32685)) * (sext_i32_i64(p_32686) *\n                                          sext_i32_i64(p_32686) *\n                                          sext_i32_i64(c_32685)) -\n        squot64(sext_i32_i64(group_tid_40300) *\n                sext_i32_i64(segmap_group_sizze_39262) +\n                sext_i32_i64(local_tid_40299) -\n                squot64(sext_i32_i64(group_tid_40300) *\n                        sext_i32_i64(segmap_group_sizze_39262) +\n                        sext_i32_i64(local_tid_40299),\n                        sext_i32_i64(n_cols_32689) * sext_i32_i64(p_32686) *\n                        sext_i32_i64(p_32686) * sext_i32_i64(c_32685)) *\n                (sext_i32_i64(n_cols_32689) * sext_i32_i64(p_32686) *\n                 sext_i32_i64(p_32686) * sext_i32_i64(c_32685)) -\n                squot64(sext_i32_i64(group_tid_40300) *\n                        sext_i32_i64(segmap_group_sizze_39262) +\n                        sext_i32_i64(local_tid_40299) -\n                        squot64(sext_i32_i64(group_tid_40300) *\n                                sext_i32_i64(segmap_group_sizze_39262) +\n                                sext_i32_i64(local_tid_40299),\n                                sext_i32_i64(n_cols_32689) *\n                                sext_i32_i64(p_32686) * sext_i32_i64(p_",
            "32686) *\n                                sext_i32_i64(c_32685)) *\n                        (sext_i32_i64(n_cols_32689) * sext_i32_i64(p_32686) *\n                         sext_i32_i64(p_32686) * sext_i32_i64(c_32685)),\n                        sext_i32_i64(p_32686) * sext_i32_i64(p_32686) *\n                        sext_i32_i64(c_32685)) * (sext_i32_i64(p_32686) *\n                                                  sext_i32_i64(p_32686) *\n                                                  sext_i32_i64(c_32685)),\n                sext_i32_i64(p_32686) * sext_i32_i64(c_32685)) *\n        (sext_i32_i64(p_32686) * sext_i32_i64(c_32685)) -\n        squot64(sext_i32_i64(group_tid_40300) *\n                sext_i32_i64(segmap_group_sizze_39262) +\n                sext_i32_i64(local_tid_40299) -\n                squot64(sext_i32_i64(group_tid_40300) *\n                        sext_i32_i64(segmap_group_sizze_39262) +\n                        sext_i32_i64(local_tid_40299),\n                        sext_i32_i64(n_cols_32689) * sext_i32_i64(p_32686) *\n                        sext_i32_i64(p_32686) * sext_i32_i64(c_32685)) *\n                (sext_i32_i64(n_cols_32689) * sext_i32_i64(p_32686) *\n                 sext_i32_i64(p_32686) * sext_i32_i64(c_32685)) -\n                squot64(sext_i32_i64(group_tid_40300) *\n                        sext_i32_i64(segmap_group_sizze_39262) +\n                        sext_i32_i64(local_tid_40299) -\n                        squot64(sext_i32_i64(group_tid_40300) *\n                                sext_i32_i64(segmap_group_sizze_39262) +\n                                sext_i32_i64(local_tid_40299),\n                                sext_i32_i64(n_cols_32689) *\n                                sext_i32_i64(p_32686) * sext_i32_i64(p_32686) *\n                                sext_i32_i64(c_32685)) *\n                        (sext_i32_i64(n_cols_32689) * sext_i32_i64(p_32686) *\n                         sext_i32_i64(p_32686) * sext_i32_i64(c_32685)),\n                        s",
            "ext_i32_i64(p_32686) * sext_i32_i64(p_32686) *\n                        sext_i32_i64(c_32685)) * (sext_i32_i64(p_32686) *\n                                                  sext_i32_i64(p_32686) *\n                                                  sext_i32_i64(c_32685)) -\n                squot64(sext_i32_i64(group_tid_40300) *\n                        sext_i32_i64(segmap_group_sizze_39262) +\n                        sext_i32_i64(local_tid_40299) -\n                        squot64(sext_i32_i64(group_tid_40300) *\n                                sext_i32_i64(segmap_group_sizze_39262) +\n                                sext_i32_i64(local_tid_40299),\n                                sext_i32_i64(n_cols_32689) *\n                                sext_i32_i64(p_32686) * sext_i32_i64(p_32686) *\n                                sext_i32_i64(c_32685)) *\n                        (sext_i32_i64(n_cols_32689) * sext_i32_i64(p_32686) *\n                         sext_i32_i64(p_32686) * sext_i32_i64(c_32685)) -\n                        squot64(sext_i32_i64(group_tid_40300) *\n                                sext_i32_i64(segmap_group_sizze_39262) +\n                                sext_i32_i64(local_tid_40299) -\n                                squot64(sext_i32_i64(group_tid_40300) *\n                                        sext_i32_i64(segmap_group_sizze_39262) +\n                                        sext_i32_i64(local_tid_40299),\n                                        sext_i32_i64(n_cols_32689) *\n                                        sext_i32_i64(p_32686) *\n                                        sext_i32_i64(p_32686) *\n                                        sext_i32_i64(c_32685)) *\n                                (sext_i32_i64(n_cols_32689) *\n                                 sext_i32_i64(p_32686) * sext_i32_i64(p_32686) *\n                                 sext_i32_i64(c_32685)), sext_i32_i64(p_32686) *\n                                sext_i32_i64(p_32686) * sext_i32_i64(c_32685)) *\n           ",
            "             (sext_i32_i64(p_32686) * sext_i32_i64(p_32686) *\n                         sext_i32_i64(c_32685)), sext_i32_i64(p_32686) *\n                        sext_i32_i64(c_32685)) * (sext_i32_i64(p_32686) *\n                                                  sext_i32_i64(c_32685)),\n                sext_i32_i64(c_32685)) * sext_i32_i64(c_32685));\n    if ((((slt32(gtid_38757, n_rows_32691) && slt32(gtid_38758,\n                                                    n_cols_32689)) &&\n          slt32(gtid_38759, p_32686)) && slt32(gtid_38760, p_32686)) &&\n        slt32(gtid_38761, c_32685)) {\n        int32_t index_primexp_39303 = add32(gtid_38757, gtid_38759);\n        bool binop_x_39310 = sle32(0, index_primexp_39303);\n        bool binop_y_39312 = slt32(index_primexp_39303, h_32683);\n        bool index_primexp_39313 = binop_x_39310 && binop_y_39312;\n        int32_t index_primexp_39298 = add32(gtid_38758, gtid_38760);\n        bool binop_x_39305 = sle32(0, index_primexp_39298);\n        bool binop_y_39307 = slt32(index_primexp_39298, w_32684);\n        bool index_primexp_39308 = binop_x_39305 && binop_y_39307;\n        bool index_ok_39276 = index_primexp_39308 && index_primexp_39313;\n        bool index_certs_39277;\n        \n        if (!index_ok_39276) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 53) == -1) {\n                    global_failure_args[0] = index_primexp_39303;\n                    global_failure_args[1] = index_primexp_39298;\n                    global_failure_args[2] = gtid_38761;\n                    global_failure_args[3] = h_32683;\n                    global_failure_args[4] = w_32684;\n                    global_failure_args[5] = c_32685;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        int32_t i32_arg_39278 = ((__global\n                                  int32_t *) img_mem_39418)[sext_i32_i64(index_primexp_39303) *\n                                                          ",
            "  sext_i32_i64(c_32685 *\n                                                            w_32684) +\n                                                            sext_i32_i64(index_primexp_39298) *\n                                                            sext_i32_i64(c_32685) +\n                                                            sext_i32_i64(gtid_38761)];\n        int8_t unsign_arg_39279 = zext_i32_i8(i32_arg_39278);\n        \n        ((__global int8_t *) mem_39429)[sext_i32_i64(gtid_38757) *\n                                        sext_i32_i64(c_32685 * p_32686 *\n                                        p_32686 * n_cols_32689) +\n                                        sext_i32_i64(gtid_38758) *\n                                        sext_i32_i64(c_32685 * p_32686 *\n                                        p_32686) + sext_i32_i64(gtid_38759) *\n                                        sext_i32_i64(c_32685 * p_32686) +\n                                        sext_i32_i64(gtid_38760) *\n                                        sext_i32_i64(c_32685) +\n                                        sext_i32_i64(gtid_38761)] =\n            unsign_arg_39279;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_39262\n}\n__kernel void propagateFixKzicopy_40323(int32_t nc_31615, int32_t i_31649,\n                                        __global unsigned char *mem_39428,\n                                        int32_t ctx_val_39482, __global\n                                        unsigned char *mem_39519)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_40323;\n    int32_t copy_ltid_40324;\n    int32_t copy_gid_40325;\n    \n    copy_gtid_40323 = get_global_id(0);\n    copy_ltid_40324 = get_local_id(0);\n    copy_gid_40325 = get_group_id(0);\n    if (slt32(copy_gtid_40323, sext_i64_i32(sext_i32_i64(nc_31615) * 8))) {\n        ((__global int32_t *) mem_39519)[sext_i32_i64(copy_gtid_40323 -\n                               ",
            "          squot32(copy_gtid_40323, 8) * 8) *\n                                         sext_i32_i64(nc_31615) +\n                                         sext_i32_i64(squot32(copy_gtid_40323,\n                                                              8))] = ((__global\n                                                                       int32_t *) mem_39428)[sext_i32_i64(i_31649 *\n                                                                                             ctx_val_39482) +\n                                                                                             (sext_i32_i64(squot32(copy_gtid_40323,\n                                                                                                                   8)) *\n                                                                                              8 +\n                                                                                              sext_i32_i64(copy_gtid_40323 -\n                                                                                              squot32(copy_gtid_40323,\n                                                                                                      8) *\n                                                                                              8))];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void propagateFixKzicopy_40328(int32_t nc_31615, int32_t i_31649,\n                                        __global unsigned char *mem_39432,\n                                        int32_t ctx_val_39482, __global\n                                        unsigned char *mem_39523)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_40328;\n    int32_t copy_ltid_40329;\n    int32_t copy_gid_40330;\n    \n    copy_gtid_40328 = get_global_id(0);\n    copy_ltid_40329 = get_local_id(0);\n    copy_gid_40330 = get_group_id(0);\n    if (slt32(copy_gtid_40328, sext_i64_i32(sext_i32_i64(nc_31615) * 8))) {\n  ",
            "      ((__global float *) mem_39523)[sext_i32_i64(copy_gtid_40328 -\n                                       squot32(copy_gtid_40328, 8) * 8) *\n                                       sext_i32_i64(nc_31615) +\n                                       sext_i32_i64(squot32(copy_gtid_40328,\n                                                            8))] = ((__global\n                                                                     float *) mem_39432)[sext_i32_i64(i_31649 *\n                                                                                         ctx_val_39482) +\n                                                                                         (sext_i32_i64(squot32(copy_gtid_40328,\n                                                                                                               8)) *\n                                                                                          8 +\n                                                                                          sext_i32_i64(copy_gtid_40328 -\n                                                                                          squot32(copy_gtid_40328,\n                                                                                                  8) *\n                                                                                          8))];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void propagateFixKzicopy_40366(int32_t nc_31615, int32_t i_31649,\n                                        __global unsigned char *mem_39428,\n                                        int32_t ctx_val_39482, __global\n                                        unsigned char *mem_39679)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_40366;\n    int32_t copy_ltid_40367;\n    int32_t copy_gid_40368;\n    \n    copy_gtid_40366 = get_global_id(0);\n    copy_ltid_40367 = get_local_id(0);\n    copy_gid_40368 = get_group_id(0);\n    if (slt32(copy_gtid",
            "_40366, sext_i64_i32(sext_i32_i64(nc_31615) * 8))) {\n        ((__global int32_t *) mem_39679)[sext_i32_i64(copy_gtid_40366 -\n                                         squot32(copy_gtid_40366, 8) * 8) *\n                                         sext_i32_i64(nc_31615) +\n                                         sext_i32_i64(squot32(copy_gtid_40366,\n                                                              8))] = ((__global\n                                                                       int32_t *) mem_39428)[sext_i32_i64(i_31649 *\n                                                                                             ctx_val_39482) +\n                                                                                             (sext_i32_i64(squot32(copy_gtid_40366,\n                                                                                                                   8)) *\n                                                                                              8 +\n                                                                                              sext_i32_i64(copy_gtid_40366 -\n                                                                                              squot32(copy_gtid_40366,\n                                                                                                      8) *\n                                                                                              8))];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void propagateFixKzicopy_40371(int32_t nc_31615, int32_t i_31649,\n                                        __global unsigned char *mem_39432,\n                                        int32_t ctx_val_39482, __global\n                                        unsigned char *mem_39683)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_40371;\n    int32_t copy_ltid_40372;\n    int32_t copy_gid_40373;\n    \n    copy_gtid_40371 = get_global_id(0);",
            "\n    copy_ltid_40372 = get_local_id(0);\n    copy_gid_40373 = get_group_id(0);\n    if (slt32(copy_gtid_40371, sext_i64_i32(sext_i32_i64(nc_31615) * 8))) {\n        ((__global float *) mem_39683)[sext_i32_i64(copy_gtid_40371 -\n                                       squot32(copy_gtid_40371, 8) * 8) *\n                                       sext_i32_i64(nc_31615) +\n                                       sext_i32_i64(squot32(copy_gtid_40371,\n                                                            8))] = ((__global\n                                                                     float *) mem_39432)[sext_i32_i64(i_31649 *\n                                                                                         ctx_val_39482) +\n                                                                                         (sext_i32_i64(squot32(copy_gtid_40371,\n                                                                                                               8)) *\n                                                                                          8 +\n                                                                                          sext_i32_i64(copy_gtid_40371 -\n                                                                                          squot32(copy_gtid_40371,\n                                                                                                  8) *\n                                                                                          8))];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void propagateFixKzicopy_40410(int32_t nc_31615, int32_t i_31649,\n                                        __global unsigned char *mem_39428,\n                                        int32_t ctx_val_39482, __global\n                                        unsigned char *mem_39831)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_40410;\n    int32_t copy_ltid_40411;\n    int32_t copy_",
            "gid_40412;\n    \n    copy_gtid_40410 = get_global_id(0);\n    copy_ltid_40411 = get_local_id(0);\n    copy_gid_40412 = get_group_id(0);\n    if (slt32(copy_gtid_40410, sext_i64_i32(sext_i32_i64(nc_31615) * 8))) {\n        ((__global int32_t *) mem_39831)[sext_i32_i64(copy_gtid_40410 -\n                                         squot32(copy_gtid_40410, 8) * 8) *\n                                         sext_i32_i64(nc_31615) +\n                                         sext_i32_i64(squot32(copy_gtid_40410,\n                                                              8))] = ((__global\n                                                                       int32_t *) mem_39428)[sext_i32_i64(i_31649 *\n                                                                                             ctx_val_39482) +\n                                                                                             (sext_i32_i64(squot32(copy_gtid_40410,\n                                                                                                                   8)) *\n                                                                                              8 +\n                                                                                              sext_i32_i64(copy_gtid_40410 -\n                                                                                              squot32(copy_gtid_40410,\n                                                                                                      8) *\n                                                                                              8))];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void propagateFixKzicopy_40415(int32_t nc_31615, int32_t i_31649,\n                                        __global unsigned char *mem_39432,\n                                        int32_t ctx_val_39482, __global\n                                        unsigned char *mem_39835)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    ",
            "const int block_dim2 = 2;\n    int32_t copy_gtid_40415;\n    int32_t copy_ltid_40416;\n    int32_t copy_gid_40417;\n    \n    copy_gtid_40415 = get_global_id(0);\n    copy_ltid_40416 = get_local_id(0);\n    copy_gid_40417 = get_group_id(0);\n    if (slt32(copy_gtid_40415, sext_i64_i32(sext_i32_i64(nc_31615) * 8))) {\n        ((__global float *) mem_39835)[sext_i32_i64(copy_gtid_40415 -\n                                       squot32(copy_gtid_40415, 8) * 8) *\n                                       sext_i32_i64(nc_31615) +\n                                       sext_i32_i64(squot32(copy_gtid_40415,\n                                                            8))] = ((__global\n                                                                     float *) mem_39432)[sext_i32_i64(i_31649 *\n                                                                                         ctx_val_39482) +\n                                                                                         (sext_i32_i64(squot32(copy_gtid_40415,\n                                                                                                               8)) *\n                                                                                          8 +\n                                                                                          sext_i32_i64(copy_gtid_40415 -\n                                                                                          squot32(copy_gtid_40415,\n                                                                                                  8) *\n                                                                                          8))];\n    }\n    \n  error_0:\n    return;\n}\n__kernel void propagateFixKzisegmap_34700(__global int *global_failure,\n                                          int failure_is_an_option, __global\n                                          int *global_failure_args,\n                                          int32_t m_31574, int32_t nc_31615,\n     ",
            "                                     int32_t upper_bound_31636,\n                                          int32_t im1_31646,\n                                          int32_t num_groups_34831,\n                                          int32_t binop_x_39322,\n                                          int32_t num_threads_39324,\n                                          int32_t per_chunk_39330, __global\n                                          unsigned char *indir_mem_39419,\n                                          __global\n                                          unsigned char *orig2leaf_mem_39420,\n                                          __global\n                                          unsigned char *nat_leaves0_mem_39422,\n                                          __global unsigned char *mem_39428,\n                                          __global unsigned char *mem_39443,\n                                          int32_t ctx_val_39482, __global\n                                          unsigned char *mem_39511, __global\n                                          unsigned char *mem_39515)\n{\n    #define segmap_group_sizze_34830 (propagateFixKzisegmap_group_sizze_34703)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40307;\n    int32_t local_tid_40308;\n    int32_t group_sizze_40311;\n    int32_t wave_sizze_40310;\n    int32_t group_tid_40309;\n    \n    global_tid_40307 = get_global_id(0);\n    local_tid_40308 = get_local_id(0);\n    group_sizze_40311 = get_local_size(0);\n    wave_sizze_40310 = LOCKSTEP_WIDTH;\n    group_tid_40309 = get_group_id(0);\n    \n    int32_t phys_tid_34700;\n    \n    phys_tid_34700 = global_tid_40307;\n    \n    int32_t phys_group_id_40312;\n  ",
            "  \n    phys_group_id_40312 = get_group_id(0);\n    for (int32_t i_40313 = 0; i_40313 < sdiv_up32(sdiv_up32(nc_31615,\n                                                            segmap_group_sizze_34830) -\n                                                  phys_group_id_40312,\n                                                  num_groups_34831);\n         i_40313++) {\n        int32_t virt_group_id_40314 = phys_group_id_40312 + i_40313 *\n                num_groups_34831;\n        int32_t gtid_34699 = sext_i64_i32(sext_i32_i64(virt_group_id_40314) *\n                sext_i32_i64(segmap_group_sizze_34830) +\n                sext_i32_i64(local_tid_40308));\n        \n        if (slt32(gtid_34699, nc_31615)) {\n            int32_t new_index_39323 = gtid_34699 + binop_x_39322;\n            int32_t x_34835 = ((__global\n                                int32_t *) nat_leaves0_mem_39422)[sext_i32_i64(new_index_39323)];\n            int32_t mem_39494[8];\n            \n            for (int32_t i_40315 = 0; i_40315 < 8; i_40315++) {\n                mem_39494[sext_i32_i64(i_40315)] = -1;\n            }\n            \n            int32_t res_34838;\n            int32_t n_inds_34841 = 0;\n            \n            for (int32_t q_34840 = 0; q_34840 < 8; q_34840++) {\n                int32_t estimateIndex_arg_34843 = ((__global\n                                                    int32_t *) mem_39428)[sext_i32_i64(im1_31646) *\n                                                                          sext_i32_i64(ctx_val_39482) +\n                                                                          sext_i32_i64(gtid_34699) *\n                                                                          8 +\n                                                                          sext_i32_i64(q_34840)];\n                bool x_34844 = sle32(0, estimateIndex_arg_34843);\n                bool y_34845 = slt32(estimateIndex_arg_34843, m_31574);\n                bool bounds_check_34846 = x_34844 && y_34845;\n         ",
            "       bool index_certs_34847;\n                \n                if (!bounds_check_34846) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 54) ==\n                            -1) {\n                            global_failure_args[0] = estimateIndex_arg_34843;\n                            global_failure_args[1] = m_31574;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int32_t orig_par_ind_34848 = ((__global\n                                               int32_t *) indir_mem_39419)[sext_i32_i64(estimateIndex_arg_34843)];\n                int32_t orig_par_y_34849 = sdiv32(orig_par_ind_34848, nc_31615);\n                int32_t y_34850 = mul32(nc_31615, orig_par_y_34849);\n                int32_t orig_par_x_34851 = sub32(orig_par_ind_34848, y_34850);\n                bool cond_34852 = slt32(orig_par_y_34849, upper_bound_31636);\n                int32_t cand_y_34853;\n                \n                if (cond_34852) {\n                    int32_t res_34854 = add32(1, orig_par_y_34849);\n                    \n                    cand_y_34853 = res_34854;\n                } else {\n                    cand_y_34853 = upper_bound_31636;\n                }\n                \n                int32_t x_34855 = mul32(nc_31615, cand_y_34853);\n                int32_t orig_cand_ind_34856 = add32(orig_par_x_34851, x_34855);\n                bool x_34857 = sle32(0, orig_cand_ind_34856);\n                bool y_34858 = slt32(orig_cand_ind_34856, m_31574);\n                bool bounds_check_34859 = x_34857 && y_34858;\n                bool index_certs_34860;\n                \n                if (!bounds_check_34859) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 55) ==\n                            -1) {\n                            global_failure_ar",
            "gs[0] = orig_cand_ind_34856;\n                            global_failure_args[1] = m_31574;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int32_t cand_leaf_ind_34861 = ((__global\n                                                int32_t *) orig2leaf_mem_39420)[sext_i32_i64(orig_cand_ind_34856)];\n                bool not_found_34862 = cand_leaf_ind_34861 == x_34835;\n                bool not_found_34863 = !not_found_34862;\n                bool res_34864 = slt32(0, n_inds_34841);\n                bool x_34865 = not_found_34863 && res_34864;\n                bool not_found_34866;\n                int32_t not_found_34867;\n                bool not_found_34868;\n                bool loop_while_34869;\n                int32_t j_34870;\n                bool not_found_34871;\n                \n                loop_while_34869 = x_34865;\n                j_34870 = 0;\n                not_found_34871 = not_found_34863;\n                while (loop_while_34869) {\n                    bool x_34872 = sle32(0, j_34870);\n                    bool y_34873 = slt32(j_34870, 8);\n                    bool bounds_check_34874 = x_34872 && y_34873;\n                    bool index_certs_34875;\n                    \n                    if (!bounds_check_34874) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          56) == -1) {\n                                global_failure_args[0] = j_34870;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    int32_t x_34876 = mem_39494[sext_i32_i64(j_34870)]",
            ";\n                    bool cond_34877 = x_34876 == cand_leaf_ind_34861;\n                    bool x_34878 = !cond_34877;\n                    int32_t loopres_34879;\n                    \n                    if (cond_34877) {\n                        loopres_34879 = j_34870;\n                    } else {\n                        int32_t res_34880 = add32(1, j_34870);\n                        \n                        loopres_34879 = res_34880;\n                    }\n                    \n                    bool res_34881 = slt32(loopres_34879, n_inds_34841);\n                    bool x_34882 = x_34878 && res_34881;\n                    bool loop_while_tmp_40318 = x_34882;\n                    int32_t j_tmp_40319 = loopres_34879;\n                    bool not_found_tmp_40320 = x_34878;\n                    \n                    loop_while_34869 = loop_while_tmp_40318;\n                    j_34870 = j_tmp_40319;\n                    not_found_34871 = not_found_tmp_40320;\n                }\n                not_found_34866 = loop_while_34869;\n                not_found_34867 = j_34870;\n                not_found_34868 = not_found_34871;\n                \n                int32_t loopres_34883;\n                \n                if (not_found_34868) {\n                    bool x_34885 = sle32(0, n_inds_34841);\n                    bool y_34886 = slt32(n_inds_34841, 8);\n                    bool bounds_check_34887 = x_34885 && y_34886;\n                    bool index_certs_34888;\n                    \n                    if (!bounds_check_34887) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          57) == -1) {\n                                global_failure_args[0] = n_inds_34841;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n",
            "                        }\n                    }\n                    for (int32_t i_40321 = 0; i_40321 < 1; i_40321++) {\n                        mem_39494[sext_i32_i64(n_inds_34841 + i_40321)] =\n                            ((__global\n                              int32_t *) mem_39443)[(sext_i32_i64(orig_cand_ind_34856) +\n                                                     sext_i32_i64(i_40321) -\n                                                     squot64(sext_i32_i64(orig_cand_ind_34856) +\n                                                             sext_i32_i64(i_40321),\n                                                             sext_i32_i64(per_chunk_39330)) *\n                                                     sext_i32_i64(per_chunk_39330)) *\n                                                    sext_i32_i64(num_threads_39324) +\n                                                    squot64(sext_i32_i64(orig_cand_ind_34856) +\n                                                            sext_i32_i64(i_40321),\n                                                            sext_i32_i64(per_chunk_39330))];\n                    }\n                    \n                    int32_t res_34891 = add32(1, n_inds_34841);\n                    \n                    loopres_34883 = res_34891;\n                } else {\n                    loopres_34883 = n_inds_34841;\n                }\n                \n                int32_t n_inds_tmp_40316 = loopres_34883;\n                \n                n_inds_34841 = n_inds_tmp_40316;\n            }\n            res_34838 = n_inds_34841;\n            ((__global int32_t *) mem_39511)[sext_i32_i64(gtid_34699)] =\n                res_34838;\n            for (int32_t i_40322 = 0; i_40322 < 8; i_40322++) {\n                ((__global int32_t *) mem_39515)[sext_i32_i64(i_40322) *\n                                                 sext_i32_i64(nc_31615) +\n                                                 sext_i32_i64(gtid_34699)] =\n                    mem_39494[sex",
            "t_i32_i64(i_40322)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_34830\n}\n__kernel void propagateFixKzisegmap_34912(__global int *global_failure,\n                                          int failure_is_an_option, __global\n                                          int *global_failure_args,\n                                          int32_t d_31575, int32_t nr_31586,\n                                          int32_t nc_31615,\n                                          int32_t num_leaves_31627,\n                                          int32_t ppl_31631, int32_t i_31649,\n                                          int32_t num_groups_35039, __global\n                                          unsigned char *mem_39450, __global\n                                          unsigned char *mem_39457, __global\n                                          unsigned char *mem_39511, __global\n                                          unsigned char *mem_39515, __global\n                                          unsigned char *mem_39519, __global\n                                          unsigned char *mem_39523, __global\n                                          unsigned char *mem_39561, __global\n                                          unsigned char *mem_39671, __global\n                                          unsigned char *mem_39675, __global\n                                          unsigned char *double_buffer_mem_40098,\n                                          __global\n                                          unsigned char *double_buffer_mem_40099)\n{\n    #define segmap_group_sizze_35038 (propagateFixKzisegmap_group_sizze_34915)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n           ",
            " return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40333;\n    int32_t local_tid_40334;\n    int32_t group_sizze_40337;\n    int32_t wave_sizze_40336;\n    int32_t group_tid_40335;\n    \n    global_tid_40333 = get_global_id(0);\n    local_tid_40334 = get_local_id(0);\n    group_sizze_40337 = get_local_size(0);\n    wave_sizze_40336 = LOCKSTEP_WIDTH;\n    group_tid_40335 = get_group_id(0);\n    \n    int32_t phys_tid_34912;\n    \n    phys_tid_34912 = global_tid_40333;\n    \n    int32_t phys_group_id_40338;\n    \n    phys_group_id_40338 = get_group_id(0);\n    for (int32_t i_40339 = 0; i_40339 < sdiv_up32(sdiv_up32(nc_31615,\n                                                            segmap_group_sizze_35038) -\n                                                  phys_group_id_40338,\n                                                  num_groups_35039);\n         i_40339++) {\n        int32_t virt_group_id_40340 = phys_group_id_40338 + i_40339 *\n                num_groups_35039;\n        int32_t gtid_34911 = sext_i64_i32(sext_i32_i64(virt_group_id_40340) *\n                sext_i32_i64(segmap_group_sizze_35038) +\n                sext_i32_i64(local_tid_40334));\n        \n        if (slt32(gtid_34911, nc_31615)) {\n            int32_t x_35043 = ((__global\n                                int32_t *) mem_39511)[sext_i32_i64(gtid_34911)];\n            int32_t mem_39556[8];\n            float mem_39558[8];\n            int32_t mem_39613[8];\n            float mem_39615[8];\n            \n            for (int32_t i_40341 = 0; i_40341 < 8; i_40341++) {\n                ((__global\n                  int32_t *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_34912) +\n                                                      sext_i32_i64(i_40341) *\n                                                      sext_i32_i64(num_groups_35039 *\n                                                      segmap_group_sizze_35038)] =\n                    ((__global int32_t *) mem_39519)",
            "[sext_i32_i64(gtid_34911) +\n                                                     sext_i32_i64(i_40341) *\n                                                     sext_i32_i64(nc_31615)];\n            }\n            for (int32_t i_40342 = 0; i_40342 < 8; i_40342++) {\n                ((__global\n                  float *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_34912) +\n                                                    sext_i32_i64(i_40342) *\n                                                    sext_i32_i64(num_groups_35039 *\n                                                    segmap_group_sizze_35038)] =\n                    ((__global float *) mem_39523)[sext_i32_i64(gtid_34911) +\n                                                   sext_i32_i64(i_40342) *\n                                                   sext_i32_i64(nc_31615)];\n            }\n            for (int32_t q_35052 = 0; q_35052 < x_35043; q_35052++) {\n                int32_t i_35055 = q_35052;\n                bool x_35056 = sle32(0, i_35055);\n                bool y_35057 = slt32(i_35055, 8);\n                bool bounds_check_35058 = x_35056 && y_35057;\n                bool index_certs_35059;\n                \n                if (!bounds_check_35058) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 58) ==\n                            -1) {\n                            global_failure_args[0] = i_35055;\n                            global_failure_args[1] = 8;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int32_t leaf_ind_35060 = ((__global\n                                           int32_t *) mem_39515)[sext_i32_i64(i_35055) *\n                                                                 sext_i32_i64(nc_31615) +\n                                                                 sext_i32_i64(gtid_3491",
            "1)];\n                int32_t bruteForcePar_arg_35061 = mul32(ppl_31631,\n                                                        leaf_ind_35060);\n                bool x_35062 = sle32(0, leaf_ind_35060);\n                bool y_35063 = slt32(leaf_ind_35060, num_leaves_31627);\n                bool bounds_check_35064 = x_35062 && y_35063;\n                bool index_certs_35065;\n                \n                if (!bounds_check_35064) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 59) ==\n                            -1) {\n                            global_failure_args[0] = leaf_ind_35060;\n                            global_failure_args[1] = num_leaves_31627;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                for (int32_t i_40345 = 0; i_40345 < 8; i_40345++) {\n                    mem_39556[sext_i32_i64(i_40345)] = ((__global\n                                                         int32_t *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_34912) +\n                                                                                             sext_i32_i64(i_40345) *\n                                                                                             sext_i32_i64(num_groups_35039 *\n                                                                                             segmap_group_sizze_35038)];\n                }\n                for (int32_t i_40346 = 0; i_40346 < 8; i_40346++) {\n                    mem_39558[sext_i32_i64(i_40346)] = ((__global\n                                                         float *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_34912) +\n                                                                                           sext_i32_i64(i_40346) *\n                                                                                           sext_i",
            "32_i64(num_groups_35039 *\n                                                                                           segmap_group_sizze_35038)];\n                }\n                for (int32_t i_39355 = 0; i_39355 < ppl_31631; i_39355++) {\n                    float res_35071;\n                    float res_35073 = 0.0F;\n                    float x_35074;\n                    float y_35075;\n                    \n                    for (int32_t i_35072 = 0; i_35072 < d_31575; i_35072++) {\n                        x_35074 = ((__global\n                                    float *) mem_39450)[sext_i32_i64(i_31649 *\n                                                        nc_31615 + gtid_34911) +\n                                                        sext_i32_i64(i_35072) *\n                                                        sext_i32_i64(nc_31615 *\n                                                        nr_31586)];\n                        y_35075 = ((__global\n                                    float *) mem_39457)[sext_i32_i64(i_39355 *\n                                                        (num_leaves_31627 *\n                                                         d_31575) +\n                                                        leaf_ind_35060) +\n                                                        sext_i32_i64(i_35072) *\n                                                        sext_i32_i64(num_leaves_31627)];\n                        \n                        float zz_35076;\n                        \n                        zz_35076 = x_35074 - y_35075;\n                        \n                        float y_35077 = zz_35076 * zz_35076;\n                        float loopres_35078 = res_35073 + y_35077;\n                        float res_tmp_40348 = loopres_35078;\n                        \n                        res_35073 = res_tmp_40348;\n                    }\n                    res_35071 = res_35073;\n                    ((__global\n                      float *) mem_39",
            "561)[sext_i32_i64(phys_tid_34912) +\n                                          sext_i32_i64(i_39355) *\n                                          sext_i32_i64(num_groups_35039 *\n                                          segmap_group_sizze_35038)] =\n                        res_35071;\n                }\n                \n                bool knn_35079;\n                int32_t knn_35083;\n                bool loop_while_35084;\n                int32_t j_35088;\n                \n                loop_while_35084 = 1;\n                j_35088 = 0;\n                while (loop_while_35084) {\n                    int32_t res_35089;\n                    float res_35090;\n                    int32_t redout_39357;\n                    float redout_39358;\n                    \n                    redout_39357 = ppl_31631;\n                    redout_39358 = INFINITY;\n                    for (int32_t i_39359 = 0; i_39359 < ppl_31631; i_39359++) {\n                        float x_35104 = ((__global\n                                          float *) mem_39561)[sext_i32_i64(phys_tid_34912) +\n                                                              sext_i32_i64(i_39359) *\n                                                              sext_i32_i64(num_groups_35039 *\n                                                              segmap_group_sizze_35038)];\n                        bool cond_35095 = redout_39358 < x_35104;\n                        int32_t res_35096;\n                        float res_35097;\n                        \n                        if (cond_35095) {\n                            res_35096 = redout_39357;\n                            res_35097 = redout_39358;\n                        } else {\n                            bool cond_35098 = x_35104 < redout_39358;\n                            float res_35099;\n                            \n                            if (cond_35098) {\n                                res_35099 = x_35104;\n                            } else {\n               ",
            "                 res_35099 = redout_39358;\n                            }\n                            \n                            int32_t res_35100;\n                            \n                            if (cond_35098) {\n                                res_35100 = i_39359;\n                            } else {\n                                bool cond_35101 = sle32(redout_39357, i_39359);\n                                int32_t res_35102;\n                                \n                                if (cond_35101) {\n                                    res_35102 = redout_39357;\n                                } else {\n                                    res_35102 = i_39359;\n                                }\n                                res_35100 = res_35102;\n                            }\n                            res_35096 = res_35100;\n                            res_35097 = res_35099;\n                        }\n                        \n                        int32_t redout_tmp_40354 = res_35096;\n                        float redout_tmp_40355 = res_35097;\n                        \n                        redout_39357 = redout_tmp_40354;\n                        redout_39358 = redout_tmp_40355;\n                    }\n                    res_35089 = redout_39357;\n                    res_35090 = redout_39358;\n                    \n                    int32_t i_35105 = sub32(7, j_35088);\n                    bool x_35106 = sle32(0, i_35105);\n                    bool y_35107 = slt32(i_35105, 8);\n                    bool bounds_check_35108 = x_35106 && y_35107;\n                    bool index_certs_35109;\n                    \n                    if (!bounds_check_35108) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          60) == -1) {\n                                global_failure_args[0] = i_35105;\n                                global_failure_args[1] = 8;\n",
            "                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float y_35110 = mem_39558[sext_i32_i64(i_35105)];\n                    bool cond_35111 = res_35090 < y_35110;\n                    int32_t loopres_35115;\n                    \n                    if (cond_35111) {\n                        bool x_35116 = sle32(0, res_35089);\n                        bool y_35117 = slt32(res_35089, ppl_31631);\n                        bool bounds_check_35118 = x_35116 && y_35117;\n                        bool index_certs_35119;\n                        \n                        if (!bounds_check_35118) {\n                            {\n                                if (atomic_cmpxchg_i32_global(global_failure,\n                                                              -1, 61) == -1) {\n                                    global_failure_args[0] = res_35089;\n                                    global_failure_args[1] = ppl_31631;\n                                    ;\n                                }\n                                local_failure = true;\n                                goto error_0;\n                            }\n                        }\n                        ((__global\n                          float *) mem_39561)[sext_i32_i64(phys_tid_34912) +\n                                              sext_i32_i64(res_35089) *\n                                              sext_i32_i64(num_groups_35039 *\n                                              segmap_group_sizze_35038)] =\n                            INFINITY;\n                        \n                        int32_t lw_val_35121 = add32(bruteForcePar_arg_35061,\n                                                     res_35089);\n                        \n                        mem_39556[sext_i32_i64(i_35105)] = lw_val_35121;\n                      ",
            "  mem_39558[sext_i32_i64(i_35105)] = res_35090;\n                        \n                        int32_t res_35124 = add32(1, j_35088);\n                        \n                        loopres_35115 = res_35124;\n                    } else {\n                        loopres_35115 = j_35088;\n                    }\n                    \n                    bool res_35125 = slt32(loopres_35115, 8);\n                    bool x_35126 = cond_35111 && res_35125;\n                    bool loop_while_tmp_40349 = x_35126;\n                    int32_t j_tmp_40353 = loopres_35115;\n                    \n                    loop_while_35084 = loop_while_tmp_40349;\n                    j_35088 = j_tmp_40353;\n                }\n                knn_35079 = loop_while_35084;\n                knn_35083 = j_35088;\n                for (int32_t i_40356 = 0; i_40356 < 8; i_40356++) {\n                    mem_39613[sext_i32_i64(i_40356)] = -1;\n                }\n                for (int32_t i_40357 = 0; i_40357 < 8; i_40357++) {\n                    mem_39615[sext_i32_i64(i_40357)] = INFINITY;\n                }\n                \n                int32_t res_35131;\n                int32_t res_35132;\n                int32_t beg_35136;\n                int32_t end_35137;\n                \n                beg_35136 = 0;\n                end_35137 = 7;\n                for (int32_t i_35133 = 0; i_35133 < 8; i_35133++) {\n                    bool x_35138 = sle32(0, beg_35136);\n                    bool y_35139 = slt32(beg_35136, 8);\n                    bool bounds_check_35140 = x_35138 && y_35139;\n                    bool index_certs_35141;\n                    \n                    if (!bounds_check_35140) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          62) == -1) {\n                                global_failure_args[0] = beg_35136;\n                                global_failure_args[1] = 8;\n            ",
            "                    ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float x_35142 = mem_39558[sext_i32_i64(beg_35136)];\n                    bool x_35143 = sle32(0, end_35137);\n                    bool y_35144 = slt32(end_35137, 8);\n                    bool bounds_check_35145 = x_35143 && y_35144;\n                    bool index_certs_35146;\n                    \n                    if (!bounds_check_35145) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          63) == -1) {\n                                global_failure_args[0] = end_35137;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float y_35147 = mem_39558[sext_i32_i64(end_35137)];\n                    bool cond_35148 = x_35142 < y_35147;\n                    float loopres_35149;\n                    \n                    if (cond_35148) {\n                        loopres_35149 = x_35142;\n                    } else {\n                        loopres_35149 = y_35147;\n                    }\n                    \n                    int32_t loopres_35150;\n                    int32_t loopres_35151;\n                    int32_t loopres_35152;\n                    \n                    if (cond_35148) {\n                        int32_t res_35153 = mem_39556[sext_i32_i64(beg_35136)];\n                        int32_t res_35154 = add32(1, beg_35136);\n                        \n                        loopres_35150 = res_35153;\n                        loopres_35151 = res_35154;\n                        loopres_35152 ",
            "= end_35137;\n                    } else {\n                        int32_t res_35155 = mem_39556[sext_i32_i64(end_35137)];\n                        int32_t res_35156 = sub32(end_35137, 1);\n                        \n                        loopres_35150 = res_35155;\n                        loopres_35151 = beg_35136;\n                        loopres_35152 = res_35156;\n                    }\n                    mem_39613[sext_i32_i64(i_35133)] = loopres_35150;\n                    mem_39615[sext_i32_i64(i_35133)] = loopres_35149;\n                    \n                    int32_t beg_tmp_40360 = loopres_35151;\n                    int32_t end_tmp_40361 = loopres_35152;\n                    \n                    beg_35136 = beg_tmp_40360;\n                    end_35137 = end_tmp_40361;\n                }\n                res_35131 = beg_35136;\n                res_35132 = end_35137;\n                for (int32_t i_40362 = 0; i_40362 < 8; i_40362++) {\n                    ((__global\n                      int32_t *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_34912) +\n                                                          sext_i32_i64(i_40362) *\n                                                          sext_i32_i64(num_groups_35039 *\n                                                          segmap_group_sizze_35038)] =\n                        mem_39613[sext_i32_i64(i_40362)];\n                }\n                for (int32_t i_40363 = 0; i_40363 < 8; i_40363++) {\n                    ((__global\n                      float *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_34912) +\n                                                        sext_i32_i64(i_40363) *\n                                                        sext_i32_i64(num_groups_35039 *\n                                                        segmap_group_sizze_35038)] =\n                        mem_39615[sext_i32_i64(i_40363)];\n                }\n            }\n            for (int32_t i_40364 = 0; i_40364 < 8; i_40364++) {\n       ",
            "         ((__global int32_t *) mem_39671)[sext_i32_i64(i_40364) *\n                                                 sext_i32_i64(nc_31615) +\n                                                 sext_i32_i64(gtid_34911)] =\n                    ((__global\n                      int32_t *) double_buffer_mem_40098)[sext_i32_i64(phys_tid_34912) +\n                                                          sext_i32_i64(i_40364) *\n                                                          sext_i32_i64(num_groups_35039 *\n                                                          segmap_group_sizze_35038)];\n            }\n            for (int32_t i_40365 = 0; i_40365 < 8; i_40365++) {\n                ((__global float *) mem_39675)[sext_i32_i64(i_40365) *\n                                               sext_i32_i64(nc_31615) +\n                                               sext_i32_i64(gtid_34911)] =\n                    ((__global\n                      float *) double_buffer_mem_40099)[sext_i32_i64(phys_tid_34912) +\n                                                        sext_i32_i64(i_40365) *\n                                                        sext_i32_i64(num_groups_35039 *\n                                                        segmap_group_sizze_35038)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_35038\n}\n__kernel void propagateFixKzisegmap_35287(__global int *global_failure,\n                                          int failure_is_an_option, __global\n                                          int *global_failure_args,\n                                          int32_t d_31575, int32_t nr_31586,\n                                          int32_t nc_31615,\n                                          int32_t num_leaves_31627,\n                                          int32_t ppl_31631, int32_t i_31649,\n                                          int32_t num_groups_35414, __global\n     ",
            "                                     unsigned char *mem_39450, __global\n                                          unsigned char *mem_39457, __global\n                                          unsigned char *mem_39511, __global\n                                          unsigned char *mem_39515, __global\n                                          unsigned char *mem_39831, __global\n                                          unsigned char *mem_39835, __global\n                                          unsigned char *mem_39873, __global\n                                          unsigned char *mem_39983, __global\n                                          unsigned char *mem_39987, __global\n                                          unsigned char *double_buffer_mem_40110,\n                                          __global\n                                          unsigned char *double_buffer_mem_40111)\n{\n    #define segmap_group_sizze_35413 (propagateFixKzisegmap_group_sizze_35290)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40420;\n    int32_t local_tid_40421;\n    int32_t group_sizze_40424;\n    int32_t wave_sizze_40423;\n    int32_t group_tid_40422;\n    \n    global_tid_40420 = get_global_id(0);\n    local_tid_40421 = get_local_id(0);\n    group_sizze_40424 = get_local_size(0);\n    wave_sizze_40423 = LOCKSTEP_WIDTH;\n    group_tid_40422 = get_group_id(0);\n    \n    int32_t phys_tid_35287;\n    \n    phys_tid_35287 = global_tid_40420;\n    \n    int32_t phys_group_id_40425;\n    \n    phys_group_id_40425 = get_group_id(0);\n    for (int32_t i_40426 = 0; i_40426 < sdiv_up32(sdiv_up32(nc_31615,\n                                                            segmap_group_sizze_35413) -\n   ",
            "                                               phys_group_id_40425,\n                                                  num_groups_35414);\n         i_40426++) {\n        int32_t virt_group_id_40427 = phys_group_id_40425 + i_40426 *\n                num_groups_35414;\n        int32_t gtid_35286 = sext_i64_i32(sext_i32_i64(virt_group_id_40427) *\n                sext_i32_i64(segmap_group_sizze_35413) +\n                sext_i32_i64(local_tid_40421));\n        \n        if (slt32(gtid_35286, nc_31615)) {\n            int32_t x_35418 = ((__global\n                                int32_t *) mem_39511)[sext_i32_i64(gtid_35286)];\n            int32_t mem_39868[8];\n            float mem_39870[8];\n            int32_t mem_39925[8];\n            float mem_39927[8];\n            \n            for (int32_t i_40428 = 0; i_40428 < 8; i_40428++) {\n                ((__global\n                  int32_t *) double_buffer_mem_40110)[sext_i32_i64(phys_tid_35287) +\n                                                      sext_i32_i64(i_40428) *\n                                                      sext_i32_i64(num_groups_35414 *\n                                                      segmap_group_sizze_35413)] =\n                    ((__global int32_t *) mem_39831)[sext_i32_i64(gtid_35286) +\n                                                     sext_i32_i64(i_40428) *\n                                                     sext_i32_i64(nc_31615)];\n            }\n            for (int32_t i_40429 = 0; i_40429 < 8; i_40429++) {\n                ((__global\n                  float *) double_buffer_mem_40111)[sext_i32_i64(phys_tid_35287) +\n                                                    sext_i32_i64(i_40429) *\n                                                    sext_i32_i64(num_groups_35414 *\n                                                    segmap_group_sizze_35413)] =\n                    ((__global float *) mem_39835)[sext_i32_i64(gtid_35286) +\n                                                   sext_i32_i64(i_4042",
            "9) *\n                                                   sext_i32_i64(nc_31615)];\n            }\n            for (int32_t q_35425 = 0; q_35425 < x_35418; q_35425++) {\n                int32_t i_35428 = q_35425;\n                bool x_35429 = sle32(0, i_35428);\n                bool y_35430 = slt32(i_35428, 8);\n                bool bounds_check_35431 = x_35429 && y_35430;\n                bool index_certs_35432;\n                \n                if (!bounds_check_35431) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 70) ==\n                            -1) {\n                            global_failure_args[0] = i_35428;\n                            global_failure_args[1] = 8;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int32_t leaf_ind_35433 = ((__global\n                                           int32_t *) mem_39515)[sext_i32_i64(i_35428) *\n                                                                 sext_i32_i64(nc_31615) +\n                                                                 sext_i32_i64(gtid_35286)];\n                int32_t bruteForcePar_arg_35434 = mul32(ppl_31631,\n                                                        leaf_ind_35433);\n                bool x_35435 = sle32(0, leaf_ind_35433);\n                bool y_35436 = slt32(leaf_ind_35433, num_leaves_31627);\n                bool bounds_check_35437 = x_35435 && y_35436;\n                bool index_certs_35438;\n                \n                if (!bounds_check_35437) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 71) ==\n                            -1) {\n                            global_failure_args[0] = leaf_ind_35433;\n                            global_failure_args[1] = num_leaves_31627;\n                            ;\n                 ",
            "       }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                for (int32_t i_40432 = 0; i_40432 < 8; i_40432++) {\n                    mem_39868[sext_i32_i64(i_40432)] = ((__global\n                                                         int32_t *) double_buffer_mem_40110)[sext_i32_i64(phys_tid_35287) +\n                                                                                             sext_i32_i64(i_40432) *\n                                                                                             sext_i32_i64(num_groups_35414 *\n                                                                                             segmap_group_sizze_35413)];\n                }\n                for (int32_t i_40433 = 0; i_40433 < 8; i_40433++) {\n                    mem_39870[sext_i32_i64(i_40433)] = ((__global\n                                                         float *) double_buffer_mem_40111)[sext_i32_i64(phys_tid_35287) +\n                                                                                           sext_i32_i64(i_40433) *\n                                                                                           sext_i32_i64(num_groups_35414 *\n                                                                                           segmap_group_sizze_35413)];\n                }\n                for (int32_t i_39362 = 0; i_39362 < ppl_31631; i_39362++) {\n                    float res_35444;\n                    float res_35446 = 0.0F;\n                    float x_35447;\n                    float y_35448;\n                    \n                    for (int32_t i_35445 = 0; i_35445 < d_31575; i_35445++) {\n                        x_35447 = ((__global\n                                    float *) mem_39450)[sext_i32_i64(i_31649 *\n                                                        nc_31615 + gtid_35286) +\n                                                        sext_i32_i",
            "64(i_35445) *\n                                                        sext_i32_i64(nc_31615 *\n                                                        nr_31586)];\n                        y_35448 = ((__global\n                                    float *) mem_39457)[sext_i32_i64(i_39362 *\n                                                        (num_leaves_31627 *\n                                                         d_31575) +\n                                                        leaf_ind_35433) +\n                                                        sext_i32_i64(i_35445) *\n                                                        sext_i32_i64(num_leaves_31627)];\n                        \n                        float zz_35449;\n                        \n                        zz_35449 = x_35447 - y_35448;\n                        \n                        float y_35450 = zz_35449 * zz_35449;\n                        float loopres_35451 = res_35446 + y_35450;\n                        float res_tmp_40435 = loopres_35451;\n                        \n                        res_35446 = res_tmp_40435;\n                    }\n                    res_35444 = res_35446;\n                    ((__global\n                      float *) mem_39873)[sext_i32_i64(phys_tid_35287) +\n                                          sext_i32_i64(i_39362) *\n                                          sext_i32_i64(num_groups_35414 *\n                                          segmap_group_sizze_35413)] =\n                        res_35444;\n                }\n                \n                bool knn_35452;\n                int32_t knn_35456;\n                bool loop_while_35457;\n                int32_t j_35461;\n                \n                loop_while_35457 = 1;\n                j_35461 = 0;\n                while (loop_while_35457) {\n                    int32_t res_35462;\n                    float res_35463;\n                    int32_t redout_39364;\n                    float redout_39365;\n                   ",
            " \n                    redout_39364 = ppl_31631;\n                    redout_39365 = INFINITY;\n                    for (int32_t i_39366 = 0; i_39366 < ppl_31631; i_39366++) {\n                        float x_35477 = ((__global\n                                          float *) mem_39873)[sext_i32_i64(phys_tid_35287) +\n                                                              sext_i32_i64(i_39366) *\n                                                              sext_i32_i64(num_groups_35414 *\n                                                              segmap_group_sizze_35413)];\n                        bool cond_35468 = redout_39365 < x_35477;\n                        int32_t res_35469;\n                        float res_35470;\n                        \n                        if (cond_35468) {\n                            res_35469 = redout_39364;\n                            res_35470 = redout_39365;\n                        } else {\n                            bool cond_35471 = x_35477 < redout_39365;\n                            float res_35472;\n                            \n                            if (cond_35471) {\n                                res_35472 = x_35477;\n                            } else {\n                                res_35472 = redout_39365;\n                            }\n                            \n                            int32_t res_35473;\n                            \n                            if (cond_35471) {\n                                res_35473 = i_39366;\n                            } else {\n                                bool cond_35474 = sle32(redout_39364, i_39366);\n                                int32_t res_35475;\n                                \n                                if (cond_35474) {\n                                    res_35475 = redout_39364;\n                                } else {\n                                    res_35475 = i_39366;\n                                }\n                                res_35",
            "473 = res_35475;\n                            }\n                            res_35469 = res_35473;\n                            res_35470 = res_35472;\n                        }\n                        \n                        int32_t redout_tmp_40441 = res_35469;\n                        float redout_tmp_40442 = res_35470;\n                        \n                        redout_39364 = redout_tmp_40441;\n                        redout_39365 = redout_tmp_40442;\n                    }\n                    res_35462 = redout_39364;\n                    res_35463 = redout_39365;\n                    \n                    int32_t i_35478 = sub32(7, j_35461);\n                    bool x_35479 = sle32(0, i_35478);\n                    bool y_35480 = slt32(i_35478, 8);\n                    bool bounds_check_35481 = x_35479 && y_35480;\n                    bool index_certs_35482;\n                    \n                    if (!bounds_check_35481) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          72) == -1) {\n                                global_failure_args[0] = i_35478;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float y_35483 = mem_39870[sext_i32_i64(i_35478)];\n                    bool cond_35484 = res_35463 < y_35483;\n                    int32_t loopres_35488;\n                    \n                    if (cond_35484) {\n                        bool x_35489 = sle32(0, res_35462);\n                        bool y_35490 = slt32(res_35462, ppl_31631);\n                        bool bounds_check_35491 = x_35489 && y_35490;\n                        bool index_certs_35492;\n                        \n                        if (!boun",
            "ds_check_35491) {\n                            {\n                                if (atomic_cmpxchg_i32_global(global_failure,\n                                                              -1, 73) == -1) {\n                                    global_failure_args[0] = res_35462;\n                                    global_failure_args[1] = ppl_31631;\n                                    ;\n                                }\n                                local_failure = true;\n                                goto error_0;\n                            }\n                        }\n                        ((__global\n                          float *) mem_39873)[sext_i32_i64(phys_tid_35287) +\n                                              sext_i32_i64(res_35462) *\n                                              sext_i32_i64(num_groups_35414 *\n                                              segmap_group_sizze_35413)] =\n                            INFINITY;\n                        \n                        int32_t lw_val_35494 = add32(bruteForcePar_arg_35434,\n                                                     res_35462);\n                        \n                        mem_39868[sext_i32_i64(i_35478)] = lw_val_35494;\n                        mem_39870[sext_i32_i64(i_35478)] = res_35463;\n                        \n                        int32_t res_35497 = add32(1, j_35461);\n                        \n                        loopres_35488 = res_35497;\n                    } else {\n                        loopres_35488 = j_35461;\n                    }\n                    \n                    bool res_35498 = slt32(loopres_35488, 8);\n                    bool x_35499 = cond_35484 && res_35498;\n                    bool loop_while_tmp_40436 = x_35499;\n                    int32_t j_tmp_40440 = loopres_35488;\n                    \n                    loop_while_35457 = loop_while_tmp_40436;\n                    j_35461 = j_tmp_40440;\n                }\n                knn_35452 = loop_while_35457;\n  ",
            "              knn_35456 = j_35461;\n                for (int32_t i_40443 = 0; i_40443 < 8; i_40443++) {\n                    mem_39925[sext_i32_i64(i_40443)] = -1;\n                }\n                for (int32_t i_40444 = 0; i_40444 < 8; i_40444++) {\n                    mem_39927[sext_i32_i64(i_40444)] = INFINITY;\n                }\n                \n                int32_t res_35504;\n                int32_t res_35505;\n                int32_t beg_35509;\n                int32_t end_35510;\n                \n                beg_35509 = 0;\n                end_35510 = 7;\n                for (int32_t i_35506 = 0; i_35506 < 8; i_35506++) {\n                    bool x_35511 = sle32(0, beg_35509);\n                    bool y_35512 = slt32(beg_35509, 8);\n                    bool bounds_check_35513 = x_35511 && y_35512;\n                    bool index_certs_35514;\n                    \n                    if (!bounds_check_35513) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          74) == -1) {\n                                global_failure_args[0] = beg_35509;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float x_35515 = mem_39870[sext_i32_i64(beg_35509)];\n                    bool x_35516 = sle32(0, end_35510);\n                    bool y_35517 = slt32(end_35510, 8);\n                    bool bounds_check_35518 = x_35516 && y_35517;\n                    bool index_certs_35519;\n                    \n                    if (!bounds_check_35518) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                                          75) == -1) {\n          ",
            "                      global_failure_args[0] = end_35510;\n                                global_failure_args[1] = 8;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    float y_35520 = mem_39870[sext_i32_i64(end_35510)];\n                    bool cond_35521 = x_35515 < y_35520;\n                    float loopres_35522;\n                    \n                    if (cond_35521) {\n                        loopres_35522 = x_35515;\n                    } else {\n                        loopres_35522 = y_35520;\n                    }\n                    \n                    int32_t loopres_35523;\n                    int32_t loopres_35524;\n                    int32_t loopres_35525;\n                    \n                    if (cond_35521) {\n                        int32_t res_35526 = mem_39868[sext_i32_i64(beg_35509)];\n                        int32_t res_35527 = add32(1, beg_35509);\n                        \n                        loopres_35523 = res_35526;\n                        loopres_35524 = res_35527;\n                        loopres_35525 = end_35510;\n                    } else {\n                        int32_t res_35528 = mem_39868[sext_i32_i64(end_35510)];\n                        int32_t res_35529 = sub32(end_35510, 1);\n                        \n                        loopres_35523 = res_35528;\n                        loopres_35524 = beg_35509;\n                        loopres_35525 = res_35529;\n                    }\n                    mem_39925[sext_i32_i64(i_35506)] = loopres_35523;\n                    mem_39927[sext_i32_i64(i_35506)] = loopres_35522;\n                    \n                    int32_t beg_tmp_40447 = loopres_35524;\n                    int32_t end_tmp_40448 = loopres_35525;\n                    \n                    beg_35509 = beg_tmp_40447;\n                    end_35",
            "510 = end_tmp_40448;\n                }\n                res_35504 = beg_35509;\n                res_35505 = end_35510;\n                for (int32_t i_40449 = 0; i_40449 < 8; i_40449++) {\n                    ((__global\n                      int32_t *) double_buffer_mem_40110)[sext_i32_i64(phys_tid_35287) +\n                                                          sext_i32_i64(i_40449) *\n                                                          sext_i32_i64(num_groups_35414 *\n                                                          segmap_group_sizze_35413)] =\n                        mem_39925[sext_i32_i64(i_40449)];\n                }\n                for (int32_t i_40450 = 0; i_40450 < 8; i_40450++) {\n                    ((__global\n                      float *) double_buffer_mem_40111)[sext_i32_i64(phys_tid_35287) +\n                                                        sext_i32_i64(i_40450) *\n                                                        sext_i32_i64(num_groups_35414 *\n                                                        segmap_group_sizze_35413)] =\n                        mem_39927[sext_i32_i64(i_40450)];\n                }\n            }\n            for (int32_t i_40451 = 0; i_40451 < 8; i_40451++) {\n                ((__global int32_t *) mem_39983)[sext_i32_i64(i_40451) *\n                                                 sext_i32_i64(nc_31615) +\n                                                 sext_i32_i64(gtid_35286)] =\n                    ((__global\n                      int32_t *) double_buffer_mem_40110)[sext_i32_i64(phys_tid_35287) +\n                                                          sext_i32_i64(i_40451) *\n                                                          sext_i32_i64(num_groups_35414 *\n                                                          segmap_group_sizze_35413)];\n            }\n            for (int32_t i_40452 = 0; i_40452 < 8; i_40452++) {\n                ((__global float *) mem_39987)[sext_i32_i64(i_40452) *\n                ",
            "                               sext_i32_i64(nc_31615) +\n                                               sext_i32_i64(gtid_35286)] =\n                    ((__global\n                      float *) double_buffer_mem_40111)[sext_i32_i64(phys_tid_35287) +\n                                                        sext_i32_i64(i_40452) *\n                                                        sext_i32_i64(num_groups_35414 *\n                                                        segmap_group_sizze_35413)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_35413\n}\n__kernel void propagateFixKzisegmap_35593(__global int *global_failure,\n                                          int failure_is_an_option, __global\n                                          int *global_failure_args,\n                                          int32_t m_31574, int32_t n_31578,\n                                          __global\n                                          unsigned char *indir_mem_39419,\n                                          __global unsigned char *mem_39428,\n                                          int32_t ctx_val_39482, __global\n                                          unsigned char *mem_40042)\n{\n    #define segmap_group_sizze_35639 (propagateFixKzisegmap_group_sizze_35598)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40455;\n    int32_t local_tid_40456;\n    int32_t group_sizze_40459;\n    int32_t wave_sizze_40458;\n    int32_t group_tid_40457;\n    \n    global_tid_40455 = get_global_id(0);\n    local_tid_40456 = get_local_id(0);\n    group_sizze_40459 = get_local_size(0);\n    wave_sizze_40458 = LOCKSTEP_WIDTH;\n    group_tid_40457 = get_group_id(0);\n    \n    int32_t phys_tid_35593;\n    \n    phys_tid_35593 = global_tid_40455;\n    \n    int32_t gtid_35591;\n    \n    gti",
            "d_35591 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40457) *\n                                      sext_i32_i64(segmap_group_sizze_35639) +\n                                      sext_i32_i64(local_tid_40456), 8));\n    \n    int32_t gtid_35592;\n    \n    gtid_35592 = sext_i64_i32(sext_i32_i64(group_tid_40457) *\n        sext_i32_i64(segmap_group_sizze_35639) + sext_i32_i64(local_tid_40456) -\n        squot64(sext_i32_i64(group_tid_40457) *\n                sext_i32_i64(segmap_group_sizze_35639) +\n                sext_i32_i64(local_tid_40456), 8) * 8);\n    if (slt32(gtid_35591, n_31578) && slt32(gtid_35592, 8)) {\n        int32_t binop_x_39287 = 8 * gtid_35591;\n        int32_t binop_x_39288 = gtid_35592 + binop_x_39287;\n        int32_t new_index_39290 = squot32(binop_x_39288, ctx_val_39482);\n        int32_t binop_y_39298 = new_index_39290 * ctx_val_39482;\n        int32_t binop_x_39299 = binop_x_39288 - binop_y_39298;\n        int32_t new_index_39300 = squot32(binop_x_39299, 8);\n        int32_t binop_y_39320 = 8 * new_index_39300;\n        int32_t new_index_39321 = binop_x_39299 - binop_y_39320;\n        int32_t x_35644 = ((__global\n                            int32_t *) mem_39428)[sext_i32_i64(new_index_39290) *\n                                                  sext_i32_i64(ctx_val_39482) +\n                                                  sext_i32_i64(new_index_39300) *\n                                                  8 +\n                                                  sext_i32_i64(new_index_39321)];\n        bool x_35645 = sle32(0, x_35644);\n        bool y_35646 = slt32(x_35644, m_31574);\n        bool bounds_check_35647 = x_35645 && y_35646;\n        bool index_certs_35648;\n        \n        if (!bounds_check_35647) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 76) == -1) {\n                    global_failure_args[0] = x_35644;\n                    global_failure_args[1] = m_31574;\n                    ;\n                }\n                re",
            "turn;\n            }\n        }\n        \n        int32_t res_35649 = ((__global\n                              int32_t *) indir_mem_39419)[sext_i32_i64(x_35644)];\n        \n        ((__global int32_t *) mem_40042)[sext_i32_i64(gtid_35591) * 8 +\n                                         sext_i32_i64(gtid_35592)] = res_35649;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_35639\n}\n__kernel void propagateFixKzisegmap_intragroup_34910(__global\n                                                     int *global_failure,\n                                                     int failure_is_an_option,\n                                                     __global\n                                                     int *global_failure_args,\n                                                     uint red_arr_mem_40396_backing_offset_0,\n                                                     uint red_arr_mem_40394_backing_offset_1,\n                                                     uint mem_39767_backing_offset_2,\n                                                     uint mem_39765_backing_offset_3,\n                                                     uint mem_39722_backing_offset_4,\n                                                     uint mem_39718_backing_offset_5,\n                                                     uint mem_39716_backing_offset_6,\n                                                     int32_t d_31575,\n                                                     int32_t nr_31586,\n                                                     int32_t nc_31615,\n                                                     int32_t num_leaves_31627,\n                                                     int32_t ppl_31631,\n                                                     int32_t i_31649, __global\n                                                     unsigned char *ref_pts_mem_39418,\n                                                     __global\n                                          ",
            "           unsigned char *mem_39450,\n                                                     __global\n                                                     unsigned char *mem_39511,\n                                                     __global\n                                                     unsigned char *mem_39515,\n                                                     __global\n                                                     unsigned char *mem_39679,\n                                                     __global\n                                                     unsigned char *mem_39683,\n                                                     __global\n                                                     unsigned char *mem_39823,\n                                                     __global\n                                                     unsigned char *mem_39827,\n                                                     __global\n                                                     unsigned char *double_buffer_mem_40104,\n                                                     __global\n                                                     unsigned char *double_buffer_mem_40105)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *red_arr_mem_40396_backing_6 =\n                  &shared_mem[red_arr_mem_40396_backing_offset_0];\n    volatile char *red_arr_mem_40394_backing_5 =\n                  &shared_mem[red_arr_mem_40394_backing_offset_1];\n    volatile char *mem_39767_backing_4 =\n                  &shared_mem[mem_39767_backing_offset_2];\n    volatile char *mem_39765_backing_3 =\n                  &shared_mem[mem_39765_backing_offset_3];\n    volatile char *mem_39722_backing_2 =\n                  &shared_mem[mem_39722_backing_offset_4];\n    volatile char *mem_39718_backing_1 =\n                  &shared_mem[mem_39718_backing_offset_5];\n    volatile char *mem_39716_backing_0 =\n                  &shared_mem[mem_39716_ba",
            "cking_offset_6];\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40376;\n    int32_t local_tid_40377;\n    int32_t group_sizze_40380;\n    int32_t wave_sizze_40379;\n    int32_t group_tid_40378;\n    \n    global_tid_40376 = get_global_id(0);\n    local_tid_40377 = get_local_id(0);\n    group_sizze_40380 = get_local_size(0);\n    wave_sizze_40379 = LOCKSTEP_WIDTH;\n    group_tid_40378 = get_group_id(0);\n    \n    int32_t phys_tid_34910;\n    \n    phys_tid_34910 = group_tid_40378;\n    \n    int32_t ltid_pre_40381;\n    \n    ltid_pre_40381 = local_tid_40377;\n    \n    int32_t gtid_34894;\n    \n    gtid_34894 = group_tid_40378;\n    \n    int32_t x_35166;\n    \n    x_35166 = ((__global int32_t *) mem_39511)[sext_i32_i64(gtid_34894)];\n    \n    __local char *mem_39716;\n    \n    mem_39716 = (__local char *) mem_39716_backing_0;\n    \n    __local char *mem_39718;\n    \n    mem_39718 = (__local char *) mem_39718_backing_1;\n    \n    __local char *mem_39722;\n    \n    mem_39722 = (__local char *) mem_39722_backing_2;\n    \n    __local char *mem_39765;\n    \n    mem_39765 = (__local char *) mem_39765_backing_3;\n    \n    __local char *mem_39767;\n    \n    mem_39767 = (__local char *) mem_39767_backing_4;\n    for (int32_t i_40382 = 0; i_40382 < sdiv_up32(8 - local_tid_40377,\n                                                  ppl_31631); i_40382++) {\n        ((__global\n          int32_t *) double_buffer_mem_40104)[sext_i32_i64(phys_tid_34910 * 8) +\n                                              sext_i32_i64(i_40382 * ppl_31631 +\n                                              local_tid_40377)] = ((__global\n                                                                    int32_t *) mem_39679)[sext_i32_i64(gtid_34894) +\n                                                                           ",
            "               sext_i32_i64(i_40382 *\n                                                                                          ppl_31631 +\n                                                                                          local_tid_40377) *\n                                                                                          sext_i32_i64(nc_31615)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_40383 = 0; i_40383 < sdiv_up32(8 - local_tid_40377,\n                                                  ppl_31631); i_40383++) {\n        ((__global\n          float *) double_buffer_mem_40105)[sext_i32_i64(phys_tid_34910 * 8) +\n                                            sext_i32_i64(i_40383 * ppl_31631 +\n                                            local_tid_40377)] = ((__global\n                                                                  float *) mem_39683)[sext_i32_i64(gtid_34894) +\n                                                                                      sext_i32_i64(i_40383 *\n                                                                                      ppl_31631 +\n                                                                                      local_tid_40377) *\n                                                                                      sext_i32_i64(nc_31615)];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t q_35175 = 0; q_35175 < x_35166; q_35175++) {\n        int32_t i_35178 = q_35175;\n        bool x_35179 = sle32(0, i_35178);\n        bool y_35180 = slt32(i_35178, 8);\n        bool bounds_check_35181 = x_35179 && y_35180;\n        bool index_certs_35182;\n        \n        if (!bounds_check_35181) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 64) == -1) {\n                    global_failure_args[0] = i_35178;\n                    global_failure_args[1] = 8;\n                    ;\n                }\n                local_failure = true;\n                goto error_0;\n        ",
            "    }\n        }\n        \n        int32_t leaf_ind_35183 = ((__global\n                                   int32_t *) mem_39515)[sext_i32_i64(i_35178) *\n                                                         sext_i32_i64(nc_31615) +\n                                                         sext_i32_i64(gtid_34894)];\n        int32_t bruteForcePar_arg_35184 = mul32(ppl_31631, leaf_ind_35183);\n        bool x_35185 = sle32(0, leaf_ind_35183);\n        bool y_35186 = slt32(leaf_ind_35183, num_leaves_31627);\n        bool bounds_check_35187 = x_35185 && y_35186;\n        bool index_certs_35188;\n        \n        if (!bounds_check_35187) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 65) == -1) {\n                    global_failure_args[0] = leaf_ind_35183;\n                    global_failure_args[1] = num_leaves_31627;\n                    ;\n                }\n                local_failure = true;\n                goto error_0;\n            }\n        }\n        for (int32_t i_40386 = 0; i_40386 < sdiv_up32(8 - local_tid_40377,\n                                                      ppl_31631); i_40386++) {\n            ((__local int32_t *) mem_39716)[sext_i32_i64(i_40386 * ppl_31631 +\n                                            local_tid_40377)] = ((__global\n                                                                  int32_t *) double_buffer_mem_40104)[sext_i32_i64(phys_tid_34910 *\n                                                                                                      8) +\n                                                                                                      sext_i32_i64(i_40386 *\n                                                                                                      ppl_31631 +\n                                                                                                      local_tid_40377)];\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_40387 = 0; i_40387 < sdiv_up32(8 - loc",
            "al_tid_40377,\n                                                      ppl_31631); i_40387++) {\n            ((__local float *) mem_39718)[sext_i32_i64(i_40387 * ppl_31631 +\n                                          local_tid_40377)] = ((__global\n                                                                float *) double_buffer_mem_40105)[sext_i32_i64(phys_tid_34910 *\n                                                                                                  8) +\n                                                                                                  sext_i32_i64(i_40387 *\n                                                                                                  ppl_31631 +\n                                                                                                  local_tid_40377)];\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t gtid_34897 = ltid_pre_40381;\n        int32_t phys_tid_34898 = local_tid_40377;\n        \n        if (slt32(gtid_34897, ppl_31631)) {\n            float res_35194;\n            float res_35196 = 0.0F;\n            float x_35197;\n            float y_35198;\n            \n            for (int32_t i_35195 = 0; i_35195 < d_31575; i_35195++) {\n                x_35197 = ((__global float *) mem_39450)[sext_i32_i64(i_31649 *\n                                                         nc_31615 +\n                                                         gtid_34894) +\n                                                         sext_i32_i64(i_35195) *\n                                                         sext_i32_i64(nc_31615 *\n                                                         nr_31586)];\n                y_35198 = ((__global\n                            float *) ref_pts_mem_39418)[sext_i32_i64(leaf_ind_35183 *\n                                                        (d_31575 * ppl_31631) +\n                                                        gtid_34897 * d_31575) +\n                                      ",
            "                  sext_i32_i64(i_35195)];\n                \n                float zz_35199;\n                \n                zz_35199 = x_35197 - y_35198;\n                \n                float y_35200 = zz_35199 * zz_35199;\n                float loopres_35201 = res_35196 + y_35200;\n                float res_tmp_40388 = loopres_35201;\n                \n                res_35196 = res_tmp_40388;\n            }\n            res_35194 = res_35196;\n            ((__local float *) mem_39722)[sext_i32_i64(gtid_34897)] = res_35194;\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        bool knn_35202;\n        int32_t knn_35206;\n        bool loop_while_35207;\n        int32_t j_35211;\n        \n        loop_while_35207 = 1;\n        j_35211 = 0;\n        while (loop_while_35207) {\n            int32_t res_35212;\n            float res_35213;\n            int32_t gtid_34908 = ltid_pre_40381;\n            int32_t phys_tid_34909 = local_tid_40377;\n            __local char *red_arr_mem_40394;\n            \n            red_arr_mem_40394 = (__local char *) red_arr_mem_40394_backing_5;\n            \n            __local char *red_arr_mem_40396;\n            \n            red_arr_mem_40396 = (__local char *) red_arr_mem_40396_backing_6;\n            if (slt32(gtid_34908, ppl_31631)) {\n                float x_35227 = ((__local\n                                  float *) mem_39722)[sext_i32_i64(gtid_34908)];\n                \n                ((__local\n                  int32_t *) red_arr_mem_40394)[sext_i32_i64(gtid_34908)] =\n                    gtid_34908;\n                ((__local\n                  float *) red_arr_mem_40396)[sext_i32_i64(gtid_34908)] =\n                    x_35227;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int32_t offset_40398;\n            int32_t skip_waves_40399;\n            int32_t x_35214;\n            float x_35215;\n          ",
            "  int32_t x_35216;\n            float x_35217;\n            \n            offset_40398 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_40377, ppl_31631)) {\n                    x_35214 = ((__local\n                                int32_t *) red_arr_mem_40394)[sext_i32_i64(local_tid_40377 +\n                                                              offset_40398)];\n                    x_35215 = ((__local\n                                float *) red_arr_mem_40396)[sext_i32_i64(local_tid_40377 +\n                                                            offset_40398)];\n                }\n            }\n            offset_40398 = 1;\n            while (slt32(offset_40398, wave_sizze_40379)) {\n                if (slt32(local_tid_40377 + offset_40398, ppl_31631) &&\n                    ((local_tid_40377 - squot32(local_tid_40377,\n                                                wave_sizze_40379) *\n                      wave_sizze_40379) & (2 * offset_40398 - 1)) == 0) {\n                    // read array element\n                    {\n                        x_35216 = ((volatile __local\n                                    int32_t *) red_arr_mem_40394)[sext_i32_i64(local_tid_40377 +\n                                                                  offset_40398)];\n                        x_35217 = ((volatile __local\n                                    float *) red_arr_mem_40396)[sext_i32_i64(local_tid_40377 +\n                                                                offset_40398)];\n                    }\n                    // apply reduction operation\n                    {\n                        bool cond_35218 = x_35215 < x_35217;\n                        int32_t res_35219;\n                        float res_35220;\n                        \n                        if (cond_35218) {\n                            res_35219 = x_35214;\n                            res_35220 = x_35215;\n                        } else {",
            "\n                            bool cond_35221 = x_35217 < x_35215;\n                            float res_35222;\n                            \n                            if (cond_35221) {\n                                res_35222 = x_35217;\n                            } else {\n                                res_35222 = x_35215;\n                            }\n                            \n                            int32_t res_35223;\n                            \n                            if (cond_35221) {\n                                res_35223 = x_35216;\n                            } else {\n                                bool cond_35224 = sle32(x_35214, x_35216);\n                                int32_t res_35225;\n                                \n                                if (cond_35224) {\n                                    res_35225 = x_35214;\n                                } else {\n                                    res_35225 = x_35216;\n                                }\n                                res_35223 = res_35225;\n                            }\n                            res_35219 = res_35223;\n                            res_35220 = res_35222;\n                        }\n                        x_35214 = res_35219;\n                        x_35215 = res_35220;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          int32_t *) red_arr_mem_40394)[sext_i32_i64(local_tid_40377)] =\n                            x_35214;\n                        ((volatile __local\n                          float *) red_arr_mem_40396)[sext_i32_i64(local_tid_40377)] =\n                            x_35215;\n                    }\n                }\n                offset_40398 *= 2;\n            }\n            skip_waves_40399 = 1;\n            while (slt32(skip_waves_40399, squot32(ppl_31631 +\n                                                   wave_sizze_40379 - 1,\n           ",
            "                                        wave_sizze_40379))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_40398 = skip_waves_40399 * wave_sizze_40379;\n                if (slt32(local_tid_40377 + offset_40398, ppl_31631) &&\n                    ((local_tid_40377 - squot32(local_tid_40377,\n                                                wave_sizze_40379) *\n                      wave_sizze_40379) == 0 && (squot32(local_tid_40377,\n                                                         wave_sizze_40379) &\n                                                 (2 * skip_waves_40399 - 1)) ==\n                     0)) {\n                    // read array element\n                    {\n                        x_35216 = ((__local\n                                    int32_t *) red_arr_mem_40394)[sext_i32_i64(local_tid_40377 +\n                                                                  offset_40398)];\n                        x_35217 = ((__local\n                                    float *) red_arr_mem_40396)[sext_i32_i64(local_tid_40377 +\n                                                                offset_40398)];\n                    }\n                    // apply reduction operation\n                    {\n                        bool cond_35218 = x_35215 < x_35217;\n                        int32_t res_35219;\n                        float res_35220;\n                        \n                        if (cond_35218) {\n                            res_35219 = x_35214;\n                            res_35220 = x_35215;\n                        } else {\n                            bool cond_35221 = x_35217 < x_35215;\n                            float res_35222;\n                            \n                            if (cond_35221) {\n                                res_35222 = x_35217;\n                            } else {\n                                res_35222 = x_35215;\n                            }\n                            \n                            int3",
            "2_t res_35223;\n                            \n                            if (cond_35221) {\n                                res_35223 = x_35216;\n                            } else {\n                                bool cond_35224 = sle32(x_35214, x_35216);\n                                int32_t res_35225;\n                                \n                                if (cond_35224) {\n                                    res_35225 = x_35214;\n                                } else {\n                                    res_35225 = x_35216;\n                                }\n                                res_35223 = res_35225;\n                            }\n                            res_35219 = res_35223;\n                            res_35220 = res_35222;\n                        }\n                        x_35214 = res_35219;\n                        x_35215 = res_35220;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          int32_t *) red_arr_mem_40394)[sext_i32_i64(local_tid_40377)] =\n                            x_35214;\n                        ((__local\n                          float *) red_arr_mem_40396)[sext_i32_i64(local_tid_40377)] =\n                            x_35215;\n                    }\n                }\n                skip_waves_40399 *= 2;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            res_35212 = ((__local int32_t *) red_arr_mem_40394)[0];\n            res_35213 = ((__local float *) red_arr_mem_40396)[0];\n            \n            int32_t i_35228 = sub32(7, j_35211);\n            bool x_35229 = sle32(0, i_35228);\n            bool y_35230 = slt32(i_35228, 8);\n            bool bounds_check_35231 = x_35229 && y_35230;\n            bool index_certs_35232;\n            \n            if (!bounds_check_35231) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 66) ==\n                        -1) {\n              ",
            "          global_failure_args[0] = i_35228;\n                        global_failure_args[1] = 8;\n                        ;\n                    }\n                    local_failure = true;\n                    goto error_3;\n                }\n            }\n            \n            float y_35233 = ((__local\n                              float *) mem_39718)[sext_i32_i64(i_35228)];\n            bool cond_35234 = res_35213 < y_35233;\n            int32_t loopres_35238;\n            \n            if (cond_35234) {\n                bool x_35239 = sle32(0, res_35212);\n                bool y_35240 = slt32(res_35212, ppl_31631);\n                bool bounds_check_35241 = x_35239 && y_35240;\n                bool index_certs_35242;\n                \n                if (!bounds_check_35241) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 67) ==\n                            -1) {\n                            global_failure_args[0] = res_35212;\n                            global_failure_args[1] = ppl_31631;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_3;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                if (local_tid_40377 == 0) {\n                    ((__local float *) mem_39722)[sext_i32_i64(res_35212)] =\n                        INFINITY;\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                int32_t lw_val_35244 = add32(bruteForcePar_arg_35184,\n                                             res_35212);\n                \n                barrier(CLK_LOCAL_MEM_FENCE);\n                if (local_tid_40377 == 0) {\n                    ((__local int32_t *) mem_39716)[sext_i32_i64(i_35228)] =\n                        lw_val_35244;\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                barrier(CLK_LOCAL_MEM_FENCE);\n                if (local_tid_4037",
            "7 == 0) {\n                    ((__local float *) mem_39718)[sext_i32_i64(i_35228)] =\n                        res_35213;\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                int32_t res_35247 = add32(1, j_35211);\n                \n                loopres_35238 = res_35247;\n            } else {\n                loopres_35238 = j_35211;\n            }\n            \n            bool res_35248 = slt32(loopres_35238, 8);\n            bool x_35249 = cond_35234 && res_35248;\n            bool loop_while_tmp_40389 = x_35249;\n            int32_t j_tmp_40393 = loopres_35238;\n            \n            loop_while_35207 = loop_while_tmp_40389;\n            j_35211 = j_tmp_40393;\n        }\n        knn_35202 = loop_while_35207;\n        knn_35206 = j_35211;\n        for (int32_t i_40400 = 0; i_40400 < sdiv_up32(8 - local_tid_40377,\n                                                      ppl_31631); i_40400++) {\n            ((__local int32_t *) mem_39765)[sext_i32_i64(i_40400 * ppl_31631 +\n                                            local_tid_40377)] = -1;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_40401 = 0; i_40401 < sdiv_up32(8 - local_tid_40377,\n                                                      ppl_31631); i_40401++) {\n            ((__local float *) mem_39767)[sext_i32_i64(i_40401 * ppl_31631 +\n                                          local_tid_40377)] = INFINITY;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t res_35254;\n        int32_t res_35255;\n        int32_t beg_35259;\n        int32_t end_35260;\n        \n        beg_35259 = 0;\n        end_35260 = 7;\n        for (int32_t i_35256 = 0; i_35256 < 8; i_35256++) {\n            bool x_35261 = sle32(0, beg_35259);\n            bool y_35262 = slt32(beg_35259, 8);\n            bool bounds_check_35263 = x_35261 && y_35262;\n            bool index_certs_35264;\n            \n            if (!bounds_check_35263) {\n                {\n                    i",
            "f (atomic_cmpxchg_i32_global(global_failure, -1, 68) ==\n                        -1) {\n                        global_failure_args[0] = beg_35259;\n                        global_failure_args[1] = 8;\n                        ;\n                    }\n                    local_failure = true;\n                    goto error_3;\n                }\n            }\n            \n            float x_35265 = ((__local\n                              float *) mem_39718)[sext_i32_i64(beg_35259)];\n            bool x_35266 = sle32(0, end_35260);\n            bool y_35267 = slt32(end_35260, 8);\n            bool bounds_check_35268 = x_35266 && y_35267;\n            bool index_certs_35269;\n            \n            if (!bounds_check_35268) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 69) ==\n                        -1) {\n                        global_failure_args[0] = end_35260;\n                        global_failure_args[1] = 8;\n                        ;\n                    }\n                    local_failure = true;\n                    goto error_3;\n                }\n            }\n            \n            float y_35270 = ((__local\n                              float *) mem_39718)[sext_i32_i64(end_35260)];\n            bool cond_35271 = x_35265 < y_35270;\n            float loopres_35272;\n            \n            if (cond_35271) {\n                loopres_35272 = x_35265;\n            } else {\n                loopres_35272 = y_35270;\n            }\n            \n            int32_t loopres_35273;\n            int32_t loopres_35274;\n            int32_t loopres_35275;\n            \n            if (cond_35271) {\n                int32_t res_35276 = ((__local\n                                      int32_t *) mem_39716)[sext_i32_i64(beg_35259)];\n                int32_t res_35277 = add32(1, beg_35259);\n                \n                loopres_35273 = res_35276;\n                loopres_35274 = res_35277;\n                loopres_35275 = end_35260;\n            } else ",
            "{\n                int32_t res_35278 = ((__local\n                                      int32_t *) mem_39716)[sext_i32_i64(end_35260)];\n                int32_t res_35279 = sub32(end_35260, 1);\n                \n                loopres_35273 = res_35278;\n                loopres_35274 = beg_35259;\n                loopres_35275 = res_35279;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_40377 == 0) {\n                ((__local int32_t *) mem_39765)[sext_i32_i64(i_35256)] =\n                    loopres_35273;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_40377 == 0) {\n                ((__local float *) mem_39767)[sext_i32_i64(i_35256)] =\n                    loopres_35272;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            int32_t beg_tmp_40404 = loopres_35274;\n            int32_t end_tmp_40405 = loopres_35275;\n            \n            beg_35259 = beg_tmp_40404;\n            end_35260 = end_tmp_40405;\n        }\n        res_35254 = beg_35259;\n        res_35255 = end_35260;\n        for (int32_t i_40406 = 0; i_40406 < sdiv_up32(8 - local_tid_40377,\n                                                      ppl_31631); i_40406++) {\n            ((__global\n              int32_t *) double_buffer_mem_40104)[sext_i32_i64(phys_tid_34910 *\n                                                  8) + sext_i32_i64(i_40406 *\n                                                  ppl_31631 +\n                                                  local_tid_40377)] = ((__local\n                                                                        int32_t *) mem_39765)[sext_i32_i64(i_40406 *\n                                                                                              ppl_31631 +\n                                                                                              local_tid_40377)];\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t",
            " i_40407 = 0; i_40407 < sdiv_up32(8 - local_tid_40377,\n                                                      ppl_31631); i_40407++) {\n            ((__global\n              float *) double_buffer_mem_40105)[sext_i32_i64(phys_tid_34910 *\n                                                8) + sext_i32_i64(i_40407 *\n                                                ppl_31631 + local_tid_40377)] =\n                ((__local float *) mem_39767)[sext_i32_i64(i_40407 * ppl_31631 +\n                                              local_tid_40377)];\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n    }\n    if (local_tid_40377 == 0) {\n        for (int32_t i_40408 = 0; i_40408 < 8; i_40408++) {\n            ((__global int32_t *) mem_39823)[sext_i32_i64(gtid_34894) * 8 +\n                                             sext_i32_i64(i_40408)] = ((__global\n                                                                        int32_t *) double_buffer_mem_40104)[sext_i32_i64(phys_tid_34910 *\n                                                                                                            8) +\n                                                                                                            sext_i32_i64(i_40408)];\n        }\n    }\n    if (local_tid_40377 == 0) {\n        for (int32_t i_40409 = 0; i_40409 < 8; i_40409++) {\n            ((__global float *) mem_39827)[sext_i32_i64(gtid_34894) * 8 +\n                                           sext_i32_i64(i_40409)] = ((__global\n                                                                      float *) double_buffer_mem_40105)[sext_i32_i64(phys_tid_34910 *\n                                                                                                        8) +\n                                                                                                        sext_i32_i64(i_40409)];\n        }\n    }\n    \n  error_3:\n    return;\n}\n__kernel void reducePatchDimzisegmap_33764(__global int *global_failure,\n                          ",
            "                 int32_t n_30993, int32_t d_30994,\n                                           int32_t d_red_30995, int32_t d_30996,\n                                           int32_t num_groups_33788, __global\n                                           unsigned char *comps_mem_39419,\n                                           __global\n                                           unsigned char *means_mem_39420,\n                                           __global unsigned char *mem_39424,\n                                           __global unsigned char *mem_39428,\n                                           __global unsigned char *mem_39445)\n{\n    #define segmap_group_sizze_33787 (reducePatchDimzisegmap_group_sizze_33767)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40300;\n    int32_t local_tid_40301;\n    int32_t group_sizze_40304;\n    int32_t wave_sizze_40303;\n    int32_t group_tid_40302;\n    \n    global_tid_40300 = get_global_id(0);\n    local_tid_40301 = get_local_id(0);\n    group_sizze_40304 = get_local_size(0);\n    wave_sizze_40303 = LOCKSTEP_WIDTH;\n    group_tid_40302 = get_group_id(0);\n    \n    int32_t phys_tid_33764;\n    \n    phys_tid_33764 = global_tid_40300;\n    \n    int32_t phys_group_id_40305;\n    \n    phys_group_id_40305 = get_group_id(0);\n    for (int32_t i_40306 = 0; i_40306 < sdiv_up32(sdiv_up32(n_30993,\n                                                            segmap_group_sizze_33787) -\n                                                  phys_group_id_40305,\n                                                  num_groups_33788);\n         i_40306++) {\n        int32_t virt_group_id_40307 = phys_group_id_40305 + i_40306 *\n                num_groups_33788;\n        int32_t gtid_33763 = sext_i64_i32(sext_i32_i64(virt_group_id_40307) *\n                sext_i32_i64(segmap_group_sizze_33787) +\n                sext_i32_i64(local_tid_40301)",
            ");\n        \n        if (slt32(gtid_33763, n_30993)) {\n            for (int32_t i_39355 = 0; i_39355 < d_red_30995; i_39355++) {\n                float res_33794;\n                float redout_39357 = 0.0F;\n                \n                for (int32_t i_39358 = 0; i_39358 < d_30994; i_39358++) {\n                    int8_t x_33798 = ((__global\n                                       int8_t *) mem_39424)[sext_i32_i64(i_39358) *\n                                                            sext_i32_i64(n_30993) +\n                                                            sext_i32_i64(gtid_33763)];\n                    float x_33799 = ((__global\n                                      float *) comps_mem_39419)[sext_i32_i64(i_39355) *\n                                                                sext_i32_i64(d_30996) +\n                                                                sext_i32_i64(i_39358)];\n                    float x_33800 = ((__global\n                                      float *) means_mem_39420)[sext_i32_i64(i_39358)];\n                    float res_33801 = uitofp_i8_f32(x_33798);\n                    float x_33802 = res_33801 - x_33800;\n                    float res_33803 = x_33799 * x_33802;\n                    float res_33797 = res_33803 + redout_39357;\n                    float redout_tmp_40309 = res_33797;\n                    \n                    redout_39357 = redout_tmp_40309;\n                }\n                res_33794 = redout_39357;\n                ((__global float *) mem_39428)[sext_i32_i64(phys_tid_33764) +\n                                               sext_i32_i64(i_39355) *\n                                               sext_i32_i64(num_groups_33788 *\n                                               segmap_group_sizze_33787)] =\n                    res_33794;\n            }\n            for (int32_t i_40310 = 0; i_40310 < d_red_30995; i_40310++) {\n                ((__global float *) mem_39445)[sext_i32_i64(i_40310) *\n                                ",
            "               sext_i32_i64(n_30993) +\n                                               sext_i32_i64(gtid_33763)] =\n                    ((__global\n                      float *) mem_39428)[sext_i32_i64(phys_tid_33764) +\n                                          sext_i32_i64(i_40310) *\n                                          sext_i32_i64(num_groups_33788 *\n                                          segmap_group_sizze_33787)];\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_33787\n}\n__kernel void reducePatchDimzisegmap_33806(__global int *global_failure,\n                                           int32_t n_30993, int32_t d_30994,\n                                           int32_t d_red_30995, __global\n                                           unsigned char *img_mem_39418,\n                                           __global\n                                           unsigned char *means_mem_39420,\n                                           __global unsigned char *mem_39450,\n                                           __global unsigned char *mem_39456)\n{\n    #define segmap_group_sizze_33884 (reducePatchDimzisegmap_group_sizze_33811)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40311;\n    int32_t local_tid_40312;\n    int32_t group_sizze_40315;\n    int32_t wave_sizze_40314;\n    int32_t group_tid_40313;\n    \n    global_tid_40311 = get_global_id(0);\n    local_tid_40312 = get_local_id(0);\n    group_sizze_40315 = get_local_size(0);\n    wave_sizze_40314 = LOCKSTEP_WIDTH;\n    group_tid_40313 = get_group_id(0);\n    \n    int32_t phys_tid_33806;\n    \n    phys_tid_33806 = global_tid_40311;\n    \n    int32_t gtid_33804;\n    \n    gtid_33804 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40313) *\n                                      sext_i32_i64(segmap_group_siz",
            "ze_33884) +\n                                      sext_i32_i64(local_tid_40312),\n                                      sext_i32_i64(d_red_30995)));\n    \n    int32_t gtid_33805;\n    \n    gtid_33805 = sext_i64_i32(sext_i32_i64(group_tid_40313) *\n        sext_i32_i64(segmap_group_sizze_33884) + sext_i32_i64(local_tid_40312) -\n        squot64(sext_i32_i64(group_tid_40313) *\n                sext_i32_i64(segmap_group_sizze_33884) +\n                sext_i32_i64(local_tid_40312), sext_i32_i64(d_red_30995)) *\n        sext_i32_i64(d_red_30995));\n    if (slt32(gtid_33804, n_30993) && slt32(gtid_33805, d_red_30995)) {\n        float res_33895;\n        float redout_39359 = 0.0F;\n        \n        for (int32_t i_39360 = 0; i_39360 < d_30994; i_39360++) {\n            int8_t x_33899 = ((__global\n                               int8_t *) img_mem_39418)[sext_i32_i64(gtid_33804) *\n                                                        sext_i32_i64(d_30994) +\n                                                        sext_i32_i64(i_39360)];\n            float x_33900 = ((__global\n                              float *) mem_39450)[sext_i32_i64(i_39360) *\n                                                  sext_i32_i64(d_red_30995) +\n                                                  sext_i32_i64(gtid_33805)];\n            float x_33901 = ((__global\n                              float *) means_mem_39420)[sext_i32_i64(i_39360)];\n            float res_33902 = uitofp_i8_f32(x_33899);\n            float x_33903 = res_33902 - x_33901;\n            float res_33904 = x_33900 * x_33903;\n            float res_33898 = res_33904 + redout_39359;\n            float redout_tmp_40316 = res_33898;\n            \n            redout_39359 = redout_tmp_40316;\n        }\n        res_33895 = redout_39359;\n        ((__global float *) mem_39456)[sext_i32_i64(gtid_33804) *\n                                       sext_i32_i64(d_red_30995) +\n                                       sext_i32_i64(gtid_33805)] = res_33895;\n    }\n    \n ",
            " error_0:\n    return;\n    #undef segmap_group_sizze_33884\n}\n__kernel void reducePatchDimzisegred_large_33846(__global int *global_failure,\n                                                 uint sync_arr_mem_40353_backing_offset_0,\n                                                 uint red_arr_mem_40351_backing_offset_1,\n                                                 int32_t d_30994,\n                                                 int32_t d_red_30995,\n                                                 int32_t d_30996,\n                                                 int32_t num_groups_33912,\n                                                 __global\n                                                 unsigned char *img_mem_39418,\n                                                 __global\n                                                 unsigned char *comps_mem_39419,\n                                                 __global\n                                                 unsigned char *means_mem_39420,\n                                                 __global\n                                                 unsigned char *mem_39462,\n                                                 int32_t groups_per_segment_40337,\n                                                 int32_t elements_per_thread_40338,\n                                                 int32_t virt_num_groups_40339,\n                                                 int32_t threads_per_segment_40341,\n                                                 __global\n                                                 unsigned char *group_res_arr_mem_40342,\n                                                 __global\n                                                 unsigned char *reducePatchDimzicounter_mem_40344)\n{\n    #define segred_group_sizze_33911 (reducePatchDimzisegred_group_sizze_33840)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *sync_arr_mem_40353_backi",
            "ng_1 =\n                  &shared_mem[sync_arr_mem_40353_backing_offset_0];\n    volatile char *red_arr_mem_40351_backing_0 =\n                  &shared_mem[red_arr_mem_40351_backing_offset_1];\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40346;\n    int32_t local_tid_40347;\n    int32_t group_sizze_40350;\n    int32_t wave_sizze_40349;\n    int32_t group_tid_40348;\n    \n    global_tid_40346 = get_global_id(0);\n    local_tid_40347 = get_local_id(0);\n    group_sizze_40350 = get_local_size(0);\n    wave_sizze_40349 = LOCKSTEP_WIDTH;\n    group_tid_40348 = get_group_id(0);\n    \n    int32_t phys_tid_33846;\n    \n    phys_tid_33846 = global_tid_40346;\n    \n    __local char *red_arr_mem_40351;\n    \n    red_arr_mem_40351 = (__local char *) red_arr_mem_40351_backing_0;\n    \n    __local char *sync_arr_mem_40353;\n    \n    sync_arr_mem_40353 = (__local char *) sync_arr_mem_40353_backing_1;\n    \n    int32_t phys_group_id_40355;\n    \n    phys_group_id_40355 = get_group_id(0);\n    for (int32_t i_40356 = 0; i_40356 < sdiv_up32(virt_num_groups_40339 -\n                                                  phys_group_id_40355,\n                                                  num_groups_33912);\n         i_40356++) {\n        int32_t virt_group_id_40357 = phys_group_id_40355 + i_40356 *\n                num_groups_33912;\n        int32_t flat_segment_id_40358 = squot32(virt_group_id_40357,\n                                                groups_per_segment_40337);\n        int32_t global_tid_40359 = srem32(virt_group_id_40357 *\n                                          segred_group_sizze_33911 +\n                                          local_tid_40347,\n                                          segred_group_sizze_33911 *\n                                          groups_per_segment_40337);\n        int32_t gtid_33832 = squot32(flat_segment_id_40358, d_red_30995);\n        int32_t gtid_33833 = flat_segment_id_40358 -\n                squot32(flat_segment_id_40358, d_red_3099",
            "5) * d_red_30995;\n        int32_t gtid_33845;\n        float x_acc_40360;\n        int32_t chunk_sizze_40361;\n        \n        chunk_sizze_40361 = smin32(elements_per_thread_40338,\n                                   sdiv_up32(d_30994 - global_tid_40359,\n                                             threads_per_segment_40341));\n        \n        float x_33915;\n        float x_33916;\n        \n        // neutral-initialise the accumulators\n        {\n            x_acc_40360 = 0.0F;\n        }\n        for (int32_t i_40365 = 0; i_40365 < chunk_sizze_40361; i_40365++) {\n            gtid_33845 = global_tid_40359 + threads_per_segment_40341 * i_40365;\n            // apply map function\n            {\n                int8_t x_33920 = ((__global\n                                   int8_t *) img_mem_39418)[sext_i32_i64(gtid_33832) *\n                                                            sext_i32_i64(d_30994) +\n                                                            sext_i32_i64(gtid_33845)];\n                float x_33921 = ((__global\n                                  float *) comps_mem_39419)[sext_i32_i64(gtid_33833) *\n                                                            sext_i32_i64(d_30996) +\n                                                            sext_i32_i64(gtid_33845)];\n                float x_33922 = ((__global\n                                  float *) means_mem_39420)[sext_i32_i64(gtid_33845)];\n                float res_33923 = uitofp_i8_f32(x_33920);\n                float x_33924 = res_33923 - x_33922;\n                float res_33925 = x_33921 * x_33924;\n                \n                // save map-out results\n                { }\n                // load accumulator\n                {\n                    x_33915 = x_acc_40360;\n                }\n                // load new values\n                {\n                    x_33916 = res_33925;\n                }\n                // apply reduction operator\n                {\n                    float res_33917 = x_339",
            "15 + x_33916;\n                    \n                    // store in accumulator\n                    {\n                        x_acc_40360 = res_33917;\n                    }\n                }\n            }\n        }\n        // to reduce current chunk, first store our result in memory\n        {\n            x_33915 = x_acc_40360;\n            ((__local\n              float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347)] =\n                x_33915;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_40366;\n        int32_t skip_waves_40367;\n        float x_40362;\n        float x_40363;\n        \n        offset_40366 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_40347, segred_group_sizze_33911)) {\n                x_40362 = ((__local\n                            float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347 +\n                                                        offset_40366)];\n            }\n        }\n        offset_40366 = 1;\n        while (slt32(offset_40366, wave_sizze_40349)) {\n            if (slt32(local_tid_40347 + offset_40366,\n                      segred_group_sizze_33911) && ((local_tid_40347 -\n                                                     squot32(local_tid_40347,\n                                                             wave_sizze_40349) *\n                                                     wave_sizze_40349) & (2 *\n                                                                          offset_40366 -\n                                                                          1)) ==\n                0) {\n                // read array element\n                {\n                    x_40363 = ((volatile __local\n                                float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347 +\n                                                            offset_40366)];\n                }\n                // apply reduction operation\n                {\n     ",
            "               float res_40364 = x_40362 + x_40363;\n                    \n                    x_40362 = res_40364;\n                }\n                // write result of operation\n                {\n                    ((volatile __local\n                      float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347)] =\n                        x_40362;\n                }\n            }\n            offset_40366 *= 2;\n        }\n        skip_waves_40367 = 1;\n        while (slt32(skip_waves_40367, squot32(segred_group_sizze_33911 +\n                                               wave_sizze_40349 - 1,\n                                               wave_sizze_40349))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_40366 = skip_waves_40367 * wave_sizze_40349;\n            if (slt32(local_tid_40347 + offset_40366,\n                      segred_group_sizze_33911) && ((local_tid_40347 -\n                                                     squot32(local_tid_40347,\n                                                             wave_sizze_40349) *\n                                                     wave_sizze_40349) == 0 &&\n                                                    (squot32(local_tid_40347,\n                                                             wave_sizze_40349) &\n                                                     (2 * skip_waves_40367 -\n                                                      1)) == 0)) {\n                // read array element\n                {\n                    x_40363 = ((__local\n                                float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347 +\n                                                            offset_40366)];\n                }\n                // apply reduction operation\n                {\n                    float res_40364 = x_40362 + x_40363;\n                    \n                    x_40362 = res_40364;\n                }\n                // write result of operation\n                {\n                   ",
            " ((__local\n                      float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347)] =\n                        x_40362;\n                }\n            }\n            skip_waves_40367 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // first thread saves the result in accumulator\n        {\n            if (local_tid_40347 == 0) {\n                x_acc_40360 = x_40362;\n            }\n        }\n        if (groups_per_segment_40337 == 1) {\n            // first thread in group saves final result to memory\n            {\n                if (local_tid_40347 == 0) {\n                    ((__global float *) mem_39462)[sext_i32_i64(gtid_33832) *\n                                                   sext_i32_i64(d_red_30995) +\n                                                   sext_i32_i64(gtid_33833)] =\n                        x_acc_40360;\n                }\n            }\n        } else {\n            int32_t old_counter_40368;\n            \n            // first thread in group saves group result to global memory\n            {\n                if (local_tid_40347 == 0) {\n                    ((__global\n                      float *) group_res_arr_mem_40342)[sext_i32_i64(virt_group_id_40357) *\n                                                        sext_i32_i64(segred_group_sizze_33911)] =\n                        x_acc_40360;\n                    mem_fence_global();\n                    old_counter_40368 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) reducePatchDimzicounter_mem_40344)[sext_i64_i32(sext_i32_i64(srem32(flat_segment_id_40358,\n                                                                                                                            10240)))],\n                                              (int) 1);\n                    ((__local bool *) sync_arr_mem_40353)[0] =\n                        old_counter_40368 == groups_per_segment_40337 - 1;\n                }\n            }\n  ",
            "          barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            \n            bool is_last_group_40369;\n            \n            is_last_group_40369 = ((__local bool *) sync_arr_mem_40353)[0];\n            if (is_last_group_40369) {\n                if (local_tid_40347 == 0) {\n                    old_counter_40368 =\n                        atomic_add_i32_global(&((volatile __global\n                                                 int *) reducePatchDimzicounter_mem_40344)[sext_i64_i32(sext_i32_i64(srem32(flat_segment_id_40358,\n                                                                                                                            10240)))],\n                                              (int) (0 -\n                                                     groups_per_segment_40337));\n                }\n                // read in the per-group-results\n                {\n                    int32_t read_per_thread_40370 =\n                            sdiv_up32(groups_per_segment_40337,\n                                      segred_group_sizze_33911);\n                    \n                    x_33915 = 0.0F;\n                    for (int32_t i_40371 = 0; i_40371 < read_per_thread_40370;\n                         i_40371++) {\n                        int32_t group_res_id_40372 = local_tid_40347 *\n                                read_per_thread_40370 + i_40371;\n                        int32_t index_of_group_res_40373 =\n                                flat_segment_id_40358 *\n                                groups_per_segment_40337 + group_res_id_40372;\n                        \n                        if (slt32(group_res_id_40372,\n                                  groups_per_segment_40337)) {\n                            x_33916 = ((__global\n                                        float *) group_res_arr_mem_40342)[sext_i32_i64(index_of_group_res_40373) *\n                                                                          sext_i32_i64(segred_group_sizze_33911",
            ")];\n                            \n                            float res_33917;\n                            \n                            res_33917 = x_33915 + x_33916;\n                            x_33915 = res_33917;\n                        }\n                    }\n                }\n                ((__local\n                  float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347)] =\n                    x_33915;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-group results\n                {\n                    int32_t offset_40374;\n                    int32_t skip_waves_40375;\n                    float x_40362;\n                    float x_40363;\n                    \n                    offset_40374 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_40347, segred_group_sizze_33911)) {\n                            x_40362 = ((__local\n                                        float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347 +\n                                                                    offset_40374)];\n                        }\n                    }\n                    offset_40374 = 1;\n                    while (slt32(offset_40374, wave_sizze_40349)) {\n                        if (slt32(local_tid_40347 + offset_40374,\n                                  segred_group_sizze_33911) &&\n                            ((local_tid_40347 - squot32(local_tid_40347,\n                                                        wave_sizze_40349) *\n                              wave_sizze_40349) & (2 * offset_40374 - 1)) ==\n                            0) {\n                            // read array element\n                            {\n                                x_40363 = ((volatile __local\n                                            float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347 +\n                                                                   ",
            "     offset_40374)];\n                            }\n                            // apply reduction operation\n                            {\n                                float res_40364 = x_40362 + x_40363;\n                                \n                                x_40362 = res_40364;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347)] =\n                                    x_40362;\n                            }\n                        }\n                        offset_40374 *= 2;\n                    }\n                    skip_waves_40375 = 1;\n                    while (slt32(skip_waves_40375,\n                                 squot32(segred_group_sizze_33911 +\n                                         wave_sizze_40349 - 1,\n                                         wave_sizze_40349))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_40374 = skip_waves_40375 * wave_sizze_40349;\n                        if (slt32(local_tid_40347 + offset_40374,\n                                  segred_group_sizze_33911) &&\n                            ((local_tid_40347 - squot32(local_tid_40347,\n                                                        wave_sizze_40349) *\n                              wave_sizze_40349) == 0 &&\n                             (squot32(local_tid_40347, wave_sizze_40349) & (2 *\n                                                                            skip_waves_40375 -\n                                                                            1)) ==\n                             0)) {\n                            // read array element\n                            {\n                                x_40363 = ((__local\n                                            float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347 +",
            "\n                                                                        offset_40374)];\n                            }\n                            // apply reduction operation\n                            {\n                                float res_40364 = x_40362 + x_40363;\n                                \n                                x_40362 = res_40364;\n                            }\n                            // write result of operation\n                            {\n                                ((__local\n                                  float *) red_arr_mem_40351)[sext_i32_i64(local_tid_40347)] =\n                                    x_40362;\n                            }\n                        }\n                        skip_waves_40375 *= 2;\n                    }\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_40347 == 0) {\n                            ((__global\n                              float *) mem_39462)[sext_i32_i64(gtid_33832) *\n                                                  sext_i32_i64(d_red_30995) +\n                                                  sext_i32_i64(gtid_33833)] =\n                                x_40362;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_33911\n}\n__kernel void reducePatchDimzisegred_small_33846(__global int *global_failure,\n                                                 uint red_arr_mem_40324_backing_offset_0,\n                                                 int32_t n_30993,\n                                                 int32_t d_30994,\n                                                 int32_t d_red_30995,\n                                                 int32_t d_30996,\n                                                 int32_t num_groups_33912,\n                             ",
            "                    __global\n                                                 unsigned char *img_mem_39418,\n                                                 __global\n                                                 unsigned char *comps_mem_39419,\n                                                 __global\n                                                 unsigned char *means_mem_39420,\n                                                 __global\n                                                 unsigned char *mem_39462,\n                                                 int32_t segment_sizze_nonzzero_40317)\n{\n    #define segred_group_sizze_33911 (reducePatchDimzisegred_group_sizze_33840)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *red_arr_mem_40324_backing_0 =\n                  &shared_mem[red_arr_mem_40324_backing_offset_0];\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40319;\n    int32_t local_tid_40320;\n    int32_t group_sizze_40323;\n    int32_t wave_sizze_40322;\n    int32_t group_tid_40321;\n    \n    global_tid_40319 = get_global_id(0);\n    local_tid_40320 = get_local_id(0);\n    group_sizze_40323 = get_local_size(0);\n    wave_sizze_40322 = LOCKSTEP_WIDTH;\n    group_tid_40321 = get_group_id(0);\n    \n    int32_t phys_tid_33846;\n    \n    phys_tid_33846 = global_tid_40319;\n    \n    __local char *red_arr_mem_40324;\n    \n    red_arr_mem_40324 = (__local char *) red_arr_mem_40324_backing_0;\n    \n    int32_t phys_group_id_40326;\n    \n    phys_group_id_40326 = get_group_id(0);\n    for (int32_t i_40327 = 0; i_40327 < sdiv_up32(sdiv_up32(n_30993 *\n                                                            d_red_30995,\n                                                            squot32(segred_group_sizze_33911,\n                                                                    segment_sizze_nonzzero_40317)) -\n                                                  phys_group_id_40326,\n ",
            "                                                 num_groups_33912);\n         i_40327++) {\n        int32_t virt_group_id_40328 = phys_group_id_40326 + i_40327 *\n                num_groups_33912;\n        int32_t gtid_33832 = squot32(squot32(local_tid_40320,\n                                             segment_sizze_nonzzero_40317) +\n                                     virt_group_id_40328 *\n                                     squot32(segred_group_sizze_33911,\n                                             segment_sizze_nonzzero_40317),\n                                     d_red_30995);\n        int32_t gtid_33833 = squot32(local_tid_40320,\n                                     segment_sizze_nonzzero_40317) +\n                virt_group_id_40328 * squot32(segred_group_sizze_33911,\n                                              segment_sizze_nonzzero_40317) -\n                squot32(squot32(local_tid_40320, segment_sizze_nonzzero_40317) +\n                        virt_group_id_40328 * squot32(segred_group_sizze_33911,\n                                                      segment_sizze_nonzzero_40317),\n                        d_red_30995) * d_red_30995;\n        int32_t gtid_33845 = srem32(local_tid_40320, d_30994);\n        \n        // apply map function if in bounds\n        {\n            if (slt32(0, d_30994) && ((slt32(gtid_33832, n_30993) &&\n                                       slt32(gtid_33833, d_red_30995)) &&\n                                      slt32(local_tid_40320, d_30994 *\n                                            squot32(segred_group_sizze_33911,\n                                                    segment_sizze_nonzzero_40317)))) {\n                int8_t x_33920 = ((__global\n                                   int8_t *) img_mem_39418)[sext_i32_i64(gtid_33832) *\n                                                            sext_i32_i64(d_30994) +\n                                                            sext_i32_i64(gtid_33845)];\n                float x_33921 = (",
            "(__global\n                                  float *) comps_mem_39419)[sext_i32_i64(gtid_33833) *\n                                                            sext_i32_i64(d_30996) +\n                                                            sext_i32_i64(gtid_33845)];\n                float x_33922 = ((__global\n                                  float *) means_mem_39420)[sext_i32_i64(gtid_33845)];\n                float res_33923 = uitofp_i8_f32(x_33920);\n                float x_33924 = res_33923 - x_33922;\n                float res_33925 = x_33921 * x_33924;\n                \n                // save map-out results\n                { }\n                // save results to be reduced\n                {\n                    ((__local\n                      float *) red_arr_mem_40324)[sext_i32_i64(local_tid_40320)] =\n                        res_33925;\n                }\n            } else {\n                ((__local\n                  float *) red_arr_mem_40324)[sext_i32_i64(local_tid_40320)] =\n                    0.0F;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt32(0, d_30994)) {\n            // perform segmented scan to imitate reduction\n            {\n                float x_33915;\n                float x_33916;\n                float x_40329;\n                float x_40330;\n                int32_t skip_threads_40332;\n                \n                // read input for in-block scan\n                {\n                    if (slt32(local_tid_40320, d_30994 *\n                              squot32(segred_group_sizze_33911,\n                                      segment_sizze_nonzzero_40317))) {\n                        x_33916 = ((volatile __local\n                                    float *) red_arr_mem_40324)[sext_i32_i64(local_tid_40320)];\n                        if ((local_tid_40320 - squot32(local_tid_40320, 32) *\n                             32) == 0) {\n                            x_33915 = x_33916;\n                        }\n                    }\n    ",
            "            }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_40332 = 1;\n                    while (slt32(skip_threads_40332, 32)) {\n                        if (sle32(skip_threads_40332, local_tid_40320 -\n                                  squot32(local_tid_40320, 32) * 32) &&\n                            slt32(local_tid_40320, d_30994 *\n                                  squot32(segred_group_sizze_33911,\n                                          segment_sizze_nonzzero_40317))) {\n                            // read operands\n                            {\n                                x_33915 = ((volatile __local\n                                            float *) red_arr_mem_40324)[sext_i32_i64(local_tid_40320 -\n                                                                        skip_threads_40332)];\n                            }\n                            // perform operation\n                            {\n                                bool inactive_40333 =\n                                     slt32(srem32(local_tid_40320, d_30994),\n                                           local_tid_40320 - (local_tid_40320 -\n                                                              skip_threads_40332));\n                                \n                                if (inactive_40333) {\n                                    x_33915 = x_33916;\n                                }\n                                if (!inactive_40333) {\n                                    float res_33917 = x_33915 + x_33916;\n                                    \n                                    x_33915 = res_33917;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_40322, skip_threads_40332)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (sle32(skip_threads_40332, local_tid_403",
            "20 -\n                                  squot32(local_tid_40320, 32) * 32) &&\n                            slt32(local_tid_40320, d_30994 *\n                                  squot32(segred_group_sizze_33911,\n                                          segment_sizze_nonzzero_40317))) {\n                            // write result\n                            {\n                                ((volatile __local\n                                  float *) red_arr_mem_40324)[sext_i32_i64(local_tid_40320)] =\n                                    x_33915;\n                                x_33916 = x_33915;\n                            }\n                        }\n                        if (sle32(wave_sizze_40322, skip_threads_40332)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_40332 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_40320 - squot32(local_tid_40320, 32) * 32) ==\n                        31 && slt32(local_tid_40320, d_30994 *\n                                    squot32(segred_group_sizze_33911,\n                                            segment_sizze_nonzzero_40317))) {\n                        ((volatile __local\n                          float *) red_arr_mem_40324)[sext_i32_i64(squot32(local_tid_40320,\n                                                                           32))] =\n                            x_33915;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_40334;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_40320, 32) == 0 &&\n ",
            "                           slt32(local_tid_40320, d_30994 *\n                                  squot32(segred_group_sizze_33911,\n                                          segment_sizze_nonzzero_40317))) {\n                            x_40330 = ((volatile __local\n                                        float *) red_arr_mem_40324)[sext_i32_i64(local_tid_40320)];\n                            if ((local_tid_40320 - squot32(local_tid_40320,\n                                                           32) * 32) == 0) {\n                                x_40329 = x_40330;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_40334 = 1;\n                        while (slt32(skip_threads_40334, 32)) {\n                            if (sle32(skip_threads_40334, local_tid_40320 -\n                                      squot32(local_tid_40320, 32) * 32) &&\n                                (squot32(local_tid_40320, 32) == 0 &&\n                                 slt32(local_tid_40320, d_30994 *\n                                       squot32(segred_group_sizze_33911,\n                                               segment_sizze_nonzzero_40317)))) {\n                                // read operands\n                                {\n                                    x_40329 = ((volatile __local\n                                                float *) red_arr_mem_40324)[sext_i32_i64(local_tid_40320 -\n                                                                            skip_threads_40334)];\n                                }\n                                // perform operation\n                                {\n                                    bool inactive_40335 =\n                                         slt32(srem32(local_tid_40320 * 32 +\n                                                      32 - 1, d_30994),\n                               ",
            "                local_tid_40320 * 32 + 32 - 1 -\n                                               ((local_tid_40320 -\n                                                 skip_threads_40334) * 32 + 32 -\n                                                1));\n                                    \n                                    if (inactive_40335) {\n                                        x_40329 = x_40330;\n                                    }\n                                    if (!inactive_40335) {\n                                        float res_40331 = x_40329 + x_40330;\n                                        \n                                        x_40329 = res_40331;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_40322, skip_threads_40334)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (sle32(skip_threads_40334, local_tid_40320 -\n                                      squot32(local_tid_40320, 32) * 32) &&\n                                (squot32(local_tid_40320, 32) == 0 &&\n                                 slt32(local_tid_40320, d_30994 *\n                                       squot32(segred_group_sizze_33911,\n                                               segment_sizze_nonzzero_40317)))) {\n                                // write result\n                                {\n                                    ((volatile __local\n                                      float *) red_arr_mem_40324)[sext_i32_i64(local_tid_40320)] =\n                                        x_40329;\n                                    x_40330 = x_40329;\n                                }\n                            }\n                            if (sle32(wave_sizze_40322, skip_threads_40334)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            sk",
            "ip_threads_40334 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // carry-in for every block except the first\n                {\n                    if (!(squot32(local_tid_40320, 32) == 0 ||\n                          !slt32(local_tid_40320, d_30994 *\n                                 squot32(segred_group_sizze_33911,\n                                         segment_sizze_nonzzero_40317)))) {\n                        // read operands\n                        {\n                            x_33916 = x_33915;\n                            x_33915 = ((__local\n                                        float *) red_arr_mem_40324)[sext_i32_i64(squot32(local_tid_40320,\n                                                                                         32) -\n                                                                    1)];\n                        }\n                        // perform operation\n                        {\n                            bool inactive_40336 = slt32(srem32(local_tid_40320,\n                                                               d_30994),\n                                                        local_tid_40320 -\n                                                        (squot32(local_tid_40320,\n                                                                 32) * 32 - 1));\n                            \n                            if (inactive_40336) {\n                                x_33915 = x_33916;\n                            }\n                            if (!inactive_40336) {\n                                float res_33917 = x_33915 + x_33916;\n                                \n                                x_33915 = res_33917;\n                            }\n                        }\n                        // write final result\n                        {\n                            ((__local\n                              float *) red_arr_mem_40324)[sext_i3",
            "2_i64(local_tid_40320)] =\n                                x_33915;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_40320, 32) == 0) {\n                        ((__local\n                          float *) red_arr_mem_40324)[sext_i32_i64(local_tid_40320)] =\n                            x_33916;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt32(virt_group_id_40328 * squot32(segred_group_sizze_33911,\n                                                    segment_sizze_nonzzero_40317) +\n                      local_tid_40320, n_30993 * d_red_30995) &&\n                slt32(local_tid_40320, squot32(segred_group_sizze_33911,\n                                               segment_sizze_nonzzero_40317))) {\n                ((__global\n                  float *) mem_39462)[sext_i32_i64(squot32(virt_group_id_40328 *\n                                                           squot32(segred_group_sizze_33911,\n                                                                   segment_sizze_nonzzero_40317) +\n                                                           local_tid_40320,\n                                                           d_red_30995)) *\n                                      sext_i32_i64(d_red_30995) +\n                                      sext_i32_i64(virt_group_id_40328 *\n                                      squot32(segred_group_sizze_33911,\n                                              segment_sizze_nonzzero_40317) +\n                                      local_tid_40320 -\n                                      squot32(virt_group_id_40328 *\n                                              squot32(segred_group_sizze_33911,\n  ",
            "                                                    segment_sizze_nonzzero_40317) +\n                                              local_tid_40320, d_red_30995) *\n                                      d_red_30995)] = ((__local\n                                                        float *) red_arr_mem_40324)[sext_i32_i64((local_tid_40320 +\n                                                                                                  1) *\n                                                                                    segment_sizze_nonzzero_40317 -\n                                                                                    1)];\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_33911\n}\n__kernel void selectBestNNzisegmap_32876(__global int *global_failure,\n                                         int failure_is_an_option, __global\n                                         int *global_failure_args,\n                                         int32_t n_30870, int32_t h1_30872,\n                                         int32_t w1_30873, int32_t c_30874,\n                                         int32_t h2_30875, int32_t w2_30876,\n                                         int32_t c_30877, int32_t p_30878,\n                                         int32_t n_colsA_30887,\n                                         int32_t n_colsB_30889,\n                                         int32_t patch_len_30891,\n                                         int32_t segmap_usable_groups_33466,\n                                         __global unsigned char *imgA_mem_39419,\n                                         __global unsigned char *imgB_mem_39420,\n                                         __global unsigned char *mem_39454,\n                                         __global unsigned char *mem_39458,\n                                         __global uns",
            "igned char *mem_39473,\n                                         __global unsigned char *mem_39476,\n                                         __global unsigned char *mem_39479)\n{\n    #define segmap_group_sizze_33463 (selectBestNNzisegmap_group_sizze_32879)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40336;\n    int32_t local_tid_40337;\n    int32_t group_sizze_40340;\n    int32_t wave_sizze_40339;\n    int32_t group_tid_40338;\n    \n    global_tid_40336 = get_global_id(0);\n    local_tid_40337 = get_local_id(0);\n    group_sizze_40340 = get_local_size(0);\n    wave_sizze_40339 = LOCKSTEP_WIDTH;\n    group_tid_40338 = get_group_id(0);\n    \n    int32_t phys_tid_32876;\n    \n    phys_tid_32876 = global_tid_40336;\n    \n    int32_t gtid_32875;\n    \n    gtid_32875 = sext_i64_i32(sext_i32_i64(group_tid_40338) *\n        sext_i32_i64(segmap_group_sizze_33463) + sext_i32_i64(local_tid_40337));\n    if (slt32(gtid_32875, n_30870)) {\n        int32_t y_33472 = sdiv32(gtid_32875, n_colsA_30887);\n        int32_t y_33473 = mul32(n_colsA_30887, y_33472);\n        int32_t x_33474 = sub32(gtid_32875, y_33473);\n        \n        for (int32_t i_39359 = 0; i_39359 < patch_len_30891; i_39359++) {\n            int32_t ij_33477 = sdiv32(i_39359, c_30874);\n            int32_t y_33478 = mul32(c_30874, ij_33477);\n            int32_t k_33479 = sub32(i_39359, y_33478);\n            int32_t i_33480 = sdiv32(ij_33477, p_30878);\n            int32_t y_33481 = mul32(p_30878, i_33480);\n            int32_t j_33482 = sub32(ij_33477, y_33481);\n            int32_t i_33483 = add32(y_33472, i_33480);\n            bool x_33484 = sle32(0, i_33483);\n            bool y_33485 = slt32(i_33483, h1_30872);\n            bool bounds_check_33486 = x_33484 && y_33485;\n            int32_t i_33487 = add32(x_33474, j_33482);\n            bool x_33488 = sle32(0, i_33487);\n            bool y_33489 = slt32(i_33487, w",
            "1_30873);\n            bool bounds_check_33490 = x_33488 && y_33489;\n            bool x_33491 = sle32(0, k_33479);\n            bool y_33492 = slt32(k_33479, c_30874);\n            bool bounds_check_33493 = x_33491 && y_33492;\n            bool y_33494 = bounds_check_33486 && bounds_check_33493;\n            bool index_ok_33495 = bounds_check_33490 && y_33494;\n            bool index_certs_33496;\n            \n            if (!index_ok_33495) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 79) ==\n                        -1) {\n                        global_failure_args[0] = i_33483;\n                        global_failure_args[1] = i_33487;\n                        global_failure_args[2] = k_33479;\n                        global_failure_args[3] = h1_30872;\n                        global_failure_args[4] = w1_30873;\n                        global_failure_args[5] = c_30874;\n                        ;\n                    }\n                    return;\n                }\n            }\n            \n            int32_t i32_arg_33497 = ((__global\n                                      int32_t *) imgA_mem_39419)[sext_i32_i64(i_33483) *\n                                                                 sext_i32_i64(c_30874 *\n                                                                 w1_30873) +\n                                                                 sext_i32_i64(i_33487) *\n                                                                 sext_i32_i64(c_30874) +\n                                                                 sext_i32_i64(k_33479)];\n            float res_33498 = sitofp_i32_f32(i32_arg_33497);\n            \n            ((__global float *) mem_39458)[sext_i32_i64(phys_tid_32876) +\n                                           sext_i32_i64(i_39359) *\n                                           sext_i32_i64(segmap_usable_groups_33466 *\n                                           segmap_group_sizze_33463)] =\n                res_33",
            "498;\n        }\n        \n        int32_t res_33499;\n        float res_33500;\n        int32_t nn_ind_33502;\n        float nn_dst_33503;\n        \n        nn_ind_33502 = -1;\n        nn_dst_33503 = INFINITY;\n        for (int32_t q_33501 = 0; q_33501 < 8; q_33501++) {\n            int32_t indB_33504 = ((__global\n                                   int32_t *) mem_39454)[sext_i32_i64(q_33501) *\n                                                         sext_i32_i64(n_30870) +\n                                                         sext_i32_i64(gtid_32875)];\n            int32_t ii_33505 = sdiv32(indB_33504, n_colsB_30889);\n            int32_t y_33506 = mul32(n_colsB_30889, ii_33505);\n            int32_t jj_33507 = sub32(indB_33504, y_33506);\n            float res_33508;\n            float redout_39288 = 0.0F;\n            \n            for (int32_t i_39289 = 0; i_39289 < patch_len_30891; i_39289++) {\n                int32_t ij_33513 = sdiv32(i_39289, c_30874);\n                int32_t y_33514 = mul32(c_30874, ij_33513);\n                int32_t k_33515 = sub32(i_39289, y_33514);\n                int32_t i_33516 = sdiv32(ij_33513, p_30878);\n                int32_t y_33517 = mul32(p_30878, i_33516);\n                int32_t j_33518 = sub32(ij_33513, y_33517);\n                int32_t i_33519 = add32(ii_33505, i_33516);\n                bool x_33520 = sle32(0, i_33519);\n                bool y_33521 = slt32(i_33519, h2_30875);\n                bool bounds_check_33522 = x_33520 && y_33521;\n                int32_t i_33523 = add32(jj_33507, j_33518);\n                bool x_33524 = sle32(0, i_33523);\n                bool y_33525 = slt32(i_33523, w2_30876);\n                bool bounds_check_33526 = x_33524 && y_33525;\n                bool x_33527 = sle32(0, k_33515);\n                bool y_33528 = slt32(k_33515, c_30874);\n                bool bounds_check_33529 = x_33527 && y_33528;\n                bool y_33530 = bounds_check_33522 && bounds_check_33529;\n                bool index_ok_33531 = boun",
            "ds_check_33526 && y_33530;\n                bool index_certs_33532;\n                \n                if (!index_ok_33531) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 80) ==\n                            -1) {\n                            global_failure_args[0] = i_33519;\n                            global_failure_args[1] = i_33523;\n                            global_failure_args[2] = k_33515;\n                            global_failure_args[3] = h2_30875;\n                            global_failure_args[4] = w2_30876;\n                            global_failure_args[5] = c_30874;\n                            ;\n                        }\n                        return;\n                    }\n                }\n                \n                int32_t i32_arg_33533 = ((__global\n                                          int32_t *) imgB_mem_39420)[sext_i32_i64(i_33519) *\n                                                                     sext_i32_i64(c_30877 *\n                                                                     w2_30876) +\n                                                                     sext_i32_i64(i_33523) *\n                                                                     sext_i32_i64(c_30877) +\n                                                                     sext_i32_i64(k_33515)];\n                float res_33534 = sitofp_i32_f32(i32_arg_33533);\n                float a_v_33539 = ((__global\n                                    float *) mem_39458)[sext_i32_i64(phys_tid_32876) +\n                                                        sext_i32_i64(i_39289) *\n                                                        sext_i32_i64(segmap_usable_groups_33466 *\n                                                        segmap_group_sizze_33463)];\n                float d_33540 = res_33534 - a_v_33539;\n                float res_33541 = d_33540 * d_33540;\n                float res_33511 = res_33541 + redout_39288",
            ";\n                float redout_tmp_40344 = res_33511;\n                \n                redout_39288 = redout_tmp_40344;\n            }\n            res_33508 = redout_39288;\n            \n            float dst_33542 = res_33508;\n            bool cond_33543 = res_33508 < nn_dst_33503;\n            int32_t loopres_33544;\n            \n            if (cond_33543) {\n                loopres_33544 = indB_33504;\n            } else {\n                loopres_33544 = nn_ind_33502;\n            }\n            \n            float loopres_33545;\n            \n            if (cond_33543) {\n                loopres_33545 = dst_33542;\n            } else {\n                loopres_33545 = nn_dst_33503;\n            }\n            \n            int32_t nn_ind_tmp_40342 = loopres_33544;\n            float nn_dst_tmp_40343 = loopres_33545;\n            \n            nn_ind_33502 = nn_ind_tmp_40342;\n            nn_dst_33503 = nn_dst_tmp_40343;\n        }\n        res_33499 = nn_ind_33502;\n        res_33500 = nn_dst_33503;\n        ((__global float *) mem_39473)[sext_i32_i64(gtid_32875)] = res_33500;\n        ((__global int32_t *) mem_39476)[sext_i32_i64(gtid_32875)] = res_33499;\n        ((__global float *) mem_39479)[sext_i32_i64(gtid_32875)] = res_33500;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_33463\n}\n__kernel void selectBestNNzisegmap_33132(__global int *global_failure,\n                                         int failure_is_an_option, __global\n                                         int *global_failure_args,\n                                         int32_t n_30870, int32_t c_30874,\n                                         int32_t h2_30875, int32_t w2_30876,\n                                         int32_t c_30877, int32_t p_30878,\n                                         int32_t n_colsB_30889,\n                                         int32_t patch_len_30891, __global\n                                         unsigned char *imgB_mem_39420, __global\n                                 ",
            "        unsigned char *mem_39510, __global\n                                         unsigned char *mem_39515, __global\n                                         unsigned char *mem_39519, __global\n                                         unsigned char *mem_39522, __global\n                                         unsigned char *mem_39525)\n{\n    #define segmap_group_sizze_33688 (selectBestNNzisegmap_group_sizze_33135)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40362;\n    int32_t local_tid_40363;\n    int32_t group_sizze_40366;\n    int32_t wave_sizze_40365;\n    int32_t group_tid_40364;\n    \n    global_tid_40362 = get_global_id(0);\n    local_tid_40363 = get_local_id(0);\n    group_sizze_40366 = get_local_size(0);\n    wave_sizze_40365 = LOCKSTEP_WIDTH;\n    group_tid_40364 = get_group_id(0);\n    \n    int32_t phys_tid_33132;\n    \n    phys_tid_33132 = global_tid_40362;\n    \n    int32_t gtid_33131;\n    \n    gtid_33131 = sext_i64_i32(sext_i32_i64(group_tid_40364) *\n        sext_i32_i64(segmap_group_sizze_33688) + sext_i32_i64(local_tid_40363));\n    if (slt32(gtid_33131, n_30870)) {\n        int32_t res_33697;\n        float res_33698;\n        int32_t nn_ind_33700;\n        float nn_dst_33701;\n        \n        nn_ind_33700 = -1;\n        nn_dst_33701 = INFINITY;\n        for (int32_t q_33699 = 0; q_33699 < 8; q_33699++) {\n            int32_t indB_33702 = ((__global\n                                   int32_t *) mem_39510)[sext_i32_i64(q_33699) *\n                                                         sext_i32_i64(n_30870) +\n                                                         sext_i32_i64(gtid_33131)];\n            int32_t ii_33703 = sdiv32(indB_33702, n_colsB_30889);\n            int32_t y_33704 = mul32(n_colsB_30889, ii_33703);\n            int32_t jj_33705 = sub32(indB_33702, y_33704);\n            float res_33706;\n            float redout_39312 = 0.0F;\n",
            "            \n            for (int32_t i_39313 = 0; i_39313 < patch_len_30891; i_39313++) {\n                int32_t ij_33711 = sdiv32(i_39313, c_30874);\n                int32_t y_33712 = mul32(c_30874, ij_33711);\n                int32_t k_33713 = sub32(i_39313, y_33712);\n                int32_t i_33714 = sdiv32(ij_33711, p_30878);\n                int32_t y_33715 = mul32(p_30878, i_33714);\n                int32_t j_33716 = sub32(ij_33711, y_33715);\n                int32_t i_33717 = add32(ii_33703, i_33714);\n                bool x_33718 = sle32(0, i_33717);\n                bool y_33719 = slt32(i_33717, h2_30875);\n                bool bounds_check_33720 = x_33718 && y_33719;\n                int32_t i_33721 = add32(jj_33705, j_33716);\n                bool x_33722 = sle32(0, i_33721);\n                bool y_33723 = slt32(i_33721, w2_30876);\n                bool bounds_check_33724 = x_33722 && y_33723;\n                bool x_33725 = sle32(0, k_33713);\n                bool y_33726 = slt32(k_33713, c_30874);\n                bool bounds_check_33727 = x_33725 && y_33726;\n                bool y_33728 = bounds_check_33720 && bounds_check_33727;\n                bool index_ok_33729 = bounds_check_33724 && y_33728;\n                bool index_certs_33730;\n                \n                if (!index_ok_33729) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 84) ==\n                            -1) {\n                            global_failure_args[0] = i_33717;\n                            global_failure_args[1] = i_33721;\n                            global_failure_args[2] = k_33713;\n                            global_failure_args[3] = h2_30875;\n                            global_failure_args[4] = w2_30876;\n                            global_failure_args[5] = c_30874;\n                            ;\n                        }\n                        return;\n                    }\n                }\n                \n                int32_t i32_a",
            "rg_33731 = ((__global\n                                          int32_t *) imgB_mem_39420)[sext_i32_i64(i_33717) *\n                                                                     sext_i32_i64(c_30877 *\n                                                                     w2_30876) +\n                                                                     sext_i32_i64(i_33721) *\n                                                                     sext_i32_i64(c_30877) +\n                                                                     sext_i32_i64(k_33713)];\n                float res_33732 = sitofp_i32_f32(i32_arg_33731);\n                float a_v_33737 = ((__global\n                                    float *) mem_39515)[sext_i32_i64(i_39313) *\n                                                        sext_i32_i64(n_30870) +\n                                                        sext_i32_i64(gtid_33131)];\n                float d_33738 = res_33732 - a_v_33737;\n                float res_33739 = d_33738 * d_33738;\n                float res_33709 = res_33739 + redout_39312;\n                float redout_tmp_40369 = res_33709;\n                \n                redout_39312 = redout_tmp_40369;\n            }\n            res_33706 = redout_39312;\n            \n            float dst_33740 = res_33706;\n            bool cond_33741 = res_33706 < nn_dst_33701;\n            int32_t loopres_33742;\n            \n            if (cond_33741) {\n                loopres_33742 = indB_33702;\n            } else {\n                loopres_33742 = nn_ind_33700;\n            }\n            \n            float loopres_33743;\n            \n            if (cond_33741) {\n                loopres_33743 = dst_33740;\n            } else {\n                loopres_33743 = nn_dst_33701;\n            }\n            \n            int32_t nn_ind_tmp_40367 = loopres_33742;\n            float nn_dst_tmp_40368 = loopres_33743;\n            \n            nn_ind_33700 = nn_ind_tmp_40367;\n            nn_dst_33701 = nn_dst_tmp_4",
            "0368;\n        }\n        res_33697 = nn_ind_33700;\n        res_33698 = nn_dst_33701;\n        ((__global float *) mem_39519)[sext_i32_i64(gtid_33131)] = res_33698;\n        ((__global int32_t *) mem_39522)[sext_i32_i64(gtid_33131)] = res_33697;\n        ((__global float *) mem_39525)[sext_i32_i64(gtid_33131)] = res_33698;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_33688\n}\n__kernel void selectBestNNzisegmap_33234(__global int *global_failure,\n                                         int failure_is_an_option, __global\n                                         int *global_failure_args,\n                                         int32_t n_30870, int32_t h1_30872,\n                                         int32_t w1_30873, int32_t c_30874,\n                                         int32_t p_30878, int32_t n_colsA_30887,\n                                         int32_t patch_len_30891, __global\n                                         unsigned char *imgA_mem_39419, __global\n                                         unsigned char *mem_39505)\n{\n    #define segmap_group_sizze_33655 (selectBestNNzisegmap_group_sizze_33239)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40357;\n    int32_t local_tid_40358;\n    int32_t group_sizze_40361;\n    int32_t wave_sizze_40360;\n    int32_t group_tid_40359;\n    \n    global_tid_40357 = get_global_id(0);\n    local_tid_40358 = get_local_id(0);\n    group_sizze_40361 = get_local_size(0);\n    wave_sizze_40360 = LOCKSTEP_WIDTH;\n    group_tid_40359 = get_group_id(0);\n    \n    int32_t phys_tid_33234;\n    \n    phys_tid_33234 = global_tid_40357;\n    \n    int32_t gtid_33232;\n    \n    gtid_33232 = sext_i64_i32(squot64(sext_i32_i64(group_tid_40359) *\n                                      sext_i32_i64(segmap_group_sizze_33655) +\n                                      sext_i32_i64(local_tid_40358),\n                       ",
            "               sext_i32_i64(patch_len_30891)));\n    \n    int32_t gtid_33233;\n    \n    gtid_33233 = sext_i64_i32(sext_i32_i64(group_tid_40359) *\n        sext_i32_i64(segmap_group_sizze_33655) + sext_i32_i64(local_tid_40358) -\n        squot64(sext_i32_i64(group_tid_40359) *\n                sext_i32_i64(segmap_group_sizze_33655) +\n                sext_i32_i64(local_tid_40358), sext_i32_i64(patch_len_30891)) *\n        sext_i32_i64(patch_len_30891));\n    if (slt32(gtid_33232, n_30870) && slt32(gtid_33233, patch_len_30891)) {\n        int32_t index_primexp_39311 = sdiv32(gtid_33232, n_colsA_30887);\n        int32_t binop_y_39307 = mul32(n_colsA_30887, index_primexp_39311);\n        int32_t index_primexp_39308 = sub32(gtid_33232, binop_y_39307);\n        int32_t ij_33663 = sdiv32(gtid_33233, c_30874);\n        int32_t y_33664 = mul32(c_30874, ij_33663);\n        int32_t k_33665 = sub32(gtid_33233, y_33664);\n        int32_t i_33666 = sdiv32(ij_33663, p_30878);\n        int32_t y_33667 = mul32(p_30878, i_33666);\n        int32_t j_33668 = sub32(ij_33663, y_33667);\n        int32_t i_33669 = add32(i_33666, index_primexp_39311);\n        bool x_33670 = sle32(0, i_33669);\n        bool y_33671 = slt32(i_33669, h1_30872);\n        bool bounds_check_33672 = x_33670 && y_33671;\n        int32_t i_33673 = add32(j_33668, index_primexp_39308);\n        bool x_33674 = sle32(0, i_33673);\n        bool y_33675 = slt32(i_33673, w1_30873);\n        bool bounds_check_33676 = x_33674 && y_33675;\n        bool x_33677 = sle32(0, k_33665);\n        bool y_33678 = slt32(k_33665, c_30874);\n        bool bounds_check_33679 = x_33677 && y_33678;\n        bool y_33680 = bounds_check_33672 && bounds_check_33679;\n        bool index_ok_33681 = bounds_check_33676 && y_33680;\n        bool index_certs_33682;\n        \n        if (!index_ok_33681) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 83) == -1) {\n                    global_failure_args[0] = i_33669;\n                    global_fail",
            "ure_args[1] = i_33673;\n                    global_failure_args[2] = k_33665;\n                    global_failure_args[3] = h1_30872;\n                    global_failure_args[4] = w1_30873;\n                    global_failure_args[5] = c_30874;\n                    ;\n                }\n                return;\n            }\n        }\n        \n        int32_t i32_arg_33683 = ((__global\n                                  int32_t *) imgA_mem_39419)[sext_i32_i64(i_33669) *\n                                                             sext_i32_i64(c_30874 *\n                                                             w1_30873) +\n                                                             sext_i32_i64(i_33673) *\n                                                             sext_i32_i64(c_30874) +\n                                                             sext_i32_i64(k_33665)];\n        float res_33684 = sitofp_i32_f32(i32_arg_33683);\n        \n        ((__global float *) mem_39505)[sext_i32_i64(gtid_33232) *\n                                       sext_i32_i64(patch_len_30891) +\n                                       sext_i32_i64(gtid_33233)] = res_33684;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_group_sizze_33655\n}\n__kernel void selectBestNNzisegmap_intragroup_32874(__global\n                                                    int *global_failure,\n                                                    int failure_is_an_option,\n                                                    __global\n                                                    int *global_failure_args,\n                                                    uint red_arr_mem_40353_backing_offset_0,\n                                                    uint mem_39489_backing_offset_1,\n                                                    int32_t n_30870,\n                                                    int32_t h1_30872,\n                                                    int32_t w1_30873,\n                               ",
            "                     int32_t c_30874,\n                                                    int32_t h2_30875,\n                                                    int32_t w2_30876,\n                                                    int32_t c_30877,\n                                                    int32_t p_30878,\n                                                    int32_t n_colsA_30887,\n                                                    int32_t n_colsB_30889,\n                                                    int32_t patch_len_30891,\n                                                    __global\n                                                    unsigned char *imgA_mem_39419,\n                                                    __global\n                                                    unsigned char *imgB_mem_39420,\n                                                    __global\n                                                    unsigned char *mem_39484,\n                                                    __global\n                                                    unsigned char *mem_39493,\n                                                    __global\n                                                    unsigned char *mem_39496,\n                                                    __global\n                                                    unsigned char *mem_39499)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *red_arr_mem_40353_backing_1 =\n                  &shared_mem[red_arr_mem_40353_backing_offset_0];\n    volatile char *mem_39489_backing_0 =\n                  &shared_mem[mem_39489_backing_offset_1];\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40345;\n    int32_t local_tid_40346;\n    ",
            "int32_t group_sizze_40349;\n    int32_t wave_sizze_40348;\n    int32_t group_tid_40347;\n    \n    global_tid_40345 = get_global_id(0);\n    local_tid_40346 = get_local_id(0);\n    group_sizze_40349 = get_local_size(0);\n    wave_sizze_40348 = LOCKSTEP_WIDTH;\n    group_tid_40347 = get_group_id(0);\n    \n    int32_t phys_tid_32874;\n    \n    phys_tid_32874 = group_tid_40347;\n    \n    int32_t ltid_pre_40350;\n    \n    ltid_pre_40350 = local_tid_40346;\n    \n    int32_t gtid_32844;\n    \n    gtid_32844 = group_tid_40347;\n    \n    int32_t y_33554;\n    \n    y_33554 = sdiv32(gtid_32844, n_colsA_30887);\n    \n    int32_t y_33555 = mul32(n_colsA_30887, y_33554);\n    int32_t x_33556 = sub32(gtid_32844, y_33555);\n    __local char *mem_39489;\n    \n    mem_39489 = (__local char *) mem_39489_backing_0;\n    \n    int32_t gtid_32847 = ltid_pre_40350;\n    int32_t phys_tid_32848 = local_tid_40346;\n    \n    if (slt32(gtid_32847, patch_len_30891)) {\n        int32_t ij_33559 = sdiv32(gtid_32847, c_30874);\n        int32_t y_33560 = mul32(c_30874, ij_33559);\n        int32_t k_33561 = sub32(gtid_32847, y_33560);\n        int32_t i_33562 = sdiv32(ij_33559, p_30878);\n        int32_t y_33563 = mul32(p_30878, i_33562);\n        int32_t j_33564 = sub32(ij_33559, y_33563);\n        int32_t i_33565 = add32(y_33554, i_33562);\n        bool x_33566 = sle32(0, i_33565);\n        bool y_33567 = slt32(i_33565, h1_30872);\n        bool bounds_check_33568 = x_33566 && y_33567;\n        int32_t i_33569 = add32(x_33556, j_33564);\n        bool x_33570 = sle32(0, i_33569);\n        bool y_33571 = slt32(i_33569, w1_30873);\n        bool bounds_check_33572 = x_33570 && y_33571;\n        bool x_33573 = sle32(0, k_33561);\n        bool y_33574 = slt32(k_33561, c_30874);\n        bool bounds_check_33575 = x_33573 && y_33574;\n        bool y_33576 = bounds_check_33568 && bounds_check_33575;\n        bool index_ok_33577 = bounds_check_33572 && y_33576;\n        bool index_certs_33578;\n        \n        if (!index_ok_33577) {\n            {\n   ",
            "             if (atomic_cmpxchg_i32_global(global_failure, -1, 81) == -1) {\n                    global_failure_args[0] = i_33565;\n                    global_failure_args[1] = i_33569;\n                    global_failure_args[2] = k_33561;\n                    global_failure_args[3] = h1_30872;\n                    global_failure_args[4] = w1_30873;\n                    global_failure_args[5] = c_30874;\n                    ;\n                }\n                local_failure = true;\n                goto error_0;\n            }\n        }\n        \n        int32_t i32_arg_33579 = ((__global\n                                  int32_t *) imgA_mem_39419)[sext_i32_i64(i_33565) *\n                                                             sext_i32_i64(c_30874 *\n                                                             w1_30873) +\n                                                             sext_i32_i64(i_33569) *\n                                                             sext_i32_i64(c_30874) +\n                                                             sext_i32_i64(k_33561)];\n        float res_33580 = sitofp_i32_f32(i32_arg_33579);\n        \n        ((__local float *) mem_39489)[sext_i32_i64(gtid_32847)] = res_33580;\n    }\n    \n  error_0:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t res_33581;\n    float res_33582;\n    int32_t nn_ind_33584;\n    float nn_dst_33585;\n    \n    nn_ind_33584 = -1;\n    nn_dst_33585 = INFINITY;\n    for (int32_t q_33583 = 0; q_33583 < 8; q_33583++) {\n        int32_t indB_33586 = ((__global\n                               int32_t *) mem_39484)[sext_i32_i64(q_33583) *\n                                                     sext_i32_i64(n_30870) +\n                                                     sext_i32_i64(gtid_32844)];\n        int32_t ii_33587 = sdiv32(indB_33586, n_colsB_30889);\n        int32_t y_33588 = mul32(n_colsB_30889, ii_33587);\n        int32_t jj_33589 = sub32(indB_3",
            "3586, y_33588);\n        float res_33590;\n        int32_t gtid_32872 = ltid_pre_40350;\n        int32_t phys_tid_32873 = local_tid_40346;\n        __local char *red_arr_mem_40353;\n        \n        red_arr_mem_40353 = (__local char *) red_arr_mem_40353_backing_1;\n        if (slt32(gtid_32872, patch_len_30891)) {\n            int32_t ij_33595 = sdiv32(gtid_32872, c_30874);\n            int32_t y_33596 = mul32(c_30874, ij_33595);\n            int32_t k_33597 = sub32(gtid_32872, y_33596);\n            int32_t i_33598 = sdiv32(ij_33595, p_30878);\n            int32_t y_33599 = mul32(p_30878, i_33598);\n            int32_t j_33600 = sub32(ij_33595, y_33599);\n            int32_t i_33601 = add32(ii_33587, i_33598);\n            bool x_33602 = sle32(0, i_33601);\n            bool y_33603 = slt32(i_33601, h2_30875);\n            bool bounds_check_33604 = x_33602 && y_33603;\n            int32_t i_33605 = add32(jj_33589, j_33600);\n            bool x_33606 = sle32(0, i_33605);\n            bool y_33607 = slt32(i_33605, w2_30876);\n            bool bounds_check_33608 = x_33606 && y_33607;\n            bool x_33609 = sle32(0, k_33597);\n            bool y_33610 = slt32(k_33597, c_30874);\n            bool bounds_check_33611 = x_33609 && y_33610;\n            bool y_33612 = bounds_check_33604 && bounds_check_33611;\n            bool index_ok_33613 = bounds_check_33608 && y_33612;\n            bool index_certs_33614;\n            \n            if (!index_ok_33613) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 82) ==\n                        -1) {\n                        global_failure_args[0] = i_33601;\n                        global_failure_args[1] = i_33605;\n                        global_failure_args[2] = k_33597;\n                        global_failure_args[3] = h2_30875;\n                        global_failure_args[4] = w2_30876;\n                        global_failure_args[5] = c_30874;\n                        ;\n                    }\n                    local",
            "_failure = true;\n                    goto error_1;\n                }\n            }\n            \n            int32_t i32_arg_33615 = ((__global\n                                      int32_t *) imgB_mem_39420)[sext_i32_i64(i_33601) *\n                                                                 sext_i32_i64(c_30877 *\n                                                                 w2_30876) +\n                                                                 sext_i32_i64(i_33605) *\n                                                                 sext_i32_i64(c_30877) +\n                                                                 sext_i32_i64(k_33597)];\n            float res_33616 = sitofp_i32_f32(i32_arg_33615);\n            float a_v_33621 = ((__local\n                                float *) mem_39489)[sext_i32_i64(gtid_32872)];\n            float d_33622 = res_33616 - a_v_33621;\n            float res_33623 = d_33622 * d_33622;\n            \n            ((__local float *) red_arr_mem_40353)[sext_i32_i64(gtid_32872)] =\n                res_33623;\n        }\n        \n      error_1:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        \n        int32_t offset_40355;\n        int32_t skip_waves_40356;\n        float x_33591;\n        float x_33592;\n        \n        offset_40355 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_40346, patch_len_30891)) {\n                x_33591 = ((__local\n                            float *) red_arr_mem_40353)[sext_i32_i64(local_tid_40346 +\n                                                        offset_40355)];\n            }\n        }\n        offset_40355 = 1;\n        while (slt32(offset_40355, wave_sizze_40348)) {\n            if (slt32(local_tid_40346 + offset_40355, patch_len_30891) &&\n                ((local_tid_40346 - squot32(local_tid_40346, wave_sizze_40348) *\n                  wave_sizze_40348) & (2 * o",
            "ffset_40355 - 1)) == 0) {\n                // read array element\n                {\n                    x_33592 = ((volatile __local\n                                float *) red_arr_mem_40353)[sext_i32_i64(local_tid_40346 +\n                                                            offset_40355)];\n                }\n                // apply reduction operation\n                {\n                    float res_33593 = x_33591 + x_33592;\n                    \n                    x_33591 = res_33593;\n                }\n                // write result of operation\n                {\n                    ((volatile __local\n                      float *) red_arr_mem_40353)[sext_i32_i64(local_tid_40346)] =\n                        x_33591;\n                }\n            }\n            offset_40355 *= 2;\n        }\n        skip_waves_40356 = 1;\n        while (slt32(skip_waves_40356, squot32(patch_len_30891 +\n                                               wave_sizze_40348 - 1,\n                                               wave_sizze_40348))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_40355 = skip_waves_40356 * wave_sizze_40348;\n            if (slt32(local_tid_40346 + offset_40355, patch_len_30891) &&\n                ((local_tid_40346 - squot32(local_tid_40346, wave_sizze_40348) *\n                  wave_sizze_40348) == 0 && (squot32(local_tid_40346,\n                                                     wave_sizze_40348) & (2 *\n                                                                          skip_waves_40356 -\n                                                                          1)) ==\n                 0)) {\n                // read array element\n                {\n                    x_33592 = ((__local\n                                float *) red_arr_mem_40353)[sext_i32_i64(local_tid_40346 +\n                                                            offset_40355)];\n                }\n                // apply reduction operation\n                {\n          ",
            "          float res_33593 = x_33591 + x_33592;\n                    \n                    x_33591 = res_33593;\n                }\n                // write result of operation\n                {\n                    ((__local\n                      float *) red_arr_mem_40353)[sext_i32_i64(local_tid_40346)] =\n                        x_33591;\n                }\n            }\n            skip_waves_40356 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        res_33590 = ((__local float *) red_arr_mem_40353)[0];\n        \n        float dst_33624 = res_33590;\n        bool cond_33625 = res_33590 < nn_dst_33585;\n        int32_t loopres_33626;\n        \n        if (cond_33625) {\n            loopres_33626 = indB_33586;\n        } else {\n            loopres_33626 = nn_ind_33584;\n        }\n        \n        float loopres_33627;\n        \n        if (cond_33625) {\n            loopres_33627 = dst_33624;\n        } else {\n            loopres_33627 = nn_dst_33585;\n        }\n        \n        int32_t nn_ind_tmp_40351 = loopres_33626;\n        float nn_dst_tmp_40352 = loopres_33627;\n        \n        nn_ind_33584 = nn_ind_tmp_40351;\n        nn_dst_33585 = nn_dst_tmp_40352;\n    }\n    res_33581 = nn_ind_33584;\n    res_33582 = nn_dst_33585;\n    if (local_tid_40346 == 0) {\n        ((__global float *) mem_39493)[sext_i32_i64(gtid_32844)] = res_33582;\n    }\n    if (local_tid_40346 == 0) {\n        ((__global int32_t *) mem_39496)[sext_i32_i64(gtid_32844)] = res_33581;\n    }\n    if (local_tid_40346 == 0) {\n        ((__global float *) mem_39499)[sext_i32_i64(gtid_32844)] = res_33582;\n    }\n    \n  error_3:\n    return;\n}\n__kernel void selectBestNNzisegred_nonseg_32749(__global int *global_failure,\n                                                int failure_is_an_option,\n                                                __global\n                                                int *global_failure_args,\n                                                uint red_arr_mem_40314_backing_offset_0,\n                 ",
            "                               uint sync_arr_mem_40312_backing_offset_1,\n                                                int32_t n_30870,\n                                                int32_t h1_30872,\n                                                int32_t w1_30873,\n                                                int32_t c_30874,\n                                                int32_t h2_30875,\n                                                int32_t w2_30876,\n                                                int32_t c_30877,\n                                                int32_t p_30878,\n                                                int32_t n_colsA_30887,\n                                                int32_t n_colsB_30889,\n                                                int32_t patch_len_30891,\n                                                int32_t num_groups_32753,\n                                                __global\n                                                unsigned char *imgA_mem_39419,\n                                                __global\n                                                unsigned char *imgB_mem_39420,\n                                                __global\n                                                unsigned char *mem_39425,\n                                                __global\n                                                unsigned char *mem_39429,\n                                                __global\n                                                unsigned char *mem_39443,\n                                                __global\n                                                unsigned char *mem_39446,\n                                                __global\n                                                unsigned char *mem_39449,\n                                                __global\n                                                unsigned char *selectBestNNzicounter_mem_40302,\n                                  ",
            "              __global\n                                                unsigned char *group_res_arr_mem_40304,\n                                                int32_t num_threads_40306)\n{\n    #define segred_group_sizze_32752 (selectBestNNzisegred_group_sizze_32739)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *red_arr_mem_40314_backing_1 =\n                  &shared_mem[red_arr_mem_40314_backing_offset_0];\n    volatile char *sync_arr_mem_40312_backing_0 =\n                  &shared_mem[sync_arr_mem_40312_backing_offset_1];\n    volatile __local bool local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = false;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t global_tid_40307;\n    int32_t local_tid_40308;\n    int32_t group_sizze_40311;\n    int32_t wave_sizze_40310;\n    int32_t group_tid_40309;\n    \n    global_tid_40307 = get_global_id(0);\n    local_tid_40308 = get_local_id(0);\n    group_sizze_40311 = get_local_size(0);\n    wave_sizze_40310 = LOCKSTEP_WIDTH;\n    group_tid_40309 = get_group_id(0);\n    \n    int32_t phys_tid_32749;\n    \n    phys_tid_32749 = global_tid_40307;\n    \n    __local char *sync_arr_mem_40312;\n    \n    sync_arr_mem_40312 = (__local char *) sync_arr_mem_40312_backing_0;\n    \n    __local char *red_arr_mem_40314;\n    \n    red_arr_mem_40314 = (__local char *) red_arr_mem_40314_backing_1;\n    \n    int32_t dummy_32747;\n    \n    dummy_32747 = 0;\n    \n    int32_t gtid_32748;\n    \n    gtid_32748 = 0;\n    \n    float x_acc_40316;\n    int32_t chunk_sizze_40317;\n    \n    chunk_sizze_40317 = smin32(sdiv_up32(n_30870, segred_group_sizze_32752 *\n                                         num_groups_32753), sdiv_up32(n_30870 -\n                                                                      phys_tid_32749,\n                                                                      num_thr",
            "eads_40306));\n    \n    float x_32758;\n    float x_32759;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_40316 = 0.0F;\n    }\n    for (int32_t i_40321 = 0; i_40321 < chunk_sizze_40317; i_40321++) {\n        gtid_32748 = phys_tid_32749 + num_threads_40306 * i_40321;\n        // apply map function\n        {\n            int32_t y_32763 = sdiv32(gtid_32748, n_colsA_30887);\n            int32_t y_32764 = mul32(n_colsA_30887, y_32763);\n            int32_t x_32765 = sub32(gtid_32748, y_32764);\n            \n            for (int32_t i_39355 = 0; i_39355 < patch_len_30891; i_39355++) {\n                int32_t ij_32768 = sdiv32(i_39355, c_30874);\n                int32_t y_32769 = mul32(c_30874, ij_32768);\n                int32_t k_32770 = sub32(i_39355, y_32769);\n                int32_t i_32771 = sdiv32(ij_32768, p_30878);\n                int32_t y_32772 = mul32(p_30878, i_32771);\n                int32_t j_32773 = sub32(ij_32768, y_32772);\n                int32_t i_32774 = add32(y_32763, i_32771);\n                bool x_32775 = sle32(0, i_32774);\n                bool y_32776 = slt32(i_32774, h1_30872);\n                bool bounds_check_32777 = x_32775 && y_32776;\n                int32_t i_32778 = add32(x_32765, j_32773);\n                bool x_32779 = sle32(0, i_32778);\n                bool y_32780 = slt32(i_32778, w1_30873);\n                bool bounds_check_32781 = x_32779 && y_32780;\n                bool x_32782 = sle32(0, k_32770);\n                bool y_32783 = slt32(k_32770, c_30874);\n                bool bounds_check_32784 = x_32782 && y_32783;\n                bool y_32785 = bounds_check_32777 && bounds_check_32784;\n                bool index_ok_32786 = bounds_check_32781 && y_32785;\n                bool index_certs_32787;\n                \n                if (!index_ok_32786) {\n                    {\n                        if (atomic_cmpxchg_i32_global(global_failure, -1, 77) ==\n                            -1) {\n                            global_failure",
            "_args[0] = i_32774;\n                            global_failure_args[1] = i_32778;\n                            global_failure_args[2] = k_32770;\n                            global_failure_args[3] = h1_30872;\n                            global_failure_args[4] = w1_30873;\n                            global_failure_args[5] = c_30874;\n                            ;\n                        }\n                        local_failure = true;\n                        goto error_0;\n                    }\n                }\n                \n                int32_t i32_arg_32788 = ((__global\n                                          int32_t *) imgA_mem_39419)[sext_i32_i64(i_32774) *\n                                                                     sext_i32_i64(c_30874 *\n                                                                     w1_30873) +\n                                                                     sext_i32_i64(i_32778) *\n                                                                     sext_i32_i64(c_30874) +\n                                                                     sext_i32_i64(k_32770)];\n                float res_32789 = sitofp_i32_f32(i32_arg_32788);\n                \n                ((__global float *) mem_39429)[sext_i32_i64(phys_tid_32749) +\n                                               sext_i32_i64(i_39355) *\n                                               sext_i32_i64(num_groups_32753 *\n                                               segred_group_sizze_32752)] =\n                    res_32789;\n            }\n            \n            int32_t res_32790;\n            float res_32791;\n            int32_t nn_ind_32793;\n            float nn_dst_32794;\n            \n            nn_ind_32793 = -1;\n            nn_dst_32794 = INFINITY;\n            for (int32_t q_32792 = 0; q_32792 < 8; q_32792++) {\n                int32_t indB_32795 = ((__global\n                                       int32_t *) mem_39425)[sext_i32_i64(q_32792) *\n                           ",
            "                                  sext_i32_i64(n_30870) +\n                                                             sext_i32_i64(gtid_32748)];\n                int32_t ii_32796 = sdiv32(indB_32795, n_colsB_30889);\n                int32_t y_32797 = mul32(n_colsB_30889, ii_32796);\n                int32_t jj_32798 = sub32(indB_32795, y_32797);\n                float res_32799;\n                float redout_39284 = 0.0F;\n                \n                for (int32_t i_39285 = 0; i_39285 < patch_len_30891;\n                     i_39285++) {\n                    int32_t ij_32804 = sdiv32(i_39285, c_30874);\n                    int32_t y_32805 = mul32(c_30874, ij_32804);\n                    int32_t k_32806 = sub32(i_39285, y_32805);\n                    int32_t i_32807 = sdiv32(ij_32804, p_30878);\n                    int32_t y_32808 = mul32(p_30878, i_32807);\n                    int32_t j_32809 = sub32(ij_32804, y_32808);\n                    int32_t i_32810 = add32(ii_32796, i_32807);\n                    bool x_32811 = sle32(0, i_32810);\n                    bool y_32812 = slt32(i_32810, h2_30875);\n                    bool bounds_check_32813 = x_32811 && y_32812;\n                    int32_t i_32814 = add32(jj_32798, j_32809);\n                    bool x_32815 = sle32(0, i_32814);\n                    bool y_32816 = slt32(i_32814, w2_30876);\n                    bool bounds_check_32817 = x_32815 && y_32816;\n                    bool x_32818 = sle32(0, k_32806);\n                    bool y_32819 = slt32(k_32806, c_30874);\n                    bool bounds_check_32820 = x_32818 && y_32819;\n                    bool y_32821 = bounds_check_32813 && bounds_check_32820;\n                    bool index_ok_32822 = bounds_check_32817 && y_32821;\n                    bool index_certs_32823;\n                    \n                    if (!index_ok_32822) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1,\n                                           ",
            "               78) == -1) {\n                                global_failure_args[0] = i_32810;\n                                global_failure_args[1] = i_32814;\n                                global_failure_args[2] = k_32806;\n                                global_failure_args[3] = h2_30875;\n                                global_failure_args[4] = w2_30876;\n                                global_failure_args[5] = c_30874;\n                                ;\n                            }\n                            local_failure = true;\n                            goto error_0;\n                        }\n                    }\n                    \n                    int32_t i32_arg_32824 = ((__global\n                                              int32_t *) imgB_mem_39420)[sext_i32_i64(i_32810) *\n                                                                         sext_i32_i64(c_30877 *\n                                                                         w2_30876) +\n                                                                         sext_i32_i64(i_32814) *\n                                                                         sext_i32_i64(c_30877) +\n                                                                         sext_i32_i64(k_32806)];\n                    float res_32825 = sitofp_i32_f32(i32_arg_32824);\n                    float a_v_32830 = ((__global\n                                        float *) mem_39429)[sext_i32_i64(phys_tid_32749) +\n                                                            sext_i32_i64(i_39285) *\n                                                            sext_i32_i64(num_groups_32753 *\n                                                            segred_group_sizze_32752)];\n                    float d_32831 = res_32825 - a_v_32830;\n                    float res_32832 = d_32831 * d_32831;\n                    float res_32802 = res_32832 + redout_39284;\n                    float redout_tmp_40325 = res_32802;\n                ",
            "    \n                    redout_39284 = redout_tmp_40325;\n                }\n                res_32799 = redout_39284;\n                \n                float dst_32833 = res_32799;\n                bool cond_32834 = res_32799 < nn_dst_32794;\n                int32_t loopres_32835;\n                \n                if (cond_32834) {\n                    loopres_32835 = indB_32795;\n                } else {\n                    loopres_32835 = nn_ind_32793;\n                }\n                \n                float loopres_32836;\n                \n                if (cond_32834) {\n                    loopres_32836 = dst_32833;\n                } else {\n                    loopres_32836 = nn_dst_32794;\n                }\n                \n                int32_t nn_ind_tmp_40323 = loopres_32835;\n                float nn_dst_tmp_40324 = loopres_32836;\n                \n                nn_ind_32793 = nn_ind_tmp_40323;\n                nn_dst_32794 = nn_dst_tmp_40324;\n            }\n            res_32790 = nn_ind_32793;\n            res_32791 = nn_dst_32794;\n            // save map-out results\n            {\n                ((__global int32_t *) mem_39446)[sext_i32_i64(dummy_32747) *\n                                                 sext_i32_i64(n_30870) +\n                                                 sext_i32_i64(gtid_32748)] =\n                    res_32790;\n                ((__global float *) mem_39449)[sext_i32_i64(dummy_32747) *\n                                               sext_i32_i64(n_30870) +\n                                               sext_i32_i64(gtid_32748)] =\n                    res_32791;\n            }\n            // load accumulator\n            {\n                x_32758 = x_acc_40316;\n            }\n            // load new values\n            {\n                x_32759 = res_32791;\n            }\n            // apply reduction operator\n            {\n                float res_32760 = x_32758 + x_32759;\n                \n                // store in accumulator\n               ",
            " {\n                    x_acc_40316 = res_32760;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_32758 = x_acc_40316;\n        ((__local float *) red_arr_mem_40314)[sext_i32_i64(local_tid_40308)] =\n            x_32758;\n    }\n    \n  error_0:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_40326;\n    int32_t skip_waves_40327;\n    float x_40318;\n    float x_40319;\n    \n    offset_40326 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_40308, segred_group_sizze_32752)) {\n            x_40318 = ((__local\n                        float *) red_arr_mem_40314)[sext_i32_i64(local_tid_40308 +\n                                                    offset_40326)];\n        }\n    }\n    offset_40326 = 1;\n    while (slt32(offset_40326, wave_sizze_40310)) {\n        if (slt32(local_tid_40308 + offset_40326, segred_group_sizze_32752) &&\n            ((local_tid_40308 - squot32(local_tid_40308, wave_sizze_40310) *\n              wave_sizze_40310) & (2 * offset_40326 - 1)) == 0) {\n            // read array element\n            {\n                x_40319 = ((volatile __local\n                            float *) red_arr_mem_40314)[sext_i32_i64(local_tid_40308 +\n                                                        offset_40326)];\n            }\n            // apply reduction operation\n            {\n                float res_40320 = x_40318 + x_40319;\n                \n                x_40318 = res_40320;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_40314)[sext_i32_i64(local_tid_40308)] =\n                    x_40318;\n            }\n        }\n        offset_40326 *= 2;\n    }\n    skip_waves_40327 = 1;\n    while (slt32(skip_waves_40327, squot32(segred_group_sizze_32752 +\n                                   ",
            "        wave_sizze_40310 - 1,\n                                           wave_sizze_40310))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_40326 = skip_waves_40327 * wave_sizze_40310;\n        if (slt32(local_tid_40308 + offset_40326, segred_group_sizze_32752) &&\n            ((local_tid_40308 - squot32(local_tid_40308, wave_sizze_40310) *\n              wave_sizze_40310) == 0 && (squot32(local_tid_40308,\n                                                 wave_sizze_40310) & (2 *\n                                                                      skip_waves_40327 -\n                                                                      1)) ==\n             0)) {\n            // read array element\n            {\n                x_40319 = ((__local\n                            float *) red_arr_mem_40314)[sext_i32_i64(local_tid_40308 +\n                                                        offset_40326)];\n            }\n            // apply reduction operation\n            {\n                float res_40320 = x_40318 + x_40319;\n                \n                x_40318 = res_40320;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_40314)[sext_i32_i64(local_tid_40308)] =\n                    x_40318;\n            }\n        }\n        skip_waves_40327 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (local_tid_40308 == 0) {\n            x_acc_40316 = x_40318;\n        }\n    }\n    \n    int32_t old_counter_40328;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_40308 == 0) {\n            ((__global\n              float *) group_res_arr_mem_40304)[sext_i32_i64(group_tid_40309) *\n                                                sext_i32_i64(segred_group_sizze_32752)] =\n                x_acc_40316;\n            mem_fence_global();\n            old_counter_40328 = atomic_add_i32_global(&((volat",
            "ile __global\n                                                         int *) selectBestNNzicounter_mem_40302)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_40312)[0] = old_counter_40328 ==\n                num_groups_32753 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_40329;\n    \n    is_last_group_40329 = ((__local bool *) sync_arr_mem_40312)[0];\n    if (is_last_group_40329) {\n        if (local_tid_40308 == 0) {\n            old_counter_40328 = atomic_add_i32_global(&((volatile __global\n                                                         int *) selectBestNNzicounter_mem_40302)[0],\n                                                      (int) (0 -\n                                                             num_groups_32753));\n        }\n        // read in the per-group-results\n        {\n            int32_t read_per_thread_40330 = sdiv_up32(num_groups_32753,\n                                                      segred_group_sizze_32752);\n            \n            x_32758 = 0.0F;\n            for (int32_t i_40331 = 0; i_40331 < read_per_thread_40330;\n                 i_40331++) {\n                int32_t group_res_id_40332 = local_tid_40308 *\n                        read_per_thread_40330 + i_40331;\n                int32_t index_of_group_res_40333 = group_res_id_40332;\n                \n                if (slt32(group_res_id_40332, num_groups_32753)) {\n                    x_32759 = ((__global\n                                float *) group_res_arr_mem_40304)[sext_i32_i64(index_of_group_res_40333) *\n                                                                  sext_i32_i64(segred_group_sizze_32752)];\n                    \n                    float res_32760;\n                    \n                    res_32760 = x_32758 + x_32759;\n                    x_32758 = res_32760;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_",
            "40314)[sext_i32_i64(local_tid_40308)] =\n            x_32758;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_40334;\n            int32_t skip_waves_40335;\n            float x_40318;\n            float x_40319;\n            \n            offset_40334 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_40308, segred_group_sizze_32752)) {\n                    x_40318 = ((__local\n                                float *) red_arr_mem_40314)[sext_i32_i64(local_tid_40308 +\n                                                            offset_40334)];\n                }\n            }\n            offset_40334 = 1;\n            while (slt32(offset_40334, wave_sizze_40310)) {\n                if (slt32(local_tid_40308 + offset_40334,\n                          segred_group_sizze_32752) && ((local_tid_40308 -\n                                                         squot32(local_tid_40308,\n                                                                 wave_sizze_40310) *\n                                                         wave_sizze_40310) &\n                                                        (2 * offset_40334 -\n                                                         1)) == 0) {\n                    // read array element\n                    {\n                        x_40319 = ((volatile __local\n                                    float *) red_arr_mem_40314)[sext_i32_i64(local_tid_40308 +\n                                                                offset_40334)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_40320 = x_40318 + x_40319;\n                        \n                        x_40318 = res_40320;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float",
            " *) red_arr_mem_40314)[sext_i32_i64(local_tid_40308)] =\n                            x_40318;\n                    }\n                }\n                offset_40334 *= 2;\n            }\n            skip_waves_40335 = 1;\n            while (slt32(skip_waves_40335, squot32(segred_group_sizze_32752 +\n                                                   wave_sizze_40310 - 1,\n                                                   wave_sizze_40310))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_40334 = skip_waves_40335 * wave_sizze_40310;\n                if (slt32(local_tid_40308 + offset_40334,\n                          segred_group_sizze_32752) && ((local_tid_40308 -\n                                                         squot32(local_tid_40308,\n                                                                 wave_sizze_40310) *\n                                                         wave_sizze_40310) ==\n                                                        0 &&\n                                                        (squot32(local_tid_40308,\n                                                                 wave_sizze_40310) &\n                                                         (2 * skip_waves_40335 -\n                                                          1)) == 0)) {\n                    // read array element\n                    {\n                        x_40319 = ((__local\n                                    float *) red_arr_mem_40314)[sext_i32_i64(local_tid_40308 +\n                                                                offset_40334)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_40320 = x_40318 + x_40319;\n                        \n                        x_40318 = res_40320;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_40314)[",
            "sext_i32_i64(local_tid_40308)] =\n                            x_40318;\n                    }\n                }\n                skip_waves_40335 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_40308 == 0) {\n                    ((__global float *) mem_39443)[0] = x_40318;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_32752\n}\n__kernel void selectBestNNzisegred_nonseg_33448(__global int *global_failure,\n                                                uint red_arr_mem_40384_backing_offset_0,\n                                                uint sync_arr_mem_40382_backing_offset_1,\n                                                int32_t n_30870,\n                                                int32_t num_groups_33750,\n                                                __global\n                                                unsigned char *res_map_acc_mem_39529,\n                                                __global\n                                                unsigned char *mem_39534,\n                                                __global\n                                                unsigned char *selectBestNNzicounter_mem_40372,\n                                                __global\n                                                unsigned char *group_res_arr_mem_40374,\n                                                int32_t num_threads_40376)\n{\n    #define segred_group_sizze_33749 (selectBestNNzisegred_group_sizze_33440)\n    \n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    volatile char *red_arr_mem_40384_backing_1 =\n                  &shared_mem[red_arr_mem_40384_backing_offset_0];\n    volatile char *sync_arr_mem_40382_backing_0 =\n                  &shared_mem[sync_arr_mem_40382_backing_offset_1];\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t global_tid_40377;\n    in",
            "t32_t local_tid_40378;\n    int32_t group_sizze_40381;\n    int32_t wave_sizze_40380;\n    int32_t group_tid_40379;\n    \n    global_tid_40377 = get_global_id(0);\n    local_tid_40378 = get_local_id(0);\n    group_sizze_40381 = get_local_size(0);\n    wave_sizze_40380 = LOCKSTEP_WIDTH;\n    group_tid_40379 = get_group_id(0);\n    \n    int32_t phys_tid_33448;\n    \n    phys_tid_33448 = global_tid_40377;\n    \n    __local char *sync_arr_mem_40382;\n    \n    sync_arr_mem_40382 = (__local char *) sync_arr_mem_40382_backing_0;\n    \n    __local char *red_arr_mem_40384;\n    \n    red_arr_mem_40384 = (__local char *) red_arr_mem_40384_backing_1;\n    \n    int32_t dummy_33446;\n    \n    dummy_33446 = 0;\n    \n    int32_t gtid_33447;\n    \n    gtid_33447 = 0;\n    \n    float x_acc_40386;\n    int32_t chunk_sizze_40387;\n    \n    chunk_sizze_40387 = smin32(sdiv_up32(n_30870, segred_group_sizze_33749 *\n                                         num_groups_33750), sdiv_up32(n_30870 -\n                                                                      phys_tid_33448,\n                                                                      num_threads_40376));\n    \n    float x_33753;\n    float x_33754;\n    \n    // neutral-initialise the accumulators\n    {\n        x_acc_40386 = 0.0F;\n    }\n    for (int32_t i_40391 = 0; i_40391 < chunk_sizze_40387; i_40391++) {\n        gtid_33447 = phys_tid_33448 + num_threads_40376 * i_40391;\n        // apply map function\n        {\n            float x_33756 = ((__global\n                              float *) res_map_acc_mem_39529)[sext_i32_i64(gtid_33447)];\n            \n            // save map-out results\n            { }\n            // load accumulator\n            {\n                x_33753 = x_acc_40386;\n            }\n            // load new values\n            {\n                x_33754 = x_33756;\n            }\n            // apply reduction operator\n            {\n                float res_33755 = x_33753 + x_33754;\n                \n                // store in accumulator",
            "\n                {\n                    x_acc_40386 = res_33755;\n                }\n            }\n        }\n    }\n    // to reduce current chunk, first store our result in memory\n    {\n        x_33753 = x_acc_40386;\n        ((__local float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378)] =\n            x_33753;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t offset_40392;\n    int32_t skip_waves_40393;\n    float x_40388;\n    float x_40389;\n    \n    offset_40392 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_40378, segred_group_sizze_33749)) {\n            x_40388 = ((__local\n                        float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378 +\n                                                    offset_40392)];\n        }\n    }\n    offset_40392 = 1;\n    while (slt32(offset_40392, wave_sizze_40380)) {\n        if (slt32(local_tid_40378 + offset_40392, segred_group_sizze_33749) &&\n            ((local_tid_40378 - squot32(local_tid_40378, wave_sizze_40380) *\n              wave_sizze_40380) & (2 * offset_40392 - 1)) == 0) {\n            // read array element\n            {\n                x_40389 = ((volatile __local\n                            float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378 +\n                                                        offset_40392)];\n            }\n            // apply reduction operation\n            {\n                float res_40390 = x_40388 + x_40389;\n                \n                x_40388 = res_40390;\n            }\n            // write result of operation\n            {\n                ((volatile __local\n                  float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378)] =\n                    x_40388;\n            }\n        }\n        offset_40392 *= 2;\n    }\n    skip_waves_40393 = 1;\n    while (slt32(skip_waves_40393, squot32(segred_group_sizze_33749 +\n                                           wave_sizze_40380 - 1,\n                                           ",
            "wave_sizze_40380))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_40392 = skip_waves_40393 * wave_sizze_40380;\n        if (slt32(local_tid_40378 + offset_40392, segred_group_sizze_33749) &&\n            ((local_tid_40378 - squot32(local_tid_40378, wave_sizze_40380) *\n              wave_sizze_40380) == 0 && (squot32(local_tid_40378,\n                                                 wave_sizze_40380) & (2 *\n                                                                      skip_waves_40393 -\n                                                                      1)) ==\n             0)) {\n            // read array element\n            {\n                x_40389 = ((__local\n                            float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378 +\n                                                        offset_40392)];\n            }\n            // apply reduction operation\n            {\n                float res_40390 = x_40388 + x_40389;\n                \n                x_40388 = res_40390;\n            }\n            // write result of operation\n            {\n                ((__local\n                  float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378)] =\n                    x_40388;\n            }\n        }\n        skip_waves_40393 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // first thread saves the result in accumulator\n    {\n        if (local_tid_40378 == 0) {\n            x_acc_40386 = x_40388;\n        }\n    }\n    \n    int32_t old_counter_40394;\n    \n    // first thread in group saves group result to global memory\n    {\n        if (local_tid_40378 == 0) {\n            ((__global\n              float *) group_res_arr_mem_40374)[sext_i32_i64(group_tid_40379) *\n                                                sext_i32_i64(segred_group_sizze_33749)] =\n                x_acc_40386;\n            mem_fence_global();\n            old_counter_40394 = atomic_add_i32_global(&((volatile __global\n                                                         int",
            " *) selectBestNNzicounter_mem_40372)[0],\n                                                      (int) 1);\n            ((__local bool *) sync_arr_mem_40382)[0] = old_counter_40394 ==\n                num_groups_33750 - 1;\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    \n    bool is_last_group_40395;\n    \n    is_last_group_40395 = ((__local bool *) sync_arr_mem_40382)[0];\n    if (is_last_group_40395) {\n        if (local_tid_40378 == 0) {\n            old_counter_40394 = atomic_add_i32_global(&((volatile __global\n                                                         int *) selectBestNNzicounter_mem_40372)[0],\n                                                      (int) (0 -\n                                                             num_groups_33750));\n        }\n        // read in the per-group-results\n        {\n            int32_t read_per_thread_40396 = sdiv_up32(num_groups_33750,\n                                                      segred_group_sizze_33749);\n            \n            x_33753 = 0.0F;\n            for (int32_t i_40397 = 0; i_40397 < read_per_thread_40396;\n                 i_40397++) {\n                int32_t group_res_id_40398 = local_tid_40378 *\n                        read_per_thread_40396 + i_40397;\n                int32_t index_of_group_res_40399 = group_res_id_40398;\n                \n                if (slt32(group_res_id_40398, num_groups_33750)) {\n                    x_33754 = ((__global\n                                float *) group_res_arr_mem_40374)[sext_i32_i64(index_of_group_res_40399) *\n                                                                  sext_i32_i64(segred_group_sizze_33749)];\n                    \n                    float res_33755;\n                    \n                    res_33755 = x_33753 + x_33754;\n                    x_33753 = res_33755;\n                }\n            }\n        }\n        ((__local float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378)] =\n            x_33753;\n        barr",
            "ier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-group results\n        {\n            int32_t offset_40400;\n            int32_t skip_waves_40401;\n            float x_40388;\n            float x_40389;\n            \n            offset_40400 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_40378, segred_group_sizze_33749)) {\n                    x_40388 = ((__local\n                                float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378 +\n                                                            offset_40400)];\n                }\n            }\n            offset_40400 = 1;\n            while (slt32(offset_40400, wave_sizze_40380)) {\n                if (slt32(local_tid_40378 + offset_40400,\n                          segred_group_sizze_33749) && ((local_tid_40378 -\n                                                         squot32(local_tid_40378,\n                                                                 wave_sizze_40380) *\n                                                         wave_sizze_40380) &\n                                                        (2 * offset_40400 -\n                                                         1)) == 0) {\n                    // read array element\n                    {\n                        x_40389 = ((volatile __local\n                                    float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378 +\n                                                                offset_40400)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_40390 = x_40388 + x_40389;\n                        \n                        x_40388 = res_40390;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local\n                          float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378)] =\n                 ",
            "           x_40388;\n                    }\n                }\n                offset_40400 *= 2;\n            }\n            skip_waves_40401 = 1;\n            while (slt32(skip_waves_40401, squot32(segred_group_sizze_33749 +\n                                                   wave_sizze_40380 - 1,\n                                                   wave_sizze_40380))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_40400 = skip_waves_40401 * wave_sizze_40380;\n                if (slt32(local_tid_40378 + offset_40400,\n                          segred_group_sizze_33749) && ((local_tid_40378 -\n                                                         squot32(local_tid_40378,\n                                                                 wave_sizze_40380) *\n                                                         wave_sizze_40380) ==\n                                                        0 &&\n                                                        (squot32(local_tid_40378,\n                                                                 wave_sizze_40380) &\n                                                         (2 * skip_waves_40401 -\n                                                          1)) == 0)) {\n                    // read array element\n                    {\n                        x_40389 = ((__local\n                                    float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378 +\n                                                                offset_40400)];\n                    }\n                    // apply reduction operation\n                    {\n                        float res_40390 = x_40388 + x_40389;\n                        \n                        x_40388 = res_40390;\n                    }\n                    // write result of operation\n                    {\n                        ((__local\n                          float *) red_arr_mem_40384)[sext_i32_i64(local_tid_40378)] =\n                            x_40388;\n   ",
            "                 }\n                }\n                skip_waves_40401 *= 2;\n            }\n            // and back to memory with the final result\n            {\n                if (local_tid_40378 == 0) {\n                    ((__global float *) mem_39534)[0] = x_40388;\n                }\n            }\n        }\n    }\n    \n  error_1:\n    return;\n    #undef segred_group_sizze_33749\n}\n__kernel void selectBestNN_BADzicopy_40308(int32_t n_30845, int32_t kk_30846,\n                                           __global\n                                           unsigned char *knn_inds_mem_39418,\n                                           __global unsigned char *mem_39426)\n{\n    const int block_dim0 = 0;\n    const int block_dim1 = 1;\n    const int block_dim2 = 2;\n    int32_t copy_gtid_40308;\n    int32_t copy_ltid_40309;\n    int32_t copy_gid_40310;\n    \n    copy_gtid_40308 = get_global_id(0);\n    copy_ltid_40309 = get_local_id(0);\n    copy_gid_40310 = get_group_id(0);\n    if (slt32(copy_gtid_40308, sext_i64_i32(sext_i32_i64(n_30845)))) {\n        ((__global int32_t *) mem_39426)[sext_i32_i64(copy_gtid_40308)] =\n            ((__global\n              int32_t *) knn_inds_mem_39418)[sext_i32_i64(copy_gtid_40308) *\n                                             sext_i32_i64(kk_30846)];\n    }\n    \n  error_0:\n    return;\n}\n",
            NULL};
static const char *size_names[] = {"buildKDtree.group_size_40596",
                                   "buildKDtree.segmap_group_size_36317",
                                   "buildKDtree.segmap_group_size_36378",
                                   "buildKDtree.segmap_group_size_36439",
                                   "buildKDtree.segmap_group_size_36631",
                                   "buildKDtree.segmap_group_size_36751",
                                   "buildKDtree.segmap_group_size_36945",
                                   "buildKDtree.segmap_group_size_37345",
                                   "buildKDtree.segmap_group_size_37680",
                                   "buildKDtree.segmap_group_size_37951",
                                   "buildKDtree.segmap_group_size_37993",
                                   "buildKDtree.segmap_group_size_38314",
                                   "buildKDtree.segmap_group_size_38403",
                                   "buildKDtree.segmap_group_size_38445",
                                   "buildKDtree.segmap_group_size_38505",
                                   "buildKDtree.segmap_num_groups_36753",
                                   "buildKDtree.segmap_num_groups_36947",
                                   "buildKDtree.segred_group_size_36346",
                                   "buildKDtree.segred_group_size_36407",
                                   "buildKDtree.segred_group_size_36669",
                                   "buildKDtree.segred_num_groups_36348",
                                   "buildKDtree.segred_num_groups_36409",
                                   "buildKDtree.segred_num_groups_36671",
                                   "buildKDtree.segscan_group_size_37740",
                                   "buildKDtree.segscan_num_groups_37742",
                                   "buildKDtree.suff_intra_par_4",
                                   "buildKDtree.suff_intra_par_7",
                                   "buildKDtree.suff_outer_par_0",
                                   "buildKDtree.suff_outer_par_1",
                                   "buildKDtree.suff_outer_par_2",
                                   "buildKDtree.suff_outer_par_3",
                                   "builtin#iota_i32.group_size_40457",
                                   "builtin#replicate_f32.group_size_40466",
                                   "builtin#replicate_i32.group_size_40475",
                                   "exactKnnFixK.group_size_40305",
                                   "exactKnnFixK.group_size_40310",
                                   "exactKnnFixK.segmap_group_size_33965",
                                   "exactKnnFixK.segmap_group_size_34324",
                                   "exactKnnFixK.segmap_num_groups_33967",
                                   "exactKnnFixK.segmap_num_groups_34326",
                                   "exactKnnFixK.segred_group_size_33930",
                                   "exactKnnFixK.segred_num_groups_33932",
                                   "exactKnnFixK.suff_intra_par_1",
                                   "exactKnnFixK.suff_outer_par_0",
                                   "findNaturalLeavesFixK.segmap_group_size_35725",
                                   "findNaturalLeavesFixK.segmap_group_size_35802",
                                   "findNaturalLeavesFixK.segmap_group_size_36065",
                                   "findNaturalLeavesFixK.segmap_group_size_36151",
                                   "findNaturalLeavesFixK.segmap_group_size_36189",
                                   "findNaturalLeavesFixK.segmap_group_size_36306",
                                   "findNaturalLeavesFixK.segmap_num_groups_36067",
                                   "findNaturalLeavesFixK.segscan_group_size_35791",
                                   "findNaturalLeavesFixK.segscan_num_groups_35793",
                                   "mkImgPatches.segmap_group_size_38773",
                                   "propagateFixK.group_size_40326",
                                   "propagateFixK.group_size_40331",
                                   "propagateFixK.group_size_40369",
                                   "propagateFixK.group_size_40374",
                                   "propagateFixK.group_size_40413",
                                   "propagateFixK.group_size_40418",
                                   "propagateFixK.segmap_group_size_34703",
                                   "propagateFixK.segmap_group_size_34915",
                                   "propagateFixK.segmap_group_size_35290",
                                   "propagateFixK.segmap_group_size_35598",
                                   "propagateFixK.segmap_num_groups_34705",
                                   "propagateFixK.segmap_num_groups_34917",
                                   "propagateFixK.segmap_num_groups_35292",
                                   "propagateFixK.suff_intra_par_3",
                                   "propagateFixK.suff_outer_par_2",
                                   "reducePatchDim.segmap_group_size_33767",
                                   "reducePatchDim.segmap_group_size_33811",
                                   "reducePatchDim.segmap_num_groups_33769",
                                   "reducePatchDim.segred_group_size_33840",
                                   "reducePatchDim.segred_num_groups_33842",
                                   "reducePatchDim.suff_outer_par_0",
                                   "reducePatchDim.suff_outer_par_1",
                                   "selectBestNN.segmap_group_size_32879",
                                   "selectBestNN.segmap_group_size_33135",
                                   "selectBestNN.segmap_group_size_33239",
                                   "selectBestNN.segred_group_size_32739",
                                   "selectBestNN.segred_group_size_33440",
                                   "selectBestNN.segred_num_groups_32741",
                                   "selectBestNN.segred_num_groups_33442",
                                   "selectBestNN.suff_intra_par_2",
                                   "selectBestNN.suff_outer_par_1",
                                   "selectBestNN.suff_outer_redomap_0",
                                   "selectBestNN_BAD.group_size_40311"};
static const char *size_vars[] = {"buildKDtreezigroup_sizze_40596",
                                  "buildKDtreezisegmap_group_sizze_36317",
                                  "buildKDtreezisegmap_group_sizze_36378",
                                  "buildKDtreezisegmap_group_sizze_36439",
                                  "buildKDtreezisegmap_group_sizze_36631",
                                  "buildKDtreezisegmap_group_sizze_36751",
                                  "buildKDtreezisegmap_group_sizze_36945",
                                  "buildKDtreezisegmap_group_sizze_37345",
                                  "buildKDtreezisegmap_group_sizze_37680",
                                  "buildKDtreezisegmap_group_sizze_37951",
                                  "buildKDtreezisegmap_group_sizze_37993",
                                  "buildKDtreezisegmap_group_sizze_38314",
                                  "buildKDtreezisegmap_group_sizze_38403",
                                  "buildKDtreezisegmap_group_sizze_38445",
                                  "buildKDtreezisegmap_group_sizze_38505",
                                  "buildKDtreezisegmap_num_groups_36753",
                                  "buildKDtreezisegmap_num_groups_36947",
                                  "buildKDtreezisegred_group_sizze_36346",
                                  "buildKDtreezisegred_group_sizze_36407",
                                  "buildKDtreezisegred_group_sizze_36669",
                                  "buildKDtreezisegred_num_groups_36348",
                                  "buildKDtreezisegred_num_groups_36409",
                                  "buildKDtreezisegred_num_groups_36671",
                                  "buildKDtreezisegscan_group_sizze_37740",
                                  "buildKDtreezisegscan_num_groups_37742",
                                  "buildKDtreezisuff_intra_par_4",
                                  "buildKDtreezisuff_intra_par_7",
                                  "buildKDtreezisuff_outer_par_0",
                                  "buildKDtreezisuff_outer_par_1",
                                  "buildKDtreezisuff_outer_par_2",
                                  "buildKDtreezisuff_outer_par_3",
                                  "builtinzhiota_i32zigroup_sizze_40457",
                                  "builtinzhreplicate_f32zigroup_sizze_40466",
                                  "builtinzhreplicate_i32zigroup_sizze_40475",
                                  "exactKnnFixKzigroup_sizze_40305",
                                  "exactKnnFixKzigroup_sizze_40310",
                                  "exactKnnFixKzisegmap_group_sizze_33965",
                                  "exactKnnFixKzisegmap_group_sizze_34324",
                                  "exactKnnFixKzisegmap_num_groups_33967",
                                  "exactKnnFixKzisegmap_num_groups_34326",
                                  "exactKnnFixKzisegred_group_sizze_33930",
                                  "exactKnnFixKzisegred_num_groups_33932",
                                  "exactKnnFixKzisuff_intra_par_1",
                                  "exactKnnFixKzisuff_outer_par_0",
                                  "findNaturalLeavesFixKzisegmap_group_sizze_35725",
                                  "findNaturalLeavesFixKzisegmap_group_sizze_35802",
                                  "findNaturalLeavesFixKzisegmap_group_sizze_36065",
                                  "findNaturalLeavesFixKzisegmap_group_sizze_36151",
                                  "findNaturalLeavesFixKzisegmap_group_sizze_36189",
                                  "findNaturalLeavesFixKzisegmap_group_sizze_36306",
                                  "findNaturalLeavesFixKzisegmap_num_groups_36067",
                                  "findNaturalLeavesFixKzisegscan_group_sizze_35791",
                                  "findNaturalLeavesFixKzisegscan_num_groups_35793",
                                  "mkImgPatcheszisegmap_group_sizze_38773",
                                  "propagateFixKzigroup_sizze_40326",
                                  "propagateFixKzigroup_sizze_40331",
                                  "propagateFixKzigroup_sizze_40369",
                                  "propagateFixKzigroup_sizze_40374",
                                  "propagateFixKzigroup_sizze_40413",
                                  "propagateFixKzigroup_sizze_40418",
                                  "propagateFixKzisegmap_group_sizze_34703",
                                  "propagateFixKzisegmap_group_sizze_34915",
                                  "propagateFixKzisegmap_group_sizze_35290",
                                  "propagateFixKzisegmap_group_sizze_35598",
                                  "propagateFixKzisegmap_num_groups_34705",
                                  "propagateFixKzisegmap_num_groups_34917",
                                  "propagateFixKzisegmap_num_groups_35292",
                                  "propagateFixKzisuff_intra_par_3",
                                  "propagateFixKzisuff_outer_par_2",
                                  "reducePatchDimzisegmap_group_sizze_33767",
                                  "reducePatchDimzisegmap_group_sizze_33811",
                                  "reducePatchDimzisegmap_num_groups_33769",
                                  "reducePatchDimzisegred_group_sizze_33840",
                                  "reducePatchDimzisegred_num_groups_33842",
                                  "reducePatchDimzisuff_outer_par_0",
                                  "reducePatchDimzisuff_outer_par_1",
                                  "selectBestNNzisegmap_group_sizze_32879",
                                  "selectBestNNzisegmap_group_sizze_33135",
                                  "selectBestNNzisegmap_group_sizze_33239",
                                  "selectBestNNzisegred_group_sizze_32739",
                                  "selectBestNNzisegred_group_sizze_33440",
                                  "selectBestNNzisegred_num_groups_32741",
                                  "selectBestNNzisegred_num_groups_33442",
                                  "selectBestNNzisuff_intra_par_2",
                                  "selectBestNNzisuff_outer_par_1",
                                  "selectBestNNzisuff_outer_redomap_0",
                                  "selectBestNN_BADzigroup_sizze_40311"};
static const char *size_classes[] = {"group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "num_groups", "num_groups", "group_size",
                                     "group_size", "group_size", "num_groups",
                                     "num_groups", "num_groups", "group_size",
                                     "num_groups",
                                     "threshold (!buildKDtree.suff_outer_par_3)",
                                     "threshold (!buildKDtree.suff_outer_par_3 !buildKDtree.suff_intra_par_4)",
                                     "threshold ()", "threshold ()",
                                     "threshold ()", "threshold ()",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "num_groups", "num_groups",
                                     "group_size", "num_groups",
                                     "threshold (!exactKnnFixK.suff_outer_par_0)",
                                     "threshold ()", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "num_groups", "group_size",
                                     "num_groups", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "group_size",
                                     "num_groups", "num_groups", "num_groups",
                                     "threshold (!propagateFixK.suff_outer_par_2)",
                                     "threshold ()", "group_size", "group_size",
                                     "num_groups", "group_size", "num_groups",
                                     "threshold ()",
                                     "threshold (!reducePatchDim.suff_outer_par_0)",
                                     "group_size", "group_size", "group_size",
                                     "group_size", "group_size", "num_groups",
                                     "num_groups",
                                     "threshold (!selectBestNN.suff_outer_par_1 !selectBestNN.suff_outer_redomap_0)",
                                     "threshold (!selectBestNN.suff_outer_redomap_0)",
                                     "threshold ()", "group_size"};
int futhark_get_num_sizes(void)
{
    return 87;
}
const char *futhark_get_size_name(int i)
{
    return size_names[i];
}
const char *futhark_get_size_class(int i)
{
    return size_classes[i];
}
struct sizes {
    size_t buildKDtreezigroup_sizze_40596;
    size_t buildKDtreezisegmap_group_sizze_36317;
    size_t buildKDtreezisegmap_group_sizze_36378;
    size_t buildKDtreezisegmap_group_sizze_36439;
    size_t buildKDtreezisegmap_group_sizze_36631;
    size_t buildKDtreezisegmap_group_sizze_36751;
    size_t buildKDtreezisegmap_group_sizze_36945;
    size_t buildKDtreezisegmap_group_sizze_37345;
    size_t buildKDtreezisegmap_group_sizze_37680;
    size_t buildKDtreezisegmap_group_sizze_37951;
    size_t buildKDtreezisegmap_group_sizze_37993;
    size_t buildKDtreezisegmap_group_sizze_38314;
    size_t buildKDtreezisegmap_group_sizze_38403;
    size_t buildKDtreezisegmap_group_sizze_38445;
    size_t buildKDtreezisegmap_group_sizze_38505;
    size_t buildKDtreezisegmap_num_groups_36753;
    size_t buildKDtreezisegmap_num_groups_36947;
    size_t buildKDtreezisegred_group_sizze_36346;
    size_t buildKDtreezisegred_group_sizze_36407;
    size_t buildKDtreezisegred_group_sizze_36669;
    size_t buildKDtreezisegred_num_groups_36348;
    size_t buildKDtreezisegred_num_groups_36409;
    size_t buildKDtreezisegred_num_groups_36671;
    size_t buildKDtreezisegscan_group_sizze_37740;
    size_t buildKDtreezisegscan_num_groups_37742;
    size_t buildKDtreezisuff_intra_par_4;
    size_t buildKDtreezisuff_intra_par_7;
    size_t buildKDtreezisuff_outer_par_0;
    size_t buildKDtreezisuff_outer_par_1;
    size_t buildKDtreezisuff_outer_par_2;
    size_t buildKDtreezisuff_outer_par_3;
    size_t builtinzhiota_i32zigroup_sizze_40457;
    size_t builtinzhreplicate_f32zigroup_sizze_40466;
    size_t builtinzhreplicate_i32zigroup_sizze_40475;
    size_t exactKnnFixKzigroup_sizze_40305;
    size_t exactKnnFixKzigroup_sizze_40310;
    size_t exactKnnFixKzisegmap_group_sizze_33965;
    size_t exactKnnFixKzisegmap_group_sizze_34324;
    size_t exactKnnFixKzisegmap_num_groups_33967;
    size_t exactKnnFixKzisegmap_num_groups_34326;
    size_t exactKnnFixKzisegred_group_sizze_33930;
    size_t exactKnnFixKzisegred_num_groups_33932;
    size_t exactKnnFixKzisuff_intra_par_1;
    size_t exactKnnFixKzisuff_outer_par_0;
    size_t findNaturalLeavesFixKzisegmap_group_sizze_35725;
    size_t findNaturalLeavesFixKzisegmap_group_sizze_35802;
    size_t findNaturalLeavesFixKzisegmap_group_sizze_36065;
    size_t findNaturalLeavesFixKzisegmap_group_sizze_36151;
    size_t findNaturalLeavesFixKzisegmap_group_sizze_36189;
    size_t findNaturalLeavesFixKzisegmap_group_sizze_36306;
    size_t findNaturalLeavesFixKzisegmap_num_groups_36067;
    size_t findNaturalLeavesFixKzisegscan_group_sizze_35791;
    size_t findNaturalLeavesFixKzisegscan_num_groups_35793;
    size_t mkImgPatcheszisegmap_group_sizze_38773;
    size_t propagateFixKzigroup_sizze_40326;
    size_t propagateFixKzigroup_sizze_40331;
    size_t propagateFixKzigroup_sizze_40369;
    size_t propagateFixKzigroup_sizze_40374;
    size_t propagateFixKzigroup_sizze_40413;
    size_t propagateFixKzigroup_sizze_40418;
    size_t propagateFixKzisegmap_group_sizze_34703;
    size_t propagateFixKzisegmap_group_sizze_34915;
    size_t propagateFixKzisegmap_group_sizze_35290;
    size_t propagateFixKzisegmap_group_sizze_35598;
    size_t propagateFixKzisegmap_num_groups_34705;
    size_t propagateFixKzisegmap_num_groups_34917;
    size_t propagateFixKzisegmap_num_groups_35292;
    size_t propagateFixKzisuff_intra_par_3;
    size_t propagateFixKzisuff_outer_par_2;
    size_t reducePatchDimzisegmap_group_sizze_33767;
    size_t reducePatchDimzisegmap_group_sizze_33811;
    size_t reducePatchDimzisegmap_num_groups_33769;
    size_t reducePatchDimzisegred_group_sizze_33840;
    size_t reducePatchDimzisegred_num_groups_33842;
    size_t reducePatchDimzisuff_outer_par_0;
    size_t reducePatchDimzisuff_outer_par_1;
    size_t selectBestNNzisegmap_group_sizze_32879;
    size_t selectBestNNzisegmap_group_sizze_33135;
    size_t selectBestNNzisegmap_group_sizze_33239;
    size_t selectBestNNzisegred_group_sizze_32739;
    size_t selectBestNNzisegred_group_sizze_33440;
    size_t selectBestNNzisegred_num_groups_32741;
    size_t selectBestNNzisegred_num_groups_33442;
    size_t selectBestNNzisuff_intra_par_2;
    size_t selectBestNNzisuff_outer_par_1;
    size_t selectBestNNzisuff_outer_redomap_0;
    size_t selectBestNN_BADzigroup_sizze_40311;
} ;
struct futhark_context_config {
    struct cuda_config cu_cfg;
    int profiling;
    size_t sizes[87];
    int num_nvrtc_opts;
    const char **nvrtc_opts;
} ;
struct futhark_context_config *futhark_context_config_new(void)
{
    struct futhark_context_config *cfg =
                                  (struct futhark_context_config *) malloc(sizeof(struct futhark_context_config));
    
    if (cfg == NULL)
        return NULL;
    cfg->profiling = 0;
    cfg->num_nvrtc_opts = 0;
    cfg->nvrtc_opts = (const char **) malloc(sizeof(const char *));
    cfg->nvrtc_opts[0] = NULL;
    cfg->sizes[0] = 0;
    cfg->sizes[1] = 0;
    cfg->sizes[2] = 0;
    cfg->sizes[3] = 0;
    cfg->sizes[4] = 0;
    cfg->sizes[5] = 0;
    cfg->sizes[6] = 0;
    cfg->sizes[7] = 0;
    cfg->sizes[8] = 0;
    cfg->sizes[9] = 0;
    cfg->sizes[10] = 0;
    cfg->sizes[11] = 0;
    cfg->sizes[12] = 0;
    cfg->sizes[13] = 0;
    cfg->sizes[14] = 0;
    cfg->sizes[15] = 0;
    cfg->sizes[16] = 0;
    cfg->sizes[17] = 0;
    cfg->sizes[18] = 0;
    cfg->sizes[19] = 0;
    cfg->sizes[20] = 0;
    cfg->sizes[21] = 0;
    cfg->sizes[22] = 0;
    cfg->sizes[23] = 0;
    cfg->sizes[24] = 0;
    cfg->sizes[25] = 32;
    cfg->sizes[26] = 32;
    cfg->sizes[27] = 0;
    cfg->sizes[28] = 0;
    cfg->sizes[29] = 0;
    cfg->sizes[30] = 0;
    cfg->sizes[31] = 0;
    cfg->sizes[32] = 0;
    cfg->sizes[33] = 0;
    cfg->sizes[34] = 0;
    cfg->sizes[35] = 0;
    cfg->sizes[36] = 0;
    cfg->sizes[37] = 0;
    cfg->sizes[38] = 0;
    cfg->sizes[39] = 0;
    cfg->sizes[40] = 0;
    cfg->sizes[41] = 0;
    cfg->sizes[42] = 32;
    cfg->sizes[43] = 0;
    cfg->sizes[44] = 0;
    cfg->sizes[45] = 0;
    cfg->sizes[46] = 0;
    cfg->sizes[47] = 0;
    cfg->sizes[48] = 0;
    cfg->sizes[49] = 0;
    cfg->sizes[50] = 0;
    cfg->sizes[51] = 0;
    cfg->sizes[52] = 0;
    cfg->sizes[53] = 0;
    cfg->sizes[54] = 0;
    cfg->sizes[55] = 0;
    cfg->sizes[56] = 0;
    cfg->sizes[57] = 0;
    cfg->sizes[58] = 0;
    cfg->sizes[59] = 0;
    cfg->sizes[60] = 0;
    cfg->sizes[61] = 0;
    cfg->sizes[62] = 0;
    cfg->sizes[63] = 0;
    cfg->sizes[64] = 0;
    cfg->sizes[65] = 0;
    cfg->sizes[66] = 0;
    cfg->sizes[67] = 32;
    cfg->sizes[68] = 0;
    cfg->sizes[69] = 0;
    cfg->sizes[70] = 0;
    cfg->sizes[71] = 0;
    cfg->sizes[72] = 0;
    cfg->sizes[73] = 0;
    cfg->sizes[74] = 0;
    cfg->sizes[75] = 0;
    cfg->sizes[76] = 0;
    cfg->sizes[77] = 0;
    cfg->sizes[78] = 0;
    cfg->sizes[79] = 0;
    cfg->sizes[80] = 0;
    cfg->sizes[81] = 0;
    cfg->sizes[82] = 0;
    cfg->sizes[83] = 32;
    cfg->sizes[84] = 0;
    cfg->sizes[85] = 0;
    cfg->sizes[86] = 0;
    cuda_config_init(&cfg->cu_cfg, 87, size_names, size_vars, cfg->sizes,
                     size_classes);
    return cfg;
}
void futhark_context_config_free(struct futhark_context_config *cfg)
{
    free(cfg->nvrtc_opts);
    free(cfg);
}
void futhark_context_config_add_nvrtc_option(struct futhark_context_config *cfg,
                                             const char *opt)
{
    cfg->nvrtc_opts[cfg->num_nvrtc_opts] = opt;
    cfg->num_nvrtc_opts++;
    cfg->nvrtc_opts = (const char **) realloc(cfg->nvrtc_opts,
                                              (cfg->num_nvrtc_opts + 1) *
                                              sizeof(const char *));
    cfg->nvrtc_opts[cfg->num_nvrtc_opts] = NULL;
}
void futhark_context_config_set_debugging(struct futhark_context_config *cfg,
                                          int flag)
{
    cfg->cu_cfg.logging = cfg->cu_cfg.debugging = flag;
}
void futhark_context_config_set_profiling(struct futhark_context_config *cfg,
                                          int flag)
{
    cfg->profiling = flag;
}
void futhark_context_config_set_logging(struct futhark_context_config *cfg,
                                        int flag)
{
    cfg->cu_cfg.logging = flag;
}
void futhark_context_config_set_device(struct futhark_context_config *cfg, const
                                       char *s)
{
    set_preferred_device(&cfg->cu_cfg, s);
}
void futhark_context_config_dump_program_to(struct futhark_context_config *cfg,
                                            const char *path)
{
    cfg->cu_cfg.dump_program_to = path;
}
void futhark_context_config_load_program_from(struct futhark_context_config *cfg,
                                              const char *path)
{
    cfg->cu_cfg.load_program_from = path;
}
void futhark_context_config_dump_ptx_to(struct futhark_context_config *cfg,
                                        const char *path)
{
    cfg->cu_cfg.dump_ptx_to = path;
}
void futhark_context_config_load_ptx_from(struct futhark_context_config *cfg,
                                          const char *path)
{
    cfg->cu_cfg.load_ptx_from = path;
}
void futhark_context_config_set_default_group_size(struct futhark_context_config *cfg,
                                                   int size)
{
    cfg->cu_cfg.default_block_size = size;
    cfg->cu_cfg.default_block_size_changed = 1;
}
void futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg,
                                                   int num)
{
    cfg->cu_cfg.default_grid_size = num;
    cfg->cu_cfg.default_grid_size_changed = 1;
}
void futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg,
                                                  int size)
{
    cfg->cu_cfg.default_tile_size = size;
    cfg->cu_cfg.default_tile_size_changed = 1;
}
void futhark_context_config_set_default_threshold(struct futhark_context_config *cfg,
                                                  int size)
{
    cfg->cu_cfg.default_threshold = size;
}
int futhark_context_config_set_size(struct futhark_context_config *cfg, const
                                    char *size_name, size_t size_value)
{
    for (int i = 0; i < 87; i++) {
        if (strcmp(size_name, size_names[i]) == 0) {
            cfg->sizes[i] = size_value;
            return 0;
        }
    }
    if (strcmp(size_name, "default_group_size") == 0) {
        cfg->cu_cfg.default_block_size = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_num_groups") == 0) {
        cfg->cu_cfg.default_grid_size = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_threshold") == 0) {
        cfg->cu_cfg.default_threshold = size_value;
        return 0;
    }
    if (strcmp(size_name, "default_tile_size") == 0) {
        cfg->cu_cfg.default_tile_size = size_value;
        return 0;
    }
    return 1;
}
struct futhark_context {
    int detail_memory;
    int debugging;
    int profiling;
    int profiling_paused;
    lock_t lock;
    char *error;
    int64_t peak_mem_usage_device;
    int64_t cur_mem_usage_device;
    int64_t peak_mem_usage_default;
    int64_t cur_mem_usage_default;
    struct {
        int dummy;
    } constants;
    struct memblock_device buildKDtreezicounter_mem_40348;
    struct memblock_device buildKDtreezicounter_mem_40415;
    struct memblock_device buildKDtreezicounter_mem_40544;
    struct memblock_device exactKnnFixKzicounter_mem_40349;
    struct memblock_device reducePatchDimzicounter_mem_40344;
    struct memblock_device selectBestNNzicounter_mem_40302;
    struct memblock_device selectBestNNzicounter_mem_40372;
    CUfunction buildKDtreezireplicate_40593;
    int64_t buildKDtreezireplicate_40593_total_runtime;
    int buildKDtreezireplicate_40593_runs;
    CUfunction buildKDtreeziscan_stage1_37746;
    int64_t buildKDtreeziscan_stage1_37746_total_runtime;
    int buildKDtreeziscan_stage1_37746_runs;
    CUfunction buildKDtreeziscan_stage2_37746;
    int64_t buildKDtreeziscan_stage2_37746_total_runtime;
    int buildKDtreeziscan_stage2_37746_runs;
    CUfunction buildKDtreeziscan_stage3_37746;
    int64_t buildKDtreeziscan_stage3_37746_total_runtime;
    int buildKDtreeziscan_stage3_37746_runs;
    CUfunction buildKDtreezisegmap_36314;
    int64_t buildKDtreezisegmap_36314_total_runtime;
    int buildKDtreezisegmap_36314_runs;
    CUfunction buildKDtreezisegmap_36375;
    int64_t buildKDtreezisegmap_36375_total_runtime;
    int buildKDtreezisegmap_36375_runs;
    CUfunction buildKDtreezisegmap_36436;
    int64_t buildKDtreezisegmap_36436_total_runtime;
    int buildKDtreezisegmap_36436_runs;
    CUfunction buildKDtreezisegmap_36628;
    int64_t buildKDtreezisegmap_36628_total_runtime;
    int buildKDtreezisegmap_36628_runs;
    CUfunction buildKDtreezisegmap_36748;
    int64_t buildKDtreezisegmap_36748_total_runtime;
    int buildKDtreezisegmap_36748_runs;
    CUfunction buildKDtreezisegmap_36942;
    int64_t buildKDtreezisegmap_36942_total_runtime;
    int buildKDtreezisegmap_36942_runs;
    CUfunction buildKDtreezisegmap_37340;
    int64_t buildKDtreezisegmap_37340_total_runtime;
    int buildKDtreezisegmap_37340_runs;
    CUfunction buildKDtreezisegmap_37675;
    int64_t buildKDtreezisegmap_37675_total_runtime;
    int buildKDtreezisegmap_37675_runs;
    CUfunction buildKDtreezisegmap_37946;
    int64_t buildKDtreezisegmap_37946_total_runtime;
    int buildKDtreezisegmap_37946_runs;
    CUfunction buildKDtreezisegmap_37990;
    int64_t buildKDtreezisegmap_37990_total_runtime;
    int buildKDtreezisegmap_37990_runs;
    CUfunction buildKDtreezisegmap_38311;
    int64_t buildKDtreezisegmap_38311_total_runtime;
    int buildKDtreezisegmap_38311_runs;
    CUfunction buildKDtreezisegmap_38398;
    int64_t buildKDtreezisegmap_38398_total_runtime;
    int buildKDtreezisegmap_38398_runs;
    CUfunction buildKDtreezisegmap_38442;
    int64_t buildKDtreezisegmap_38442_total_runtime;
    int buildKDtreezisegmap_38442_runs;
    CUfunction buildKDtreezisegmap_38502;
    int64_t buildKDtreezisegmap_38502_total_runtime;
    int buildKDtreezisegmap_38502_runs;
    CUfunction buildKDtreezisegmap_intragroup_36940;
    int64_t buildKDtreezisegmap_intragroup_36940_total_runtime;
    int buildKDtreezisegmap_intragroup_36940_runs;
    CUfunction buildKDtreezisegmap_intragroup_37393;
    int64_t buildKDtreezisegmap_intragroup_37393_total_runtime;
    int buildKDtreezisegmap_intragroup_37393_runs;
    CUfunction buildKDtreezisegred_large_36352;
    int64_t buildKDtreezisegred_large_36352_total_runtime;
    int buildKDtreezisegred_large_36352_runs;
    CUfunction buildKDtreezisegred_large_36413;
    int64_t buildKDtreezisegred_large_36413_total_runtime;
    int buildKDtreezisegred_large_36413_runs;
    CUfunction buildKDtreezisegred_large_36675;
    int64_t buildKDtreezisegred_large_36675_total_runtime;
    int buildKDtreezisegred_large_36675_runs;
    CUfunction buildKDtreezisegred_small_36352;
    int64_t buildKDtreezisegred_small_36352_total_runtime;
    int buildKDtreezisegred_small_36352_runs;
    CUfunction buildKDtreezisegred_small_36413;
    int64_t buildKDtreezisegred_small_36413_total_runtime;
    int buildKDtreezisegred_small_36413_runs;
    CUfunction buildKDtreezisegred_small_36675;
    int64_t buildKDtreezisegred_small_36675_total_runtime;
    int buildKDtreezisegred_small_36675_runs;
    CUfunction builtinzhiota_i32ziiota_i32_40454;
    int64_t builtinzhiota_i32ziiota_i32_40454_total_runtime;
    int builtinzhiota_i32ziiota_i32_40454_runs;
    CUfunction builtinzhreplicate_f32zireplicate_40463;
    int64_t builtinzhreplicate_f32zireplicate_40463_total_runtime;
    int builtinzhreplicate_f32zireplicate_40463_runs;
    CUfunction builtinzhreplicate_i32zireplicate_40472;
    int64_t builtinzhreplicate_i32zireplicate_40472_total_runtime;
    int builtinzhreplicate_i32zireplicate_40472_runs;
    CUfunction exactKnnFixKzicopy_40302;
    int64_t exactKnnFixKzicopy_40302_total_runtime;
    int exactKnnFixKzicopy_40302_runs;
    CUfunction exactKnnFixKzicopy_40307;
    int64_t exactKnnFixKzicopy_40307_total_runtime;
    int exactKnnFixKzicopy_40307_runs;
    CUfunction exactKnnFixKzisegmap_33962;
    int64_t exactKnnFixKzisegmap_33962_total_runtime;
    int exactKnnFixKzisegmap_33962_runs;
    CUfunction exactKnnFixKzisegmap_34321;
    int64_t exactKnnFixKzisegmap_34321_total_runtime;
    int exactKnnFixKzisegmap_34321_runs;
    CUfunction exactKnnFixKzisegmap_intragroup_33960;
    int64_t exactKnnFixKzisegmap_intragroup_33960_total_runtime;
    int exactKnnFixKzisegmap_intragroup_33960_runs;
    CUfunction exactKnnFixKzisegred_nonseg_33941;
    int64_t exactKnnFixKzisegred_nonseg_33941_total_runtime;
    int exactKnnFixKzisegred_nonseg_33941_runs;
    CUfunction findNaturalLeavesFixKziscan_stage1_35797;
    int64_t findNaturalLeavesFixKziscan_stage1_35797_total_runtime;
    int findNaturalLeavesFixKziscan_stage1_35797_runs;
    CUfunction findNaturalLeavesFixKziscan_stage2_35797;
    int64_t findNaturalLeavesFixKziscan_stage2_35797_total_runtime;
    int findNaturalLeavesFixKziscan_stage2_35797_runs;
    CUfunction findNaturalLeavesFixKziscan_stage3_35797;
    int64_t findNaturalLeavesFixKziscan_stage3_35797_total_runtime;
    int findNaturalLeavesFixKziscan_stage3_35797_runs;
    CUfunction findNaturalLeavesFixKzisegmap_35722;
    int64_t findNaturalLeavesFixKzisegmap_35722_total_runtime;
    int findNaturalLeavesFixKzisegmap_35722_runs;
    CUfunction findNaturalLeavesFixKzisegmap_35799;
    int64_t findNaturalLeavesFixKzisegmap_35799_total_runtime;
    int findNaturalLeavesFixKzisegmap_35799_runs;
    CUfunction findNaturalLeavesFixKzisegmap_36062;
    int64_t findNaturalLeavesFixKzisegmap_36062_total_runtime;
    int findNaturalLeavesFixKzisegmap_36062_runs;
    CUfunction findNaturalLeavesFixKzisegmap_36146;
    int64_t findNaturalLeavesFixKzisegmap_36146_total_runtime;
    int findNaturalLeavesFixKzisegmap_36146_runs;
    CUfunction findNaturalLeavesFixKzisegmap_36186;
    int64_t findNaturalLeavesFixKzisegmap_36186_total_runtime;
    int findNaturalLeavesFixKzisegmap_36186_runs;
    CUfunction findNaturalLeavesFixKzisegmap_36303;
    int64_t findNaturalLeavesFixKzisegmap_36303_total_runtime;
    int findNaturalLeavesFixKzisegmap_36303_runs;
    CUfunction gpu_map_transpose_f32;
    int64_t gpu_map_transpose_f32_total_runtime;
    int gpu_map_transpose_f32_runs;
    CUfunction gpu_map_transpose_f32_low_height;
    int64_t gpu_map_transpose_f32_low_height_total_runtime;
    int gpu_map_transpose_f32_low_height_runs;
    CUfunction gpu_map_transpose_f32_low_width;
    int64_t gpu_map_transpose_f32_low_width_total_runtime;
    int gpu_map_transpose_f32_low_width_runs;
    CUfunction gpu_map_transpose_f32_small;
    int64_t gpu_map_transpose_f32_small_total_runtime;
    int gpu_map_transpose_f32_small_runs;
    CUfunction gpu_map_transpose_i32;
    int64_t gpu_map_transpose_i32_total_runtime;
    int gpu_map_transpose_i32_runs;
    CUfunction gpu_map_transpose_i32_low_height;
    int64_t gpu_map_transpose_i32_low_height_total_runtime;
    int gpu_map_transpose_i32_low_height_runs;
    CUfunction gpu_map_transpose_i32_low_width;
    int64_t gpu_map_transpose_i32_low_width_total_runtime;
    int gpu_map_transpose_i32_low_width_runs;
    CUfunction gpu_map_transpose_i32_small;
    int64_t gpu_map_transpose_i32_small_total_runtime;
    int gpu_map_transpose_i32_small_runs;
    CUfunction gpu_map_transpose_i8;
    int64_t gpu_map_transpose_i8_total_runtime;
    int gpu_map_transpose_i8_runs;
    CUfunction gpu_map_transpose_i8_low_height;
    int64_t gpu_map_transpose_i8_low_height_total_runtime;
    int gpu_map_transpose_i8_low_height_runs;
    CUfunction gpu_map_transpose_i8_low_width;
    int64_t gpu_map_transpose_i8_low_width_total_runtime;
    int gpu_map_transpose_i8_low_width_runs;
    CUfunction gpu_map_transpose_i8_small;
    int64_t gpu_map_transpose_i8_small_total_runtime;
    int gpu_map_transpose_i8_small_runs;
    CUfunction mkImgPatcheszisegmap_38762;
    int64_t mkImgPatcheszisegmap_38762_total_runtime;
    int mkImgPatcheszisegmap_38762_runs;
    CUfunction propagateFixKzicopy_40323;
    int64_t propagateFixKzicopy_40323_total_runtime;
    int propagateFixKzicopy_40323_runs;
    CUfunction propagateFixKzicopy_40328;
    int64_t propagateFixKzicopy_40328_total_runtime;
    int propagateFixKzicopy_40328_runs;
    CUfunction propagateFixKzicopy_40366;
    int64_t propagateFixKzicopy_40366_total_runtime;
    int propagateFixKzicopy_40366_runs;
    CUfunction propagateFixKzicopy_40371;
    int64_t propagateFixKzicopy_40371_total_runtime;
    int propagateFixKzicopy_40371_runs;
    CUfunction propagateFixKzicopy_40410;
    int64_t propagateFixKzicopy_40410_total_runtime;
    int propagateFixKzicopy_40410_runs;
    CUfunction propagateFixKzicopy_40415;
    int64_t propagateFixKzicopy_40415_total_runtime;
    int propagateFixKzicopy_40415_runs;
    CUfunction propagateFixKzisegmap_34700;
    int64_t propagateFixKzisegmap_34700_total_runtime;
    int propagateFixKzisegmap_34700_runs;
    CUfunction propagateFixKzisegmap_34912;
    int64_t propagateFixKzisegmap_34912_total_runtime;
    int propagateFixKzisegmap_34912_runs;
    CUfunction propagateFixKzisegmap_35287;
    int64_t propagateFixKzisegmap_35287_total_runtime;
    int propagateFixKzisegmap_35287_runs;
    CUfunction propagateFixKzisegmap_35593;
    int64_t propagateFixKzisegmap_35593_total_runtime;
    int propagateFixKzisegmap_35593_runs;
    CUfunction propagateFixKzisegmap_intragroup_34910;
    int64_t propagateFixKzisegmap_intragroup_34910_total_runtime;
    int propagateFixKzisegmap_intragroup_34910_runs;
    CUfunction reducePatchDimzisegmap_33764;
    int64_t reducePatchDimzisegmap_33764_total_runtime;
    int reducePatchDimzisegmap_33764_runs;
    CUfunction reducePatchDimzisegmap_33806;
    int64_t reducePatchDimzisegmap_33806_total_runtime;
    int reducePatchDimzisegmap_33806_runs;
    CUfunction reducePatchDimzisegred_large_33846;
    int64_t reducePatchDimzisegred_large_33846_total_runtime;
    int reducePatchDimzisegred_large_33846_runs;
    CUfunction reducePatchDimzisegred_small_33846;
    int64_t reducePatchDimzisegred_small_33846_total_runtime;
    int reducePatchDimzisegred_small_33846_runs;
    CUfunction selectBestNNzisegmap_32876;
    int64_t selectBestNNzisegmap_32876_total_runtime;
    int selectBestNNzisegmap_32876_runs;
    CUfunction selectBestNNzisegmap_33132;
    int64_t selectBestNNzisegmap_33132_total_runtime;
    int selectBestNNzisegmap_33132_runs;
    CUfunction selectBestNNzisegmap_33234;
    int64_t selectBestNNzisegmap_33234_total_runtime;
    int selectBestNNzisegmap_33234_runs;
    CUfunction selectBestNNzisegmap_intragroup_32874;
    int64_t selectBestNNzisegmap_intragroup_32874_total_runtime;
    int selectBestNNzisegmap_intragroup_32874_runs;
    CUfunction selectBestNNzisegred_nonseg_32749;
    int64_t selectBestNNzisegred_nonseg_32749_total_runtime;
    int selectBestNNzisegred_nonseg_32749_runs;
    CUfunction selectBestNNzisegred_nonseg_33448;
    int64_t selectBestNNzisegred_nonseg_33448_total_runtime;
    int selectBestNNzisegred_nonseg_33448_runs;
    CUfunction selectBestNN_BADzicopy_40308;
    int64_t selectBestNN_BADzicopy_40308_total_runtime;
    int selectBestNN_BADzicopy_40308_runs;
    int64_t copy_dev_to_dev_total_runtime;
    int copy_dev_to_dev_runs;
    int64_t copy_dev_to_host_total_runtime;
    int copy_dev_to_host_runs;
    int64_t copy_host_to_dev_total_runtime;
    int copy_host_to_dev_runs;
    int64_t copy_scalar_to_dev_total_runtime;
    int copy_scalar_to_dev_runs;
    int64_t copy_scalar_from_dev_total_runtime;
    int copy_scalar_from_dev_runs;
    CUdeviceptr global_failure;
    CUdeviceptr global_failure_args;
    struct cuda_context cuda;
    struct sizes sizes;
    int32_t failure_is_an_option;
    int total_runs;
    long total_runtime;
} ;
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg)
{
    struct futhark_context *ctx =
                           (struct futhark_context *) malloc(sizeof(struct futhark_context));
    
    if (ctx == NULL)
        return NULL;
    ctx->debugging = ctx->detail_memory = cfg->cu_cfg.debugging;
    ctx->profiling = cfg->profiling;
    ctx->profiling_paused = 0;
    ctx->error = NULL;
    ctx->cuda.profiling_records_capacity = 200;
    ctx->cuda.profiling_records_used = 0;
    ctx->cuda.profiling_records = malloc(ctx->cuda.profiling_records_capacity *
        sizeof(struct profiling_record));
    ctx->cuda.cfg = cfg->cu_cfg;
    create_lock(&ctx->lock);
    ctx->failure_is_an_option = 0;
    ctx->total_runs = 0;
    ctx->total_runtime = 0;
    ctx->peak_mem_usage_device = 0;
    ctx->cur_mem_usage_device = 0;
    ctx->peak_mem_usage_default = 0;
    ctx->cur_mem_usage_default = 0;
    cuda_setup(&ctx->cuda, cuda_program, cfg->nvrtc_opts);
    
    int32_t no_error = -1;
    
    CUDA_SUCCEED(cuMemAlloc(&ctx->global_failure, sizeof(no_error)));
    CUDA_SUCCEED(cuMemcpyHtoD(ctx->global_failure, &no_error,
                              sizeof(no_error)));
    // The +1 is to avoid zero-byte allocations.
    CUDA_SUCCEED(cuMemAlloc(&ctx->global_failure_args, sizeof(int32_t) * (6 +
                                                                          1)));
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezireplicate_40593,
                                     ctx->cuda.module,
                                     "buildKDtreezireplicate_40593"));
    ctx->buildKDtreezireplicate_40593_total_runtime = 0;
    ctx->buildKDtreezireplicate_40593_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreeziscan_stage1_37746,
                                     ctx->cuda.module,
                                     "buildKDtreeziscan_stage1_37746"));
    ctx->buildKDtreeziscan_stage1_37746_total_runtime = 0;
    ctx->buildKDtreeziscan_stage1_37746_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreeziscan_stage2_37746,
                                     ctx->cuda.module,
                                     "buildKDtreeziscan_stage2_37746"));
    ctx->buildKDtreeziscan_stage2_37746_total_runtime = 0;
    ctx->buildKDtreeziscan_stage2_37746_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreeziscan_stage3_37746,
                                     ctx->cuda.module,
                                     "buildKDtreeziscan_stage3_37746"));
    ctx->buildKDtreeziscan_stage3_37746_total_runtime = 0;
    ctx->buildKDtreeziscan_stage3_37746_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_36314,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_36314"));
    ctx->buildKDtreezisegmap_36314_total_runtime = 0;
    ctx->buildKDtreezisegmap_36314_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_36375,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_36375"));
    ctx->buildKDtreezisegmap_36375_total_runtime = 0;
    ctx->buildKDtreezisegmap_36375_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_36436,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_36436"));
    ctx->buildKDtreezisegmap_36436_total_runtime = 0;
    ctx->buildKDtreezisegmap_36436_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_36628,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_36628"));
    ctx->buildKDtreezisegmap_36628_total_runtime = 0;
    ctx->buildKDtreezisegmap_36628_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_36748,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_36748"));
    ctx->buildKDtreezisegmap_36748_total_runtime = 0;
    ctx->buildKDtreezisegmap_36748_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_36942,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_36942"));
    ctx->buildKDtreezisegmap_36942_total_runtime = 0;
    ctx->buildKDtreezisegmap_36942_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_37340,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_37340"));
    ctx->buildKDtreezisegmap_37340_total_runtime = 0;
    ctx->buildKDtreezisegmap_37340_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_37675,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_37675"));
    ctx->buildKDtreezisegmap_37675_total_runtime = 0;
    ctx->buildKDtreezisegmap_37675_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_37946,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_37946"));
    ctx->buildKDtreezisegmap_37946_total_runtime = 0;
    ctx->buildKDtreezisegmap_37946_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_37990,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_37990"));
    ctx->buildKDtreezisegmap_37990_total_runtime = 0;
    ctx->buildKDtreezisegmap_37990_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_38311,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_38311"));
    ctx->buildKDtreezisegmap_38311_total_runtime = 0;
    ctx->buildKDtreezisegmap_38311_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_38398,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_38398"));
    ctx->buildKDtreezisegmap_38398_total_runtime = 0;
    ctx->buildKDtreezisegmap_38398_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_38442,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_38442"));
    ctx->buildKDtreezisegmap_38442_total_runtime = 0;
    ctx->buildKDtreezisegmap_38442_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_38502,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_38502"));
    ctx->buildKDtreezisegmap_38502_total_runtime = 0;
    ctx->buildKDtreezisegmap_38502_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_intragroup_36940,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_intragroup_36940"));
    ctx->buildKDtreezisegmap_intragroup_36940_total_runtime = 0;
    ctx->buildKDtreezisegmap_intragroup_36940_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegmap_intragroup_37393,
                                     ctx->cuda.module,
                                     "buildKDtreezisegmap_intragroup_37393"));
    ctx->buildKDtreezisegmap_intragroup_37393_total_runtime = 0;
    ctx->buildKDtreezisegmap_intragroup_37393_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegred_large_36352,
                                     ctx->cuda.module,
                                     "buildKDtreezisegred_large_36352"));
    ctx->buildKDtreezisegred_large_36352_total_runtime = 0;
    ctx->buildKDtreezisegred_large_36352_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegred_large_36413,
                                     ctx->cuda.module,
                                     "buildKDtreezisegred_large_36413"));
    ctx->buildKDtreezisegred_large_36413_total_runtime = 0;
    ctx->buildKDtreezisegred_large_36413_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegred_large_36675,
                                     ctx->cuda.module,
                                     "buildKDtreezisegred_large_36675"));
    ctx->buildKDtreezisegred_large_36675_total_runtime = 0;
    ctx->buildKDtreezisegred_large_36675_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegred_small_36352,
                                     ctx->cuda.module,
                                     "buildKDtreezisegred_small_36352"));
    ctx->buildKDtreezisegred_small_36352_total_runtime = 0;
    ctx->buildKDtreezisegred_small_36352_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegred_small_36413,
                                     ctx->cuda.module,
                                     "buildKDtreezisegred_small_36413"));
    ctx->buildKDtreezisegred_small_36413_total_runtime = 0;
    ctx->buildKDtreezisegred_small_36413_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->buildKDtreezisegred_small_36675,
                                     ctx->cuda.module,
                                     "buildKDtreezisegred_small_36675"));
    ctx->buildKDtreezisegred_small_36675_total_runtime = 0;
    ctx->buildKDtreezisegred_small_36675_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->builtinzhiota_i32ziiota_i32_40454,
                                     ctx->cuda.module,
                                     "builtinzhiota_i32ziiota_i32_40454"));
    ctx->builtinzhiota_i32ziiota_i32_40454_total_runtime = 0;
    ctx->builtinzhiota_i32ziiota_i32_40454_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->builtinzhreplicate_f32zireplicate_40463,
                                     ctx->cuda.module,
                                     "builtinzhreplicate_f32zireplicate_40463"));
    ctx->builtinzhreplicate_f32zireplicate_40463_total_runtime = 0;
    ctx->builtinzhreplicate_f32zireplicate_40463_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->builtinzhreplicate_i32zireplicate_40472,
                                     ctx->cuda.module,
                                     "builtinzhreplicate_i32zireplicate_40472"));
    ctx->builtinzhreplicate_i32zireplicate_40472_total_runtime = 0;
    ctx->builtinzhreplicate_i32zireplicate_40472_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->exactKnnFixKzicopy_40302,
                                     ctx->cuda.module,
                                     "exactKnnFixKzicopy_40302"));
    ctx->exactKnnFixKzicopy_40302_total_runtime = 0;
    ctx->exactKnnFixKzicopy_40302_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->exactKnnFixKzicopy_40307,
                                     ctx->cuda.module,
                                     "exactKnnFixKzicopy_40307"));
    ctx->exactKnnFixKzicopy_40307_total_runtime = 0;
    ctx->exactKnnFixKzicopy_40307_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->exactKnnFixKzisegmap_33962,
                                     ctx->cuda.module,
                                     "exactKnnFixKzisegmap_33962"));
    ctx->exactKnnFixKzisegmap_33962_total_runtime = 0;
    ctx->exactKnnFixKzisegmap_33962_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->exactKnnFixKzisegmap_34321,
                                     ctx->cuda.module,
                                     "exactKnnFixKzisegmap_34321"));
    ctx->exactKnnFixKzisegmap_34321_total_runtime = 0;
    ctx->exactKnnFixKzisegmap_34321_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->exactKnnFixKzisegmap_intragroup_33960,
                                     ctx->cuda.module,
                                     "exactKnnFixKzisegmap_intragroup_33960"));
    ctx->exactKnnFixKzisegmap_intragroup_33960_total_runtime = 0;
    ctx->exactKnnFixKzisegmap_intragroup_33960_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->exactKnnFixKzisegred_nonseg_33941,
                                     ctx->cuda.module,
                                     "exactKnnFixKzisegred_nonseg_33941"));
    ctx->exactKnnFixKzisegred_nonseg_33941_total_runtime = 0;
    ctx->exactKnnFixKzisegred_nonseg_33941_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->findNaturalLeavesFixKziscan_stage1_35797,
                                     ctx->cuda.module,
                                     "findNaturalLeavesFixKziscan_stage1_35797"));
    ctx->findNaturalLeavesFixKziscan_stage1_35797_total_runtime = 0;
    ctx->findNaturalLeavesFixKziscan_stage1_35797_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->findNaturalLeavesFixKziscan_stage2_35797,
                                     ctx->cuda.module,
                                     "findNaturalLeavesFixKziscan_stage2_35797"));
    ctx->findNaturalLeavesFixKziscan_stage2_35797_total_runtime = 0;
    ctx->findNaturalLeavesFixKziscan_stage2_35797_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->findNaturalLeavesFixKziscan_stage3_35797,
                                     ctx->cuda.module,
                                     "findNaturalLeavesFixKziscan_stage3_35797"));
    ctx->findNaturalLeavesFixKziscan_stage3_35797_total_runtime = 0;
    ctx->findNaturalLeavesFixKziscan_stage3_35797_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->findNaturalLeavesFixKzisegmap_35722,
                                     ctx->cuda.module,
                                     "findNaturalLeavesFixKzisegmap_35722"));
    ctx->findNaturalLeavesFixKzisegmap_35722_total_runtime = 0;
    ctx->findNaturalLeavesFixKzisegmap_35722_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->findNaturalLeavesFixKzisegmap_35799,
                                     ctx->cuda.module,
                                     "findNaturalLeavesFixKzisegmap_35799"));
    ctx->findNaturalLeavesFixKzisegmap_35799_total_runtime = 0;
    ctx->findNaturalLeavesFixKzisegmap_35799_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->findNaturalLeavesFixKzisegmap_36062,
                                     ctx->cuda.module,
                                     "findNaturalLeavesFixKzisegmap_36062"));
    ctx->findNaturalLeavesFixKzisegmap_36062_total_runtime = 0;
    ctx->findNaturalLeavesFixKzisegmap_36062_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->findNaturalLeavesFixKzisegmap_36146,
                                     ctx->cuda.module,
                                     "findNaturalLeavesFixKzisegmap_36146"));
    ctx->findNaturalLeavesFixKzisegmap_36146_total_runtime = 0;
    ctx->findNaturalLeavesFixKzisegmap_36146_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->findNaturalLeavesFixKzisegmap_36186,
                                     ctx->cuda.module,
                                     "findNaturalLeavesFixKzisegmap_36186"));
    ctx->findNaturalLeavesFixKzisegmap_36186_total_runtime = 0;
    ctx->findNaturalLeavesFixKzisegmap_36186_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->findNaturalLeavesFixKzisegmap_36303,
                                     ctx->cuda.module,
                                     "findNaturalLeavesFixKzisegmap_36303"));
    ctx->findNaturalLeavesFixKzisegmap_36303_total_runtime = 0;
    ctx->findNaturalLeavesFixKzisegmap_36303_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_f32,
                                     ctx->cuda.module,
                                     "gpu_map_transpose_f32"));
    ctx->gpu_map_transpose_f32_total_runtime = 0;
    ctx->gpu_map_transpose_f32_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_f32_low_height,
                                     ctx->cuda.module,
                                     "gpu_map_transpose_f32_low_height"));
    ctx->gpu_map_transpose_f32_low_height_total_runtime = 0;
    ctx->gpu_map_transpose_f32_low_height_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_f32_low_width,
                                     ctx->cuda.module,
                                     "gpu_map_transpose_f32_low_width"));
    ctx->gpu_map_transpose_f32_low_width_total_runtime = 0;
    ctx->gpu_map_transpose_f32_low_width_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_f32_small,
                                     ctx->cuda.module,
                                     "gpu_map_transpose_f32_small"));
    ctx->gpu_map_transpose_f32_small_total_runtime = 0;
    ctx->gpu_map_transpose_f32_small_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_i32,
                                     ctx->cuda.module,
                                     "gpu_map_transpose_i32"));
    ctx->gpu_map_transpose_i32_total_runtime = 0;
    ctx->gpu_map_transpose_i32_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_i32_low_height,
                                     ctx->cuda.module,
                                     "gpu_map_transpose_i32_low_height"));
    ctx->gpu_map_transpose_i32_low_height_total_runtime = 0;
    ctx->gpu_map_transpose_i32_low_height_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_i32_low_width,
                                     ctx->cuda.module,
                                     "gpu_map_transpose_i32_low_width"));
    ctx->gpu_map_transpose_i32_low_width_total_runtime = 0;
    ctx->gpu_map_transpose_i32_low_width_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_i32_small,
                                     ctx->cuda.module,
                                     "gpu_map_transpose_i32_small"));
    ctx->gpu_map_transpose_i32_small_total_runtime = 0;
    ctx->gpu_map_transpose_i32_small_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_i8,
                                     ctx->cuda.module, "gpu_map_transpose_i8"));
    ctx->gpu_map_transpose_i8_total_runtime = 0;
    ctx->gpu_map_transpose_i8_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_i8_low_height,
                                     ctx->cuda.module,
                                     "gpu_map_transpose_i8_low_height"));
    ctx->gpu_map_transpose_i8_low_height_total_runtime = 0;
    ctx->gpu_map_transpose_i8_low_height_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_i8_low_width,
                                     ctx->cuda.module,
                                     "gpu_map_transpose_i8_low_width"));
    ctx->gpu_map_transpose_i8_low_width_total_runtime = 0;
    ctx->gpu_map_transpose_i8_low_width_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->gpu_map_transpose_i8_small,
                                     ctx->cuda.module,
                                     "gpu_map_transpose_i8_small"));
    ctx->gpu_map_transpose_i8_small_total_runtime = 0;
    ctx->gpu_map_transpose_i8_small_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->mkImgPatcheszisegmap_38762,
                                     ctx->cuda.module,
                                     "mkImgPatcheszisegmap_38762"));
    ctx->mkImgPatcheszisegmap_38762_total_runtime = 0;
    ctx->mkImgPatcheszisegmap_38762_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->propagateFixKzicopy_40323,
                                     ctx->cuda.module,
                                     "propagateFixKzicopy_40323"));
    ctx->propagateFixKzicopy_40323_total_runtime = 0;
    ctx->propagateFixKzicopy_40323_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->propagateFixKzicopy_40328,
                                     ctx->cuda.module,
                                     "propagateFixKzicopy_40328"));
    ctx->propagateFixKzicopy_40328_total_runtime = 0;
    ctx->propagateFixKzicopy_40328_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->propagateFixKzicopy_40366,
                                     ctx->cuda.module,
                                     "propagateFixKzicopy_40366"));
    ctx->propagateFixKzicopy_40366_total_runtime = 0;
    ctx->propagateFixKzicopy_40366_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->propagateFixKzicopy_40371,
                                     ctx->cuda.module,
                                     "propagateFixKzicopy_40371"));
    ctx->propagateFixKzicopy_40371_total_runtime = 0;
    ctx->propagateFixKzicopy_40371_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->propagateFixKzicopy_40410,
                                     ctx->cuda.module,
                                     "propagateFixKzicopy_40410"));
    ctx->propagateFixKzicopy_40410_total_runtime = 0;
    ctx->propagateFixKzicopy_40410_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->propagateFixKzicopy_40415,
                                     ctx->cuda.module,
                                     "propagateFixKzicopy_40415"));
    ctx->propagateFixKzicopy_40415_total_runtime = 0;
    ctx->propagateFixKzicopy_40415_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->propagateFixKzisegmap_34700,
                                     ctx->cuda.module,
                                     "propagateFixKzisegmap_34700"));
    ctx->propagateFixKzisegmap_34700_total_runtime = 0;
    ctx->propagateFixKzisegmap_34700_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->propagateFixKzisegmap_34912,
                                     ctx->cuda.module,
                                     "propagateFixKzisegmap_34912"));
    ctx->propagateFixKzisegmap_34912_total_runtime = 0;
    ctx->propagateFixKzisegmap_34912_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->propagateFixKzisegmap_35287,
                                     ctx->cuda.module,
                                     "propagateFixKzisegmap_35287"));
    ctx->propagateFixKzisegmap_35287_total_runtime = 0;
    ctx->propagateFixKzisegmap_35287_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->propagateFixKzisegmap_35593,
                                     ctx->cuda.module,
                                     "propagateFixKzisegmap_35593"));
    ctx->propagateFixKzisegmap_35593_total_runtime = 0;
    ctx->propagateFixKzisegmap_35593_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->propagateFixKzisegmap_intragroup_34910,
                                     ctx->cuda.module,
                                     "propagateFixKzisegmap_intragroup_34910"));
    ctx->propagateFixKzisegmap_intragroup_34910_total_runtime = 0;
    ctx->propagateFixKzisegmap_intragroup_34910_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->reducePatchDimzisegmap_33764,
                                     ctx->cuda.module,
                                     "reducePatchDimzisegmap_33764"));
    ctx->reducePatchDimzisegmap_33764_total_runtime = 0;
    ctx->reducePatchDimzisegmap_33764_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->reducePatchDimzisegmap_33806,
                                     ctx->cuda.module,
                                     "reducePatchDimzisegmap_33806"));
    ctx->reducePatchDimzisegmap_33806_total_runtime = 0;
    ctx->reducePatchDimzisegmap_33806_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->reducePatchDimzisegred_large_33846,
                                     ctx->cuda.module,
                                     "reducePatchDimzisegred_large_33846"));
    ctx->reducePatchDimzisegred_large_33846_total_runtime = 0;
    ctx->reducePatchDimzisegred_large_33846_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->reducePatchDimzisegred_small_33846,
                                     ctx->cuda.module,
                                     "reducePatchDimzisegred_small_33846"));
    ctx->reducePatchDimzisegred_small_33846_total_runtime = 0;
    ctx->reducePatchDimzisegred_small_33846_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->selectBestNNzisegmap_32876,
                                     ctx->cuda.module,
                                     "selectBestNNzisegmap_32876"));
    ctx->selectBestNNzisegmap_32876_total_runtime = 0;
    ctx->selectBestNNzisegmap_32876_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->selectBestNNzisegmap_33132,
                                     ctx->cuda.module,
                                     "selectBestNNzisegmap_33132"));
    ctx->selectBestNNzisegmap_33132_total_runtime = 0;
    ctx->selectBestNNzisegmap_33132_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->selectBestNNzisegmap_33234,
                                     ctx->cuda.module,
                                     "selectBestNNzisegmap_33234"));
    ctx->selectBestNNzisegmap_33234_total_runtime = 0;
    ctx->selectBestNNzisegmap_33234_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->selectBestNNzisegmap_intragroup_32874,
                                     ctx->cuda.module,
                                     "selectBestNNzisegmap_intragroup_32874"));
    ctx->selectBestNNzisegmap_intragroup_32874_total_runtime = 0;
    ctx->selectBestNNzisegmap_intragroup_32874_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->selectBestNNzisegred_nonseg_32749,
                                     ctx->cuda.module,
                                     "selectBestNNzisegred_nonseg_32749"));
    ctx->selectBestNNzisegred_nonseg_32749_total_runtime = 0;
    ctx->selectBestNNzisegred_nonseg_32749_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->selectBestNNzisegred_nonseg_33448,
                                     ctx->cuda.module,
                                     "selectBestNNzisegred_nonseg_33448"));
    ctx->selectBestNNzisegred_nonseg_33448_total_runtime = 0;
    ctx->selectBestNNzisegred_nonseg_33448_runs = 0;
    CUDA_SUCCEED(cuModuleGetFunction(&ctx->selectBestNN_BADzicopy_40308,
                                     ctx->cuda.module,
                                     "selectBestNN_BADzicopy_40308"));
    ctx->selectBestNN_BADzicopy_40308_total_runtime = 0;
    ctx->selectBestNN_BADzicopy_40308_runs = 0;
    ctx->copy_dev_to_dev_total_runtime = 0;
    ctx->copy_dev_to_dev_runs = 0;
    ctx->copy_dev_to_host_total_runtime = 0;
    ctx->copy_dev_to_host_runs = 0;
    ctx->copy_host_to_dev_total_runtime = 0;
    ctx->copy_host_to_dev_runs = 0;
    ctx->copy_scalar_to_dev_total_runtime = 0;
    ctx->copy_scalar_to_dev_runs = 0;
    ctx->copy_scalar_from_dev_total_runtime = 0;
    ctx->copy_scalar_from_dev_runs = 0;
    {
        ctx->buildKDtreezicounter_mem_40348.references = NULL;
        ctx->buildKDtreezicounter_mem_40348.size = 0;
        CUDA_SUCCEED(cuMemAlloc(&ctx->buildKDtreezicounter_mem_40348.mem,
                                (10240 > 0 ? 10240 : 1) * sizeof(int32_t)));
        if (10240 > 0)
            CUDA_SUCCEED(cuMemcpyHtoD(ctx->buildKDtreezicounter_mem_40348.mem,
                                      buildKDtreezicounter_mem_realtype_40861,
                                      10240 * sizeof(int32_t)));
    }
    {
        ctx->buildKDtreezicounter_mem_40415.references = NULL;
        ctx->buildKDtreezicounter_mem_40415.size = 0;
        CUDA_SUCCEED(cuMemAlloc(&ctx->buildKDtreezicounter_mem_40415.mem,
                                (10240 > 0 ? 10240 : 1) * sizeof(int32_t)));
        if (10240 > 0)
            CUDA_SUCCEED(cuMemcpyHtoD(ctx->buildKDtreezicounter_mem_40415.mem,
                                      buildKDtreezicounter_mem_realtype_40885,
                                      10240 * sizeof(int32_t)));
    }
    {
        ctx->buildKDtreezicounter_mem_40544.references = NULL;
        ctx->buildKDtreezicounter_mem_40544.size = 0;
        CUDA_SUCCEED(cuMemAlloc(&ctx->buildKDtreezicounter_mem_40544.mem,
                                (10240 > 0 ? 10240 : 1) * sizeof(int32_t)));
        if (10240 > 0)
            CUDA_SUCCEED(cuMemcpyHtoD(ctx->buildKDtreezicounter_mem_40544.mem,
                                      buildKDtreezicounter_mem_realtype_40926,
                                      10240 * sizeof(int32_t)));
    }
    {
        ctx->exactKnnFixKzicounter_mem_40349.references = NULL;
        ctx->exactKnnFixKzicounter_mem_40349.size = 0;
        CUDA_SUCCEED(cuMemAlloc(&ctx->exactKnnFixKzicounter_mem_40349.mem, (10 >
                                                                            0 ? 10 : 1) *
                                sizeof(int32_t)));
        if (10 > 0)
            CUDA_SUCCEED(cuMemcpyHtoD(ctx->exactKnnFixKzicounter_mem_40349.mem,
                                      exactKnnFixKzicounter_mem_realtype_41244,
                                      10 * sizeof(int32_t)));
    }
    {
        ctx->reducePatchDimzicounter_mem_40344.references = NULL;
        ctx->reducePatchDimzicounter_mem_40344.size = 0;
        CUDA_SUCCEED(cuMemAlloc(&ctx->reducePatchDimzicounter_mem_40344.mem,
                                (10240 > 0 ? 10240 : 1) * sizeof(int32_t)));
        if (10240 > 0)
            CUDA_SUCCEED(cuMemcpyHtoD(ctx->reducePatchDimzicounter_mem_40344.mem,
                                      reducePatchDimzicounter_mem_realtype_41565,
                                      10240 * sizeof(int32_t)));
    }
    {
        ctx->selectBestNNzicounter_mem_40302.references = NULL;
        ctx->selectBestNNzicounter_mem_40302.size = 0;
        CUDA_SUCCEED(cuMemAlloc(&ctx->selectBestNNzicounter_mem_40302.mem, (10 >
                                                                            0 ? 10 : 1) *
                                sizeof(int32_t)));
        if (10 > 0)
            CUDA_SUCCEED(cuMemcpyHtoD(ctx->selectBestNNzicounter_mem_40302.mem,
                                      selectBestNNzicounter_mem_realtype_41584,
                                      10 * sizeof(int32_t)));
    }
    {
        ctx->selectBestNNzicounter_mem_40372.references = NULL;
        ctx->selectBestNNzicounter_mem_40372.size = 0;
        CUDA_SUCCEED(cuMemAlloc(&ctx->selectBestNNzicounter_mem_40372.mem, (10 >
                                                                            0 ? 10 : 1) *
                                sizeof(int32_t)));
        if (10 > 0)
            CUDA_SUCCEED(cuMemcpyHtoD(ctx->selectBestNNzicounter_mem_40372.mem,
                                      selectBestNNzicounter_mem_realtype_41639,
                                      10 * sizeof(int32_t)));
    }
    ctx->sizes.buildKDtreezigroup_sizze_40596 = cfg->sizes[0];
    ctx->sizes.buildKDtreezisegmap_group_sizze_36317 = cfg->sizes[1];
    ctx->sizes.buildKDtreezisegmap_group_sizze_36378 = cfg->sizes[2];
    ctx->sizes.buildKDtreezisegmap_group_sizze_36439 = cfg->sizes[3];
    ctx->sizes.buildKDtreezisegmap_group_sizze_36631 = cfg->sizes[4];
    ctx->sizes.buildKDtreezisegmap_group_sizze_36751 = cfg->sizes[5];
    ctx->sizes.buildKDtreezisegmap_group_sizze_36945 = cfg->sizes[6];
    ctx->sizes.buildKDtreezisegmap_group_sizze_37345 = cfg->sizes[7];
    ctx->sizes.buildKDtreezisegmap_group_sizze_37680 = cfg->sizes[8];
    ctx->sizes.buildKDtreezisegmap_group_sizze_37951 = cfg->sizes[9];
    ctx->sizes.buildKDtreezisegmap_group_sizze_37993 = cfg->sizes[10];
    ctx->sizes.buildKDtreezisegmap_group_sizze_38314 = cfg->sizes[11];
    ctx->sizes.buildKDtreezisegmap_group_sizze_38403 = cfg->sizes[12];
    ctx->sizes.buildKDtreezisegmap_group_sizze_38445 = cfg->sizes[13];
    ctx->sizes.buildKDtreezisegmap_group_sizze_38505 = cfg->sizes[14];
    ctx->sizes.buildKDtreezisegmap_num_groups_36753 = cfg->sizes[15];
    ctx->sizes.buildKDtreezisegmap_num_groups_36947 = cfg->sizes[16];
    ctx->sizes.buildKDtreezisegred_group_sizze_36346 = cfg->sizes[17];
    ctx->sizes.buildKDtreezisegred_group_sizze_36407 = cfg->sizes[18];
    ctx->sizes.buildKDtreezisegred_group_sizze_36669 = cfg->sizes[19];
    ctx->sizes.buildKDtreezisegred_num_groups_36348 = cfg->sizes[20];
    ctx->sizes.buildKDtreezisegred_num_groups_36409 = cfg->sizes[21];
    ctx->sizes.buildKDtreezisegred_num_groups_36671 = cfg->sizes[22];
    ctx->sizes.buildKDtreezisegscan_group_sizze_37740 = cfg->sizes[23];
    ctx->sizes.buildKDtreezisegscan_num_groups_37742 = cfg->sizes[24];
    ctx->sizes.buildKDtreezisuff_intra_par_4 = cfg->sizes[25];
    ctx->sizes.buildKDtreezisuff_intra_par_7 = cfg->sizes[26];
    ctx->sizes.buildKDtreezisuff_outer_par_0 = cfg->sizes[27];
    ctx->sizes.buildKDtreezisuff_outer_par_1 = cfg->sizes[28];
    ctx->sizes.buildKDtreezisuff_outer_par_2 = cfg->sizes[29];
    ctx->sizes.buildKDtreezisuff_outer_par_3 = cfg->sizes[30];
    ctx->sizes.builtinzhiota_i32zigroup_sizze_40457 = cfg->sizes[31];
    ctx->sizes.builtinzhreplicate_f32zigroup_sizze_40466 = cfg->sizes[32];
    ctx->sizes.builtinzhreplicate_i32zigroup_sizze_40475 = cfg->sizes[33];
    ctx->sizes.exactKnnFixKzigroup_sizze_40305 = cfg->sizes[34];
    ctx->sizes.exactKnnFixKzigroup_sizze_40310 = cfg->sizes[35];
    ctx->sizes.exactKnnFixKzisegmap_group_sizze_33965 = cfg->sizes[36];
    ctx->sizes.exactKnnFixKzisegmap_group_sizze_34324 = cfg->sizes[37];
    ctx->sizes.exactKnnFixKzisegmap_num_groups_33967 = cfg->sizes[38];
    ctx->sizes.exactKnnFixKzisegmap_num_groups_34326 = cfg->sizes[39];
    ctx->sizes.exactKnnFixKzisegred_group_sizze_33930 = cfg->sizes[40];
    ctx->sizes.exactKnnFixKzisegred_num_groups_33932 = cfg->sizes[41];
    ctx->sizes.exactKnnFixKzisuff_intra_par_1 = cfg->sizes[42];
    ctx->sizes.exactKnnFixKzisuff_outer_par_0 = cfg->sizes[43];
    ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_35725 = cfg->sizes[44];
    ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_35802 = cfg->sizes[45];
    ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_36065 = cfg->sizes[46];
    ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_36151 = cfg->sizes[47];
    ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_36189 = cfg->sizes[48];
    ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_36306 = cfg->sizes[49];
    ctx->sizes.findNaturalLeavesFixKzisegmap_num_groups_36067 = cfg->sizes[50];
    ctx->sizes.findNaturalLeavesFixKzisegscan_group_sizze_35791 =
        cfg->sizes[51];
    ctx->sizes.findNaturalLeavesFixKzisegscan_num_groups_35793 = cfg->sizes[52];
    ctx->sizes.mkImgPatcheszisegmap_group_sizze_38773 = cfg->sizes[53];
    ctx->sizes.propagateFixKzigroup_sizze_40326 = cfg->sizes[54];
    ctx->sizes.propagateFixKzigroup_sizze_40331 = cfg->sizes[55];
    ctx->sizes.propagateFixKzigroup_sizze_40369 = cfg->sizes[56];
    ctx->sizes.propagateFixKzigroup_sizze_40374 = cfg->sizes[57];
    ctx->sizes.propagateFixKzigroup_sizze_40413 = cfg->sizes[58];
    ctx->sizes.propagateFixKzigroup_sizze_40418 = cfg->sizes[59];
    ctx->sizes.propagateFixKzisegmap_group_sizze_34703 = cfg->sizes[60];
    ctx->sizes.propagateFixKzisegmap_group_sizze_34915 = cfg->sizes[61];
    ctx->sizes.propagateFixKzisegmap_group_sizze_35290 = cfg->sizes[62];
    ctx->sizes.propagateFixKzisegmap_group_sizze_35598 = cfg->sizes[63];
    ctx->sizes.propagateFixKzisegmap_num_groups_34705 = cfg->sizes[64];
    ctx->sizes.propagateFixKzisegmap_num_groups_34917 = cfg->sizes[65];
    ctx->sizes.propagateFixKzisegmap_num_groups_35292 = cfg->sizes[66];
    ctx->sizes.propagateFixKzisuff_intra_par_3 = cfg->sizes[67];
    ctx->sizes.propagateFixKzisuff_outer_par_2 = cfg->sizes[68];
    ctx->sizes.reducePatchDimzisegmap_group_sizze_33767 = cfg->sizes[69];
    ctx->sizes.reducePatchDimzisegmap_group_sizze_33811 = cfg->sizes[70];
    ctx->sizes.reducePatchDimzisegmap_num_groups_33769 = cfg->sizes[71];
    ctx->sizes.reducePatchDimzisegred_group_sizze_33840 = cfg->sizes[72];
    ctx->sizes.reducePatchDimzisegred_num_groups_33842 = cfg->sizes[73];
    ctx->sizes.reducePatchDimzisuff_outer_par_0 = cfg->sizes[74];
    ctx->sizes.reducePatchDimzisuff_outer_par_1 = cfg->sizes[75];
    ctx->sizes.selectBestNNzisegmap_group_sizze_32879 = cfg->sizes[76];
    ctx->sizes.selectBestNNzisegmap_group_sizze_33135 = cfg->sizes[77];
    ctx->sizes.selectBestNNzisegmap_group_sizze_33239 = cfg->sizes[78];
    ctx->sizes.selectBestNNzisegred_group_sizze_32739 = cfg->sizes[79];
    ctx->sizes.selectBestNNzisegred_group_sizze_33440 = cfg->sizes[80];
    ctx->sizes.selectBestNNzisegred_num_groups_32741 = cfg->sizes[81];
    ctx->sizes.selectBestNNzisegred_num_groups_33442 = cfg->sizes[82];
    ctx->sizes.selectBestNNzisuff_intra_par_2 = cfg->sizes[83];
    ctx->sizes.selectBestNNzisuff_outer_par_1 = cfg->sizes[84];
    ctx->sizes.selectBestNNzisuff_outer_redomap_0 = cfg->sizes[85];
    ctx->sizes.selectBestNN_BADzigroup_sizze_40311 = cfg->sizes[86];
    init_constants(ctx);
    // Clear the free list of any deallocations that occurred while initialising constants.
    CUDA_SUCCEED(cuda_free_all(&ctx->cuda));
    futhark_context_sync(ctx);
    return ctx;
}
void futhark_context_free(struct futhark_context *ctx)
{
    free_constants(ctx);
    cuda_cleanup(&ctx->cuda);
    free_lock(&ctx->lock);
    free(ctx);
}
int futhark_context_sync(struct futhark_context *ctx)
{
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    CUDA_SUCCEED(cuCtxSynchronize());
    if (ctx->failure_is_an_option) {
        int32_t failure_idx;
        
        CUDA_SUCCEED(cuMemcpyDtoH(&failure_idx, ctx->global_failure,
                                  sizeof(int32_t)));
        ctx->failure_is_an_option = 0;
        if (failure_idx >= 0) {
            int32_t no_failure = -1;
            
            CUDA_SUCCEED(cuMemcpyHtoD(ctx->global_failure, &no_failure,
                                      sizeof(int32_t)));
            
            int32_t args[6 + 1];
            
            CUDA_SUCCEED(cuMemcpyDtoH(&args, ctx->global_failure_args,
                                      sizeof(args)));
            switch (failure_idx) {
                
              case 0:
                {
                    ctx->error =
                        msgprintf("division by zero\n-> #0  util.fut:51:9-34\n   #1  buildKDtree.fut:33:30-60\n   #2  buildKDtree.fut:107:44-108:76\n   #3  buildKDtree.fut:104:21-117:47\n   #4  driverKNN.fut:145:11-50\n   #5  driverKNN.fut:142:1-148:101\n");
                    break;
                }
                
              case 1:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:34:23-43\n   #1  buildKDtree.fut:107:44-108:76\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 2:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:38:75-91\n   #1  buildKDtree.fut:107:44-108:76\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 3:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:38:9-39:38\n   #1  buildKDtree.fut:107:44-108:76\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 4:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:110:60-72\n   #1  buildKDtree.fut:110:41-97\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 5:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:110:76-86\n   #1  buildKDtree.fut:110:41-97\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 6:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:49:30-48\n   #1  buildKDtree.fut:115:44-86\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 7:
                {
                    ctx->error =
                        msgprintf("division by zero\n-> #0  util.fut:51:9-34\n   #1  buildKDtree.fut:33:30-60\n   #2  buildKDtree.fut:107:44-108:76\n   #3  buildKDtree.fut:104:21-117:47\n   #4  driverKNN.fut:145:11-50\n   #5  driverKNN.fut:142:1-148:101\n");
                    break;
                }
                
              case 8:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:34:23-43\n   #1  buildKDtree.fut:107:44-108:76\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 9:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:38:75-91\n   #1  buildKDtree.fut:107:44-108:76\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 10:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:38:9-39:38\n   #1  buildKDtree.fut:107:44-108:76\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 11:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:110:60-72\n   #1  buildKDtree.fut:110:41-97\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 12:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:110:76-86\n   #1  buildKDtree.fut:110:41-97\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 13:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:110:60-72\n   #1  buildKDtree.fut:110:41-97\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 14:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:110:76-86\n   #1  buildKDtree.fut:110:41-97\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 15:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:49:30-48\n   #1  buildKDtree.fut:115:44-86\n   #2  buildKDtree.fut:104:21-117:47\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 16:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d] out of bounds for array of shape [%d][%d].\n-> #0  buildKDtree.fut:123:58-73\n   #1  buildKDtree.fut:123:45-124:61\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  buildKDtree.fut:122:37-125:59\n   #5  driverKNN.fut:145:11-50\n   #6  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1], args[2], args[3]);
                    break;
                }
                
              case 17:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  lib/github.com/diku-dk/sorts/radix_sort.fut:62:22-26\n   #1  /prelude/functional.fut:9:42-44\n   #2  lib/github.com/diku-dk/sorts/radix_sort.fut:59:3-62:27\n   #3  lib/github.com/diku-dk/sorts/radix_sort.fut:110:3-57\n   #4  /prelude/functional.fut:9:42-44\n   #5  buildKDtree.fut:128:21-129:91\n   #6  driverKNN.fut:145:11-50\n   #7  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 18:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:138:54-69\n   #1  buildKDtree.fut:138:41-80\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  buildKDtree.fut:137:31-139:56\n   #5  driverKNN.fut:145:11-50\n   #6  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 19:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d] out of bounds for array of shape [%d][%d].\n-> #0  buildKDtree.fut:123:58-73\n   #1  buildKDtree.fut:123:45-124:61\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  buildKDtree.fut:122:37-125:59\n   #5  driverKNN.fut:145:11-50\n   #6  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1], args[2], args[3]);
                    break;
                }
                
              case 20:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  lib/github.com/diku-dk/sorts/radix_sort.fut:62:22-26\n   #1  /prelude/functional.fut:9:42-44\n   #2  lib/github.com/diku-dk/sorts/radix_sort.fut:59:3-62:27\n   #3  lib/github.com/diku-dk/sorts/radix_sort.fut:110:3-57\n   #4  /prelude/functional.fut:9:42-44\n   #5  buildKDtree.fut:128:21-129:91\n   #6  driverKNN.fut:145:11-50\n   #7  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 21:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:138:54-69\n   #1  buildKDtree.fut:138:41-80\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  buildKDtree.fut:137:31-139:56\n   #5  driverKNN.fut:145:11-50\n   #6  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 22:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d] out of bounds for array of shape [%d][%d].\n-> #0  buildKDtree.fut:123:58-73\n   #1  buildKDtree.fut:123:45-124:61\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  buildKDtree.fut:122:37-125:59\n   #5  driverKNN.fut:145:11-50\n   #6  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1], args[2], args[3]);
                    break;
                }
                
              case 23:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  lib/github.com/diku-dk/sorts/radix_sort.fut:62:22-26\n   #1  /prelude/functional.fut:9:42-44\n   #2  lib/github.com/diku-dk/sorts/radix_sort.fut:59:3-62:27\n   #3  lib/github.com/diku-dk/sorts/radix_sort.fut:110:3-57\n   #4  /prelude/functional.fut:9:42-44\n   #5  buildKDtree.fut:128:21-129:91\n   #6  driverKNN.fut:145:11-50\n   #7  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 24:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  buildKDtree.fut:138:54-69\n   #1  buildKDtree.fut:138:41-80\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  buildKDtree.fut:137:31-139:56\n   #5  driverKNN.fut:145:11-50\n   #6  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 25:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d] out of bounds for array of shape [%d][%d].\n-> #0  buildKDtree.fut:150:49-62\n   #1  buildKDtree.fut:150:38-72\n   #2  buildKDtree.fut:150:24-81\n   #3  driverKNN.fut:145:11-50\n   #4  driverKNN.fut:142:1-148:101\n",
                                  args[0], args[1], args[2], args[3]);
                    break;
                }
                
              case 26:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  kd-traverse.fut:69:37-55\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  driverKNN.fut:251:13-92\n   #4  driverKNN.fut:282:5-64\n   #5  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 27:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  kd-traverse.fut:69:31-56\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  driverKNN.fut:251:13-92\n   #4  driverKNN.fut:282:5-64\n   #5  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 28:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  kd-traverse.fut:51:19-34\n   #1  kd-traverse.fut:73:35-73\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:251:13-92\n   #5  driverKNN.fut:282:5-64\n   #6  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 29:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  kd-traverse.fut:57:28-43\n   #1  kd-traverse.fut:73:35-73\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:251:13-92\n   #5  driverKNN.fut:282:5-64\n   #6  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 30:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  kd-traverse.fut:111:28-50\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  driverKNN.fut:251:13-92\n   #4  driverKNN.fut:282:5-64\n   #5  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 31:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  kd-traverse.fut:111:22-51\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  driverKNN.fut:251:13-92\n   #4  driverKNN.fut:282:5-64\n   #5  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 32:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:262:78-93\n   #1  /prelude/soacs.fut:64:22-28\n   #2  /prelude/soacs.fut:64:3-45\n   #3  driverKNN.fut:258:23-263:52\n   #4  driverKNN.fut:282:5-64\n   #5  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 33:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:59:27-36\n   #1  driverKNN.fut:262:39-94\n   #2  /prelude/soacs.fut:64:22-28\n   #3  /prelude/soacs.fut:64:3-45\n   #4  driverKNN.fut:258:23-263:52\n   #5  driverKNN.fut:282:5-64\n   #6  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 34:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:60:19-62:45\n   #1  driverKNN.fut:262:39-94\n   #2  /prelude/soacs.fut:64:22-28\n   #3  /prelude/soacs.fut:64:3-45\n   #4  driverKNN.fut:258:23-263:52\n   #5  driverKNN.fut:282:5-64\n   #6  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 35:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:14-21\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:262:39-94\n   #3  /prelude/soacs.fut:64:22-28\n   #4  /prelude/soacs.fut:64:3-45\n   #5  driverKNN.fut:258:23-263:52\n   #6  driverKNN.fut:282:5-64\n   #7  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 36:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:27-34\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:262:39-94\n   #3  /prelude/soacs.fut:64:22-28\n   #4  /prelude/soacs.fut:64:3-45\n   #5  driverKNN.fut:258:23-263:52\n   #6  driverKNN.fut:282:5-64\n   #7  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 37:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:262:78-93\n   #1  /prelude/soacs.fut:64:22-28\n   #2  /prelude/soacs.fut:64:3-45\n   #3  driverKNN.fut:258:23-263:52\n   #4  driverKNN.fut:282:5-64\n   #5  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 38:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:59:27-36\n   #1  driverKNN.fut:262:39-94\n   #2  /prelude/soacs.fut:64:22-28\n   #3  /prelude/soacs.fut:64:3-45\n   #4  driverKNN.fut:258:23-263:52\n   #5  driverKNN.fut:282:5-64\n   #6  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 39:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:60:19-62:45\n   #1  driverKNN.fut:262:39-94\n   #2  /prelude/soacs.fut:64:22-28\n   #3  /prelude/soacs.fut:64:3-45\n   #4  driverKNN.fut:258:23-263:52\n   #5  driverKNN.fut:282:5-64\n   #6  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 40:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:14-21\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:262:39-94\n   #3  /prelude/soacs.fut:64:22-28\n   #4  /prelude/soacs.fut:64:3-45\n   #5  driverKNN.fut:258:23-263:52\n   #6  driverKNN.fut:282:5-64\n   #7  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 41:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:27-34\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:262:39-94\n   #3  /prelude/soacs.fut:64:22-28\n   #4  /prelude/soacs.fut:64:3-45\n   #5  driverKNN.fut:258:23-263:52\n   #6  driverKNN.fut:282:5-64\n   #7  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 42:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:262:78-93\n   #1  /prelude/soacs.fut:64:22-28\n   #2  /prelude/soacs.fut:64:3-45\n   #3  driverKNN.fut:258:23-263:52\n   #4  driverKNN.fut:282:5-64\n   #5  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 43:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:59:27-36\n   #1  driverKNN.fut:262:39-94\n   #2  /prelude/soacs.fut:64:22-28\n   #3  /prelude/soacs.fut:64:3-45\n   #4  driverKNN.fut:258:23-263:52\n   #5  driverKNN.fut:282:5-64\n   #6  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 44:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:60:19-62:45\n   #1  driverKNN.fut:262:39-94\n   #2  /prelude/soacs.fut:64:22-28\n   #3  /prelude/soacs.fut:64:3-45\n   #4  driverKNN.fut:258:23-263:52\n   #5  driverKNN.fut:282:5-64\n   #6  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 45:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:14-21\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:262:39-94\n   #3  /prelude/soacs.fut:64:22-28\n   #4  /prelude/soacs.fut:64:3-45\n   #5  driverKNN.fut:258:23-263:52\n   #6  driverKNN.fut:282:5-64\n   #7  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 46:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:27-34\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:262:39-94\n   #3  /prelude/soacs.fut:64:22-28\n   #4  /prelude/soacs.fut:64:3-45\n   #5  driverKNN.fut:258:23-263:52\n   #6  driverKNN.fut:282:5-64\n   #7  driverKNN.fut:269:1-288:33\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 47:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  kd-traverse.fut:10:18-40\n   #1  driverKNN.fut:162:23-70\n   #2  driverKNN.fut:179:3-62\n   #3  driverKNN.fut:173:1-179:62\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 48:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  kd-traverse.fut:10:12-41\n   #1  driverKNN.fut:162:23-70\n   #2  driverKNN.fut:179:3-62\n   #3  driverKNN.fut:173:1-179:62\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 49:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  lib/github.com/diku-dk/sorts/radix_sort.fut:62:22-26\n   #1  /prelude/functional.fut:9:42-44\n   #2  lib/github.com/diku-dk/sorts/radix_sort.fut:59:3-62:27\n   #3  lib/github.com/diku-dk/sorts/radix_sort.fut:68:3-51\n   #4  driverKNN.fut:8:12-85\n   #5  driverKNN.fut:163:36-79\n   #6  driverKNN.fut:179:3-62\n   #7  driverKNN.fut:173:1-179:62\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 50:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d] out of bounds for array of shape [%d][%d].\n-> #0  util.fut:28:29-40\n   #1  util.fut:28:18-50\n   #2  util.fut:28:5-57\n   #3  driverKNN.fut:164:17-43\n   #4  driverKNN.fut:179:3-62\n   #5  driverKNN.fut:173:1-179:62\n",
                                  args[0], args[1], args[2], args[3]);
                    break;
                }
                
              case 51:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:166:66-81\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  driverKNN.fut:165:15-167:40\n   #4  driverKNN.fut:179:3-62\n   #5  driverKNN.fut:173:1-179:62\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 52:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  util.fut:33:34-41\n   #1  util.fut:32:20-34:34\n   #2  driverKNN.fut:169:16-47\n   #3  driverKNN.fut:179:3-62\n   #4  driverKNN.fut:173:1-179:62\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 53:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d, %d] out of bounds for array of shape [%d][%d][%d].\n-> #0  driverKNN.fut:37:44-61\n   #1  driverKNN.fut:37:25-72\n   #2  /prelude/soacs.fut:48:3-10\n   #3  /prelude/array.fut:126:3-17\n   #4  /prelude/functional.fut:15:59-65\n   #5  /prelude/soacs.fut:48:3-10\n   #6  /prelude/array.fut:130:3-34\n   #7  driverKNN.fut:35:9-38:17\n   #8  /prelude/soacs.fut:48:3-10\n   #9  /prelude/array.fut:126:3-17\n   #10 /prelude/functional.fut:15:59-65\n   #11 /prelude/soacs.fut:48:3-10\n   #12 /prelude/array.fut:130:3-34\n   #13 driverKNN.fut:39:15-47\n   #14 driverKNN.fut:28:1-42:11\n",
                                  args[0], args[1], args[2], args[3], args[4],
                                  args[5]);
                    break;
                }
                
              case 54:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:296:22-35\n   #1  driverKNN.fut:335:27-75\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:326:9-350:42\n   #5  driverKNN.fut:408:15-73\n   #6  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 55:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:302:23-46\n   #1  driverKNN.fut:335:27-75\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:326:9-350:42\n   #5  driverKNN.fut:408:15-73\n   #6  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 56:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:342:34-43\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  driverKNN.fut:326:9-350:42\n   #4  driverKNN.fut:408:15-73\n   #5  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 57:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:346:35-347:57\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  driverKNN.fut:326:9-350:42\n   #4  driverKNN.fut:408:15-73\n   #5  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 58:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:356:38-66\n   #1  /prelude/soacs.fut:72:25-33\n   #2  /prelude/soacs.fut:72:3-53\n   #3  driverKNN.fut:353:9-358:64\n   #4  driverKNN.fut:408:15-73\n   #5  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 59:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:357:66-81\n   #1  /prelude/soacs.fut:72:25-33\n   #2  /prelude/soacs.fut:72:3-53\n   #3  driverKNN.fut:353:9-358:64\n   #4  driverKNN.fut:408:15-73\n   #5  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 60:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:59:27-36\n   #1  driverKNN.fut:357:27-82\n   #2  /prelude/soacs.fut:72:25-33\n   #3  /prelude/soacs.fut:72:3-53\n   #4  driverKNN.fut:353:9-358:64\n   #5  driverKNN.fut:408:15-73\n   #6  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 61:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:60:19-62:45\n   #1  driverKNN.fut:357:27-82\n   #2  /prelude/soacs.fut:72:25-33\n   #3  /prelude/soacs.fut:72:3-53\n   #4  driverKNN.fut:353:9-358:64\n   #5  driverKNN.fut:408:15-73\n   #6  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 62:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:14-21\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:357:27-82\n   #3  /prelude/soacs.fut:72:25-33\n   #4  /prelude/soacs.fut:72:3-53\n   #5  driverKNN.fut:353:9-358:64\n   #6  driverKNN.fut:408:15-73\n   #7  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 63:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:27-34\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:357:27-82\n   #3  /prelude/soacs.fut:72:25-33\n   #4  /prelude/soacs.fut:72:3-53\n   #5  driverKNN.fut:353:9-358:64\n   #6  driverKNN.fut:408:15-73\n   #7  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 64:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:356:38-66\n   #1  /prelude/soacs.fut:72:25-33\n   #2  /prelude/soacs.fut:72:3-53\n   #3  driverKNN.fut:353:9-358:64\n   #4  driverKNN.fut:408:15-73\n   #5  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 65:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:357:66-81\n   #1  /prelude/soacs.fut:72:25-33\n   #2  /prelude/soacs.fut:72:3-53\n   #3  driverKNN.fut:353:9-358:64\n   #4  driverKNN.fut:408:15-73\n   #5  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 66:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:59:27-36\n   #1  driverKNN.fut:357:27-82\n   #2  /prelude/soacs.fut:72:25-33\n   #3  /prelude/soacs.fut:72:3-53\n   #4  driverKNN.fut:353:9-358:64\n   #5  driverKNN.fut:408:15-73\n   #6  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 67:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:60:19-62:45\n   #1  driverKNN.fut:357:27-82\n   #2  /prelude/soacs.fut:72:25-33\n   #3  /prelude/soacs.fut:72:3-53\n   #4  driverKNN.fut:353:9-358:64\n   #5  driverKNN.fut:408:15-73\n   #6  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 68:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:14-21\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:357:27-82\n   #3  /prelude/soacs.fut:72:25-33\n   #4  /prelude/soacs.fut:72:3-53\n   #5  driverKNN.fut:353:9-358:64\n   #6  driverKNN.fut:408:15-73\n   #7  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 69:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:27-34\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:357:27-82\n   #3  /prelude/soacs.fut:72:25-33\n   #4  /prelude/soacs.fut:72:3-53\n   #5  driverKNN.fut:353:9-358:64\n   #6  driverKNN.fut:408:15-73\n   #7  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 70:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:356:38-66\n   #1  /prelude/soacs.fut:72:25-33\n   #2  /prelude/soacs.fut:72:3-53\n   #3  driverKNN.fut:353:9-358:64\n   #4  driverKNN.fut:408:15-73\n   #5  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 71:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:357:66-81\n   #1  /prelude/soacs.fut:72:25-33\n   #2  /prelude/soacs.fut:72:3-53\n   #3  driverKNN.fut:353:9-358:64\n   #4  driverKNN.fut:408:15-73\n   #5  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 72:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:59:27-36\n   #1  driverKNN.fut:357:27-82\n   #2  /prelude/soacs.fut:72:25-33\n   #3  /prelude/soacs.fut:72:3-53\n   #4  driverKNN.fut:353:9-358:64\n   #5  driverKNN.fut:408:15-73\n   #6  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 73:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:60:19-62:45\n   #1  driverKNN.fut:357:27-82\n   #2  /prelude/soacs.fut:72:25-33\n   #3  /prelude/soacs.fut:72:3-53\n   #4  driverKNN.fut:353:9-358:64\n   #5  driverKNN.fut:408:15-73\n   #6  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 74:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:14-21\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:357:27-82\n   #3  /prelude/soacs.fut:72:25-33\n   #4  /prelude/soacs.fut:72:3-53\n   #5  driverKNN.fut:353:9-358:64\n   #6  driverKNN.fut:408:15-73\n   #7  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 75:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  brute-force.fut:34:27-34\n   #1  brute-force.fut:64:18-39\n   #2  driverKNN.fut:357:27-82\n   #3  /prelude/soacs.fut:72:25-33\n   #4  /prelude/soacs.fut:72:3-53\n   #5  driverKNN.fut:353:9-358:64\n   #6  driverKNN.fut:408:15-73\n   #7  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 76:
                {
                    ctx->error =
                        msgprintf("Index [%d] out of bounds for array of shape [%d].\n-> #0  driverKNN.fut:413:48-57\n   #1  driverKNN.fut:413:35-64\n   #2  driverKNN.fut:413:20-75\n   #3  driverKNN.fut:392:1-414:28\n",
                                  args[0], args[1]);
                    break;
                }
                
              case 77:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d, %d] out of bounds for array of shape [%d][%d][%d].\n-> #0  driverKNN.fut:108:42-58\n   #1  driverKNN.fut:103:23-109:44\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:100:5-129:27\n   #5  driverKNN.fut:90:1-131:38\n",
                                  args[0], args[1], args[2], args[3], args[4],
                                  args[5]);
                    break;
                }
                
              case 78:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d, %d] out of bounds for array of shape [%d][%d][%d].\n-> #0  driverKNN.fut:121:40-58\n   #1  driverKNN.fut:116:15-125:36\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:100:5-129:27\n   #5  driverKNN.fut:90:1-131:38\n",
                                  args[0], args[1], args[2], args[3], args[4],
                                  args[5]);
                    break;
                }
                
              case 79:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d, %d] out of bounds for array of shape [%d][%d][%d].\n-> #0  driverKNN.fut:108:42-58\n   #1  driverKNN.fut:103:23-109:44\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:100:5-129:27\n   #5  driverKNN.fut:90:1-131:38\n",
                                  args[0], args[1], args[2], args[3], args[4],
                                  args[5]);
                    break;
                }
                
              case 80:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d, %d] out of bounds for array of shape [%d][%d][%d].\n-> #0  driverKNN.fut:121:40-58\n   #1  driverKNN.fut:116:15-125:36\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:100:5-129:27\n   #5  driverKNN.fut:90:1-131:38\n",
                                  args[0], args[1], args[2], args[3], args[4],
                                  args[5]);
                    break;
                }
                
              case 81:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d, %d] out of bounds for array of shape [%d][%d][%d].\n-> #0  driverKNN.fut:108:42-58\n   #1  driverKNN.fut:103:23-109:44\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:100:5-129:27\n   #5  driverKNN.fut:90:1-131:38\n",
                                  args[0], args[1], args[2], args[3], args[4],
                                  args[5]);
                    break;
                }
                
              case 82:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d, %d] out of bounds for array of shape [%d][%d][%d].\n-> #0  driverKNN.fut:121:40-58\n   #1  driverKNN.fut:116:15-125:36\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:100:5-129:27\n   #5  driverKNN.fut:90:1-131:38\n",
                                  args[0], args[1], args[2], args[3], args[4],
                                  args[5]);
                    break;
                }
                
              case 83:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d, %d] out of bounds for array of shape [%d][%d][%d].\n-> #0  driverKNN.fut:108:42-58\n   #1  driverKNN.fut:103:23-109:44\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:100:5-129:27\n   #5  driverKNN.fut:90:1-131:38\n",
                                  args[0], args[1], args[2], args[3], args[4],
                                  args[5]);
                    break;
                }
                
              case 84:
                {
                    ctx->error =
                        msgprintf("Index [%d, %d, %d] out of bounds for array of shape [%d][%d][%d].\n-> #0  driverKNN.fut:121:40-58\n   #1  driverKNN.fut:116:15-125:36\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:100:5-129:27\n   #5  driverKNN.fut:90:1-131:38\n",
                                  args[0], args[1], args[2], args[3], args[4],
                                  args[5]);
                    break;
                }
            }
            return 1;
        }
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    return 0;
}
int futhark_context_clear_caches(struct futhark_context *ctx)
{
    CUDA_SUCCEED(cuda_free_all(&ctx->cuda));
    return 0;
}
static int memblock_unref_device(struct futhark_context *ctx,
                                 struct memblock_device *block, const
                                 char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(stderr,
                    "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n",
                    desc, block->desc, "space 'device'", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_device -= block->size;
            CUDA_SUCCEED(cuda_free(&ctx->cuda, block->mem, desc));
            free(block->references);
            if (ctx->detail_memory)
                fprintf(stderr,
                        "%lld bytes freed (now allocated: %lld bytes)\n",
                        (long long) block->size,
                        (long long) ctx->cur_mem_usage_device);
        }
        block->references = NULL;
    }
    return 0;
}
static int memblock_alloc_device(struct futhark_context *ctx,
                                 struct memblock_device *block, int64_t size,
                                 const char *desc)
{
    if (size < 0)
        futhark_panic(1,
                      "Negative allocation of %lld bytes attempted for %s in %s.\n",
                      (long long) size, desc, "space 'device'",
                      ctx->cur_mem_usage_device);
    
    int ret = memblock_unref_device(ctx, block, desc);
    
    ctx->cur_mem_usage_device += size;
    if (ctx->detail_memory)
        fprintf(stderr,
                "Allocating %lld bytes for %s in %s (then allocated: %lld bytes)",
                (long long) size, desc, "space 'device'",
                (long long) ctx->cur_mem_usage_device);
    if (ctx->cur_mem_usage_device > ctx->peak_mem_usage_device) {
        ctx->peak_mem_usage_device = ctx->cur_mem_usage_device;
        if (ctx->detail_memory)
            fprintf(stderr, " (new peak).\n");
    } else if (ctx->detail_memory)
        fprintf(stderr, ".\n");
    CUDA_SUCCEED(cuda_alloc(&ctx->cuda, size, desc, &block->mem));
    block->references = (int *) malloc(sizeof(int));
    *block->references = 1;
    block->size = size;
    block->desc = desc;
    return ret;
}
static int memblock_set_device(struct futhark_context *ctx,
                               struct memblock_device *lhs,
                               struct memblock_device *rhs, const
                               char *lhs_desc)
{
    int ret = memblock_unref_device(ctx, lhs, lhs_desc);
    
    (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
static int memblock_unref(struct futhark_context *ctx, struct memblock *block,
                          const char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(stderr,
                    "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n",
                    desc, block->desc, "default space", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_default -= block->size;
            free(block->mem);
            free(block->references);
            if (ctx->detail_memory)
                fprintf(stderr,
                        "%lld bytes freed (now allocated: %lld bytes)\n",
                        (long long) block->size,
                        (long long) ctx->cur_mem_usage_default);
        }
        block->references = NULL;
    }
    return 0;
}
static int memblock_alloc(struct futhark_context *ctx, struct memblock *block,
                          int64_t size, const char *desc)
{
    if (size < 0)
        futhark_panic(1,
                      "Negative allocation of %lld bytes attempted for %s in %s.\n",
                      (long long) size, desc, "default space",
                      ctx->cur_mem_usage_default);
    
    int ret = memblock_unref(ctx, block, desc);
    
    ctx->cur_mem_usage_default += size;
    if (ctx->detail_memory)
        fprintf(stderr,
                "Allocating %lld bytes for %s in %s (then allocated: %lld bytes)",
                (long long) size, desc, "default space",
                (long long) ctx->cur_mem_usage_default);
    if (ctx->cur_mem_usage_default > ctx->peak_mem_usage_default) {
        ctx->peak_mem_usage_default = ctx->cur_mem_usage_default;
        if (ctx->detail_memory)
            fprintf(stderr, " (new peak).\n");
    } else if (ctx->detail_memory)
        fprintf(stderr, ".\n");
    block->mem = (char *) malloc(size);
    block->references = (int *) malloc(sizeof(int));
    *block->references = 1;
    block->size = size;
    block->desc = desc;
    return ret;
}
static int memblock_set(struct futhark_context *ctx, struct memblock *lhs,
                        struct memblock *rhs, const char *lhs_desc)
{
    int ret = memblock_unref(ctx, lhs, lhs_desc);
    
    (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
char *futhark_context_report(struct futhark_context *ctx)
{
    struct str_builder builder;
    
    str_builder_init(&builder);
    if (ctx->detail_memory || ctx->profiling) {
        str_builder(&builder,
                    "Peak memory usage for space 'device': %lld bytes.\n",
                    (long long) ctx->peak_mem_usage_device);
        { }
    }
    if (ctx->profiling) {
        CUDA_SUCCEED(cuda_tally_profiling_records(&ctx->cuda));
        str_builder(&builder,
                    "copy_dev_to_dev                         ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_dev_to_dev_runs,
                    (long) ctx->copy_dev_to_dev_total_runtime /
                    (ctx->copy_dev_to_dev_runs !=
                     0 ? ctx->copy_dev_to_dev_runs : 1),
                    (long) ctx->copy_dev_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_dev_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_dev_to_dev_runs;
        str_builder(&builder,
                    "copy_dev_to_host                        ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_dev_to_host_runs,
                    (long) ctx->copy_dev_to_host_total_runtime /
                    (ctx->copy_dev_to_host_runs !=
                     0 ? ctx->copy_dev_to_host_runs : 1),
                    (long) ctx->copy_dev_to_host_total_runtime);
        ctx->total_runtime += ctx->copy_dev_to_host_total_runtime;
        ctx->total_runs += ctx->copy_dev_to_host_runs;
        str_builder(&builder,
                    "copy_host_to_dev                        ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_host_to_dev_runs,
                    (long) ctx->copy_host_to_dev_total_runtime /
                    (ctx->copy_host_to_dev_runs !=
                     0 ? ctx->copy_host_to_dev_runs : 1),
                    (long) ctx->copy_host_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_host_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_host_to_dev_runs;
        str_builder(&builder,
                    "copy_scalar_to_dev                      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_scalar_to_dev_runs,
                    (long) ctx->copy_scalar_to_dev_total_runtime /
                    (ctx->copy_scalar_to_dev_runs !=
                     0 ? ctx->copy_scalar_to_dev_runs : 1),
                    (long) ctx->copy_scalar_to_dev_total_runtime);
        ctx->total_runtime += ctx->copy_scalar_to_dev_total_runtime;
        ctx->total_runs += ctx->copy_scalar_to_dev_runs;
        str_builder(&builder,
                    "copy_scalar_from_dev                    ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->copy_scalar_from_dev_runs,
                    (long) ctx->copy_scalar_from_dev_total_runtime /
                    (ctx->copy_scalar_from_dev_runs !=
                     0 ? ctx->copy_scalar_from_dev_runs : 1),
                    (long) ctx->copy_scalar_from_dev_total_runtime);
        ctx->total_runtime += ctx->copy_scalar_from_dev_total_runtime;
        ctx->total_runs += ctx->copy_scalar_from_dev_runs;
        str_builder(&builder,
                    "buildKDtree.replicate_40593             ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezireplicate_40593_runs,
                    (long) ctx->buildKDtreezireplicate_40593_total_runtime /
                    (ctx->buildKDtreezireplicate_40593_runs !=
                     0 ? ctx->buildKDtreezireplicate_40593_runs : 1),
                    (long) ctx->buildKDtreezireplicate_40593_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezireplicate_40593_total_runtime;
        ctx->total_runs += ctx->buildKDtreezireplicate_40593_runs;
        str_builder(&builder,
                    "buildKDtree.scan_stage1_37746           ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreeziscan_stage1_37746_runs,
                    (long) ctx->buildKDtreeziscan_stage1_37746_total_runtime /
                    (ctx->buildKDtreeziscan_stage1_37746_runs !=
                     0 ? ctx->buildKDtreeziscan_stage1_37746_runs : 1),
                    (long) ctx->buildKDtreeziscan_stage1_37746_total_runtime);
        ctx->total_runtime += ctx->buildKDtreeziscan_stage1_37746_total_runtime;
        ctx->total_runs += ctx->buildKDtreeziscan_stage1_37746_runs;
        str_builder(&builder,
                    "buildKDtree.scan_stage2_37746           ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreeziscan_stage2_37746_runs,
                    (long) ctx->buildKDtreeziscan_stage2_37746_total_runtime /
                    (ctx->buildKDtreeziscan_stage2_37746_runs !=
                     0 ? ctx->buildKDtreeziscan_stage2_37746_runs : 1),
                    (long) ctx->buildKDtreeziscan_stage2_37746_total_runtime);
        ctx->total_runtime += ctx->buildKDtreeziscan_stage2_37746_total_runtime;
        ctx->total_runs += ctx->buildKDtreeziscan_stage2_37746_runs;
        str_builder(&builder,
                    "buildKDtree.scan_stage3_37746           ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreeziscan_stage3_37746_runs,
                    (long) ctx->buildKDtreeziscan_stage3_37746_total_runtime /
                    (ctx->buildKDtreeziscan_stage3_37746_runs !=
                     0 ? ctx->buildKDtreeziscan_stage3_37746_runs : 1),
                    (long) ctx->buildKDtreeziscan_stage3_37746_total_runtime);
        ctx->total_runtime += ctx->buildKDtreeziscan_stage3_37746_total_runtime;
        ctx->total_runs += ctx->buildKDtreeziscan_stage3_37746_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_36314                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_36314_runs,
                    (long) ctx->buildKDtreezisegmap_36314_total_runtime /
                    (ctx->buildKDtreezisegmap_36314_runs !=
                     0 ? ctx->buildKDtreezisegmap_36314_runs : 1),
                    (long) ctx->buildKDtreezisegmap_36314_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_36314_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_36314_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_36375                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_36375_runs,
                    (long) ctx->buildKDtreezisegmap_36375_total_runtime /
                    (ctx->buildKDtreezisegmap_36375_runs !=
                     0 ? ctx->buildKDtreezisegmap_36375_runs : 1),
                    (long) ctx->buildKDtreezisegmap_36375_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_36375_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_36375_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_36436                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_36436_runs,
                    (long) ctx->buildKDtreezisegmap_36436_total_runtime /
                    (ctx->buildKDtreezisegmap_36436_runs !=
                     0 ? ctx->buildKDtreezisegmap_36436_runs : 1),
                    (long) ctx->buildKDtreezisegmap_36436_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_36436_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_36436_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_36628                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_36628_runs,
                    (long) ctx->buildKDtreezisegmap_36628_total_runtime /
                    (ctx->buildKDtreezisegmap_36628_runs !=
                     0 ? ctx->buildKDtreezisegmap_36628_runs : 1),
                    (long) ctx->buildKDtreezisegmap_36628_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_36628_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_36628_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_36748                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_36748_runs,
                    (long) ctx->buildKDtreezisegmap_36748_total_runtime /
                    (ctx->buildKDtreezisegmap_36748_runs !=
                     0 ? ctx->buildKDtreezisegmap_36748_runs : 1),
                    (long) ctx->buildKDtreezisegmap_36748_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_36748_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_36748_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_36942                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_36942_runs,
                    (long) ctx->buildKDtreezisegmap_36942_total_runtime /
                    (ctx->buildKDtreezisegmap_36942_runs !=
                     0 ? ctx->buildKDtreezisegmap_36942_runs : 1),
                    (long) ctx->buildKDtreezisegmap_36942_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_36942_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_36942_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_37340                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_37340_runs,
                    (long) ctx->buildKDtreezisegmap_37340_total_runtime /
                    (ctx->buildKDtreezisegmap_37340_runs !=
                     0 ? ctx->buildKDtreezisegmap_37340_runs : 1),
                    (long) ctx->buildKDtreezisegmap_37340_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_37340_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_37340_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_37675                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_37675_runs,
                    (long) ctx->buildKDtreezisegmap_37675_total_runtime /
                    (ctx->buildKDtreezisegmap_37675_runs !=
                     0 ? ctx->buildKDtreezisegmap_37675_runs : 1),
                    (long) ctx->buildKDtreezisegmap_37675_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_37675_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_37675_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_37946                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_37946_runs,
                    (long) ctx->buildKDtreezisegmap_37946_total_runtime /
                    (ctx->buildKDtreezisegmap_37946_runs !=
                     0 ? ctx->buildKDtreezisegmap_37946_runs : 1),
                    (long) ctx->buildKDtreezisegmap_37946_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_37946_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_37946_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_37990                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_37990_runs,
                    (long) ctx->buildKDtreezisegmap_37990_total_runtime /
                    (ctx->buildKDtreezisegmap_37990_runs !=
                     0 ? ctx->buildKDtreezisegmap_37990_runs : 1),
                    (long) ctx->buildKDtreezisegmap_37990_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_37990_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_37990_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_38311                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_38311_runs,
                    (long) ctx->buildKDtreezisegmap_38311_total_runtime /
                    (ctx->buildKDtreezisegmap_38311_runs !=
                     0 ? ctx->buildKDtreezisegmap_38311_runs : 1),
                    (long) ctx->buildKDtreezisegmap_38311_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_38311_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_38311_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_38398                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_38398_runs,
                    (long) ctx->buildKDtreezisegmap_38398_total_runtime /
                    (ctx->buildKDtreezisegmap_38398_runs !=
                     0 ? ctx->buildKDtreezisegmap_38398_runs : 1),
                    (long) ctx->buildKDtreezisegmap_38398_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_38398_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_38398_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_38442                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_38442_runs,
                    (long) ctx->buildKDtreezisegmap_38442_total_runtime /
                    (ctx->buildKDtreezisegmap_38442_runs !=
                     0 ? ctx->buildKDtreezisegmap_38442_runs : 1),
                    (long) ctx->buildKDtreezisegmap_38442_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_38442_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_38442_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_38502                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_38502_runs,
                    (long) ctx->buildKDtreezisegmap_38502_total_runtime /
                    (ctx->buildKDtreezisegmap_38502_runs !=
                     0 ? ctx->buildKDtreezisegmap_38502_runs : 1),
                    (long) ctx->buildKDtreezisegmap_38502_total_runtime);
        ctx->total_runtime += ctx->buildKDtreezisegmap_38502_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_38502_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_intragroup_36940     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_intragroup_36940_runs,
                    (long) ctx->buildKDtreezisegmap_intragroup_36940_total_runtime /
                    (ctx->buildKDtreezisegmap_intragroup_36940_runs !=
                     0 ? ctx->buildKDtreezisegmap_intragroup_36940_runs : 1),
                    (long) ctx->buildKDtreezisegmap_intragroup_36940_total_runtime);
        ctx->total_runtime +=
            ctx->buildKDtreezisegmap_intragroup_36940_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_intragroup_36940_runs;
        str_builder(&builder,
                    "buildKDtree.segmap_intragroup_37393     ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegmap_intragroup_37393_runs,
                    (long) ctx->buildKDtreezisegmap_intragroup_37393_total_runtime /
                    (ctx->buildKDtreezisegmap_intragroup_37393_runs !=
                     0 ? ctx->buildKDtreezisegmap_intragroup_37393_runs : 1),
                    (long) ctx->buildKDtreezisegmap_intragroup_37393_total_runtime);
        ctx->total_runtime +=
            ctx->buildKDtreezisegmap_intragroup_37393_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegmap_intragroup_37393_runs;
        str_builder(&builder,
                    "buildKDtree.segred_large_36352          ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegred_large_36352_runs,
                    (long) ctx->buildKDtreezisegred_large_36352_total_runtime /
                    (ctx->buildKDtreezisegred_large_36352_runs !=
                     0 ? ctx->buildKDtreezisegred_large_36352_runs : 1),
                    (long) ctx->buildKDtreezisegred_large_36352_total_runtime);
        ctx->total_runtime +=
            ctx->buildKDtreezisegred_large_36352_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegred_large_36352_runs;
        str_builder(&builder,
                    "buildKDtree.segred_large_36413          ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegred_large_36413_runs,
                    (long) ctx->buildKDtreezisegred_large_36413_total_runtime /
                    (ctx->buildKDtreezisegred_large_36413_runs !=
                     0 ? ctx->buildKDtreezisegred_large_36413_runs : 1),
                    (long) ctx->buildKDtreezisegred_large_36413_total_runtime);
        ctx->total_runtime +=
            ctx->buildKDtreezisegred_large_36413_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegred_large_36413_runs;
        str_builder(&builder,
                    "buildKDtree.segred_large_36675          ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegred_large_36675_runs,
                    (long) ctx->buildKDtreezisegred_large_36675_total_runtime /
                    (ctx->buildKDtreezisegred_large_36675_runs !=
                     0 ? ctx->buildKDtreezisegred_large_36675_runs : 1),
                    (long) ctx->buildKDtreezisegred_large_36675_total_runtime);
        ctx->total_runtime +=
            ctx->buildKDtreezisegred_large_36675_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegred_large_36675_runs;
        str_builder(&builder,
                    "buildKDtree.segred_small_36352          ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegred_small_36352_runs,
                    (long) ctx->buildKDtreezisegred_small_36352_total_runtime /
                    (ctx->buildKDtreezisegred_small_36352_runs !=
                     0 ? ctx->buildKDtreezisegred_small_36352_runs : 1),
                    (long) ctx->buildKDtreezisegred_small_36352_total_runtime);
        ctx->total_runtime +=
            ctx->buildKDtreezisegred_small_36352_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegred_small_36352_runs;
        str_builder(&builder,
                    "buildKDtree.segred_small_36413          ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegred_small_36413_runs,
                    (long) ctx->buildKDtreezisegred_small_36413_total_runtime /
                    (ctx->buildKDtreezisegred_small_36413_runs !=
                     0 ? ctx->buildKDtreezisegred_small_36413_runs : 1),
                    (long) ctx->buildKDtreezisegred_small_36413_total_runtime);
        ctx->total_runtime +=
            ctx->buildKDtreezisegred_small_36413_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegred_small_36413_runs;
        str_builder(&builder,
                    "buildKDtree.segred_small_36675          ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->buildKDtreezisegred_small_36675_runs,
                    (long) ctx->buildKDtreezisegred_small_36675_total_runtime /
                    (ctx->buildKDtreezisegred_small_36675_runs !=
                     0 ? ctx->buildKDtreezisegred_small_36675_runs : 1),
                    (long) ctx->buildKDtreezisegred_small_36675_total_runtime);
        ctx->total_runtime +=
            ctx->buildKDtreezisegred_small_36675_total_runtime;
        ctx->total_runs += ctx->buildKDtreezisegred_small_36675_runs;
        str_builder(&builder,
                    "builtin#iota_i32.iota_i32_40454         ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->builtinzhiota_i32ziiota_i32_40454_runs,
                    (long) ctx->builtinzhiota_i32ziiota_i32_40454_total_runtime /
                    (ctx->builtinzhiota_i32ziiota_i32_40454_runs !=
                     0 ? ctx->builtinzhiota_i32ziiota_i32_40454_runs : 1),
                    (long) ctx->builtinzhiota_i32ziiota_i32_40454_total_runtime);
        ctx->total_runtime +=
            ctx->builtinzhiota_i32ziiota_i32_40454_total_runtime;
        ctx->total_runs += ctx->builtinzhiota_i32ziiota_i32_40454_runs;
        str_builder(&builder,
                    "builtin#replicate_f32.replicate_40463   ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->builtinzhreplicate_f32zireplicate_40463_runs,
                    (long) ctx->builtinzhreplicate_f32zireplicate_40463_total_runtime /
                    (ctx->builtinzhreplicate_f32zireplicate_40463_runs !=
                     0 ? ctx->builtinzhreplicate_f32zireplicate_40463_runs : 1),
                    (long) ctx->builtinzhreplicate_f32zireplicate_40463_total_runtime);
        ctx->total_runtime +=
            ctx->builtinzhreplicate_f32zireplicate_40463_total_runtime;
        ctx->total_runs += ctx->builtinzhreplicate_f32zireplicate_40463_runs;
        str_builder(&builder,
                    "builtin#replicate_i32.replicate_40472   ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->builtinzhreplicate_i32zireplicate_40472_runs,
                    (long) ctx->builtinzhreplicate_i32zireplicate_40472_total_runtime /
                    (ctx->builtinzhreplicate_i32zireplicate_40472_runs !=
                     0 ? ctx->builtinzhreplicate_i32zireplicate_40472_runs : 1),
                    (long) ctx->builtinzhreplicate_i32zireplicate_40472_total_runtime);
        ctx->total_runtime +=
            ctx->builtinzhreplicate_i32zireplicate_40472_total_runtime;
        ctx->total_runs += ctx->builtinzhreplicate_i32zireplicate_40472_runs;
        str_builder(&builder,
                    "exactKnnFixK.copy_40302                 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->exactKnnFixKzicopy_40302_runs,
                    (long) ctx->exactKnnFixKzicopy_40302_total_runtime /
                    (ctx->exactKnnFixKzicopy_40302_runs !=
                     0 ? ctx->exactKnnFixKzicopy_40302_runs : 1),
                    (long) ctx->exactKnnFixKzicopy_40302_total_runtime);
        ctx->total_runtime += ctx->exactKnnFixKzicopy_40302_total_runtime;
        ctx->total_runs += ctx->exactKnnFixKzicopy_40302_runs;
        str_builder(&builder,
                    "exactKnnFixK.copy_40307                 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->exactKnnFixKzicopy_40307_runs,
                    (long) ctx->exactKnnFixKzicopy_40307_total_runtime /
                    (ctx->exactKnnFixKzicopy_40307_runs !=
                     0 ? ctx->exactKnnFixKzicopy_40307_runs : 1),
                    (long) ctx->exactKnnFixKzicopy_40307_total_runtime);
        ctx->total_runtime += ctx->exactKnnFixKzicopy_40307_total_runtime;
        ctx->total_runs += ctx->exactKnnFixKzicopy_40307_runs;
        str_builder(&builder,
                    "exactKnnFixK.segmap_33962               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->exactKnnFixKzisegmap_33962_runs,
                    (long) ctx->exactKnnFixKzisegmap_33962_total_runtime /
                    (ctx->exactKnnFixKzisegmap_33962_runs !=
                     0 ? ctx->exactKnnFixKzisegmap_33962_runs : 1),
                    (long) ctx->exactKnnFixKzisegmap_33962_total_runtime);
        ctx->total_runtime += ctx->exactKnnFixKzisegmap_33962_total_runtime;
        ctx->total_runs += ctx->exactKnnFixKzisegmap_33962_runs;
        str_builder(&builder,
                    "exactKnnFixK.segmap_34321               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->exactKnnFixKzisegmap_34321_runs,
                    (long) ctx->exactKnnFixKzisegmap_34321_total_runtime /
                    (ctx->exactKnnFixKzisegmap_34321_runs !=
                     0 ? ctx->exactKnnFixKzisegmap_34321_runs : 1),
                    (long) ctx->exactKnnFixKzisegmap_34321_total_runtime);
        ctx->total_runtime += ctx->exactKnnFixKzisegmap_34321_total_runtime;
        ctx->total_runs += ctx->exactKnnFixKzisegmap_34321_runs;
        str_builder(&builder,
                    "exactKnnFixK.segmap_intragroup_33960    ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->exactKnnFixKzisegmap_intragroup_33960_runs,
                    (long) ctx->exactKnnFixKzisegmap_intragroup_33960_total_runtime /
                    (ctx->exactKnnFixKzisegmap_intragroup_33960_runs !=
                     0 ? ctx->exactKnnFixKzisegmap_intragroup_33960_runs : 1),
                    (long) ctx->exactKnnFixKzisegmap_intragroup_33960_total_runtime);
        ctx->total_runtime +=
            ctx->exactKnnFixKzisegmap_intragroup_33960_total_runtime;
        ctx->total_runs += ctx->exactKnnFixKzisegmap_intragroup_33960_runs;
        str_builder(&builder,
                    "exactKnnFixK.segred_nonseg_33941        ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->exactKnnFixKzisegred_nonseg_33941_runs,
                    (long) ctx->exactKnnFixKzisegred_nonseg_33941_total_runtime /
                    (ctx->exactKnnFixKzisegred_nonseg_33941_runs !=
                     0 ? ctx->exactKnnFixKzisegred_nonseg_33941_runs : 1),
                    (long) ctx->exactKnnFixKzisegred_nonseg_33941_total_runtime);
        ctx->total_runtime +=
            ctx->exactKnnFixKzisegred_nonseg_33941_total_runtime;
        ctx->total_runs += ctx->exactKnnFixKzisegred_nonseg_33941_runs;
        str_builder(&builder,
                    "findNaturalLeavesFixK.scan_stage1_35797 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->findNaturalLeavesFixKziscan_stage1_35797_runs,
                    (long) ctx->findNaturalLeavesFixKziscan_stage1_35797_total_runtime /
                    (ctx->findNaturalLeavesFixKziscan_stage1_35797_runs !=
                     0 ? ctx->findNaturalLeavesFixKziscan_stage1_35797_runs : 1),
                    (long) ctx->findNaturalLeavesFixKziscan_stage1_35797_total_runtime);
        ctx->total_runtime +=
            ctx->findNaturalLeavesFixKziscan_stage1_35797_total_runtime;
        ctx->total_runs += ctx->findNaturalLeavesFixKziscan_stage1_35797_runs;
        str_builder(&builder,
                    "findNaturalLeavesFixK.scan_stage2_35797 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->findNaturalLeavesFixKziscan_stage2_35797_runs,
                    (long) ctx->findNaturalLeavesFixKziscan_stage2_35797_total_runtime /
                    (ctx->findNaturalLeavesFixKziscan_stage2_35797_runs !=
                     0 ? ctx->findNaturalLeavesFixKziscan_stage2_35797_runs : 1),
                    (long) ctx->findNaturalLeavesFixKziscan_stage2_35797_total_runtime);
        ctx->total_runtime +=
            ctx->findNaturalLeavesFixKziscan_stage2_35797_total_runtime;
        ctx->total_runs += ctx->findNaturalLeavesFixKziscan_stage2_35797_runs;
        str_builder(&builder,
                    "findNaturalLeavesFixK.scan_stage3_35797 ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->findNaturalLeavesFixKziscan_stage3_35797_runs,
                    (long) ctx->findNaturalLeavesFixKziscan_stage3_35797_total_runtime /
                    (ctx->findNaturalLeavesFixKziscan_stage3_35797_runs !=
                     0 ? ctx->findNaturalLeavesFixKziscan_stage3_35797_runs : 1),
                    (long) ctx->findNaturalLeavesFixKziscan_stage3_35797_total_runtime);
        ctx->total_runtime +=
            ctx->findNaturalLeavesFixKziscan_stage3_35797_total_runtime;
        ctx->total_runs += ctx->findNaturalLeavesFixKziscan_stage3_35797_runs;
        str_builder(&builder,
                    "findNaturalLeavesFixK.segmap_35722      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->findNaturalLeavesFixKzisegmap_35722_runs,
                    (long) ctx->findNaturalLeavesFixKzisegmap_35722_total_runtime /
                    (ctx->findNaturalLeavesFixKzisegmap_35722_runs !=
                     0 ? ctx->findNaturalLeavesFixKzisegmap_35722_runs : 1),
                    (long) ctx->findNaturalLeavesFixKzisegmap_35722_total_runtime);
        ctx->total_runtime +=
            ctx->findNaturalLeavesFixKzisegmap_35722_total_runtime;
        ctx->total_runs += ctx->findNaturalLeavesFixKzisegmap_35722_runs;
        str_builder(&builder,
                    "findNaturalLeavesFixK.segmap_35799      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->findNaturalLeavesFixKzisegmap_35799_runs,
                    (long) ctx->findNaturalLeavesFixKzisegmap_35799_total_runtime /
                    (ctx->findNaturalLeavesFixKzisegmap_35799_runs !=
                     0 ? ctx->findNaturalLeavesFixKzisegmap_35799_runs : 1),
                    (long) ctx->findNaturalLeavesFixKzisegmap_35799_total_runtime);
        ctx->total_runtime +=
            ctx->findNaturalLeavesFixKzisegmap_35799_total_runtime;
        ctx->total_runs += ctx->findNaturalLeavesFixKzisegmap_35799_runs;
        str_builder(&builder,
                    "findNaturalLeavesFixK.segmap_36062      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->findNaturalLeavesFixKzisegmap_36062_runs,
                    (long) ctx->findNaturalLeavesFixKzisegmap_36062_total_runtime /
                    (ctx->findNaturalLeavesFixKzisegmap_36062_runs !=
                     0 ? ctx->findNaturalLeavesFixKzisegmap_36062_runs : 1),
                    (long) ctx->findNaturalLeavesFixKzisegmap_36062_total_runtime);
        ctx->total_runtime +=
            ctx->findNaturalLeavesFixKzisegmap_36062_total_runtime;
        ctx->total_runs += ctx->findNaturalLeavesFixKzisegmap_36062_runs;
        str_builder(&builder,
                    "findNaturalLeavesFixK.segmap_36146      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->findNaturalLeavesFixKzisegmap_36146_runs,
                    (long) ctx->findNaturalLeavesFixKzisegmap_36146_total_runtime /
                    (ctx->findNaturalLeavesFixKzisegmap_36146_runs !=
                     0 ? ctx->findNaturalLeavesFixKzisegmap_36146_runs : 1),
                    (long) ctx->findNaturalLeavesFixKzisegmap_36146_total_runtime);
        ctx->total_runtime +=
            ctx->findNaturalLeavesFixKzisegmap_36146_total_runtime;
        ctx->total_runs += ctx->findNaturalLeavesFixKzisegmap_36146_runs;
        str_builder(&builder,
                    "findNaturalLeavesFixK.segmap_36186      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->findNaturalLeavesFixKzisegmap_36186_runs,
                    (long) ctx->findNaturalLeavesFixKzisegmap_36186_total_runtime /
                    (ctx->findNaturalLeavesFixKzisegmap_36186_runs !=
                     0 ? ctx->findNaturalLeavesFixKzisegmap_36186_runs : 1),
                    (long) ctx->findNaturalLeavesFixKzisegmap_36186_total_runtime);
        ctx->total_runtime +=
            ctx->findNaturalLeavesFixKzisegmap_36186_total_runtime;
        ctx->total_runs += ctx->findNaturalLeavesFixKzisegmap_36186_runs;
        str_builder(&builder,
                    "findNaturalLeavesFixK.segmap_36303      ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->findNaturalLeavesFixKzisegmap_36303_runs,
                    (long) ctx->findNaturalLeavesFixKzisegmap_36303_total_runtime /
                    (ctx->findNaturalLeavesFixKzisegmap_36303_runs !=
                     0 ? ctx->findNaturalLeavesFixKzisegmap_36303_runs : 1),
                    (long) ctx->findNaturalLeavesFixKzisegmap_36303_total_runtime);
        ctx->total_runtime +=
            ctx->findNaturalLeavesFixKzisegmap_36303_total_runtime;
        ctx->total_runs += ctx->findNaturalLeavesFixKzisegmap_36303_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32                   ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_runs,
                    (long) ctx->gpu_map_transpose_f32_total_runtime /
                    (ctx->gpu_map_transpose_f32_runs !=
                     0 ? ctx->gpu_map_transpose_f32_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_f32_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_low_height        ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_low_height_runs,
                    (long) ctx->gpu_map_transpose_f32_low_height_total_runtime /
                    (ctx->gpu_map_transpose_f32_low_height_runs !=
                     0 ? ctx->gpu_map_transpose_f32_low_height_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_low_height_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_f32_low_height_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_low_height_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_low_width         ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_low_width_runs,
                    (long) ctx->gpu_map_transpose_f32_low_width_total_runtime /
                    (ctx->gpu_map_transpose_f32_low_width_runs !=
                     0 ? ctx->gpu_map_transpose_f32_low_width_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_low_width_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_f32_low_width_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_low_width_runs;
        str_builder(&builder,
                    "gpu_map_transpose_f32_small             ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_f32_small_runs,
                    (long) ctx->gpu_map_transpose_f32_small_total_runtime /
                    (ctx->gpu_map_transpose_f32_small_runs !=
                     0 ? ctx->gpu_map_transpose_f32_small_runs : 1),
                    (long) ctx->gpu_map_transpose_f32_small_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_f32_small_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_f32_small_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i32                   ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i32_runs,
                    (long) ctx->gpu_map_transpose_i32_total_runtime /
                    (ctx->gpu_map_transpose_i32_runs !=
                     0 ? ctx->gpu_map_transpose_i32_runs : 1),
                    (long) ctx->gpu_map_transpose_i32_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_i32_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i32_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i32_low_height        ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i32_low_height_runs,
                    (long) ctx->gpu_map_transpose_i32_low_height_total_runtime /
                    (ctx->gpu_map_transpose_i32_low_height_runs !=
                     0 ? ctx->gpu_map_transpose_i32_low_height_runs : 1),
                    (long) ctx->gpu_map_transpose_i32_low_height_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_i32_low_height_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i32_low_height_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i32_low_width         ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i32_low_width_runs,
                    (long) ctx->gpu_map_transpose_i32_low_width_total_runtime /
                    (ctx->gpu_map_transpose_i32_low_width_runs !=
                     0 ? ctx->gpu_map_transpose_i32_low_width_runs : 1),
                    (long) ctx->gpu_map_transpose_i32_low_width_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_i32_low_width_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i32_low_width_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i32_small             ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i32_small_runs,
                    (long) ctx->gpu_map_transpose_i32_small_total_runtime /
                    (ctx->gpu_map_transpose_i32_small_runs !=
                     0 ? ctx->gpu_map_transpose_i32_small_runs : 1),
                    (long) ctx->gpu_map_transpose_i32_small_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_i32_small_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i32_small_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i8                    ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i8_runs,
                    (long) ctx->gpu_map_transpose_i8_total_runtime /
                    (ctx->gpu_map_transpose_i8_runs !=
                     0 ? ctx->gpu_map_transpose_i8_runs : 1),
                    (long) ctx->gpu_map_transpose_i8_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_i8_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i8_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i8_low_height         ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i8_low_height_runs,
                    (long) ctx->gpu_map_transpose_i8_low_height_total_runtime /
                    (ctx->gpu_map_transpose_i8_low_height_runs !=
                     0 ? ctx->gpu_map_transpose_i8_low_height_runs : 1),
                    (long) ctx->gpu_map_transpose_i8_low_height_total_runtime);
        ctx->total_runtime +=
            ctx->gpu_map_transpose_i8_low_height_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i8_low_height_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i8_low_width          ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i8_low_width_runs,
                    (long) ctx->gpu_map_transpose_i8_low_width_total_runtime /
                    (ctx->gpu_map_transpose_i8_low_width_runs !=
                     0 ? ctx->gpu_map_transpose_i8_low_width_runs : 1),
                    (long) ctx->gpu_map_transpose_i8_low_width_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_i8_low_width_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i8_low_width_runs;
        str_builder(&builder,
                    "gpu_map_transpose_i8_small              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->gpu_map_transpose_i8_small_runs,
                    (long) ctx->gpu_map_transpose_i8_small_total_runtime /
                    (ctx->gpu_map_transpose_i8_small_runs !=
                     0 ? ctx->gpu_map_transpose_i8_small_runs : 1),
                    (long) ctx->gpu_map_transpose_i8_small_total_runtime);
        ctx->total_runtime += ctx->gpu_map_transpose_i8_small_total_runtime;
        ctx->total_runs += ctx->gpu_map_transpose_i8_small_runs;
        str_builder(&builder,
                    "mkImgPatches.segmap_38762               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->mkImgPatcheszisegmap_38762_runs,
                    (long) ctx->mkImgPatcheszisegmap_38762_total_runtime /
                    (ctx->mkImgPatcheszisegmap_38762_runs !=
                     0 ? ctx->mkImgPatcheszisegmap_38762_runs : 1),
                    (long) ctx->mkImgPatcheszisegmap_38762_total_runtime);
        ctx->total_runtime += ctx->mkImgPatcheszisegmap_38762_total_runtime;
        ctx->total_runs += ctx->mkImgPatcheszisegmap_38762_runs;
        str_builder(&builder,
                    "propagateFixK.copy_40323                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->propagateFixKzicopy_40323_runs,
                    (long) ctx->propagateFixKzicopy_40323_total_runtime /
                    (ctx->propagateFixKzicopy_40323_runs !=
                     0 ? ctx->propagateFixKzicopy_40323_runs : 1),
                    (long) ctx->propagateFixKzicopy_40323_total_runtime);
        ctx->total_runtime += ctx->propagateFixKzicopy_40323_total_runtime;
        ctx->total_runs += ctx->propagateFixKzicopy_40323_runs;
        str_builder(&builder,
                    "propagateFixK.copy_40328                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->propagateFixKzicopy_40328_runs,
                    (long) ctx->propagateFixKzicopy_40328_total_runtime /
                    (ctx->propagateFixKzicopy_40328_runs !=
                     0 ? ctx->propagateFixKzicopy_40328_runs : 1),
                    (long) ctx->propagateFixKzicopy_40328_total_runtime);
        ctx->total_runtime += ctx->propagateFixKzicopy_40328_total_runtime;
        ctx->total_runs += ctx->propagateFixKzicopy_40328_runs;
        str_builder(&builder,
                    "propagateFixK.copy_40366                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->propagateFixKzicopy_40366_runs,
                    (long) ctx->propagateFixKzicopy_40366_total_runtime /
                    (ctx->propagateFixKzicopy_40366_runs !=
                     0 ? ctx->propagateFixKzicopy_40366_runs : 1),
                    (long) ctx->propagateFixKzicopy_40366_total_runtime);
        ctx->total_runtime += ctx->propagateFixKzicopy_40366_total_runtime;
        ctx->total_runs += ctx->propagateFixKzicopy_40366_runs;
        str_builder(&builder,
                    "propagateFixK.copy_40371                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->propagateFixKzicopy_40371_runs,
                    (long) ctx->propagateFixKzicopy_40371_total_runtime /
                    (ctx->propagateFixKzicopy_40371_runs !=
                     0 ? ctx->propagateFixKzicopy_40371_runs : 1),
                    (long) ctx->propagateFixKzicopy_40371_total_runtime);
        ctx->total_runtime += ctx->propagateFixKzicopy_40371_total_runtime;
        ctx->total_runs += ctx->propagateFixKzicopy_40371_runs;
        str_builder(&builder,
                    "propagateFixK.copy_40410                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->propagateFixKzicopy_40410_runs,
                    (long) ctx->propagateFixKzicopy_40410_total_runtime /
                    (ctx->propagateFixKzicopy_40410_runs !=
                     0 ? ctx->propagateFixKzicopy_40410_runs : 1),
                    (long) ctx->propagateFixKzicopy_40410_total_runtime);
        ctx->total_runtime += ctx->propagateFixKzicopy_40410_total_runtime;
        ctx->total_runs += ctx->propagateFixKzicopy_40410_runs;
        str_builder(&builder,
                    "propagateFixK.copy_40415                ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->propagateFixKzicopy_40415_runs,
                    (long) ctx->propagateFixKzicopy_40415_total_runtime /
                    (ctx->propagateFixKzicopy_40415_runs !=
                     0 ? ctx->propagateFixKzicopy_40415_runs : 1),
                    (long) ctx->propagateFixKzicopy_40415_total_runtime);
        ctx->total_runtime += ctx->propagateFixKzicopy_40415_total_runtime;
        ctx->total_runs += ctx->propagateFixKzicopy_40415_runs;
        str_builder(&builder,
                    "propagateFixK.segmap_34700              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->propagateFixKzisegmap_34700_runs,
                    (long) ctx->propagateFixKzisegmap_34700_total_runtime /
                    (ctx->propagateFixKzisegmap_34700_runs !=
                     0 ? ctx->propagateFixKzisegmap_34700_runs : 1),
                    (long) ctx->propagateFixKzisegmap_34700_total_runtime);
        ctx->total_runtime += ctx->propagateFixKzisegmap_34700_total_runtime;
        ctx->total_runs += ctx->propagateFixKzisegmap_34700_runs;
        str_builder(&builder,
                    "propagateFixK.segmap_34912              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->propagateFixKzisegmap_34912_runs,
                    (long) ctx->propagateFixKzisegmap_34912_total_runtime /
                    (ctx->propagateFixKzisegmap_34912_runs !=
                     0 ? ctx->propagateFixKzisegmap_34912_runs : 1),
                    (long) ctx->propagateFixKzisegmap_34912_total_runtime);
        ctx->total_runtime += ctx->propagateFixKzisegmap_34912_total_runtime;
        ctx->total_runs += ctx->propagateFixKzisegmap_34912_runs;
        str_builder(&builder,
                    "propagateFixK.segmap_35287              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->propagateFixKzisegmap_35287_runs,
                    (long) ctx->propagateFixKzisegmap_35287_total_runtime /
                    (ctx->propagateFixKzisegmap_35287_runs !=
                     0 ? ctx->propagateFixKzisegmap_35287_runs : 1),
                    (long) ctx->propagateFixKzisegmap_35287_total_runtime);
        ctx->total_runtime += ctx->propagateFixKzisegmap_35287_total_runtime;
        ctx->total_runs += ctx->propagateFixKzisegmap_35287_runs;
        str_builder(&builder,
                    "propagateFixK.segmap_35593              ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->propagateFixKzisegmap_35593_runs,
                    (long) ctx->propagateFixKzisegmap_35593_total_runtime /
                    (ctx->propagateFixKzisegmap_35593_runs !=
                     0 ? ctx->propagateFixKzisegmap_35593_runs : 1),
                    (long) ctx->propagateFixKzisegmap_35593_total_runtime);
        ctx->total_runtime += ctx->propagateFixKzisegmap_35593_total_runtime;
        ctx->total_runs += ctx->propagateFixKzisegmap_35593_runs;
        str_builder(&builder,
                    "propagateFixK.segmap_intragroup_34910   ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->propagateFixKzisegmap_intragroup_34910_runs,
                    (long) ctx->propagateFixKzisegmap_intragroup_34910_total_runtime /
                    (ctx->propagateFixKzisegmap_intragroup_34910_runs !=
                     0 ? ctx->propagateFixKzisegmap_intragroup_34910_runs : 1),
                    (long) ctx->propagateFixKzisegmap_intragroup_34910_total_runtime);
        ctx->total_runtime +=
            ctx->propagateFixKzisegmap_intragroup_34910_total_runtime;
        ctx->total_runs += ctx->propagateFixKzisegmap_intragroup_34910_runs;
        str_builder(&builder,
                    "reducePatchDim.segmap_33764             ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->reducePatchDimzisegmap_33764_runs,
                    (long) ctx->reducePatchDimzisegmap_33764_total_runtime /
                    (ctx->reducePatchDimzisegmap_33764_runs !=
                     0 ? ctx->reducePatchDimzisegmap_33764_runs : 1),
                    (long) ctx->reducePatchDimzisegmap_33764_total_runtime);
        ctx->total_runtime += ctx->reducePatchDimzisegmap_33764_total_runtime;
        ctx->total_runs += ctx->reducePatchDimzisegmap_33764_runs;
        str_builder(&builder,
                    "reducePatchDim.segmap_33806             ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->reducePatchDimzisegmap_33806_runs,
                    (long) ctx->reducePatchDimzisegmap_33806_total_runtime /
                    (ctx->reducePatchDimzisegmap_33806_runs !=
                     0 ? ctx->reducePatchDimzisegmap_33806_runs : 1),
                    (long) ctx->reducePatchDimzisegmap_33806_total_runtime);
        ctx->total_runtime += ctx->reducePatchDimzisegmap_33806_total_runtime;
        ctx->total_runs += ctx->reducePatchDimzisegmap_33806_runs;
        str_builder(&builder,
                    "reducePatchDim.segred_large_33846       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->reducePatchDimzisegred_large_33846_runs,
                    (long) ctx->reducePatchDimzisegred_large_33846_total_runtime /
                    (ctx->reducePatchDimzisegred_large_33846_runs !=
                     0 ? ctx->reducePatchDimzisegred_large_33846_runs : 1),
                    (long) ctx->reducePatchDimzisegred_large_33846_total_runtime);
        ctx->total_runtime +=
            ctx->reducePatchDimzisegred_large_33846_total_runtime;
        ctx->total_runs += ctx->reducePatchDimzisegred_large_33846_runs;
        str_builder(&builder,
                    "reducePatchDim.segred_small_33846       ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->reducePatchDimzisegred_small_33846_runs,
                    (long) ctx->reducePatchDimzisegred_small_33846_total_runtime /
                    (ctx->reducePatchDimzisegred_small_33846_runs !=
                     0 ? ctx->reducePatchDimzisegred_small_33846_runs : 1),
                    (long) ctx->reducePatchDimzisegred_small_33846_total_runtime);
        ctx->total_runtime +=
            ctx->reducePatchDimzisegred_small_33846_total_runtime;
        ctx->total_runs += ctx->reducePatchDimzisegred_small_33846_runs;
        str_builder(&builder,
                    "selectBestNN.segmap_32876               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->selectBestNNzisegmap_32876_runs,
                    (long) ctx->selectBestNNzisegmap_32876_total_runtime /
                    (ctx->selectBestNNzisegmap_32876_runs !=
                     0 ? ctx->selectBestNNzisegmap_32876_runs : 1),
                    (long) ctx->selectBestNNzisegmap_32876_total_runtime);
        ctx->total_runtime += ctx->selectBestNNzisegmap_32876_total_runtime;
        ctx->total_runs += ctx->selectBestNNzisegmap_32876_runs;
        str_builder(&builder,
                    "selectBestNN.segmap_33132               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->selectBestNNzisegmap_33132_runs,
                    (long) ctx->selectBestNNzisegmap_33132_total_runtime /
                    (ctx->selectBestNNzisegmap_33132_runs !=
                     0 ? ctx->selectBestNNzisegmap_33132_runs : 1),
                    (long) ctx->selectBestNNzisegmap_33132_total_runtime);
        ctx->total_runtime += ctx->selectBestNNzisegmap_33132_total_runtime;
        ctx->total_runs += ctx->selectBestNNzisegmap_33132_runs;
        str_builder(&builder,
                    "selectBestNN.segmap_33234               ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->selectBestNNzisegmap_33234_runs,
                    (long) ctx->selectBestNNzisegmap_33234_total_runtime /
                    (ctx->selectBestNNzisegmap_33234_runs !=
                     0 ? ctx->selectBestNNzisegmap_33234_runs : 1),
                    (long) ctx->selectBestNNzisegmap_33234_total_runtime);
        ctx->total_runtime += ctx->selectBestNNzisegmap_33234_total_runtime;
        ctx->total_runs += ctx->selectBestNNzisegmap_33234_runs;
        str_builder(&builder,
                    "selectBestNN.segmap_intragroup_32874    ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->selectBestNNzisegmap_intragroup_32874_runs,
                    (long) ctx->selectBestNNzisegmap_intragroup_32874_total_runtime /
                    (ctx->selectBestNNzisegmap_intragroup_32874_runs !=
                     0 ? ctx->selectBestNNzisegmap_intragroup_32874_runs : 1),
                    (long) ctx->selectBestNNzisegmap_intragroup_32874_total_runtime);
        ctx->total_runtime +=
            ctx->selectBestNNzisegmap_intragroup_32874_total_runtime;
        ctx->total_runs += ctx->selectBestNNzisegmap_intragroup_32874_runs;
        str_builder(&builder,
                    "selectBestNN.segred_nonseg_32749        ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->selectBestNNzisegred_nonseg_32749_runs,
                    (long) ctx->selectBestNNzisegred_nonseg_32749_total_runtime /
                    (ctx->selectBestNNzisegred_nonseg_32749_runs !=
                     0 ? ctx->selectBestNNzisegred_nonseg_32749_runs : 1),
                    (long) ctx->selectBestNNzisegred_nonseg_32749_total_runtime);
        ctx->total_runtime +=
            ctx->selectBestNNzisegred_nonseg_32749_total_runtime;
        ctx->total_runs += ctx->selectBestNNzisegred_nonseg_32749_runs;
        str_builder(&builder,
                    "selectBestNN.segred_nonseg_33448        ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->selectBestNNzisegred_nonseg_33448_runs,
                    (long) ctx->selectBestNNzisegred_nonseg_33448_total_runtime /
                    (ctx->selectBestNNzisegred_nonseg_33448_runs !=
                     0 ? ctx->selectBestNNzisegred_nonseg_33448_runs : 1),
                    (long) ctx->selectBestNNzisegred_nonseg_33448_total_runtime);
        ctx->total_runtime +=
            ctx->selectBestNNzisegred_nonseg_33448_total_runtime;
        ctx->total_runs += ctx->selectBestNNzisegred_nonseg_33448_runs;
        str_builder(&builder,
                    "selectBestNN_BAD.copy_40308             ran %5d times; avg: %8ldus; total: %8ldus\n",
                    ctx->selectBestNN_BADzicopy_40308_runs,
                    (long) ctx->selectBestNN_BADzicopy_40308_total_runtime /
                    (ctx->selectBestNN_BADzicopy_40308_runs !=
                     0 ? ctx->selectBestNN_BADzicopy_40308_runs : 1),
                    (long) ctx->selectBestNN_BADzicopy_40308_total_runtime);
        ctx->total_runtime += ctx->selectBestNN_BADzicopy_40308_total_runtime;
        ctx->total_runs += ctx->selectBestNN_BADzicopy_40308_runs;
        str_builder(&builder, "%d operations with cumulative runtime: %6ldus\n",
                    ctx->total_runs, ctx->total_runtime);
    }
    return builder.str;
}
char *futhark_context_get_error(struct futhark_context *ctx)
{
    char *error = ctx->error;
    
    ctx->error = NULL;
    return error;
}
void futhark_context_pause_profiling(struct futhark_context *ctx)
{
    ctx->profiling_paused = 1;
}
void futhark_context_unpause_profiling(struct futhark_context *ctx)
{
    ctx->profiling_paused = 0;
}
static int futrts_buildKDtree(struct futhark_context *ctx,
                              int32_t *out_scalar_out_40833,
                              int32_t *out_scalar_out_40834,
                              int32_t *out_scalar_out_40835,
                              struct memblock_device *out_mem_p_40836,
                              int32_t *out_out_arrsizze_40837,
                              int32_t *out_out_arrsizze_40838,
                              struct memblock_device *out_mem_p_40839,
                              int32_t *out_out_arrsizze_40840,
                              struct memblock_device *out_mem_p_40841,
                              int32_t *out_out_arrsizze_40842,
                              struct memblock_device *out_mem_p_40843,
                              int32_t *out_out_arrsizze_40844,
                              struct memblock_device *out_mem_p_40845,
                              int32_t *out_out_arrsizze_40846,
                              struct memblock_device *out_mem_p_40847,
                              int32_t *out_out_arrsizze_40848,
                              struct memblock_device input_mem_39418,
                              int32_t m_32135, int32_t d_32136,
                              int32_t defppl_32137);
static int futrts_builtinzhgpu_map_transpose_f32(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6);
static int futrts_builtinzhgpu_map_transpose_i32(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6);
static int futrts_builtinzhgpu_map_transpose_i8(struct futhark_context *ctx,
                                                struct memblock_device destmem_0,
                                                int32_t destoffset_1,
                                                struct memblock_device srcmem_2,
                                                int32_t srcoffset_3,
                                                int32_t num_arrays_4,
                                                int32_t x_elems_5,
                                                int32_t y_elems_6);
static int futrts_builtinzhiota_i32(struct futhark_context *ctx,
                                    struct memblock_device mem_40449,
                                    int32_t n_40450, int32_t x_40451,
                                    int32_t s_40452);
static int futrts_builtinzhreplicate_f32(struct futhark_context *ctx,
                                         struct memblock_device mem_40459,
                                         int32_t num_elems_40460,
                                         float val_40461);
static int futrts_builtinzhreplicate_i32(struct futhark_context *ctx,
                                         struct memblock_device mem_40468,
                                         int32_t num_elems_40469,
                                         int32_t val_40470);
static int futrts_exactKnnFixK(struct futhark_context *ctx,
                               struct memblock_device *out_mem_p_41227,
                               int32_t *out_out_arrsizze_41228,
                               int32_t *out_out_arrsizze_41229,
                               struct memblock_device *out_mem_p_41230,
                               int32_t *out_out_arrsizze_41231,
                               int32_t *out_out_arrsizze_41232,
                               int32_t *out_scalar_out_41233,
                               struct memblock_device ref_pts_mem_39418,
                               struct memblock_device median_dims_mem_39419,
                               struct memblock_device median_vals_mem_39420,
                               struct memblock_device prev_eqdims_mem_39421,
                               struct memblock_device queries_mem_39422,
                               struct memblock_device nat_leaves_mem_39423,
                               struct memblock_device knn_is_mem_39424,
                               struct memblock_device knn_vs_mem_39425,
                               int32_t m_31021, int32_t d_31022,
                               int32_t q_31023, int32_t q_31024,
                               int32_t q_31025, int32_t n_31026,
                               int32_t d_31027, int32_t n_31028,
                               int32_t n_31029, int32_t kk_31030,
                               int32_t n_31031, int32_t kk_31032,
                               int32_t s_31037);
static int futrts_findNaturalLeavesFixK(struct futhark_context *ctx,
                                        struct memblock_device *out_mem_p_41319,
                                        int32_t *out_out_arrsizze_41320,
                                        int32_t *out_out_arrsizze_41321,
                                        struct memblock_device *out_mem_p_41322,
                                        int32_t *out_out_arrsizze_41323,
                                        int32_t *out_out_arrsizze_41324,
                                        struct memblock_device *out_mem_p_41325,
                                        int32_t *out_out_arrsizze_41326,
                                        struct memblock_device ref_pts_mem_39418,
                                        struct memblock_device median_dims_mem_39419,
                                        struct memblock_device median_vals_mem_39420,
                                        struct memblock_device queries_mem_39421,
                                        int32_t m_31862, int32_t d_31863,
                                        int32_t q_31864, int32_t q_31865,
                                        int32_t n_31866, int32_t d_31867);
static int futrts_mkImgPatches(struct futhark_context *ctx,
                               struct memblock_device *out_mem_p_41423,
                               int32_t *out_out_arrsizze_41424,
                               int32_t *out_out_arrsizze_41425,
                               struct memblock_device img_mem_39418,
                               int32_t h_32683, int32_t w_32684,
                               int32_t c_32685, int32_t p_32686);
static int futrts_propagateFixK(struct futhark_context *ctx,
                                struct memblock_device *out_mem_p_41431,
                                int32_t *out_out_arrsizze_41432,
                                int32_t *out_out_arrsizze_41433,
                                struct memblock_device *out_mem_p_41434,
                                int32_t *out_out_arrsizze_41435,
                                int32_t *out_out_arrsizze_41436,
                                struct memblock_device ref_pts_mem_39418,
                                struct memblock_device indir_mem_39419,
                                struct memblock_device orig2leaf_mem_39420,
                                struct memblock_device queries0_mem_39421,
                                struct memblock_device nat_leaves0_mem_39422,
                                struct memblock_device knn_inds_mem_39423,
                                struct memblock_device knn_dsts_mem_39424,
                                int32_t m_31574, int32_t d_31575,
                                int32_t m_31576, int32_t m_31577,
                                int32_t n_31578, int32_t d_31579,
                                int32_t n_31580, int32_t n_31581,
                                int32_t kk_31582, int32_t n_31583,
                                int32_t kk_31584, int32_t h_31585,
                                int32_t nr_31586);
static int futrts_reducePatchDim(struct futhark_context *ctx,
                                 struct memblock_device *out_mem_p_41538,
                                 int32_t *out_out_arrsizze_41539,
                                 int32_t *out_out_arrsizze_41540,
                                 struct memblock_device img_mem_39418,
                                 struct memblock_device comps_mem_39419,
                                 struct memblock_device means_mem_39420,
                                 int32_t n_30993, int32_t d_30994,
                                 int32_t d_red_30995, int32_t d_30996,
                                 int32_t d_30997);
static int futrts_selectBestNN(struct futhark_context *ctx,
                               struct memblock_device *out_mem_p_41579,
                               int32_t *out_out_arrsizze_41580,
                               struct memblock_device *out_mem_p_41581,
                               int32_t *out_out_arrsizze_41582,
                               float *out_scalar_out_41583,
                               struct memblock_device knn_inds_mem_39418,
                               struct memblock_device imgA_mem_39419,
                               struct memblock_device imgB_mem_39420,
                               int32_t n_30870, int32_t kk_30871,
                               int32_t h1_30872, int32_t w1_30873,
                               int32_t c_30874, int32_t h2_30875,
                               int32_t w2_30876, int32_t c_30877,
                               int32_t p_30878);
static int futrts_selectBestNN_BAD(struct futhark_context *ctx,
                                   struct memblock_device *out_mem_p_41652,
                                   int32_t *out_out_arrsizze_41653,
                                   struct memblock_device *out_mem_p_41654,
                                   int32_t *out_out_arrsizze_41655,
                                   struct memblock_device knn_inds_mem_39418,
                                   struct memblock_device imgA_mem_39419,
                                   struct memblock_device imgB_mem_39420,
                                   int32_t n_30845, int32_t kk_30846,
                                   int32_t h1_30847, int32_t w1_30848,
                                   int32_t c_30849, int32_t h2_30850,
                                   int32_t w2_30851, int32_t c_30852,
                                   int32_t p_30853);
int init_constants(struct futhark_context *ctx)
{
    (void) ctx;
    
    int err = 0;
    
    
  cleanup:
    return err;
}
int free_constants(struct futhark_context *ctx)
{
    (void) ctx;
    return 0;
}
static int futrts_buildKDtree(struct futhark_context *ctx,
                              int32_t *out_scalar_out_40833,
                              int32_t *out_scalar_out_40834,
                              int32_t *out_scalar_out_40835,
                              struct memblock_device *out_mem_p_40836,
                              int32_t *out_out_arrsizze_40837,
                              int32_t *out_out_arrsizze_40838,
                              struct memblock_device *out_mem_p_40839,
                              int32_t *out_out_arrsizze_40840,
                              struct memblock_device *out_mem_p_40841,
                              int32_t *out_out_arrsizze_40842,
                              struct memblock_device *out_mem_p_40843,
                              int32_t *out_out_arrsizze_40844,
                              struct memblock_device *out_mem_p_40845,
                              int32_t *out_out_arrsizze_40846,
                              struct memblock_device *out_mem_p_40847,
                              int32_t *out_out_arrsizze_40848,
                              struct memblock_device input_mem_39418,
                              int32_t m_32135, int32_t d_32136,
                              int32_t defppl_32137)
{
    (void) ctx;
    
    int err = 0;
    int32_t scalar_out_40295;
    int32_t scalar_out_40296;
    int32_t scalar_out_40297;
    struct memblock_device out_mem_40298;
    
    out_mem_40298.references = NULL;
    
    int32_t out_arrsizze_40299;
    int32_t out_arrsizze_40300;
    struct memblock_device out_mem_40301;
    
    out_mem_40301.references = NULL;
    
    int32_t out_arrsizze_40302;
    struct memblock_device out_mem_40303;
    
    out_mem_40303.references = NULL;
    
    int32_t out_arrsizze_40304;
    struct memblock_device out_mem_40305;
    
    out_mem_40305.references = NULL;
    
    int32_t out_arrsizze_40306;
    struct memblock_device out_mem_40307;
    
    out_mem_40307.references = NULL;
    
    int32_t out_arrsizze_40308;
    struct memblock_device out_mem_40309;
    
    out_mem_40309.references = NULL;
    
    int32_t out_arrsizze_40310;
    int32_t x_32139 = add32(m_32135, defppl_32137);
    int32_t x_32140 = sub32(x_32139, 1);
    bool zzero_32141 = defppl_32137 == 0;
    bool nonzzero_32142 = !zzero_32141;
    bool nonzzero_cert_32143;
    
    if (!nonzzero_32142) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "division by zero",
                               "-> #0  buildKDtree.fut:18:26-50\n   #1  driverKNN.fut:143:46-70\n   #2  driverKNN.fut:142:1-148:101\n");
        if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        return 1;
    }
    
    int32_t def_num_leaves_32144 = sdiv32(x_32140, defppl_32137);
    bool cond_32145 = sle32(def_num_leaves_32144, 1);
    int32_t res_32146;
    
    if (cond_32145) {
        res_32146 = 0;
    } else {
        bool loop_cond_32147 = slt32(1, def_num_leaves_32144);
        bool res_32148;
        int32_t res_32149;
        int32_t res_32150;
        bool loop_while_32151;
        int32_t q_32152;
        int32_t r_32153;
        
        loop_while_32151 = loop_cond_32147;
        q_32152 = def_num_leaves_32144;
        r_32153 = 0;
        while (loop_while_32151) {
            int32_t loopres_32154 = ashr32(q_32152, 1);
            int32_t loopres_32155 = add32(1, r_32153);
            bool loop_cond_32156 = slt32(1, loopres_32154);
            bool loop_while_tmp_40311 = loop_cond_32156;
            int32_t q_tmp_40312 = loopres_32154;
            int32_t r_tmp_40313 = loopres_32155;
            
            loop_while_32151 = loop_while_tmp_40311;
            q_32152 = q_tmp_40312;
            r_32153 = r_tmp_40313;
        }
        res_32148 = loop_while_32151;
        res_32149 = q_32152;
        res_32150 = r_32153;
        
        int32_t y_32157 = 1 << res_32150;
        int32_t err_down_32158 = sub32(def_num_leaves_32144, y_32157);
        int32_t y_32159 = add32(1, res_32150);
        int32_t x_32160 = 1 << y_32159;
        int32_t err_upwd_32161 = sub32(x_32160, def_num_leaves_32144);
        bool cond_32162 = sle32(err_down_32158, err_upwd_32161);
        int32_t res_32163;
        
        if (cond_32162) {
            res_32163 = res_32150;
        } else {
            res_32163 = y_32159;
        }
        res_32146 = res_32163;
    }
    
    bool cond_32164 = sle32(res_32146, 0);
    int32_t res_32165;
    int32_t res_32166;
    int32_t res_32167;
    int32_t res_32168;
    
    if (cond_32164) {
        res_32165 = -1;
        res_32166 = 0;
        res_32167 = m_32135;
        res_32168 = m_32135;
    } else {
        int32_t h_32169 = sub32(res_32146, 1);
        int32_t num_leaves_32170 = 1 << res_32146;
        int32_t x_32171 = add32(m_32135, num_leaves_32170);
        int32_t x_32172 = sub32(x_32171, 1);
        bool zzero_32173 = num_leaves_32170 == 0;
        bool nonzzero_32174 = !zzero_32173;
        bool nonzzero_cert_32175;
        
        if (!nonzzero_32174) {
            ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                                   "division by zero",
                                   "-> #0  buildKDtree.fut:23:20-52\n   #1  driverKNN.fut:143:46-70\n   #2  driverKNN.fut:142:1-148:101\n");
            if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") !=
                0)
                return 1;
            return 1;
        }
        
        int32_t ppl_32176 = sdiv32(x_32172, num_leaves_32170);
        int32_t res_32177 = sub32(num_leaves_32170, 1);
        int32_t res_32178 = mul32(num_leaves_32170, ppl_32176);
        
        res_32165 = h_32169;
        res_32166 = res_32177;
        res_32167 = ppl_32176;
        res_32168 = res_32178;
    }
    
    bool suff_outer_par_36312;
    
    suff_outer_par_36312 = ctx->sizes.buildKDtreezisuff_outer_par_0 <= d_32136;
    
    int64_t d_36328 = sext_i32_i64(d_32136);
    int32_t segmap_group_sizze_36330;
    
    segmap_group_sizze_36330 = ctx->sizes.buildKDtreezisegmap_group_sizze_36317;
    
    int64_t segmap_group_sizze_36331 = sext_i32_i64(segmap_group_sizze_36330);
    int64_t m_36358 = sext_i32_i64(m_32135);
    int64_t nest_sizze_36361 = d_36328 * m_36358;
    int32_t segred_group_sizze_36362;
    
    segred_group_sizze_36362 = ctx->sizes.buildKDtreezisegred_group_sizze_36346;
    
    int32_t num_groups_36363;
    int32_t max_num_groups_40314;
    
    max_num_groups_40314 = ctx->sizes.buildKDtreezisegred_num_groups_36348;
    num_groups_36363 = sext_i64_i32(smax64(1, smin64(sdiv_up64(nest_sizze_36361,
                                                               sext_i32_i64(segred_group_sizze_36362)),
                                                     sext_i32_i64(max_num_groups_40314))));
    
    int64_t bytes_39420 = 4 * d_36328;
    int64_t bytes_39423 = 4 * nest_sizze_36361;
    struct memblock_device res_mem_39432;
    
    res_mem_39432.references = NULL;
    
    int32_t local_memory_capacity_40380;
    
    local_memory_capacity_40380 = ctx->cuda.max_shared_memory;
    if (sle64(0, sext_i32_i64(local_memory_capacity_40380)) &&
        suff_outer_par_36312) {
        int64_t segmap_usable_groups_64_36332 = sdiv_up64(d_36328,
                                                          segmap_group_sizze_36331);
        int32_t segmap_usable_groups_36333 =
                sext_i64_i32(segmap_usable_groups_64_36332);
        struct memblock_device mem_39422;
        
        mem_39422.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39422, bytes_39420, "mem_39422")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        
        CUdeviceptr kernel_arg_40852 = input_mem_39418.mem;
        CUdeviceptr kernel_arg_40853 = mem_39422.mem;
        
        if ((((((1 && segmap_usable_groups_36333 != 0) && 1 != 0) && 1 != 0) &&
              segmap_group_sizze_36330 != 0) && 1 != 0) && 1 != 0) {
            int perm[3] = {0, 1, 2};
            
            if (1 >= 1 << 16) {
                perm[1] = perm[0];
                perm[0] = 1;
            }
            if (1 >= 1 << 16) {
                perm[2] = perm[0];
                perm[0] = 2;
            }
            
            size_t grid[3];
            
            grid[perm[0]] = segmap_usable_groups_36333;
            grid[perm[1]] = 1;
            grid[perm[2]] = 1;
            
            void *kernel_args_40849[] = {&ctx->global_failure, &m_32135,
                                         &d_32136, &kernel_arg_40852,
                                         &kernel_arg_40853};
            int64_t time_start_40850 = 0, time_end_40851 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with grid size (",
                        "buildKDtree.segmap_36314");
                fprintf(stderr, "%d", segmap_usable_groups_36333);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ") and block size (");
                fprintf(stderr, "%d", segmap_group_sizze_36330);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ").\n");
                time_start_40850 = get_wall_time();
            }
            
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->buildKDtreezisegmap_36314_runs,
                                          &ctx->buildKDtreezisegmap_36314_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_36314, grid[0],
                                        grid[1], grid[2],
                                        segmap_group_sizze_36330, 1, 1, 0, NULL,
                                        kernel_args_40849, NULL));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            if (ctx->debugging) {
                CUDA_SUCCEED(cuCtxSynchronize());
                time_end_40851 = get_wall_time();
                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                        "buildKDtree.segmap_36314", time_end_40851 -
                        time_start_40850);
            }
        }
        if (memblock_set_device(ctx, &res_mem_39432, &mem_39422, "mem_39422") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39422, "mem_39422") != 0)
            return 1;
    } else {
        struct memblock_device mem_39427;
        
        mem_39427.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39427, bytes_39423, "mem_39427")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39427, 0,
                                                  input_mem_39418, 0, 1,
                                                  d_32136, m_32135) != 0) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_39431;
        
        mem_39431.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39431, bytes_39420, "mem_39431")) {
            err = 1;
            goto cleanup;
        }
        if (slt32(m_32135 * 2, segred_group_sizze_36362)) {
            int32_t segment_sizze_nonzzero_40321 = smax32(1, m_32135);
            int32_t num_threads_40322 = num_groups_36363 *
                    segred_group_sizze_36362;
            
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegRed-small");
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "num_segments",
                        (long long) d_32136, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "segment_size",
                        (long long) m_32135, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "segments_per_group",
                        (long long) squot32(segred_group_sizze_36362,
                                            segment_sizze_nonzzero_40321),
                        '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "required_groups",
                        (long long) sdiv_up32(d_32136,
                                              squot32(segred_group_sizze_36362,
                                                      segment_sizze_nonzzero_40321)),
                        '\n');
            
            unsigned int shared_sizze_40857 = (int64_t) sizeof(float) *
                         sext_i32_i64(segred_group_sizze_36362);
            CUdeviceptr kernel_arg_40859 = mem_39427.mem;
            CUdeviceptr kernel_arg_40860 = mem_39431.mem;
            unsigned int shared_offset_40858 = 0;
            
            if ((((((1 && num_groups_36363 != 0) && 1 != 0) && 1 != 0) &&
                  segred_group_sizze_36362 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = num_groups_36363;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_40854[] = {&ctx->global_failure,
                                             &shared_offset_40858, &m_32135,
                                             &d_32136, &num_groups_36363,
                                             &kernel_arg_40859,
                                             &kernel_arg_40860,
                                             &segment_sizze_nonzzero_40321};
                int64_t time_start_40855 = 0, time_end_40856 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "buildKDtree.segred_small_36352");
                    fprintf(stderr, "%d", num_groups_36363);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segred_group_sizze_36362);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_40855 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->buildKDtreezisegred_small_36352_runs,
                                              &ctx->buildKDtreezisegred_small_36352_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegred_small_36352,
                                            grid[0], grid[1], grid[2],
                                            segred_group_sizze_36362, 1, 1, 0 +
                                            (shared_sizze_40857 + (8 -
                                                                   shared_sizze_40857 %
                                                                   8) % 8),
                                            NULL, kernel_args_40854, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_40856 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "buildKDtree.segred_small_36352", time_end_40856 -
                            time_start_40855);
                }
            }
        } else {
            int32_t groups_per_segment_40341 = sdiv_up32(num_groups_36363,
                                                         smax32(1, d_32136));
            int32_t elements_per_thread_40342 = sdiv_up32(m_32135,
                                                          segred_group_sizze_36362 *
                                                          groups_per_segment_40341);
            int32_t virt_num_groups_40343 = groups_per_segment_40341 * d_32136;
            int32_t num_threads_40344 = num_groups_36363 *
                    segred_group_sizze_36362;
            int32_t threads_per_segment_40345 = groups_per_segment_40341 *
                    segred_group_sizze_36362;
            
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegRed-large");
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "num_segments",
                        (long long) d_32136, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "segment_size",
                        (long long) m_32135, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                        (long long) virt_num_groups_40343, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "num_groups",
                        (long long) num_groups_36363, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "group_size",
                        (long long) segred_group_sizze_36362, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                        (long long) elements_per_thread_40342, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                        (long long) groups_per_segment_40341, '\n');
            
            struct memblock_device group_res_arr_mem_40346;
            
            group_res_arr_mem_40346.references = NULL;
            if (memblock_alloc_device(ctx, &group_res_arr_mem_40346,
                                      (int64_t) sizeof(float) *
                                      (sext_i32_i64(segred_group_sizze_36362) *
                                       sext_i32_i64(virt_num_groups_40343)),
                                      "group_res_arr_mem_40346")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device buildKDtreezicounter_mem_40348 =
                                   ctx->buildKDtreezicounter_mem_40348;
            unsigned int shared_sizze_40865 = (int64_t) sizeof(bool);
            unsigned int shared_sizze_40867 = (int64_t) sizeof(float) *
                         sext_i32_i64(segred_group_sizze_36362);
            CUdeviceptr kernel_arg_40869 = mem_39427.mem;
            CUdeviceptr kernel_arg_40870 = mem_39431.mem;
            CUdeviceptr kernel_arg_40871 = group_res_arr_mem_40346.mem;
            CUdeviceptr kernel_arg_40872 = buildKDtreezicounter_mem_40348.mem;
            unsigned int shared_offset_40866 = 0;
            unsigned int shared_offset_40868 = 0 + (shared_sizze_40865 + (8 -
                                                                          shared_sizze_40865 %
                                                                          8) %
                                                    8);
            
            if ((((((1 && num_groups_36363 != 0) && 1 != 0) && 1 != 0) &&
                  segred_group_sizze_36362 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = num_groups_36363;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_40862[] = {&ctx->global_failure,
                                             &shared_offset_40866,
                                             &shared_offset_40868, &m_32135,
                                             &num_groups_36363,
                                             &kernel_arg_40869,
                                             &kernel_arg_40870,
                                             &groups_per_segment_40341,
                                             &elements_per_thread_40342,
                                             &virt_num_groups_40343,
                                             &threads_per_segment_40345,
                                             &kernel_arg_40871,
                                             &kernel_arg_40872};
                int64_t time_start_40863 = 0, time_end_40864 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "buildKDtree.segred_large_36352");
                    fprintf(stderr, "%d", num_groups_36363);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segred_group_sizze_36362);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_40863 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->buildKDtreezisegred_large_36352_runs,
                                              &ctx->buildKDtreezisegred_large_36352_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegred_large_36352,
                                            grid[0], grid[1], grid[2],
                                            segred_group_sizze_36362, 1, 1, 0 +
                                            (shared_sizze_40865 + (8 -
                                                                   shared_sizze_40865 %
                                                                   8) % 8) +
                                            (shared_sizze_40867 + (8 -
                                                                   shared_sizze_40867 %
                                                                   8) % 8),
                                            NULL, kernel_args_40862, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_40864 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "buildKDtree.segred_large_36352", time_end_40864 -
                            time_start_40863);
                }
            }
            if (memblock_unref_device(ctx, &group_res_arr_mem_40346,
                                      "group_res_arr_mem_40346") != 0)
                return 1;
        }
        if (memblock_unref_device(ctx, &mem_39427, "mem_39427") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_39432, &mem_39431, "mem_39431") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39431, "mem_39431") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39427, "mem_39427") != 0)
            return 1;
    }
    
    bool suff_outer_par_36373;
    
    suff_outer_par_36373 = ctx->sizes.buildKDtreezisuff_outer_par_1 <= d_32136;
    
    int32_t segmap_group_sizze_36391;
    
    segmap_group_sizze_36391 = ctx->sizes.buildKDtreezisegmap_group_sizze_36378;
    
    int64_t segmap_group_sizze_36392 = sext_i32_i64(segmap_group_sizze_36391);
    int32_t segred_group_sizze_36423;
    
    segred_group_sizze_36423 = ctx->sizes.buildKDtreezisegred_group_sizze_36407;
    
    int32_t num_groups_36424;
    int32_t max_num_groups_40381;
    
    max_num_groups_40381 = ctx->sizes.buildKDtreezisegred_num_groups_36409;
    num_groups_36424 = sext_i64_i32(smax64(1, smin64(sdiv_up64(nest_sizze_36361,
                                                               sext_i32_i64(segred_group_sizze_36423)),
                                                     sext_i32_i64(max_num_groups_40381))));
    
    struct memblock_device res_mem_39446;
    
    res_mem_39446.references = NULL;
    
    int32_t local_memory_capacity_40447;
    
    local_memory_capacity_40447 = ctx->cuda.max_shared_memory;
    if (sle64(0, sext_i32_i64(local_memory_capacity_40447)) &&
        suff_outer_par_36373) {
        int64_t segmap_usable_groups_64_36393 = sdiv_up64(d_36328,
                                                          segmap_group_sizze_36392);
        int32_t segmap_usable_groups_36394 =
                sext_i64_i32(segmap_usable_groups_64_36393);
        struct memblock_device mem_39436;
        
        mem_39436.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39436, bytes_39420, "mem_39436")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        
        CUdeviceptr kernel_arg_40876 = input_mem_39418.mem;
        CUdeviceptr kernel_arg_40877 = mem_39436.mem;
        
        if ((((((1 && segmap_usable_groups_36394 != 0) && 1 != 0) && 1 != 0) &&
              segmap_group_sizze_36391 != 0) && 1 != 0) && 1 != 0) {
            int perm[3] = {0, 1, 2};
            
            if (1 >= 1 << 16) {
                perm[1] = perm[0];
                perm[0] = 1;
            }
            if (1 >= 1 << 16) {
                perm[2] = perm[0];
                perm[0] = 2;
            }
            
            size_t grid[3];
            
            grid[perm[0]] = segmap_usable_groups_36394;
            grid[perm[1]] = 1;
            grid[perm[2]] = 1;
            
            void *kernel_args_40873[] = {&ctx->global_failure, &m_32135,
                                         &d_32136, &kernel_arg_40876,
                                         &kernel_arg_40877};
            int64_t time_start_40874 = 0, time_end_40875 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with grid size (",
                        "buildKDtree.segmap_36375");
                fprintf(stderr, "%d", segmap_usable_groups_36394);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ") and block size (");
                fprintf(stderr, "%d", segmap_group_sizze_36391);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ").\n");
                time_start_40874 = get_wall_time();
            }
            
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->buildKDtreezisegmap_36375_runs,
                                          &ctx->buildKDtreezisegmap_36375_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_36375, grid[0],
                                        grid[1], grid[2],
                                        segmap_group_sizze_36391, 1, 1, 0, NULL,
                                        kernel_args_40873, NULL));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            if (ctx->debugging) {
                CUDA_SUCCEED(cuCtxSynchronize());
                time_end_40875 = get_wall_time();
                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                        "buildKDtree.segmap_36375", time_end_40875 -
                        time_start_40874);
            }
        }
        if (memblock_set_device(ctx, &res_mem_39446, &mem_39436, "mem_39436") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39436, "mem_39436") != 0)
            return 1;
    } else {
        struct memblock_device mem_39441;
        
        mem_39441.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39441, bytes_39423, "mem_39441")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39441, 0,
                                                  input_mem_39418, 0, 1,
                                                  d_32136, m_32135) != 0) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_39445;
        
        mem_39445.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39445, bytes_39420, "mem_39445")) {
            err = 1;
            goto cleanup;
        }
        if (slt32(m_32135 * 2, segred_group_sizze_36423)) {
            int32_t segment_sizze_nonzzero_40388 = smax32(1, m_32135);
            int32_t num_threads_40389 = num_groups_36424 *
                    segred_group_sizze_36423;
            
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegRed-small");
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "num_segments",
                        (long long) d_32136, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "segment_size",
                        (long long) m_32135, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "segments_per_group",
                        (long long) squot32(segred_group_sizze_36423,
                                            segment_sizze_nonzzero_40388),
                        '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "required_groups",
                        (long long) sdiv_up32(d_32136,
                                              squot32(segred_group_sizze_36423,
                                                      segment_sizze_nonzzero_40388)),
                        '\n');
            
            unsigned int shared_sizze_40881 = (int64_t) sizeof(float) *
                         sext_i32_i64(segred_group_sizze_36423);
            CUdeviceptr kernel_arg_40883 = mem_39441.mem;
            CUdeviceptr kernel_arg_40884 = mem_39445.mem;
            unsigned int shared_offset_40882 = 0;
            
            if ((((((1 && num_groups_36424 != 0) && 1 != 0) && 1 != 0) &&
                  segred_group_sizze_36423 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = num_groups_36424;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_40878[] = {&ctx->global_failure,
                                             &shared_offset_40882, &m_32135,
                                             &d_32136, &num_groups_36424,
                                             &kernel_arg_40883,
                                             &kernel_arg_40884,
                                             &segment_sizze_nonzzero_40388};
                int64_t time_start_40879 = 0, time_end_40880 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "buildKDtree.segred_small_36413");
                    fprintf(stderr, "%d", num_groups_36424);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segred_group_sizze_36423);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_40879 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->buildKDtreezisegred_small_36413_runs,
                                              &ctx->buildKDtreezisegred_small_36413_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegred_small_36413,
                                            grid[0], grid[1], grid[2],
                                            segred_group_sizze_36423, 1, 1, 0 +
                                            (shared_sizze_40881 + (8 -
                                                                   shared_sizze_40881 %
                                                                   8) % 8),
                                            NULL, kernel_args_40878, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_40880 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "buildKDtree.segred_small_36413", time_end_40880 -
                            time_start_40879);
                }
            }
        } else {
            int32_t groups_per_segment_40408 = sdiv_up32(num_groups_36424,
                                                         smax32(1, d_32136));
            int32_t elements_per_thread_40409 = sdiv_up32(m_32135,
                                                          segred_group_sizze_36423 *
                                                          groups_per_segment_40408);
            int32_t virt_num_groups_40410 = groups_per_segment_40408 * d_32136;
            int32_t num_threads_40411 = num_groups_36424 *
                    segred_group_sizze_36423;
            int32_t threads_per_segment_40412 = groups_per_segment_40408 *
                    segred_group_sizze_36423;
            
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegRed-large");
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "num_segments",
                        (long long) d_32136, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "segment_size",
                        (long long) m_32135, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                        (long long) virt_num_groups_40410, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "num_groups",
                        (long long) num_groups_36424, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "group_size",
                        (long long) segred_group_sizze_36423, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                        (long long) elements_per_thread_40409, '\n');
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                        (long long) groups_per_segment_40408, '\n');
            
            struct memblock_device group_res_arr_mem_40413;
            
            group_res_arr_mem_40413.references = NULL;
            if (memblock_alloc_device(ctx, &group_res_arr_mem_40413,
                                      (int64_t) sizeof(float) *
                                      (sext_i32_i64(segred_group_sizze_36423) *
                                       sext_i32_i64(virt_num_groups_40410)),
                                      "group_res_arr_mem_40413")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device buildKDtreezicounter_mem_40415 =
                                   ctx->buildKDtreezicounter_mem_40415;
            unsigned int shared_sizze_40889 = (int64_t) sizeof(bool);
            unsigned int shared_sizze_40891 = (int64_t) sizeof(float) *
                         sext_i32_i64(segred_group_sizze_36423);
            CUdeviceptr kernel_arg_40893 = mem_39441.mem;
            CUdeviceptr kernel_arg_40894 = mem_39445.mem;
            CUdeviceptr kernel_arg_40895 = group_res_arr_mem_40413.mem;
            CUdeviceptr kernel_arg_40896 = buildKDtreezicounter_mem_40415.mem;
            unsigned int shared_offset_40890 = 0;
            unsigned int shared_offset_40892 = 0 + (shared_sizze_40889 + (8 -
                                                                          shared_sizze_40889 %
                                                                          8) %
                                                    8);
            
            if ((((((1 && num_groups_36424 != 0) && 1 != 0) && 1 != 0) &&
                  segred_group_sizze_36423 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = num_groups_36424;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_40886[] = {&ctx->global_failure,
                                             &shared_offset_40890,
                                             &shared_offset_40892, &m_32135,
                                             &num_groups_36424,
                                             &kernel_arg_40893,
                                             &kernel_arg_40894,
                                             &groups_per_segment_40408,
                                             &elements_per_thread_40409,
                                             &virt_num_groups_40410,
                                             &threads_per_segment_40412,
                                             &kernel_arg_40895,
                                             &kernel_arg_40896};
                int64_t time_start_40887 = 0, time_end_40888 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "buildKDtree.segred_large_36413");
                    fprintf(stderr, "%d", num_groups_36424);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segred_group_sizze_36423);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_40887 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->buildKDtreezisegred_large_36413_runs,
                                              &ctx->buildKDtreezisegred_large_36413_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegred_large_36413,
                                            grid[0], grid[1], grid[2],
                                            segred_group_sizze_36423, 1, 1, 0 +
                                            (shared_sizze_40889 + (8 -
                                                                   shared_sizze_40889 %
                                                                   8) % 8) +
                                            (shared_sizze_40891 + (8 -
                                                                   shared_sizze_40891 %
                                                                   8) % 8),
                                            NULL, kernel_args_40886, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_40888 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "buildKDtree.segred_large_36413", time_end_40888 -
                            time_start_40887);
                }
            }
            if (memblock_unref_device(ctx, &group_res_arr_mem_40413,
                                      "group_res_arr_mem_40413") != 0)
                return 1;
        }
        if (memblock_unref_device(ctx, &mem_39441, "mem_39441") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_39446, &mem_39445, "mem_39445") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39445, "mem_39445") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39441, "mem_39441") != 0)
            return 1;
    }
    
    int32_t conc_tmp_32196 = d_32136 + d_32136;
    int64_t binop_x_39448 = sext_i32_i64(conc_tmp_32196);
    int64_t bytes_39447 = 4 * binop_x_39448;
    struct memblock_device mem_39449;
    
    mem_39449.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39449, bytes_39447, "mem_39449")) {
        err = 1;
        goto cleanup;
    }
    
    int32_t tmp_offs_40448 = 0;
    
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_39449.mem + sext_i32_i64(tmp_offs_40448 * 4),
                              res_mem_39432.mem + 0, sext_i32_i64(d_32136) *
                              (int64_t) sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    tmp_offs_40448 += d_32136;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_39449.mem + sext_i32_i64(tmp_offs_40448 * 4),
                              res_mem_39446.mem + 0, sext_i32_i64(d_32136) *
                              (int64_t) sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    tmp_offs_40448 += d_32136;
    if (memblock_unref_device(ctx, &res_mem_39432, "res_mem_39432") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_39446, "res_mem_39446") != 0)
        return 1;
    
    int32_t num_pads_32198 = sub32(res_32168, m_32135);
    bool bounds_invalid_upwards_32199 = slt32(num_pads_32198, 0);
    bool valid_32200 = !bounds_invalid_upwards_32199;
    bool range_valid_c_32201;
    
    if (!valid_32200) {
        ctx->error = msgprintf("Error: %s%d%s%d%s%d%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", num_pads_32198,
                               " is invalid.",
                               "-> #0  /prelude/math.fut:461:23-30\n   #1  /prelude/math.fut:462:53-58\n   #2  /prelude/array.fut:70:3-19\n   #3  buildKDtree.fut:80:33-72\n   #4  driverKNN.fut:145:11-50\n   #5  driverKNN.fut:142:1-148:101\n");
        if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39446, "res_mem_39446") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39432, "res_mem_39432") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        return 1;
    }
    
    int64_t binop_x_39451 = sext_i32_i64(res_32168);
    int64_t bytes_39450 = 4 * binop_x_39451;
    struct memblock_device mem_39452;
    
    mem_39452.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39452, bytes_39450, "mem_39452")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhiota_i32(ctx, mem_39452, res_32168, 0, 1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    bool bounds_invalid_upwards_32203 = slt32(res_32166, 0);
    bool valid_32204 = !bounds_invalid_upwards_32203;
    bool range_valid_c_32205;
    
    if (!valid_32204) {
        ctx->error = msgprintf("Error: %s%d%s%d%s%d%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", res_32166,
                               " is invalid.",
                               "-> #0  /prelude/math.fut:461:23-30\n   #1  /prelude/math.fut:462:53-58\n   #2  /prelude/array.fut:70:3-19\n   #3  buildKDtree.fut:83:28-45\n   #4  driverKNN.fut:145:11-50\n   #5  driverKNN.fut:142:1-148:101\n");
        if (memblock_unref_device(ctx, &mem_39452, "mem_39452") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39446, "res_mem_39446") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39432, "res_mem_39432") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        return 1;
    }
    
    int64_t binop_x_39454 = sext_i32_i64(res_32166);
    int64_t bytes_39453 = 4 * binop_x_39454;
    struct memblock_device mem_39455;
    
    mem_39455.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39455, bytes_39453, "mem_39455")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f32(ctx, mem_39455, res_32166, 0.0F) != 0) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39458;
    
    mem_39458.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39458, bytes_39453, "mem_39458")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, mem_39458, res_32166, -1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39461;
    
    mem_39461.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39461, bytes_39453, "mem_39461")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, mem_39461, res_32166, -1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int32_t upper_bound_32209 = add32(1, res_32165);
    int32_t d_32210 = sdiv32(conc_tmp_32196, 2);
    int32_t segmap_group_sizze_36533;
    
    segmap_group_sizze_36533 = ctx->sizes.buildKDtreezisegmap_group_sizze_36439;
    
    int64_t segmap_group_sizze_36534 = sext_i32_i64(segmap_group_sizze_36533);
    int32_t segmap_group_sizze_36798;
    
    segmap_group_sizze_36798 = ctx->sizes.buildKDtreezisegmap_group_sizze_36751;
    
    int32_t segred_group_sizze_36847;
    
    segred_group_sizze_36847 = ctx->sizes.buildKDtreezisegred_group_sizze_36669;
    
    int32_t segmap_group_sizze_36876;
    
    segmap_group_sizze_36876 = ctx->sizes.buildKDtreezisegmap_group_sizze_36631;
    
    int64_t segmap_group_sizze_36877 = sext_i32_i64(segmap_group_sizze_36876);
    int32_t max_group_sizze_37189;
    
    max_group_sizze_37189 = ctx->cuda.max_block_size;
    
    int32_t segmap_group_sizze_37067;
    
    segmap_group_sizze_37067 = ctx->sizes.buildKDtreezisegmap_group_sizze_36945;
    
    int32_t segmap_group_sizze_38004;
    
    segmap_group_sizze_38004 = ctx->sizes.buildKDtreezisegmap_group_sizze_37993;
    
    int64_t segmap_group_sizze_38005 = sext_i32_i64(segmap_group_sizze_38004);
    int32_t segmap_group_sizze_38028;
    
    segmap_group_sizze_38028 = ctx->sizes.buildKDtreezisegmap_group_sizze_37951;
    
    int64_t segmap_group_sizze_38029 = sext_i32_i64(segmap_group_sizze_38028);
    int32_t segscan_group_sizze_38155;
    
    segscan_group_sizze_38155 =
        ctx->sizes.buildKDtreezisegscan_group_sizze_37740;
    
    int32_t segmap_group_sizze_38230;
    
    segmap_group_sizze_38230 = ctx->sizes.buildKDtreezisegmap_group_sizze_37680;
    
    int64_t segmap_group_sizze_38231 = sext_i32_i64(segmap_group_sizze_38230);
    int32_t segmap_group_sizze_38288;
    
    segmap_group_sizze_38288 = ctx->sizes.buildKDtreezisegmap_group_sizze_37345;
    
    int64_t segmap_group_sizze_38289 = sext_i32_i64(segmap_group_sizze_38288);
    int32_t segmap_group_sizze_38315;
    
    segmap_group_sizze_38315 = ctx->sizes.buildKDtreezisegmap_group_sizze_38314;
    
    int64_t segmap_group_sizze_38316 = sext_i32_i64(segmap_group_sizze_38315);
    struct memblock_device res_mem_39993;
    
    res_mem_39993.references = NULL;
    
    struct memblock_device mem_param_39466;
    
    mem_param_39466.references = NULL;
    if (memblock_set_device(ctx, &mem_param_39466, &mem_39452, "mem_39452") !=
        0)
        return 1;
    for (int32_t lev_32216 = 0; lev_32216 < upper_bound_32209; lev_32216++) {
        int32_t nodes_this_lvl_32221 = 1 << lev_32216;
        bool zzero_32222 = nodes_this_lvl_32221 == 0;
        bool nonzzero_32223 = !zzero_32222;
        bool nonzzero_cert_32224;
        
        if (!nonzzero_32223) {
            ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                                   "division by zero",
                                   "-> #0  buildKDtree.fut:97:42-60\n   #1  driverKNN.fut:145:11-50\n   #2  driverKNN.fut:142:1-148:101\n");
            if (memblock_unref_device(ctx, &mem_param_39466,
                                      "mem_param_39466") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39993, "res_mem_39993") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39461, "mem_39461") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39458, "mem_39458") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39455, "mem_39455") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39452, "mem_39452") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39446, "res_mem_39446") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39432, "res_mem_39432") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") !=
                0)
                return 1;
            return 1;
        }
        
        int32_t pts_per_node_at_lev_32225 = sdiv32(res_32168,
                                                   nodes_this_lvl_32221);
        int32_t x_32226 = nodes_this_lvl_32221 * pts_per_node_at_lev_32225;
        bool dim_ok_32227 = x_32226 == res_32168;
        bool dim_ok_cert_32228;
        
        if (!dim_ok_32227) {
            ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                                   "new shape has different number of elements than old shape",
                                   "-> #0  /prelude/array.fut:95:3-33\n   #1  buildKDtree.fut:98:30-79\n   #2  driverKNN.fut:145:11-50\n   #3  driverKNN.fut:142:1-148:101\n");
            if (memblock_unref_device(ctx, &mem_param_39466,
                                      "mem_param_39466") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39993, "res_mem_39993") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39461, "mem_39461") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39458, "mem_39458") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39455, "mem_39455") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39452, "mem_39452") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39446, "res_mem_39446") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39432, "res_mem_39432") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") !=
                0)
                return 1;
            return 1;
        }
        
        bool suff_outer_par_36434;
        
        suff_outer_par_36434 = ctx->sizes.buildKDtreezisuff_outer_par_2 <=
            nodes_this_lvl_32221;
        
        int64_t nodes_this_lvl_36531 = sext_i32_i64(nodes_this_lvl_32221);
        int32_t num_groups_36799;
        int32_t max_num_groups_40482;
        
        max_num_groups_40482 = ctx->sizes.buildKDtreezisegmap_num_groups_36753;
        num_groups_36799 = sext_i64_i32(smax64(1,
                                               smin64(sdiv_up64(nodes_this_lvl_36531,
                                                                sext_i32_i64(segmap_group_sizze_36798)),
                                                      sext_i32_i64(max_num_groups_40482))));
        
        int64_t nest_sizze_36846 = d_36328 * nodes_this_lvl_36531;
        int32_t num_groups_36848;
        int32_t max_num_groups_40483;
        
        max_num_groups_40483 = ctx->sizes.buildKDtreezisegred_num_groups_36671;
        num_groups_36848 = sext_i64_i32(smax64(1,
                                               smin64(sdiv_up64(nest_sizze_36846,
                                                                sext_i32_i64(segred_group_sizze_36847)),
                                                      sext_i32_i64(max_num_groups_40483))));
        
        int64_t bytes_39506 = 4 * nodes_this_lvl_36531;
        int64_t binop_x_39531 = nodes_this_lvl_36531 * binop_x_39448;
        int64_t bytes_39528 = 4 * binop_x_39531;
        int64_t binop_x_39539 = nodes_this_lvl_36531 * binop_x_39448;
        int64_t bytes_39536 = 4 * binop_x_39539;
        int32_t num_threads_40233 = segmap_group_sizze_36798 * num_groups_36799;
        int64_t num_threads64_40235 = sext_i32_i64(num_threads_40233);
        int64_t total_sizze_40236 = bytes_39447 * num_threads64_40235;
        struct memblock_device res_mem_39552;
        
        res_mem_39552.references = NULL;
        
        struct memblock_device res_mem_39553;
        
        res_mem_39553.references = NULL;
        
        int32_t local_memory_capacity_40591;
        
        local_memory_capacity_40591 = ctx->cuda.max_shared_memory;
        if (sle64(0, sext_i32_i64(local_memory_capacity_40591)) &&
            suff_outer_par_36434) {
            int64_t segmap_usable_groups_64_36535 =
                    sdiv_up64(nodes_this_lvl_36531, segmap_group_sizze_36534);
            int32_t segmap_usable_groups_36536 =
                    sext_i64_i32(segmap_usable_groups_64_36535);
            struct memblock_device mem_39508;
            
            mem_39508.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39508, bytes_39506,
                                      "mem_39508")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39511;
            
            mem_39511.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39511, bytes_39506,
                                      "mem_39511")) {
                err = 1;
                goto cleanup;
            }
            
            int32_t num_threads_40229 = segmap_group_sizze_36533 *
                    segmap_usable_groups_36536;
            int64_t num_threads64_40231 = sext_i32_i64(num_threads_40229);
            int64_t total_sizze_40232 = bytes_39447 * num_threads64_40231;
            struct memblock_device mem_39493;
            
            mem_39493.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39493, total_sizze_40232,
                                      "mem_39493")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegMap");
            
            CUdeviceptr kernel_arg_40900 = mem_39449.mem;
            CUdeviceptr kernel_arg_40901 = mem_39455.mem;
            CUdeviceptr kernel_arg_40902 = mem_39458.mem;
            CUdeviceptr kernel_arg_40903 = mem_39493.mem;
            CUdeviceptr kernel_arg_40904 = mem_39508.mem;
            CUdeviceptr kernel_arg_40905 = mem_39511.mem;
            
            if ((((((1 && segmap_usable_groups_36536 != 0) && 1 != 0) && 1 !=
                   0) && segmap_group_sizze_36533 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = segmap_usable_groups_36536;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_40897[] = {&ctx->global_failure,
                                             &ctx->failure_is_an_option,
                                             &ctx->global_failure_args,
                                             &d_32136, &res_32166,
                                             &conc_tmp_32196, &d_32210,
                                             &lev_32216, &nodes_this_lvl_32221,
                                             &segmap_usable_groups_36536,
                                             &kernel_arg_40900,
                                             &kernel_arg_40901,
                                             &kernel_arg_40902,
                                             &kernel_arg_40903,
                                             &kernel_arg_40904,
                                             &kernel_arg_40905};
                int64_t time_start_40898 = 0, time_end_40899 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "buildKDtree.segmap_36436");
                    fprintf(stderr, "%d", segmap_usable_groups_36536);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segmap_group_sizze_36533);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_40898 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->buildKDtreezisegmap_36436_runs,
                                              &ctx->buildKDtreezisegmap_36436_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_36436,
                                            grid[0], grid[1], grid[2],
                                            segmap_group_sizze_36533, 1, 1, 0,
                                            NULL, kernel_args_40897, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_40899 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "buildKDtree.segmap_36436", time_end_40899 -
                            time_start_40898);
                }
            }
            ctx->failure_is_an_option = 1;
            if (memblock_unref_device(ctx, &mem_39493, "mem_39493") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_39552, &mem_39508,
                                    "mem_39508") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_39553, &mem_39511,
                                    "mem_39511") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39493, "mem_39493") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39511, "mem_39511") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39508, "mem_39508") != 0)
                return 1;
        } else {
            struct memblock_device mem_39532;
            
            mem_39532.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39532, bytes_39528,
                                      "mem_39532")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39535;
            
            mem_39535.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39535, bytes_39506,
                                      "mem_39535")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39515;
            
            mem_39515.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39515, total_sizze_40236,
                                      "mem_39515")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegMap");
            
            CUdeviceptr kernel_arg_40909 = mem_39449.mem;
            CUdeviceptr kernel_arg_40910 = mem_39455.mem;
            CUdeviceptr kernel_arg_40911 = mem_39458.mem;
            CUdeviceptr kernel_arg_40912 = mem_39515.mem;
            CUdeviceptr kernel_arg_40913 = mem_39532.mem;
            CUdeviceptr kernel_arg_40914 = mem_39535.mem;
            
            if ((((((1 && num_groups_36799 != 0) && 1 != 0) && 1 != 0) &&
                  segmap_group_sizze_36798 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = num_groups_36799;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_40906[] = {&ctx->global_failure,
                                             &ctx->failure_is_an_option,
                                             &ctx->global_failure_args,
                                             &res_32166, &conc_tmp_32196,
                                             &d_32210, &lev_32216,
                                             &nodes_this_lvl_32221,
                                             &num_groups_36799,
                                             &kernel_arg_40909,
                                             &kernel_arg_40910,
                                             &kernel_arg_40911,
                                             &kernel_arg_40912,
                                             &kernel_arg_40913,
                                             &kernel_arg_40914};
                int64_t time_start_40907 = 0, time_end_40908 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "buildKDtree.segmap_36748");
                    fprintf(stderr, "%d", num_groups_36799);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segmap_group_sizze_36798);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_40907 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->buildKDtreezisegmap_36748_runs,
                                              &ctx->buildKDtreezisegmap_36748_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_36748,
                                            grid[0], grid[1], grid[2],
                                            segmap_group_sizze_36798, 1, 1, 0,
                                            NULL, kernel_args_40906, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_40908 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "buildKDtree.segmap_36748", time_end_40908 -
                            time_start_40907);
                }
            }
            ctx->failure_is_an_option = 1;
            if (memblock_unref_device(ctx, &mem_39515, "mem_39515") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39535, "mem_39535") != 0)
                return 1;
            
            struct memblock_device mem_39540;
            
            mem_39540.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39540, bytes_39536,
                                      "mem_39540")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39540, 0,
                                                      mem_39532, 0, 1,
                                                      nodes_this_lvl_32221,
                                                      conc_tmp_32196) != 0) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39544;
            
            mem_39544.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39544, bytes_39506,
                                      "mem_39544")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39547;
            
            mem_39547.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39547, bytes_39506,
                                      "mem_39547")) {
                err = 1;
                goto cleanup;
            }
            if (slt32(d_32136 * 2, segred_group_sizze_36847)) {
                int32_t segment_sizze_nonzzero_40509 = smax32(1, d_32136);
                int32_t num_threads_40510 = num_groups_36848 *
                        segred_group_sizze_36847;
                
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegRed-small");
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_segments",
                            (long long) nodes_this_lvl_32221, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segment_size",
                            (long long) d_32136, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segments_per_group",
                            (long long) squot32(segred_group_sizze_36847,
                                                segment_sizze_nonzzero_40509),
                            '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "required_groups",
                            (long long) sdiv_up32(nodes_this_lvl_32221,
                                                  squot32(segred_group_sizze_36847,
                                                          segment_sizze_nonzzero_40509)),
                            '\n');
                
                unsigned int shared_sizze_40918 = (int64_t) sizeof(float) *
                             sext_i32_i64(segred_group_sizze_36847);
                unsigned int shared_sizze_40920 = (int64_t) sizeof(int32_t) *
                             sext_i32_i64(segred_group_sizze_36847);
                CUdeviceptr kernel_arg_40922 = mem_39532.mem;
                CUdeviceptr kernel_arg_40923 = mem_39540.mem;
                CUdeviceptr kernel_arg_40924 = mem_39544.mem;
                CUdeviceptr kernel_arg_40925 = mem_39547.mem;
                unsigned int shared_offset_40919 = 0;
                unsigned int shared_offset_40921 = 0 + (shared_sizze_40918 +
                                                        (8 -
                                                         shared_sizze_40918 %
                                                         8) % 8);
                
                if ((((((1 && num_groups_36848 != 0) && 1 != 0) && 1 != 0) &&
                      segred_group_sizze_36847 != 0) && 1 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = num_groups_36848;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_40915[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &shared_offset_40919,
                                                 &shared_offset_40921, &d_32136,
                                                 &conc_tmp_32196,
                                                 &nodes_this_lvl_32221,
                                                 &num_groups_36848,
                                                 &kernel_arg_40922,
                                                 &kernel_arg_40923,
                                                 &kernel_arg_40924,
                                                 &kernel_arg_40925,
                                                 &segment_sizze_nonzzero_40509};
                    int64_t time_start_40916 = 0, time_end_40917 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "buildKDtree.segred_small_36675");
                        fprintf(stderr, "%d", num_groups_36848);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", segred_group_sizze_36847);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_40916 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->buildKDtreezisegred_small_36675_runs,
                                                  &ctx->buildKDtreezisegred_small_36675_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegred_small_36675,
                                                grid[0], grid[1], grid[2],
                                                segred_group_sizze_36847, 1, 1,
                                                0 + (shared_sizze_40918 + (8 -
                                                                           shared_sizze_40918 %
                                                                           8) %
                                                     8) + (shared_sizze_40920 +
                                                           (8 -
                                                            shared_sizze_40920 %
                                                            8) % 8), NULL,
                                                kernel_args_40915, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_40917 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "buildKDtree.segred_small_36675",
                                time_end_40917 - time_start_40916);
                    }
                }
                ctx->failure_is_an_option = 1;
            } else {
                int32_t groups_per_segment_40535 = sdiv_up32(num_groups_36848,
                                                             smax32(1,
                                                                    nodes_this_lvl_32221));
                int32_t elements_per_thread_40536 = sdiv_up32(d_32136,
                                                              segred_group_sizze_36847 *
                                                              groups_per_segment_40535);
                int32_t virt_num_groups_40537 = groups_per_segment_40535 *
                        nodes_this_lvl_32221;
                int32_t num_threads_40538 = num_groups_36848 *
                        segred_group_sizze_36847;
                int32_t threads_per_segment_40539 = groups_per_segment_40535 *
                        segred_group_sizze_36847;
                
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegRed-large");
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_segments",
                            (long long) nodes_this_lvl_32221, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segment_size",
                            (long long) d_32136, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                            (long long) virt_num_groups_40537, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_groups",
                            (long long) num_groups_36848, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "group_size",
                            (long long) segred_group_sizze_36847, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                            (long long) elements_per_thread_40536, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                            (long long) groups_per_segment_40535, '\n');
                
                struct memblock_device group_res_arr_mem_40540;
                
                group_res_arr_mem_40540.references = NULL;
                if (memblock_alloc_device(ctx, &group_res_arr_mem_40540,
                                          (int64_t) sizeof(int32_t) *
                                          (sext_i32_i64(segred_group_sizze_36847) *
                                           sext_i32_i64(virt_num_groups_40537)),
                                          "group_res_arr_mem_40540")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device group_res_arr_mem_40542;
                
                group_res_arr_mem_40542.references = NULL;
                if (memblock_alloc_device(ctx, &group_res_arr_mem_40542,
                                          (int64_t) sizeof(float) *
                                          (sext_i32_i64(segred_group_sizze_36847) *
                                           sext_i32_i64(virt_num_groups_40537)),
                                          "group_res_arr_mem_40542")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device buildKDtreezicounter_mem_40544 =
                                       ctx->buildKDtreezicounter_mem_40544;
                unsigned int shared_sizze_40930 = (int64_t) sizeof(bool);
                unsigned int shared_sizze_40932 = (int64_t) sizeof(float) *
                             sext_i32_i64(segred_group_sizze_36847);
                unsigned int shared_sizze_40934 = (int64_t) sizeof(int32_t) *
                             sext_i32_i64(segred_group_sizze_36847);
                CUdeviceptr kernel_arg_40936 = mem_39532.mem;
                CUdeviceptr kernel_arg_40937 = mem_39540.mem;
                CUdeviceptr kernel_arg_40938 = mem_39544.mem;
                CUdeviceptr kernel_arg_40939 = mem_39547.mem;
                CUdeviceptr kernel_arg_40940 = group_res_arr_mem_40540.mem;
                CUdeviceptr kernel_arg_40941 = group_res_arr_mem_40542.mem;
                CUdeviceptr kernel_arg_40942 =
                            buildKDtreezicounter_mem_40544.mem;
                unsigned int shared_offset_40931 = 0;
                unsigned int shared_offset_40933 = 0 + (shared_sizze_40930 +
                                                        (8 -
                                                         shared_sizze_40930 %
                                                         8) % 8);
                unsigned int shared_offset_40935 = 0 + (shared_sizze_40930 +
                                                        (8 -
                                                         shared_sizze_40930 %
                                                         8) % 8) +
                             (shared_sizze_40932 + (8 - shared_sizze_40932 %
                                                    8) % 8);
                
                if ((((((1 && num_groups_36848 != 0) && 1 != 0) && 1 != 0) &&
                      segred_group_sizze_36847 != 0) && 1 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = num_groups_36848;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_40927[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &shared_offset_40931,
                                                 &shared_offset_40933,
                                                 &shared_offset_40935, &d_32136,
                                                 &conc_tmp_32196,
                                                 &nodes_this_lvl_32221,
                                                 &num_groups_36848,
                                                 &kernel_arg_40936,
                                                 &kernel_arg_40937,
                                                 &kernel_arg_40938,
                                                 &kernel_arg_40939,
                                                 &groups_per_segment_40535,
                                                 &elements_per_thread_40536,
                                                 &virt_num_groups_40537,
                                                 &threads_per_segment_40539,
                                                 &kernel_arg_40940,
                                                 &kernel_arg_40941,
                                                 &kernel_arg_40942};
                    int64_t time_start_40928 = 0, time_end_40929 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "buildKDtree.segred_large_36675");
                        fprintf(stderr, "%d", num_groups_36848);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", segred_group_sizze_36847);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_40928 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->buildKDtreezisegred_large_36675_runs,
                                                  &ctx->buildKDtreezisegred_large_36675_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegred_large_36675,
                                                grid[0], grid[1], grid[2],
                                                segred_group_sizze_36847, 1, 1,
                                                0 + (shared_sizze_40930 + (8 -
                                                                           shared_sizze_40930 %
                                                                           8) %
                                                     8) + (shared_sizze_40932 +
                                                           (8 -
                                                            shared_sizze_40932 %
                                                            8) % 8) +
                                                (shared_sizze_40934 + (8 -
                                                                       shared_sizze_40934 %
                                                                       8) % 8),
                                                NULL, kernel_args_40927, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_40929 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "buildKDtree.segred_large_36675",
                                time_end_40929 - time_start_40928);
                    }
                }
                ctx->failure_is_an_option = 1;
                if (memblock_unref_device(ctx, &group_res_arr_mem_40542,
                                          "group_res_arr_mem_40542") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &group_res_arr_mem_40540,
                                          "group_res_arr_mem_40540") != 0)
                    return 1;
            }
            if (memblock_unref_device(ctx, &mem_39532, "mem_39532") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39540, "mem_39540") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39547, "mem_39547") != 0)
                return 1;
            
            int64_t segmap_usable_groups_64_36878 =
                    sdiv_up64(nodes_this_lvl_36531, segmap_group_sizze_36877);
            int32_t segmap_usable_groups_36879 =
                    sext_i64_i32(segmap_usable_groups_64_36878);
            struct memblock_device mem_39551;
            
            mem_39551.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39551, bytes_39506,
                                      "mem_39551")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegMap");
            
            CUdeviceptr kernel_arg_40946 = mem_39458.mem;
            CUdeviceptr kernel_arg_40947 = mem_39544.mem;
            CUdeviceptr kernel_arg_40948 = mem_39551.mem;
            
            if ((((((1 && segmap_usable_groups_36879 != 0) && 1 != 0) && 1 !=
                   0) && segmap_group_sizze_36876 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = segmap_usable_groups_36879;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_40943[] = {&ctx->global_failure,
                                             &ctx->failure_is_an_option,
                                             &ctx->global_failure_args,
                                             &res_32166, &nodes_this_lvl_32221,
                                             &kernel_arg_40946,
                                             &kernel_arg_40947,
                                             &kernel_arg_40948};
                int64_t time_start_40944 = 0, time_end_40945 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "buildKDtree.segmap_36628");
                    fprintf(stderr, "%d", segmap_usable_groups_36879);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segmap_group_sizze_36876);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_40944 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->buildKDtreezisegmap_36628_runs,
                                              &ctx->buildKDtreezisegmap_36628_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_36628,
                                            grid[0], grid[1], grid[2],
                                            segmap_group_sizze_36876, 1, 1, 0,
                                            NULL, kernel_args_40943, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_40945 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "buildKDtree.segmap_36628", time_end_40945 -
                            time_start_40944);
                }
            }
            ctx->failure_is_an_option = 1;
            if (memblock_set_device(ctx, &res_mem_39552, &mem_39544,
                                    "mem_39544") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_39553, &mem_39551,
                                    "mem_39551") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39551, "mem_39551") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39547, "mem_39547") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39544, "mem_39544") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39540, "mem_39540") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39515, "mem_39515") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39535, "mem_39535") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39532, "mem_39532") != 0)
                return 1;
        }
        
        int64_t binop_x_39555 = sext_i32_i64(pts_per_node_at_lev_32225);
        int64_t bytes_39554 = 4 * binop_x_39555;
        struct memblock_device mem_39556;
        
        mem_39556.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39556, bytes_39554, "mem_39556")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhiota_i32(ctx, mem_39556, pts_per_node_at_lev_32225,
                                     0, 1) != 0) {
            err = 1;
            goto cleanup;
        }
        
        bool cond_32321 = pts_per_node_at_lev_32225 == 0;
        int32_t iters_32322;
        
        if (cond_32321) {
            iters_32322 = 0;
        } else {
            iters_32322 = 16;
        }
        
        bool loop_nonempty_32323 = slt32(0, iters_32322);
        int32_t i_32324 = sub32(pts_per_node_at_lev_32225, 1);
        bool x_32325 = sle32(0, i_32324);
        bool y_32326 = slt32(i_32324, pts_per_node_at_lev_32225);
        bool bounds_check_32327 = x_32325 && y_32326;
        bool loop_not_taken_32328 = !loop_nonempty_32323;
        bool protect_assert_disj_32329 = bounds_check_32327 ||
             loop_not_taken_32328;
        bool index_certs_32330;
        
        if (!protect_assert_disj_32329) {
            ctx->error = msgprintf("Error: %s%d%s%d%s\n\nBacktrace:\n%s",
                                   "Index [", i_32324,
                                   "] out of bounds for array of shape [",
                                   pts_per_node_at_lev_32225, "].",
                                   "-> #0  /prelude/array.fut:18:29-34\n   #1  lib/github.com/diku-dk/sorts/radix_sort.fut:25:24-35\n   #2  lib/github.com/diku-dk/sorts/radix_sort.fut:53:31-62\n   #3  lib/github.com/diku-dk/sorts/radix_sort.fut:104:6-36\n   #4  /prelude/functional.fut:9:42-44\n   #5  lib/github.com/diku-dk/sorts/radix_sort.fut:59:3-61:47\n   #6  lib/github.com/diku-dk/sorts/radix_sort.fut:110:3-57\n   #7  /prelude/functional.fut:9:42-44\n   #8  buildKDtree.fut:128:21-129:91\n   #9  driverKNN.fut:145:11-50\n   #10 driverKNN.fut:142:1-148:101\n");
            if (memblock_unref_device(ctx, &mem_39556, "mem_39556") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39553, "res_mem_39553") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39552, "res_mem_39552") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &mem_param_39466,
                                      "mem_param_39466") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39993, "res_mem_39993") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39461, "mem_39461") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39458, "mem_39458") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39455, "mem_39455") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39452, "mem_39452") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39446, "res_mem_39446") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39432, "res_mem_39432") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") !=
                0)
                return 1;
            return 1;
        }
        
        int32_t mi_32473 = sdiv32(pts_per_node_at_lev_32225, 2);
        bool x_32474 = sle32(0, mi_32473);
        bool y_32475 = slt32(mi_32473, pts_per_node_at_lev_32225);
        bool bounds_check_32476 = x_32474 && y_32475;
        bool index_certs_32477;
        
        if (!bounds_check_32476) {
            ctx->error = msgprintf("Error: %s%d%s%d%s\n\nBacktrace:\n%s",
                                   "Index [", mi_32473,
                                   "] out of bounds for array of shape [",
                                   pts_per_node_at_lev_32225, "].",
                                   "-> #0  buildKDtree.fut:134:45-58\n   #1  buildKDtree.fut:132:31-135:50\n   #2  driverKNN.fut:145:11-50\n   #3  driverKNN.fut:142:1-148:101\n");
            if (memblock_unref_device(ctx, &mem_39556, "mem_39556") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39553, "res_mem_39553") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39552, "res_mem_39552") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &mem_param_39466,
                                      "mem_param_39466") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39993, "res_mem_39993") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39461, "mem_39461") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39458, "mem_39458") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39455, "mem_39455") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39452, "mem_39452") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39446, "res_mem_39446") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39432, "res_mem_39432") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") !=
                0)
                return 1;
            return 1;
        }
        
        int32_t i_32478 = sub32(mi_32473, 1);
        bool x_32479 = sle32(0, i_32478);
        bool y_32480 = slt32(i_32478, pts_per_node_at_lev_32225);
        bool bounds_check_32481 = x_32479 && y_32480;
        bool index_certs_32482;
        
        if (!bounds_check_32481) {
            ctx->error = msgprintf("Error: %s%d%s%d%s\n\nBacktrace:\n%s",
                                   "Index [", i_32478,
                                   "] out of bounds for array of shape [",
                                   pts_per_node_at_lev_32225, "].",
                                   "-> #0  buildKDtree.fut:134:62-77\n   #1  buildKDtree.fut:132:31-135:50\n   #2  driverKNN.fut:145:11-50\n   #3  driverKNN.fut:142:1-148:101\n");
            if (memblock_unref_device(ctx, &mem_39556, "mem_39556") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39553, "res_mem_39553") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39552, "res_mem_39552") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &mem_param_39466,
                                      "mem_param_39466") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39993, "res_mem_39993") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39461, "mem_39461") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39458, "mem_39458") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39455, "mem_39455") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39452, "mem_39452") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39446, "res_mem_39446") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39432, "res_mem_39432") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") !=
                0)
                return 1;
            return 1;
        }
        
        bool suff_outer_par_36910;
        
        suff_outer_par_36910 = ctx->sizes.buildKDtreezisuff_outer_par_3 <=
            nodes_this_lvl_32221;
        
        bool fits_37190 = sle32(pts_per_node_at_lev_32225,
                                max_group_sizze_37189);
        bool suff_intra_par_37188;
        
        suff_intra_par_37188 = ctx->sizes.buildKDtreezisuff_intra_par_4 <=
            pts_per_node_at_lev_32225;
        
        bool intra_suff_and_fits_37191 = suff_intra_par_37188 && fits_37190;
        int32_t num_groups_37068;
        int32_t max_num_groups_40592;
        
        max_num_groups_40592 = ctx->sizes.buildKDtreezisegmap_num_groups_36947;
        num_groups_37068 = sext_i64_i32(smax64(1,
                                               smin64(sdiv_up64(nodes_this_lvl_36531,
                                                                sext_i32_i64(segmap_group_sizze_37067)),
                                                      sext_i32_i64(max_num_groups_40592))));
        
        int64_t nest_sizze_38027 = nodes_this_lvl_36531 * binop_x_39555;
        int64_t bytes_39557 = 4 * nest_sizze_38027;
        struct memblock_device mem_39561;
        
        mem_39561.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39561, bytes_39557, "mem_39561")) {
            err = 1;
            goto cleanup;
        }
        
        int32_t group_sizze_40596;
        
        group_sizze_40596 = ctx->sizes.buildKDtreezigroup_sizze_40596;
        
        int64_t num_groups_40597;
        
        num_groups_40597 = sdiv_up64(sext_i32_i64(nodes_this_lvl_32221) *
                                     sext_i32_i64(pts_per_node_at_lev_32225),
                                     sext_i32_i64(group_sizze_40596));
        
        CUdeviceptr kernel_arg_40952 = mem_39556.mem;
        CUdeviceptr kernel_arg_40953 = mem_39561.mem;
        
        if ((((((1 && sext_i64_i32(num_groups_40597) != 0) && 1 != 0) && 1 !=
               0) && group_sizze_40596 != 0) && 1 != 0) && 1 != 0) {
            int perm[3] = {0, 1, 2};
            
            if (1 >= 1 << 16) {
                perm[1] = perm[0];
                perm[0] = 1;
            }
            if (1 >= 1 << 16) {
                perm[2] = perm[0];
                perm[0] = 2;
            }
            
            size_t grid[3];
            
            grid[perm[0]] = sext_i64_i32(num_groups_40597);
            grid[perm[1]] = 1;
            grid[perm[2]] = 1;
            
            void *kernel_args_40949[] = {&nodes_this_lvl_32221,
                                         &pts_per_node_at_lev_32225,
                                         &kernel_arg_40952, &kernel_arg_40953};
            int64_t time_start_40950 = 0, time_end_40951 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with grid size (",
                        "buildKDtree.replicate_40593");
                fprintf(stderr, "%d", sext_i64_i32(num_groups_40597));
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ") and block size (");
                fprintf(stderr, "%d", group_sizze_40596);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ").\n");
                time_start_40950 = get_wall_time();
            }
            
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->buildKDtreezireplicate_40593_runs,
                                          &ctx->buildKDtreezireplicate_40593_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezireplicate_40593,
                                        grid[0], grid[1], grid[2],
                                        group_sizze_40596, 1, 1, 0, NULL,
                                        kernel_args_40949, NULL));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            if (ctx->debugging) {
                CUDA_SUCCEED(cuCtxSynchronize());
                time_end_40951 = get_wall_time();
                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                        "buildKDtree.replicate_40593", time_end_40951 -
                        time_start_40950);
            }
        }
        
        bool suff_intra_par_38063;
        
        suff_intra_par_38063 = ctx->sizes.buildKDtreezisuff_intra_par_7 <=
            pts_per_node_at_lev_32225;
        
        bool intra_suff_and_fits_38064 = fits_37190 && suff_intra_par_38063;
        int32_t num_groups_38156;
        int32_t max_num_groups_40598;
        
        max_num_groups_40598 = ctx->sizes.buildKDtreezisegscan_num_groups_37742;
        num_groups_38156 = sext_i64_i32(smax64(1,
                                               smin64(sdiv_up64(nest_sizze_38027,
                                                                sext_i32_i64(segscan_group_sizze_38155)),
                                                      sext_i32_i64(max_num_groups_40598))));
        
        int64_t segmap_usable_groups_64_38232 = sdiv_up_safe64(nest_sizze_38027,
                                                               segmap_group_sizze_38231);
        int32_t segmap_usable_groups_38233 =
                sext_i64_i32(segmap_usable_groups_64_38232);
        int64_t binop_x_39565 = nodes_this_lvl_36531 * binop_x_39555;
        int64_t bytes_39562 = 4 * binop_x_39565;
        int64_t binop_y_40102 = sext_i32_i64(pts_per_node_at_lev_32225);
        int64_t double_buffer_sizze_40103 = 4 * binop_y_40102;
        int64_t binop_y_40104 = sext_i32_i64(pts_per_node_at_lev_32225);
        int64_t double_buffer_sizze_40105 = 4 * binop_y_40104;
        int64_t binop_y_40112 = sext_i32_i64(pts_per_node_at_lev_32225);
        int64_t double_buffer_sizze_40113 = 4 * binop_y_40112;
        int64_t binop_y_40114 = sext_i32_i64(pts_per_node_at_lev_32225);
        int64_t double_buffer_sizze_40115 = 4 * binop_y_40114;
        int32_t num_threads_40243 = segmap_group_sizze_37067 * num_groups_37068;
        int64_t num_threads64_40245 = sext_i32_i64(num_threads_40243);
        int64_t total_sizze_40246 = bytes_39554 * num_threads64_40245;
        int64_t total_sizze_40247 = bytes_39554 * num_threads64_40245;
        int64_t total_sizze_40248 = bytes_39554 * num_threads64_40245;
        int64_t total_sizze_40249 = bytes_39554 * num_threads64_40245;
        int64_t total_sizze_40250 = bytes_39554 * num_threads64_40245;
        int64_t total_sizze_40251 = bytes_39554 * num_threads64_40245;
        int64_t total_sizze_40252 = bytes_39554 * num_threads64_40245;
        int64_t total_sizze_40253 = bytes_39554 * num_threads64_40245;
        int64_t total_sizze_40254 = bytes_39554 * num_threads64_40245;
        int64_t total_sizze_40255 = bytes_39554 * num_threads64_40245;
        int64_t total_sizze_40256 = double_buffer_sizze_40103 *
                num_threads64_40245;
        int64_t total_sizze_40257 = double_buffer_sizze_40105 *
                num_threads64_40245;
        int64_t num_groups64_40259 = sext_i32_i64(nodes_this_lvl_32221);
        int64_t total_sizze_40261 = double_buffer_sizze_40115 *
                num_groups64_40259;
        struct memblock_device res_mem_39984;
        
        res_mem_39984.references = NULL;
        
        struct memblock_device res_mem_39985;
        
        res_mem_39985.references = NULL;
        
        int32_t local_memory_capacity_40812;
        
        local_memory_capacity_40812 = ctx->cuda.max_shared_memory;
        if (sle64(0, sext_i32_i64(local_memory_capacity_40812)) &&
            suff_outer_par_36910) {
            struct memblock_device mem_39566;
            
            mem_39566.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39566, bytes_39562,
                                      "mem_39566")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39566, 0,
                                                      mem_param_39466, 0, 1,
                                                      pts_per_node_at_lev_32225,
                                                      nodes_this_lvl_32221) !=
                0) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39744;
            
            mem_39744.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39744, bytes_39562,
                                      "mem_39744")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39749;
            
            mem_39749.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39749, bytes_39562,
                                      "mem_39749")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39570;
            
            mem_39570.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39570, total_sizze_40246,
                                      "mem_39570")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39597;
            
            mem_39597.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39597, total_sizze_40247,
                                      "mem_39597")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39600;
            
            mem_39600.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39600, total_sizze_40248,
                                      "mem_39600")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39603;
            
            mem_39603.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39603, total_sizze_40249,
                                      "mem_39603")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39606;
            
            mem_39606.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39606, total_sizze_40250,
                                      "mem_39606")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39609;
            
            mem_39609.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39609, total_sizze_40251,
                                      "mem_39609")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39672;
            
            mem_39672.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39672, total_sizze_40252,
                                      "mem_39672")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39675;
            
            mem_39675.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39675, total_sizze_40253,
                                      "mem_39675")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39712;
            
            mem_39712.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39712, total_sizze_40254,
                                      "mem_39712")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39715;
            
            mem_39715.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39715, total_sizze_40255,
                                      "mem_39715")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device double_buffer_mem_40098;
            
            double_buffer_mem_40098.references = NULL;
            if (memblock_alloc_device(ctx, &double_buffer_mem_40098,
                                      total_sizze_40256,
                                      "double_buffer_mem_40098")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device double_buffer_mem_40099;
            
            double_buffer_mem_40099.references = NULL;
            if (memblock_alloc_device(ctx, &double_buffer_mem_40099,
                                      total_sizze_40257,
                                      "double_buffer_mem_40099")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegMap");
            
            CUdeviceptr kernel_arg_40957 = input_mem_39418.mem;
            CUdeviceptr kernel_arg_40958 = mem_param_39466.mem;
            CUdeviceptr kernel_arg_40959 = res_mem_39552.mem;
            CUdeviceptr kernel_arg_40960 = mem_39556.mem;
            CUdeviceptr kernel_arg_40961 = mem_39566.mem;
            CUdeviceptr kernel_arg_40962 = mem_39570.mem;
            CUdeviceptr kernel_arg_40963 = mem_39597.mem;
            CUdeviceptr kernel_arg_40964 = mem_39600.mem;
            CUdeviceptr kernel_arg_40965 = mem_39603.mem;
            CUdeviceptr kernel_arg_40966 = mem_39606.mem;
            CUdeviceptr kernel_arg_40967 = mem_39609.mem;
            CUdeviceptr kernel_arg_40968 = mem_39672.mem;
            CUdeviceptr kernel_arg_40969 = mem_39675.mem;
            CUdeviceptr kernel_arg_40970 = mem_39712.mem;
            CUdeviceptr kernel_arg_40971 = mem_39715.mem;
            CUdeviceptr kernel_arg_40972 = mem_39744.mem;
            CUdeviceptr kernel_arg_40973 = mem_39749.mem;
            CUdeviceptr kernel_arg_40974 = double_buffer_mem_40098.mem;
            CUdeviceptr kernel_arg_40975 = double_buffer_mem_40099.mem;
            
            if ((((((1 && num_groups_37068 != 0) && 1 != 0) && 1 != 0) &&
                  segmap_group_sizze_37067 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = num_groups_37068;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_40954[] = {&ctx->global_failure,
                                             &ctx->failure_is_an_option,
                                             &ctx->global_failure_args,
                                             &m_32135, &d_32136, &res_32168,
                                             &nodes_this_lvl_32221,
                                             &pts_per_node_at_lev_32225,
                                             &iters_32322, &i_32324,
                                             &num_groups_37068,
                                             &kernel_arg_40957,
                                             &kernel_arg_40958,
                                             &kernel_arg_40959,
                                             &kernel_arg_40960,
                                             &kernel_arg_40961,
                                             &kernel_arg_40962,
                                             &kernel_arg_40963,
                                             &kernel_arg_40964,
                                             &kernel_arg_40965,
                                             &kernel_arg_40966,
                                             &kernel_arg_40967,
                                             &kernel_arg_40968,
                                             &kernel_arg_40969,
                                             &kernel_arg_40970,
                                             &kernel_arg_40971,
                                             &kernel_arg_40972,
                                             &kernel_arg_40973,
                                             &kernel_arg_40974,
                                             &kernel_arg_40975};
                int64_t time_start_40955 = 0, time_end_40956 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "buildKDtree.segmap_36942");
                    fprintf(stderr, "%d", num_groups_37068);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segmap_group_sizze_37067);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_40955 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->buildKDtreezisegmap_36942_runs,
                                              &ctx->buildKDtreezisegmap_36942_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_36942,
                                            grid[0], grid[1], grid[2],
                                            segmap_group_sizze_37067, 1, 1, 0,
                                            NULL, kernel_args_40954, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_40956 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "buildKDtree.segmap_36942", time_end_40956 -
                            time_start_40955);
                }
            }
            ctx->failure_is_an_option = 1;
            if (memblock_unref_device(ctx, &mem_39566, "mem_39566") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39570, "mem_39570") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39597, "mem_39597") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39600, "mem_39600") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39603, "mem_39603") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39606, "mem_39606") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39609, "mem_39609") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39672, "mem_39672") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39675, "mem_39675") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39712, "mem_39712") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39715, "mem_39715") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40098,
                                      "double_buffer_mem_40098") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40099,
                                      "double_buffer_mem_40099") != 0)
                return 1;
            
            struct memblock_device mem_39976;
            
            mem_39976.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39976, bytes_39557,
                                      "mem_39976")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39976, 0,
                                                      mem_39744, 0, 1,
                                                      nodes_this_lvl_32221,
                                                      pts_per_node_at_lev_32225) !=
                0) {
                err = 1;
                goto cleanup;
            }
            if (memblock_unref_device(ctx, &mem_39744, "mem_39744") != 0)
                return 1;
            
            struct memblock_device mem_39982;
            
            mem_39982.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39982, bytes_39557,
                                      "mem_39982")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39982, 0,
                                                      mem_39749, 0, 1,
                                                      nodes_this_lvl_32221,
                                                      pts_per_node_at_lev_32225) !=
                0) {
                err = 1;
                goto cleanup;
            }
            if (memblock_unref_device(ctx, &mem_39749, "mem_39749") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_39984, &mem_39976,
                                    "mem_39976") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_39985, &mem_39982,
                                    "mem_39982") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39982, "mem_39982") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39976, "mem_39976") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40099,
                                      "double_buffer_mem_40099") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40098,
                                      "double_buffer_mem_40098") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39715, "mem_39715") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39712, "mem_39712") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39675, "mem_39675") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39672, "mem_39672") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39609, "mem_39609") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39606, "mem_39606") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39603, "mem_39603") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39600, "mem_39600") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39597, "mem_39597") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39570, "mem_39570") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39749, "mem_39749") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39744, "mem_39744") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39566, "mem_39566") != 0)
                return 1;
        } else {
            struct memblock_device res_mem_39970;
            
            res_mem_39970.references = NULL;
            
            struct memblock_device res_mem_39971;
            
            res_mem_39971.references = NULL;
            
            int32_t local_memory_capacity_40811;
            
            local_memory_capacity_40811 = ctx->cuda.max_shared_memory;
            if (sle64(bytes_39554 + bytes_39554 + bytes_39554 + bytes_39554 +
                      bytes_39554 + bytes_39554 + bytes_39554 +
                      double_buffer_sizze_40113 + bytes_39554 + bytes_39554 +
                      bytes_39554, sext_i32_i64(local_memory_capacity_40811)) &&
                intra_suff_and_fits_37191) {
                struct memblock_device mem_39821;
                
                mem_39821.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39821, bytes_39557,
                                          "mem_39821")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39826;
                
                mem_39826.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39826, bytes_39557,
                                          "mem_39826")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device double_buffer_mem_40109;
                
                double_buffer_mem_40109.references = NULL;
                if (memblock_alloc_device(ctx, &double_buffer_mem_40109,
                                          total_sizze_40261,
                                          "double_buffer_mem_40109")) {
                    err = 1;
                    goto cleanup;
                }
                
                unsigned int shared_sizze_40979 = bytes_39554;
                unsigned int shared_sizze_40981 = bytes_39554;
                unsigned int shared_sizze_40983 = bytes_39554;
                unsigned int shared_sizze_40985 = double_buffer_sizze_40113;
                unsigned int shared_sizze_40987 = bytes_39554;
                unsigned int shared_sizze_40989 = bytes_39554;
                unsigned int shared_sizze_40991 = bytes_39554;
                unsigned int shared_sizze_40993 = bytes_39554;
                unsigned int shared_sizze_40995 = bytes_39554;
                unsigned int shared_sizze_40997 = bytes_39554;
                unsigned int shared_sizze_40999 = bytes_39554;
                CUdeviceptr kernel_arg_41001 = input_mem_39418.mem;
                CUdeviceptr kernel_arg_41002 = mem_param_39466.mem;
                CUdeviceptr kernel_arg_41003 = res_mem_39552.mem;
                CUdeviceptr kernel_arg_41004 = mem_39556.mem;
                CUdeviceptr kernel_arg_41005 = mem_39821.mem;
                CUdeviceptr kernel_arg_41006 = mem_39826.mem;
                CUdeviceptr kernel_arg_41007 = double_buffer_mem_40109.mem;
                unsigned int shared_offset_40980 = 0;
                unsigned int shared_offset_40982 = 0 + (shared_sizze_40979 +
                                                        (8 -
                                                         shared_sizze_40979 %
                                                         8) % 8);
                unsigned int shared_offset_40984 = 0 + (shared_sizze_40979 +
                                                        (8 -
                                                         shared_sizze_40979 %
                                                         8) % 8) +
                             (shared_sizze_40981 + (8 - shared_sizze_40981 %
                                                    8) % 8);
                unsigned int shared_offset_40986 = 0 + (shared_sizze_40979 +
                                                        (8 -
                                                         shared_sizze_40979 %
                                                         8) % 8) +
                             (shared_sizze_40981 + (8 - shared_sizze_40981 %
                                                    8) % 8) +
                             (shared_sizze_40983 + (8 - shared_sizze_40983 %
                                                    8) % 8);
                unsigned int shared_offset_40988 = 0 + (shared_sizze_40979 +
                                                        (8 -
                                                         shared_sizze_40979 %
                                                         8) % 8) +
                             (shared_sizze_40981 + (8 - shared_sizze_40981 %
                                                    8) % 8) +
                             (shared_sizze_40983 + (8 - shared_sizze_40983 %
                                                    8) % 8) +
                             (shared_sizze_40985 + (8 - shared_sizze_40985 %
                                                    8) % 8);
                unsigned int shared_offset_40990 = 0 + (shared_sizze_40979 +
                                                        (8 -
                                                         shared_sizze_40979 %
                                                         8) % 8) +
                             (shared_sizze_40981 + (8 - shared_sizze_40981 %
                                                    8) % 8) +
                             (shared_sizze_40983 + (8 - shared_sizze_40983 %
                                                    8) % 8) +
                             (shared_sizze_40985 + (8 - shared_sizze_40985 %
                                                    8) % 8) +
                             (shared_sizze_40987 + (8 - shared_sizze_40987 %
                                                    8) % 8);
                unsigned int shared_offset_40992 = 0 + (shared_sizze_40979 +
                                                        (8 -
                                                         shared_sizze_40979 %
                                                         8) % 8) +
                             (shared_sizze_40981 + (8 - shared_sizze_40981 %
                                                    8) % 8) +
                             (shared_sizze_40983 + (8 - shared_sizze_40983 %
                                                    8) % 8) +
                             (shared_sizze_40985 + (8 - shared_sizze_40985 %
                                                    8) % 8) +
                             (shared_sizze_40987 + (8 - shared_sizze_40987 %
                                                    8) % 8) +
                             (shared_sizze_40989 + (8 - shared_sizze_40989 %
                                                    8) % 8);
                unsigned int shared_offset_40994 = 0 + (shared_sizze_40979 +
                                                        (8 -
                                                         shared_sizze_40979 %
                                                         8) % 8) +
                             (shared_sizze_40981 + (8 - shared_sizze_40981 %
                                                    8) % 8) +
                             (shared_sizze_40983 + (8 - shared_sizze_40983 %
                                                    8) % 8) +
                             (shared_sizze_40985 + (8 - shared_sizze_40985 %
                                                    8) % 8) +
                             (shared_sizze_40987 + (8 - shared_sizze_40987 %
                                                    8) % 8) +
                             (shared_sizze_40989 + (8 - shared_sizze_40989 %
                                                    8) % 8) +
                             (shared_sizze_40991 + (8 - shared_sizze_40991 %
                                                    8) % 8);
                unsigned int shared_offset_40996 = 0 + (shared_sizze_40979 +
                                                        (8 -
                                                         shared_sizze_40979 %
                                                         8) % 8) +
                             (shared_sizze_40981 + (8 - shared_sizze_40981 %
                                                    8) % 8) +
                             (shared_sizze_40983 + (8 - shared_sizze_40983 %
                                                    8) % 8) +
                             (shared_sizze_40985 + (8 - shared_sizze_40985 %
                                                    8) % 8) +
                             (shared_sizze_40987 + (8 - shared_sizze_40987 %
                                                    8) % 8) +
                             (shared_sizze_40989 + (8 - shared_sizze_40989 %
                                                    8) % 8) +
                             (shared_sizze_40991 + (8 - shared_sizze_40991 %
                                                    8) % 8) +
                             (shared_sizze_40993 + (8 - shared_sizze_40993 %
                                                    8) % 8);
                unsigned int shared_offset_40998 = 0 + (shared_sizze_40979 +
                                                        (8 -
                                                         shared_sizze_40979 %
                                                         8) % 8) +
                             (shared_sizze_40981 + (8 - shared_sizze_40981 %
                                                    8) % 8) +
                             (shared_sizze_40983 + (8 - shared_sizze_40983 %
                                                    8) % 8) +
                             (shared_sizze_40985 + (8 - shared_sizze_40985 %
                                                    8) % 8) +
                             (shared_sizze_40987 + (8 - shared_sizze_40987 %
                                                    8) % 8) +
                             (shared_sizze_40989 + (8 - shared_sizze_40989 %
                                                    8) % 8) +
                             (shared_sizze_40991 + (8 - shared_sizze_40991 %
                                                    8) % 8) +
                             (shared_sizze_40993 + (8 - shared_sizze_40993 %
                                                    8) % 8) +
                             (shared_sizze_40995 + (8 - shared_sizze_40995 %
                                                    8) % 8);
                unsigned int shared_offset_41000 = 0 + (shared_sizze_40979 +
                                                        (8 -
                                                         shared_sizze_40979 %
                                                         8) % 8) +
                             (shared_sizze_40981 + (8 - shared_sizze_40981 %
                                                    8) % 8) +
                             (shared_sizze_40983 + (8 - shared_sizze_40983 %
                                                    8) % 8) +
                             (shared_sizze_40985 + (8 - shared_sizze_40985 %
                                                    8) % 8) +
                             (shared_sizze_40987 + (8 - shared_sizze_40987 %
                                                    8) % 8) +
                             (shared_sizze_40989 + (8 - shared_sizze_40989 %
                                                    8) % 8) +
                             (shared_sizze_40991 + (8 - shared_sizze_40991 %
                                                    8) % 8) +
                             (shared_sizze_40993 + (8 - shared_sizze_40993 %
                                                    8) % 8) +
                             (shared_sizze_40995 + (8 - shared_sizze_40995 %
                                                    8) % 8) +
                             (shared_sizze_40997 + (8 - shared_sizze_40997 %
                                                    8) % 8);
                
                if ((((((1 && nodes_this_lvl_32221 != 0) && 1 != 0) && 1 !=
                       0) && pts_per_node_at_lev_32225 != 0) && 1 != 0) && 1 !=
                    0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = nodes_this_lvl_32221;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_40976[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &shared_offset_40980,
                                                 &shared_offset_40982,
                                                 &shared_offset_40984,
                                                 &shared_offset_40986,
                                                 &shared_offset_40988,
                                                 &shared_offset_40990,
                                                 &shared_offset_40992,
                                                 &shared_offset_40994,
                                                 &shared_offset_40996,
                                                 &shared_offset_40998,
                                                 &shared_offset_41000, &m_32135,
                                                 &d_32136, &res_32168,
                                                 &pts_per_node_at_lev_32225,
                                                 &iters_32322, &i_32324,
                                                 &kernel_arg_41001,
                                                 &kernel_arg_41002,
                                                 &kernel_arg_41003,
                                                 &kernel_arg_41004,
                                                 &kernel_arg_41005,
                                                 &kernel_arg_41006,
                                                 &kernel_arg_41007};
                    int64_t time_start_40977 = 0, time_end_40978 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "buildKDtree.segmap_intragroup_36940");
                        fprintf(stderr, "%d", nodes_this_lvl_32221);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", pts_per_node_at_lev_32225);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_40977 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->buildKDtreezisegmap_intragroup_36940_runs,
                                                  &ctx->buildKDtreezisegmap_intragroup_36940_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_intragroup_36940,
                                                grid[0], grid[1], grid[2],
                                                pts_per_node_at_lev_32225, 1, 1,
                                                0 + (shared_sizze_40979 + (8 -
                                                                           shared_sizze_40979 %
                                                                           8) %
                                                     8) + (shared_sizze_40981 +
                                                           (8 -
                                                            shared_sizze_40981 %
                                                            8) % 8) +
                                                (shared_sizze_40983 + (8 -
                                                                       shared_sizze_40983 %
                                                                       8) % 8) +
                                                (shared_sizze_40985 + (8 -
                                                                       shared_sizze_40985 %
                                                                       8) % 8) +
                                                (shared_sizze_40987 + (8 -
                                                                       shared_sizze_40987 %
                                                                       8) % 8) +
                                                (shared_sizze_40989 + (8 -
                                                                       shared_sizze_40989 %
                                                                       8) % 8) +
                                                (shared_sizze_40991 + (8 -
                                                                       shared_sizze_40991 %
                                                                       8) % 8) +
                                                (shared_sizze_40993 + (8 -
                                                                       shared_sizze_40993 %
                                                                       8) % 8) +
                                                (shared_sizze_40995 + (8 -
                                                                       shared_sizze_40995 %
                                                                       8) % 8) +
                                                (shared_sizze_40997 + (8 -
                                                                       shared_sizze_40997 %
                                                                       8) % 8) +
                                                (shared_sizze_40999 + (8 -
                                                                       shared_sizze_40999 %
                                                                       8) % 8),
                                                NULL, kernel_args_40976, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_40978 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "buildKDtree.segmap_intragroup_36940",
                                time_end_40978 - time_start_40977);
                    }
                }
                ctx->failure_is_an_option = 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40109,
                                          "double_buffer_mem_40109") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39970, &mem_39821,
                                        "mem_39821") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39971, &mem_39826,
                                        "mem_39826") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40109,
                                          "double_buffer_mem_40109") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39826, "mem_39826") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39821, "mem_39821") != 0)
                    return 1;
            } else {
                int64_t segmap_usable_groups_64_38006 =
                        sdiv_up64(nodes_this_lvl_36531,
                                  segmap_group_sizze_38005);
                int32_t segmap_usable_groups_38007 =
                        sext_i64_i32(segmap_usable_groups_64_38006);
                struct memblock_device mem_39829;
                
                mem_39829.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39829, nodes_this_lvl_36531,
                                          "mem_39829")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                
                CUdeviceptr kernel_arg_41011 = res_mem_39552.mem;
                CUdeviceptr kernel_arg_41012 = mem_39829.mem;
                
                if ((((((1 && segmap_usable_groups_38007 != 0) && 1 != 0) &&
                       1 != 0) && segmap_group_sizze_38004 != 0) && 1 != 0) &&
                    1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = segmap_usable_groups_38007;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41008[] = {&ctx->global_failure, &d_32136,
                                                 &nodes_this_lvl_32221,
                                                 &kernel_arg_41011,
                                                 &kernel_arg_41012};
                    int64_t time_start_41009 = 0, time_end_41010 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "buildKDtree.segmap_37990");
                        fprintf(stderr, "%d", segmap_usable_groups_38007);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", segmap_group_sizze_38004);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41009 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->buildKDtreezisegmap_37990_runs,
                                                  &ctx->buildKDtreezisegmap_37990_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_37990,
                                                grid[0], grid[1], grid[2],
                                                segmap_group_sizze_38004, 1, 1,
                                                0, NULL, kernel_args_41008,
                                                NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41010 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "buildKDtree.segmap_37990", time_end_41010 -
                                time_start_41009);
                    }
                }
                
                int64_t segmap_usable_groups_64_38030 =
                        sdiv_up64(nest_sizze_38027, segmap_group_sizze_38029);
                int32_t segmap_usable_groups_38031 =
                        sext_i64_i32(segmap_usable_groups_64_38030);
                struct memblock_device mem_39835;
                
                mem_39835.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39835, bytes_39557,
                                          "mem_39835")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                
                CUdeviceptr kernel_arg_41016 = input_mem_39418.mem;
                CUdeviceptr kernel_arg_41017 = mem_param_39466.mem;
                CUdeviceptr kernel_arg_41018 = res_mem_39552.mem;
                CUdeviceptr kernel_arg_41019 = mem_39829.mem;
                CUdeviceptr kernel_arg_41020 = mem_39835.mem;
                
                if ((((((1 && segmap_usable_groups_38031 != 0) && 1 != 0) &&
                       1 != 0) && segmap_group_sizze_38028 != 0) && 1 != 0) &&
                    1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = segmap_usable_groups_38031;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41013[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &m_32135, &d_32136, &res_32168,
                                                 &nodes_this_lvl_32221,
                                                 &pts_per_node_at_lev_32225,
                                                 &kernel_arg_41016,
                                                 &kernel_arg_41017,
                                                 &kernel_arg_41018,
                                                 &kernel_arg_41019,
                                                 &kernel_arg_41020};
                    int64_t time_start_41014 = 0, time_end_41015 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "buildKDtree.segmap_37946");
                        fprintf(stderr, "%d", segmap_usable_groups_38031);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", segmap_group_sizze_38028);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41014 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->buildKDtreezisegmap_37946_runs,
                                                  &ctx->buildKDtreezisegmap_37946_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_37946,
                                                grid[0], grid[1], grid[2],
                                                segmap_group_sizze_38028, 1, 1,
                                                0, NULL, kernel_args_41013,
                                                NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41015 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "buildKDtree.segmap_37946", time_end_41015 -
                                time_start_41014);
                    }
                }
                ctx->failure_is_an_option = 1;
                if (memblock_unref_device(ctx, &mem_39829, "mem_39829") != 0)
                    return 1;
                
                struct memblock_device res_mem_39950;
                
                res_mem_39950.references = NULL;
                
                struct memblock_device res_r_mem_39958;
                
                res_r_mem_39958.references = NULL;
                
                struct memblock_device mem_param_39843;
                
                mem_param_39843.references = NULL;
                
                struct memblock_device mem_param_39851;
                
                mem_param_39851.references = NULL;
                if (memblock_set_device(ctx, &mem_param_39843, &mem_39835,
                                        "mem_39835") != 0)
                    return 1;
                if (memblock_set_device(ctx, &mem_param_39851, &mem_39561,
                                        "mem_39561") != 0)
                    return 1;
                for (int32_t i_38049 = 0; i_38049 < iters_32322; i_38049++) {
                    int32_t lifted_2_radix_sort_step_arg_38052 = mul32(2,
                                                                       i_38049);
                    int32_t lifted_0_get_bit_arg_38053 = add32(1,
                                                               lifted_2_radix_sort_step_arg_38052);
                    bool res_38054 = lifted_0_get_bit_arg_38053 == 31;
                    bool res_38055 = lifted_2_radix_sort_step_arg_38052 == 31;
                    struct memblock_device res_mem_39937;
                    
                    res_mem_39937.references = NULL;
                    
                    struct memblock_device res_mem_39938;
                    
                    res_mem_39938.references = NULL;
                    
                    int32_t local_memory_capacity_40805;
                    
                    local_memory_capacity_40805 = ctx->cuda.max_shared_memory;
                    if (sle64(bytes_39554 + bytes_39554 + bytes_39554 +
                              bytes_39554 + bytes_39554 + bytes_39554 +
                              bytes_39554,
                              sext_i32_i64(local_memory_capacity_40805)) &&
                        intra_suff_and_fits_38064) {
                        struct memblock_device mem_39860;
                        
                        mem_39860.references = NULL;
                        if (memblock_alloc_device(ctx, &mem_39860, bytes_39562,
                                                  "mem_39860")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (futrts_builtinzhgpu_map_transpose_f32(ctx,
                                                                  mem_39860, 0,
                                                                  mem_param_39843,
                                                                  0, 1,
                                                                  pts_per_node_at_lev_32225,
                                                                  nodes_this_lvl_32221) !=
                            0) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        struct memblock_device mem_39865;
                        
                        mem_39865.references = NULL;
                        if (memblock_alloc_device(ctx, &mem_39865, bytes_39562,
                                                  "mem_39865")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (futrts_builtinzhgpu_map_transpose_i32(ctx,
                                                                  mem_39865, 0,
                                                                  mem_param_39851,
                                                                  0, 1,
                                                                  pts_per_node_at_lev_32225,
                                                                  nodes_this_lvl_32221) !=
                            0) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        struct memblock_device mem_39894;
                        
                        mem_39894.references = NULL;
                        if (memblock_alloc_device(ctx, &mem_39894, bytes_39557,
                                                  "mem_39894")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        struct memblock_device mem_39899;
                        
                        mem_39899.references = NULL;
                        if (memblock_alloc_device(ctx, &mem_39899, bytes_39557,
                                                  "mem_39899")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        unsigned int shared_sizze_41024 = bytes_39554;
                        unsigned int shared_sizze_41026 = bytes_39554;
                        unsigned int shared_sizze_41028 = bytes_39554;
                        unsigned int shared_sizze_41030 = bytes_39554;
                        unsigned int shared_sizze_41032 = bytes_39554;
                        unsigned int shared_sizze_41034 = bytes_39554;
                        unsigned int shared_sizze_41036 = bytes_39554;
                        CUdeviceptr kernel_arg_41038 = mem_param_39843.mem;
                        CUdeviceptr kernel_arg_41039 = mem_param_39851.mem;
                        CUdeviceptr kernel_arg_41040 = mem_39860.mem;
                        CUdeviceptr kernel_arg_41041 = mem_39865.mem;
                        CUdeviceptr kernel_arg_41042 = mem_39894.mem;
                        CUdeviceptr kernel_arg_41043 = mem_39899.mem;
                        unsigned int shared_offset_41025 = 0;
                        unsigned int shared_offset_41027 = 0 +
                                     (shared_sizze_41024 + (8 -
                                                            shared_sizze_41024 %
                                                            8) % 8);
                        unsigned int shared_offset_41029 = 0 +
                                     (shared_sizze_41024 + (8 -
                                                            shared_sizze_41024 %
                                                            8) % 8) +
                                     (shared_sizze_41026 + (8 -
                                                            shared_sizze_41026 %
                                                            8) % 8);
                        unsigned int shared_offset_41031 = 0 +
                                     (shared_sizze_41024 + (8 -
                                                            shared_sizze_41024 %
                                                            8) % 8) +
                                     (shared_sizze_41026 + (8 -
                                                            shared_sizze_41026 %
                                                            8) % 8) +
                                     (shared_sizze_41028 + (8 -
                                                            shared_sizze_41028 %
                                                            8) % 8);
                        unsigned int shared_offset_41033 = 0 +
                                     (shared_sizze_41024 + (8 -
                                                            shared_sizze_41024 %
                                                            8) % 8) +
                                     (shared_sizze_41026 + (8 -
                                                            shared_sizze_41026 %
                                                            8) % 8) +
                                     (shared_sizze_41028 + (8 -
                                                            shared_sizze_41028 %
                                                            8) % 8) +
                                     (shared_sizze_41030 + (8 -
                                                            shared_sizze_41030 %
                                                            8) % 8);
                        unsigned int shared_offset_41035 = 0 +
                                     (shared_sizze_41024 + (8 -
                                                            shared_sizze_41024 %
                                                            8) % 8) +
                                     (shared_sizze_41026 + (8 -
                                                            shared_sizze_41026 %
                                                            8) % 8) +
                                     (shared_sizze_41028 + (8 -
                                                            shared_sizze_41028 %
                                                            8) % 8) +
                                     (shared_sizze_41030 + (8 -
                                                            shared_sizze_41030 %
                                                            8) % 8) +
                                     (shared_sizze_41032 + (8 -
                                                            shared_sizze_41032 %
                                                            8) % 8);
                        unsigned int shared_offset_41037 = 0 +
                                     (shared_sizze_41024 + (8 -
                                                            shared_sizze_41024 %
                                                            8) % 8) +
                                     (shared_sizze_41026 + (8 -
                                                            shared_sizze_41026 %
                                                            8) % 8) +
                                     (shared_sizze_41028 + (8 -
                                                            shared_sizze_41028 %
                                                            8) % 8) +
                                     (shared_sizze_41030 + (8 -
                                                            shared_sizze_41030 %
                                                            8) % 8) +
                                     (shared_sizze_41032 + (8 -
                                                            shared_sizze_41032 %
                                                            8) % 8) +
                                     (shared_sizze_41034 + (8 -
                                                            shared_sizze_41034 %
                                                            8) % 8);
                        
                        if ((((((1 && nodes_this_lvl_32221 != 0) && 1 != 0) &&
                               1 != 0) && pts_per_node_at_lev_32225 != 0) &&
                             1 != 0) && 1 != 0) {
                            int perm[3] = {0, 1, 2};
                            
                            if (1 >= 1 << 16) {
                                perm[1] = perm[0];
                                perm[0] = 1;
                            }
                            if (1 >= 1 << 16) {
                                perm[2] = perm[0];
                                perm[0] = 2;
                            }
                            
                            size_t grid[3];
                            
                            grid[perm[0]] = nodes_this_lvl_32221;
                            grid[perm[1]] = 1;
                            grid[perm[2]] = 1;
                            
                            void *kernel_args_41021[] = {&ctx->global_failure,
                                                         &shared_offset_41025,
                                                         &shared_offset_41027,
                                                         &shared_offset_41029,
                                                         &shared_offset_41031,
                                                         &shared_offset_41033,
                                                         &shared_offset_41035,
                                                         &shared_offset_41037,
                                                         &nodes_this_lvl_32221,
                                                         &pts_per_node_at_lev_32225,
                                                         &i_32324,
                                                         &lifted_2_radix_sort_step_arg_38052,
                                                         &lifted_0_get_bit_arg_38053,
                                                         &res_38054, &res_38055,
                                                         &kernel_arg_41038,
                                                         &kernel_arg_41039,
                                                         &kernel_arg_41040,
                                                         &kernel_arg_41041,
                                                         &kernel_arg_41042,
                                                         &kernel_arg_41043};
                            int64_t time_start_41022 = 0, time_end_41023 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr, "Launching %s with grid size (",
                                        "buildKDtree.segmap_intragroup_37393");
                                fprintf(stderr, "%d", nodes_this_lvl_32221);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ") and block size (");
                                fprintf(stderr, "%d",
                                        pts_per_node_at_lev_32225);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ").\n");
                                time_start_41022 = get_wall_time();
                            }
                            
                            cudaEvent_t *pevents = NULL;
                            
                            if (ctx->profiling && !ctx->profiling_paused) {
                                pevents = cuda_get_events(&ctx->cuda,
                                                          &ctx->buildKDtreezisegmap_intragroup_37393_runs,
                                                          &ctx->buildKDtreezisegmap_intragroup_37393_total_runtime);
                                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                            }
                            CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_intragroup_37393,
                                                        grid[0], grid[1],
                                                        grid[2],
                                                        pts_per_node_at_lev_32225,
                                                        1, 1, 0 +
                                                        (shared_sizze_41024 +
                                                         (8 -
                                                          shared_sizze_41024 %
                                                          8) % 8) +
                                                        (shared_sizze_41026 +
                                                         (8 -
                                                          shared_sizze_41026 %
                                                          8) % 8) +
                                                        (shared_sizze_41028 +
                                                         (8 -
                                                          shared_sizze_41028 %
                                                          8) % 8) +
                                                        (shared_sizze_41030 +
                                                         (8 -
                                                          shared_sizze_41030 %
                                                          8) % 8) +
                                                        (shared_sizze_41032 +
                                                         (8 -
                                                          shared_sizze_41032 %
                                                          8) % 8) +
                                                        (shared_sizze_41034 +
                                                         (8 -
                                                          shared_sizze_41034 %
                                                          8) % 8) +
                                                        (shared_sizze_41036 +
                                                         (8 -
                                                          shared_sizze_41036 %
                                                          8) % 8), NULL,
                                                        kernel_args_41021,
                                                        NULL));
                            if (pevents != NULL)
                                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                            if (ctx->debugging) {
                                CUDA_SUCCEED(cuCtxSynchronize());
                                time_end_41023 = get_wall_time();
                                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                        "buildKDtree.segmap_intragroup_37393",
                                        time_end_41023 - time_start_41022);
                            }
                        }
                        if (memblock_unref_device(ctx, &mem_39860,
                                                  "mem_39860") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39865,
                                                  "mem_39865") != 0)
                            return 1;
                        if (memblock_set_device(ctx, &res_mem_39937, &mem_39894,
                                                "mem_39894") != 0)
                            return 1;
                        if (memblock_set_device(ctx, &res_mem_39938, &mem_39899,
                                                "mem_39899") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39899,
                                                  "mem_39899") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39894,
                                                  "mem_39894") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39865,
                                                  "mem_39865") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39860,
                                                  "mem_39860") != 0)
                            return 1;
                    } else {
                        struct memblock_device mem_39905;
                        
                        mem_39905.references = NULL;
                        if (memblock_alloc_device(ctx, &mem_39905, bytes_39557,
                                                  "mem_39905")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        struct memblock_device mem_39910;
                        
                        mem_39910.references = NULL;
                        if (memblock_alloc_device(ctx, &mem_39910, bytes_39557,
                                                  "mem_39910")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        struct memblock_device mem_39915;
                        
                        mem_39915.references = NULL;
                        if (memblock_alloc_device(ctx, &mem_39915, bytes_39557,
                                                  "mem_39915")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        struct memblock_device mem_39920;
                        
                        mem_39920.references = NULL;
                        if (memblock_alloc_device(ctx, &mem_39920, bytes_39557,
                                                  "mem_39920")) {
                            err = 1;
                            goto cleanup;
                        }
                        
                        struct memblock_device mem_39925;
                        
                        mem_39925.references = NULL;
                        if (memblock_alloc_device(ctx, &mem_39925, bytes_39557,
                                                  "mem_39925")) {
                            err = 1;
                            goto cleanup;
                        }
                        if (slt32(0, nodes_this_lvl_32221 *
                                  pts_per_node_at_lev_32225)) {
                            if (ctx->debugging)
                                fprintf(stderr, "%s\n", "\n# SegScan");
                            
                            int32_t stage1_max_num_groups_40707;
                            
                            stage1_max_num_groups_40707 =
                                ctx->cuda.max_block_size;
                            
                            int32_t stage1_num_groups_40708;
                            
                            stage1_num_groups_40708 =
                                smin32(stage1_max_num_groups_40707,
                                       num_groups_38156);
                            
                            int32_t num_threads_40709;
                            
                            num_threads_40709 = stage1_num_groups_40708 *
                                segscan_group_sizze_38155;
                            
                            unsigned int shared_sizze_41047 = smax64(1,
                                                                     (int64_t) sizeof(int32_t) *
                                                                     sext_i32_i64(segscan_group_sizze_38155));
                            unsigned int shared_sizze_41049 = smax64(1,
                                                                     (int64_t) sizeof(int32_t) *
                                                                     sext_i32_i64(segscan_group_sizze_38155));
                            unsigned int shared_sizze_41051 = smax64(1,
                                                                     (int64_t) sizeof(int32_t) *
                                                                     sext_i32_i64(segscan_group_sizze_38155));
                            unsigned int shared_sizze_41053 = smax64(1,
                                                                     (int64_t) sizeof(int32_t) *
                                                                     sext_i32_i64(segscan_group_sizze_38155));
                            CUdeviceptr kernel_arg_41055 = mem_param_39843.mem;
                            CUdeviceptr kernel_arg_41056 = mem_39905.mem;
                            CUdeviceptr kernel_arg_41057 = mem_39910.mem;
                            CUdeviceptr kernel_arg_41058 = mem_39915.mem;
                            CUdeviceptr kernel_arg_41059 = mem_39920.mem;
                            CUdeviceptr kernel_arg_41060 = mem_39925.mem;
                            unsigned int shared_offset_41048 = 0;
                            unsigned int shared_offset_41050 = 0 +
                                         (shared_sizze_41047 + (8 -
                                                                shared_sizze_41047 %
                                                                8) % 8);
                            unsigned int shared_offset_41052 = 0 +
                                         (shared_sizze_41047 + (8 -
                                                                shared_sizze_41047 %
                                                                8) % 8) +
                                         (shared_sizze_41049 + (8 -
                                                                shared_sizze_41049 %
                                                                8) % 8);
                            unsigned int shared_offset_41054 = 0 +
                                         (shared_sizze_41047 + (8 -
                                                                shared_sizze_41047 %
                                                                8) % 8) +
                                         (shared_sizze_41049 + (8 -
                                                                shared_sizze_41049 %
                                                                8) % 8) +
                                         (shared_sizze_41051 + (8 -
                                                                shared_sizze_41051 %
                                                                8) % 8);
                            
                            if ((((((1 && stage1_num_groups_40708 != 0) && 1 !=
                                    0) && 1 != 0) &&
                                  segscan_group_sizze_38155 != 0) && 1 != 0) &&
                                1 != 0) {
                                int perm[3] = {0, 1, 2};
                                
                                if (1 >= 1 << 16) {
                                    perm[1] = perm[0];
                                    perm[0] = 1;
                                }
                                if (1 >= 1 << 16) {
                                    perm[2] = perm[0];
                                    perm[0] = 2;
                                }
                                
                                size_t grid[3];
                                
                                grid[perm[0]] = stage1_num_groups_40708;
                                grid[perm[1]] = 1;
                                grid[perm[2]] = 1;
                                
                                void *kernel_args_41044[] =
                                     {&ctx->global_failure,
                                      &shared_offset_41048,
                                      &shared_offset_41050,
                                      &shared_offset_41052,
                                      &shared_offset_41054,
                                      &nodes_this_lvl_32221,
                                      &pts_per_node_at_lev_32225,
                                      &lifted_2_radix_sort_step_arg_38052,
                                      &lifted_0_get_bit_arg_38053, &res_38054,
                                      &res_38055, &kernel_arg_41055,
                                      &kernel_arg_41056, &kernel_arg_41057,
                                      &kernel_arg_41058, &kernel_arg_41059,
                                      &kernel_arg_41060, &num_threads_40709};
                                int64_t time_start_41045 = 0, time_end_41046 =
                                        0;
                                
                                if (ctx->debugging) {
                                    fprintf(stderr,
                                            "Launching %s with grid size (",
                                            "buildKDtree.scan_stage1_37746");
                                    fprintf(stderr, "%d",
                                            stage1_num_groups_40708);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ") and block size (");
                                    fprintf(stderr, "%d",
                                            segscan_group_sizze_38155);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ").\n");
                                    time_start_41045 = get_wall_time();
                                }
                                
                                cudaEvent_t *pevents = NULL;
                                
                                if (ctx->profiling && !ctx->profiling_paused) {
                                    pevents = cuda_get_events(&ctx->cuda,
                                                              &ctx->buildKDtreeziscan_stage1_37746_runs,
                                                              &ctx->buildKDtreeziscan_stage1_37746_total_runtime);
                                    CUDA_SUCCEED(cudaEventRecord(pevents[0],
                                                                 0));
                                }
                                CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreeziscan_stage1_37746,
                                                            grid[0], grid[1],
                                                            grid[2],
                                                            segscan_group_sizze_38155,
                                                            1, 1, 0 +
                                                            (shared_sizze_41047 +
                                                             (8 -
                                                              shared_sizze_41047 %
                                                              8) % 8) +
                                                            (shared_sizze_41049 +
                                                             (8 -
                                                              shared_sizze_41049 %
                                                              8) % 8) +
                                                            (shared_sizze_41051 +
                                                             (8 -
                                                              shared_sizze_41051 %
                                                              8) % 8) +
                                                            (shared_sizze_41053 +
                                                             (8 -
                                                              shared_sizze_41053 %
                                                              8) % 8), NULL,
                                                            kernel_args_41044,
                                                            NULL));
                                if (pevents != NULL)
                                    CUDA_SUCCEED(cudaEventRecord(pevents[1],
                                                                 0));
                                if (ctx->debugging) {
                                    CUDA_SUCCEED(cuCtxSynchronize());
                                    time_end_41046 = get_wall_time();
                                    fprintf(stderr,
                                            "Kernel %s runtime: %ldus\n",
                                            "buildKDtree.scan_stage1_37746",
                                            time_end_41046 - time_start_41045);
                                }
                            }
                            if (ctx->debugging)
                                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                                        (long long) (segscan_group_sizze_38155 *
                                                     sdiv_up32(nodes_this_lvl_32221 *
                                                               pts_per_node_at_lev_32225,
                                                               num_threads_40709)),
                                        '\n');
                            
                            unsigned int shared_sizze_41064 = smax64(1,
                                                                     (int64_t) sizeof(int32_t) *
                                                                     sext_i32_i64(stage1_num_groups_40708));
                            unsigned int shared_sizze_41066 = smax64(1,
                                                                     (int64_t) sizeof(int32_t) *
                                                                     sext_i32_i64(stage1_num_groups_40708));
                            unsigned int shared_sizze_41068 = smax64(1,
                                                                     (int64_t) sizeof(int32_t) *
                                                                     sext_i32_i64(stage1_num_groups_40708));
                            unsigned int shared_sizze_41070 = smax64(1,
                                                                     (int64_t) sizeof(int32_t) *
                                                                     sext_i32_i64(stage1_num_groups_40708));
                            CUdeviceptr kernel_arg_41072 = mem_39905.mem;
                            CUdeviceptr kernel_arg_41073 = mem_39910.mem;
                            CUdeviceptr kernel_arg_41074 = mem_39915.mem;
                            CUdeviceptr kernel_arg_41075 = mem_39920.mem;
                            unsigned int shared_offset_41065 = 0;
                            unsigned int shared_offset_41067 = 0 +
                                         (shared_sizze_41064 + (8 -
                                                                shared_sizze_41064 %
                                                                8) % 8);
                            unsigned int shared_offset_41069 = 0 +
                                         (shared_sizze_41064 + (8 -
                                                                shared_sizze_41064 %
                                                                8) % 8) +
                                         (shared_sizze_41066 + (8 -
                                                                shared_sizze_41066 %
                                                                8) % 8);
                            unsigned int shared_offset_41071 = 0 +
                                         (shared_sizze_41064 + (8 -
                                                                shared_sizze_41064 %
                                                                8) % 8) +
                                         (shared_sizze_41066 + (8 -
                                                                shared_sizze_41066 %
                                                                8) % 8) +
                                         (shared_sizze_41068 + (8 -
                                                                shared_sizze_41068 %
                                                                8) % 8);
                            
                            if ((((((1 && 1 != 0) && 1 != 0) && 1 != 0) &&
                                  stage1_num_groups_40708 != 0) && 1 != 0) &&
                                1 != 0) {
                                int perm[3] = {0, 1, 2};
                                
                                if (1 >= 1 << 16) {
                                    perm[1] = perm[0];
                                    perm[0] = 1;
                                }
                                if (1 >= 1 << 16) {
                                    perm[2] = perm[0];
                                    perm[0] = 2;
                                }
                                
                                size_t grid[3];
                                
                                grid[perm[0]] = 1;
                                grid[perm[1]] = 1;
                                grid[perm[2]] = 1;
                                
                                void *kernel_args_41061[] =
                                     {&ctx->global_failure,
                                      &shared_offset_41065,
                                      &shared_offset_41067,
                                      &shared_offset_41069,
                                      &shared_offset_41071,
                                      &nodes_this_lvl_32221,
                                      &pts_per_node_at_lev_32225,
                                      &kernel_arg_41072, &kernel_arg_41073,
                                      &kernel_arg_41074, &kernel_arg_41075,
                                      &stage1_num_groups_40708,
                                      &num_threads_40709};
                                int64_t time_start_41062 = 0, time_end_41063 =
                                        0;
                                
                                if (ctx->debugging) {
                                    fprintf(stderr,
                                            "Launching %s with grid size (",
                                            "buildKDtree.scan_stage2_37746");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ") and block size (");
                                    fprintf(stderr, "%d",
                                            stage1_num_groups_40708);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ").\n");
                                    time_start_41062 = get_wall_time();
                                }
                                
                                cudaEvent_t *pevents = NULL;
                                
                                if (ctx->profiling && !ctx->profiling_paused) {
                                    pevents = cuda_get_events(&ctx->cuda,
                                                              &ctx->buildKDtreeziscan_stage2_37746_runs,
                                                              &ctx->buildKDtreeziscan_stage2_37746_total_runtime);
                                    CUDA_SUCCEED(cudaEventRecord(pevents[0],
                                                                 0));
                                }
                                CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreeziscan_stage2_37746,
                                                            grid[0], grid[1],
                                                            grid[2],
                                                            stage1_num_groups_40708,
                                                            1, 1, 0 +
                                                            (shared_sizze_41064 +
                                                             (8 -
                                                              shared_sizze_41064 %
                                                              8) % 8) +
                                                            (shared_sizze_41066 +
                                                             (8 -
                                                              shared_sizze_41066 %
                                                              8) % 8) +
                                                            (shared_sizze_41068 +
                                                             (8 -
                                                              shared_sizze_41068 %
                                                              8) % 8) +
                                                            (shared_sizze_41070 +
                                                             (8 -
                                                              shared_sizze_41070 %
                                                              8) % 8), NULL,
                                                            kernel_args_41061,
                                                            NULL));
                                if (pevents != NULL)
                                    CUDA_SUCCEED(cudaEventRecord(pevents[1],
                                                                 0));
                                if (ctx->debugging) {
                                    CUDA_SUCCEED(cuCtxSynchronize());
                                    time_end_41063 = get_wall_time();
                                    fprintf(stderr,
                                            "Kernel %s runtime: %ldus\n",
                                            "buildKDtree.scan_stage2_37746",
                                            time_end_41063 - time_start_41062);
                                }
                            }
                            
                            int32_t required_groups_40788;
                            
                            required_groups_40788 =
                                sdiv_up32(nodes_this_lvl_32221 *
                                          pts_per_node_at_lev_32225,
                                          segscan_group_sizze_38155);
                            
                            CUdeviceptr kernel_arg_41079 = mem_39905.mem;
                            CUdeviceptr kernel_arg_41080 = mem_39910.mem;
                            CUdeviceptr kernel_arg_41081 = mem_39915.mem;
                            CUdeviceptr kernel_arg_41082 = mem_39920.mem;
                            
                            if ((((((1 && num_groups_38156 != 0) && 1 != 0) &&
                                   1 != 0) && segscan_group_sizze_38155 != 0) &&
                                 1 != 0) && 1 != 0) {
                                int perm[3] = {0, 1, 2};
                                
                                if (1 >= 1 << 16) {
                                    perm[1] = perm[0];
                                    perm[0] = 1;
                                }
                                if (1 >= 1 << 16) {
                                    perm[2] = perm[0];
                                    perm[0] = 2;
                                }
                                
                                size_t grid[3];
                                
                                grid[perm[0]] = num_groups_38156;
                                grid[perm[1]] = 1;
                                grid[perm[2]] = 1;
                                
                                void *kernel_args_41076[] =
                                     {&ctx->global_failure,
                                      &nodes_this_lvl_32221,
                                      &pts_per_node_at_lev_32225,
                                      &num_groups_38156, &kernel_arg_41079,
                                      &kernel_arg_41080, &kernel_arg_41081,
                                      &kernel_arg_41082, &num_threads_40709,
                                      &required_groups_40788};
                                int64_t time_start_41077 = 0, time_end_41078 =
                                        0;
                                
                                if (ctx->debugging) {
                                    fprintf(stderr,
                                            "Launching %s with grid size (",
                                            "buildKDtree.scan_stage3_37746");
                                    fprintf(stderr, "%d", num_groups_38156);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ") and block size (");
                                    fprintf(stderr, "%d",
                                            segscan_group_sizze_38155);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ", ");
                                    fprintf(stderr, "%d", 1);
                                    fprintf(stderr, ").\n");
                                    time_start_41077 = get_wall_time();
                                }
                                
                                cudaEvent_t *pevents = NULL;
                                
                                if (ctx->profiling && !ctx->profiling_paused) {
                                    pevents = cuda_get_events(&ctx->cuda,
                                                              &ctx->buildKDtreeziscan_stage3_37746_runs,
                                                              &ctx->buildKDtreeziscan_stage3_37746_total_runtime);
                                    CUDA_SUCCEED(cudaEventRecord(pevents[0],
                                                                 0));
                                }
                                CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreeziscan_stage3_37746,
                                                            grid[0], grid[1],
                                                            grid[2],
                                                            segscan_group_sizze_38155,
                                                            1, 1, 0, NULL,
                                                            kernel_args_41076,
                                                            NULL));
                                if (pevents != NULL)
                                    CUDA_SUCCEED(cudaEventRecord(pevents[1],
                                                                 0));
                                if (ctx->debugging) {
                                    CUDA_SUCCEED(cuCtxSynchronize());
                                    time_end_41078 = get_wall_time();
                                    fprintf(stderr,
                                            "Kernel %s runtime: %ldus\n",
                                            "buildKDtree.scan_stage3_37746",
                                            time_end_41078 - time_start_41077);
                                }
                            }
                        }
                        
                        struct memblock_device mem_39930;
                        
                        mem_39930.references = NULL;
                        if (memblock_alloc_device(ctx, &mem_39930, bytes_39557,
                                                  "mem_39930")) {
                            err = 1;
                            goto cleanup;
                        }
                        {
                            cudaEvent_t *pevents = NULL;
                            
                            if (ctx->profiling && !ctx->profiling_paused) {
                                pevents = cuda_get_events(&ctx->cuda,
                                                          &ctx->copy_dev_to_dev_runs,
                                                          &ctx->copy_dev_to_dev_total_runtime);
                                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                            }
                            CUDA_SUCCEED(cuMemcpy(mem_39930.mem + 0,
                                                  mem_param_39843.mem + 0,
                                                  sext_i32_i64(nodes_this_lvl_32221 *
                                                  pts_per_node_at_lev_32225) *
                                                  (int64_t) sizeof(float)));
                            if (pevents != NULL)
                                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                        }
                        
                        struct memblock_device mem_39935;
                        
                        mem_39935.references = NULL;
                        if (memblock_alloc_device(ctx, &mem_39935, bytes_39557,
                                                  "mem_39935")) {
                            err = 1;
                            goto cleanup;
                        }
                        {
                            cudaEvent_t *pevents = NULL;
                            
                            if (ctx->profiling && !ctx->profiling_paused) {
                                pevents = cuda_get_events(&ctx->cuda,
                                                          &ctx->copy_dev_to_dev_runs,
                                                          &ctx->copy_dev_to_dev_total_runtime);
                                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                            }
                            CUDA_SUCCEED(cuMemcpy(mem_39935.mem + 0,
                                                  mem_param_39851.mem + 0,
                                                  sext_i32_i64(nodes_this_lvl_32221 *
                                                  pts_per_node_at_lev_32225) *
                                                  (int64_t) sizeof(int32_t)));
                            if (pevents != NULL)
                                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                        }
                        if (ctx->debugging)
                            fprintf(stderr, "%s\n", "\n# SegMap");
                        
                        CUdeviceptr kernel_arg_41086 = mem_param_39843.mem;
                        CUdeviceptr kernel_arg_41087 = mem_param_39851.mem;
                        CUdeviceptr kernel_arg_41088 = mem_39905.mem;
                        CUdeviceptr kernel_arg_41089 = mem_39910.mem;
                        CUdeviceptr kernel_arg_41090 = mem_39915.mem;
                        CUdeviceptr kernel_arg_41091 = mem_39920.mem;
                        CUdeviceptr kernel_arg_41092 = mem_39925.mem;
                        CUdeviceptr kernel_arg_41093 = mem_39930.mem;
                        CUdeviceptr kernel_arg_41094 = mem_39935.mem;
                        
                        if ((((((1 && segmap_usable_groups_38233 != 0) && 1 !=
                                0) && 1 != 0) && segmap_group_sizze_38230 !=
                              0) && 1 != 0) && 1 != 0) {
                            int perm[3] = {0, 1, 2};
                            
                            if (1 >= 1 << 16) {
                                perm[1] = perm[0];
                                perm[0] = 1;
                            }
                            if (1 >= 1 << 16) {
                                perm[2] = perm[0];
                                perm[0] = 2;
                            }
                            
                            size_t grid[3];
                            
                            grid[perm[0]] = segmap_usable_groups_38233;
                            grid[perm[1]] = 1;
                            grid[perm[2]] = 1;
                            
                            void *kernel_args_41083[] = {&ctx->global_failure,
                                                         &nodes_this_lvl_32221,
                                                         &pts_per_node_at_lev_32225,
                                                         &i_32324,
                                                         &kernel_arg_41086,
                                                         &kernel_arg_41087,
                                                         &kernel_arg_41088,
                                                         &kernel_arg_41089,
                                                         &kernel_arg_41090,
                                                         &kernel_arg_41091,
                                                         &kernel_arg_41092,
                                                         &kernel_arg_41093,
                                                         &kernel_arg_41094};
                            int64_t time_start_41084 = 0, time_end_41085 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr, "Launching %s with grid size (",
                                        "buildKDtree.segmap_37675");
                                fprintf(stderr, "%d",
                                        segmap_usable_groups_38233);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ") and block size (");
                                fprintf(stderr, "%d", segmap_group_sizze_38230);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ").\n");
                                time_start_41084 = get_wall_time();
                            }
                            
                            cudaEvent_t *pevents = NULL;
                            
                            if (ctx->profiling && !ctx->profiling_paused) {
                                pevents = cuda_get_events(&ctx->cuda,
                                                          &ctx->buildKDtreezisegmap_37675_runs,
                                                          &ctx->buildKDtreezisegmap_37675_total_runtime);
                                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                            }
                            CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_37675,
                                                        grid[0], grid[1],
                                                        grid[2],
                                                        segmap_group_sizze_38230,
                                                        1, 1, 0, NULL,
                                                        kernel_args_41083,
                                                        NULL));
                            if (pevents != NULL)
                                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                            if (ctx->debugging) {
                                CUDA_SUCCEED(cuCtxSynchronize());
                                time_end_41085 = get_wall_time();
                                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                        "buildKDtree.segmap_37675",
                                        time_end_41085 - time_start_41084);
                            }
                        }
                        if (memblock_unref_device(ctx, &mem_39905,
                                                  "mem_39905") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39910,
                                                  "mem_39910") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39915,
                                                  "mem_39915") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39920,
                                                  "mem_39920") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39925,
                                                  "mem_39925") != 0)
                            return 1;
                        if (memblock_set_device(ctx, &res_mem_39937, &mem_39930,
                                                "mem_39930") != 0)
                            return 1;
                        if (memblock_set_device(ctx, &res_mem_39938, &mem_39935,
                                                "mem_39935") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39935,
                                                  "mem_39935") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39930,
                                                  "mem_39930") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39925,
                                                  "mem_39925") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39920,
                                                  "mem_39920") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39915,
                                                  "mem_39915") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39910,
                                                  "mem_39910") != 0)
                            return 1;
                        if (memblock_unref_device(ctx, &mem_39905,
                                                  "mem_39905") != 0)
                            return 1;
                    }
                    
                    struct memblock_device mem_param_tmp_40675;
                    
                    mem_param_tmp_40675.references = NULL;
                    if (memblock_set_device(ctx, &mem_param_tmp_40675,
                                            &res_mem_39937, "res_mem_39937") !=
                        0)
                        return 1;
                    
                    struct memblock_device mem_param_tmp_40676;
                    
                    mem_param_tmp_40676.references = NULL;
                    if (memblock_set_device(ctx, &mem_param_tmp_40676,
                                            &res_mem_39938, "res_mem_39938") !=
                        0)
                        return 1;
                    if (memblock_set_device(ctx, &mem_param_39843,
                                            &mem_param_tmp_40675,
                                            "mem_param_tmp_40675") != 0)
                        return 1;
                    if (memblock_set_device(ctx, &mem_param_39851,
                                            &mem_param_tmp_40676,
                                            "mem_param_tmp_40676") != 0)
                        return 1;
                    if (memblock_unref_device(ctx, &mem_param_tmp_40676,
                                              "mem_param_tmp_40676") != 0)
                        return 1;
                    if (memblock_unref_device(ctx, &mem_param_tmp_40675,
                                              "mem_param_tmp_40675") != 0)
                        return 1;
                    if (memblock_unref_device(ctx, &res_mem_39938,
                                              "res_mem_39938") != 0)
                        return 1;
                    if (memblock_unref_device(ctx, &res_mem_39937,
                                              "res_mem_39937") != 0)
                        return 1;
                }
                if (memblock_set_device(ctx, &res_mem_39950, &mem_param_39843,
                                        "mem_param_39843") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_r_mem_39958, &mem_param_39851,
                                        "mem_param_39851") != 0)
                    return 1;
                
                int64_t segmap_usable_groups_64_38290 =
                        sdiv_up64(nest_sizze_38027, segmap_group_sizze_38289);
                int32_t segmap_usable_groups_38291 =
                        sext_i64_i32(segmap_usable_groups_64_38290);
                struct memblock_device mem_39964;
                
                mem_39964.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39964, bytes_39557,
                                          "mem_39964")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39969;
                
                mem_39969.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39969, bytes_39557,
                                          "mem_39969")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                
                CUdeviceptr kernel_arg_41098 = mem_param_39466.mem;
                CUdeviceptr kernel_arg_41099 = mem_39835.mem;
                CUdeviceptr kernel_arg_41100 = res_r_mem_39958.mem;
                CUdeviceptr kernel_arg_41101 = mem_39964.mem;
                CUdeviceptr kernel_arg_41102 = mem_39969.mem;
                
                if ((((((1 && segmap_usable_groups_38291 != 0) && 1 != 0) &&
                       1 != 0) && segmap_group_sizze_38288 != 0) && 1 != 0) &&
                    1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = segmap_usable_groups_38291;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41095[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &nodes_this_lvl_32221,
                                                 &pts_per_node_at_lev_32225,
                                                 &kernel_arg_41098,
                                                 &kernel_arg_41099,
                                                 &kernel_arg_41100,
                                                 &kernel_arg_41101,
                                                 &kernel_arg_41102};
                    int64_t time_start_41096 = 0, time_end_41097 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "buildKDtree.segmap_37340");
                        fprintf(stderr, "%d", segmap_usable_groups_38291);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", segmap_group_sizze_38288);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41096 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->buildKDtreezisegmap_37340_runs,
                                                  &ctx->buildKDtreezisegmap_37340_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_37340,
                                                grid[0], grid[1], grid[2],
                                                segmap_group_sizze_38288, 1, 1,
                                                0, NULL, kernel_args_41095,
                                                NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41097 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "buildKDtree.segmap_37340", time_end_41097 -
                                time_start_41096);
                    }
                }
                ctx->failure_is_an_option = 1;
                if (memblock_unref_device(ctx, &mem_39835, "mem_39835") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_r_mem_39958,
                                          "res_r_mem_39958") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39970, &mem_39964,
                                        "mem_39964") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39971, &mem_39969,
                                        "mem_39969") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39969, "mem_39969") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39964, "mem_39964") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_param_39851,
                                          "mem_param_39851") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_param_39843,
                                          "mem_param_39843") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_r_mem_39958,
                                          "res_r_mem_39958") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &res_mem_39950,
                                          "res_mem_39950") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39835, "mem_39835") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39829, "mem_39829") != 0)
                    return 1;
            }
            if (memblock_set_device(ctx, &res_mem_39984, &res_mem_39970,
                                    "res_mem_39970") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_39985, &res_mem_39971,
                                    "res_mem_39971") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39971, "res_mem_39971") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39970, "res_mem_39970") !=
                0)
                return 1;
        }
        if (memblock_unref_device(ctx, &mem_39556, "mem_39556") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39561, "mem_39561") != 0)
            return 1;
        
        int32_t y_32643 = sub32(nodes_this_lvl_32221, 1);
        int64_t segmap_usable_groups_64_38317 = sdiv_up64(nodes_this_lvl_36531,
                                                          segmap_group_sizze_38316);
        int32_t segmap_usable_groups_38318 =
                sext_i64_i32(segmap_usable_groups_64_38317);
        
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        
        CUdeviceptr kernel_arg_41106 = mem_39455.mem;
        CUdeviceptr kernel_arg_41107 = mem_39458.mem;
        CUdeviceptr kernel_arg_41108 = mem_39461.mem;
        CUdeviceptr kernel_arg_41109 = res_mem_39552.mem;
        CUdeviceptr kernel_arg_41110 = res_mem_39553.mem;
        CUdeviceptr kernel_arg_41111 = res_mem_39985.mem;
        
        if ((((((1 && segmap_usable_groups_38318 != 0) && 1 != 0) && 1 != 0) &&
              segmap_group_sizze_38315 != 0) && 1 != 0) && 1 != 0) {
            int perm[3] = {0, 1, 2};
            
            if (1 >= 1 << 16) {
                perm[1] = perm[0];
                perm[0] = 1;
            }
            if (1 >= 1 << 16) {
                perm[2] = perm[0];
                perm[0] = 2;
            }
            
            size_t grid[3];
            
            grid[perm[0]] = segmap_usable_groups_38318;
            grid[perm[1]] = 1;
            grid[perm[2]] = 1;
            
            void *kernel_args_41103[] = {&ctx->global_failure, &res_32166,
                                         &nodes_this_lvl_32221,
                                         &pts_per_node_at_lev_32225, &mi_32473,
                                         &i_32478, &y_32643, &kernel_arg_41106,
                                         &kernel_arg_41107, &kernel_arg_41108,
                                         &kernel_arg_41109, &kernel_arg_41110,
                                         &kernel_arg_41111};
            int64_t time_start_41104 = 0, time_end_41105 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with grid size (",
                        "buildKDtree.segmap_38311");
                fprintf(stderr, "%d", segmap_usable_groups_38318);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ") and block size (");
                fprintf(stderr, "%d", segmap_group_sizze_38315);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ").\n");
                time_start_41104 = get_wall_time();
            }
            
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->buildKDtreezisegmap_38311_runs,
                                          &ctx->buildKDtreezisegmap_38311_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_38311, grid[0],
                                        grid[1], grid[2],
                                        segmap_group_sizze_38315, 1, 1, 0, NULL,
                                        kernel_args_41103, NULL));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            if (ctx->debugging) {
                CUDA_SUCCEED(cuCtxSynchronize());
                time_end_41105 = get_wall_time();
                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                        "buildKDtree.segmap_38311", time_end_41105 -
                        time_start_41104);
            }
        }
        if (memblock_unref_device(ctx, &res_mem_39552, "res_mem_39552") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39553, "res_mem_39553") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39985, "res_mem_39985") != 0)
            return 1;
        
        bool dim_match_32656 = res_32168 == x_32226;
        bool empty_or_match_cert_32657;
        
        if (!dim_match_32656) {
            ctx->error = msgprintf("Error: %s%d%s%d%s\n\nBacktrace:\n%s",
                                   "Value of (core language) shape (", x_32226,
                                   ") cannot match shape of type `*[",
                                   res_32168, "]i32`.",
                                   "-> #0  buildKDtree.fut:146:30-57\n   #1  driverKNN.fut:145:11-50\n   #2  driverKNN.fut:142:1-148:101\n");
            if (memblock_unref_device(ctx, &res_mem_39985, "res_mem_39985") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39984, "res_mem_39984") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39561, "mem_39561") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39556, "mem_39556") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39553, "res_mem_39553") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39552, "res_mem_39552") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &mem_param_39466,
                                      "mem_param_39466") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39993, "res_mem_39993") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39461, "mem_39461") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39458, "mem_39458") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39455, "mem_39455") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39452, "mem_39452") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39446, "res_mem_39446") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39432, "res_mem_39432") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") !=
                0)
                return 1;
            return 1;
        }
        
        struct memblock_device mem_param_tmp_40477;
        
        mem_param_tmp_40477.references = NULL;
        if (memblock_set_device(ctx, &mem_param_tmp_40477, &res_mem_39984,
                                "res_mem_39984") != 0)
            return 1;
        if (memblock_set_device(ctx, &mem_param_39466, &mem_param_tmp_40477,
                                "mem_param_tmp_40477") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_40477,
                                  "mem_param_tmp_40477") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39985, "res_mem_39985") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39984, "res_mem_39984") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39561, "mem_39561") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39556, "mem_39556") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39553, "res_mem_39553") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39552, "res_mem_39552") != 0)
            return 1;
    }
    if (memblock_set_device(ctx, &res_mem_39993, &mem_param_39466,
                            "mem_param_39466") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39452, "mem_39452") != 0)
        return 1;
    
    int32_t segmap_group_sizze_38457;
    
    segmap_group_sizze_38457 = ctx->sizes.buildKDtreezisegmap_group_sizze_38445;
    
    int64_t segmap_group_sizze_38458 = sext_i32_i64(segmap_group_sizze_38457);
    int64_t segmap_usable_groups_64_38459 = sdiv_up64(binop_x_39451,
                                                      segmap_group_sizze_38458);
    int32_t segmap_usable_groups_38460 =
            sext_i64_i32(segmap_usable_groups_64_38459);
    struct memblock_device mem_40011;
    
    mem_40011.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40011, binop_x_39451, "mem_40011")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_40013;
    
    mem_40013.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40013, binop_x_39451, "mem_40013")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    
    CUdeviceptr kernel_arg_41115 = res_mem_39993.mem;
    CUdeviceptr kernel_arg_41116 = mem_40011.mem;
    CUdeviceptr kernel_arg_41117 = mem_40013.mem;
    
    if ((((((1 && segmap_usable_groups_38460 != 0) && 1 != 0) && 1 != 0) &&
          segmap_group_sizze_38457 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = segmap_usable_groups_38460;
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41112[] = {&ctx->global_failure, &m_32135, &res_32168,
                                     &kernel_arg_41115, &kernel_arg_41116,
                                     &kernel_arg_41117};
        int64_t time_start_41113 = 0, time_end_41114 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "buildKDtree.segmap_38442");
            fprintf(stderr, "%d", segmap_usable_groups_38460);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", segmap_group_sizze_38457);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41113 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->buildKDtreezisegmap_38442_runs,
                                      &ctx->buildKDtreezisegmap_38442_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_38442, grid[0],
                                    grid[1], grid[2], segmap_group_sizze_38457,
                                    1, 1, 0, NULL, kernel_args_41112, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41114 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "buildKDtree.segmap_38442", time_end_41114 -
                    time_start_41113);
        }
    }
    
    int64_t nest_sizze_38482 = d_36328 * binop_x_39451;
    int32_t segmap_group_sizze_38483;
    
    segmap_group_sizze_38483 = ctx->sizes.buildKDtreezisegmap_group_sizze_38403;
    
    int64_t segmap_group_sizze_38484 = sext_i32_i64(segmap_group_sizze_38483);
    int64_t segmap_usable_groups_64_38485 = sdiv_up64(nest_sizze_38482,
                                                      segmap_group_sizze_38484);
    int32_t segmap_usable_groups_38486 =
            sext_i64_i32(segmap_usable_groups_64_38485);
    int64_t binop_x_40018 = d_36328 * binop_x_39451;
    int64_t bytes_40015 = 4 * binop_x_40018;
    struct memblock_device mem_40019;
    
    mem_40019.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40019, bytes_40015, "mem_40019")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    
    CUdeviceptr kernel_arg_41121 = input_mem_39418.mem;
    CUdeviceptr kernel_arg_41122 = res_mem_39993.mem;
    CUdeviceptr kernel_arg_41123 = mem_40011.mem;
    CUdeviceptr kernel_arg_41124 = mem_40013.mem;
    CUdeviceptr kernel_arg_41125 = mem_40019.mem;
    
    if ((((((1 && segmap_usable_groups_38486 != 0) && 1 != 0) && 1 != 0) &&
          segmap_group_sizze_38483 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = segmap_usable_groups_38486;
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41118[] = {&ctx->global_failure,
                                     &ctx->failure_is_an_option,
                                     &ctx->global_failure_args, &d_32136,
                                     &res_32168, &kernel_arg_41121,
                                     &kernel_arg_41122, &kernel_arg_41123,
                                     &kernel_arg_41124, &kernel_arg_41125};
        int64_t time_start_41119 = 0, time_end_41120 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "buildKDtree.segmap_38398");
            fprintf(stderr, "%d", segmap_usable_groups_38486);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", segmap_group_sizze_38483);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41119 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->buildKDtreezisegmap_38398_runs,
                                      &ctx->buildKDtreezisegmap_38398_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_38398, grid[0],
                                    grid[1], grid[2], segmap_group_sizze_38483,
                                    1, 1, 0, NULL, kernel_args_41118, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41120 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "buildKDtree.segmap_38398", time_end_41120 -
                    time_start_41119);
        }
    }
    ctx->failure_is_an_option = 1;
    if (memblock_unref_device(ctx, &mem_40011, "mem_40011") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_40013, "mem_40013") != 0)
        return 1;
    
    bool zzero_32675 = res_32167 == 0;
    bool nonzzero_32676 = !zzero_32675;
    bool nonzzero_cert_32677;
    
    if (!nonzzero_32676) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "division by zero",
                               "-> #0  driverKNN.fut:147:41-47\n   #1  driverKNN.fut:147:30-58\n   #2  driverKNN.fut:142:1-148:101\n");
        if (memblock_unref_device(ctx, &mem_40019, "mem_40019") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_40013, "mem_40013") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_40011, "mem_40011") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_39466, "mem_param_39466") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39993, "res_mem_39993") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39461, "mem_39461") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39458, "mem_39458") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39455, "mem_39455") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39452, "mem_39452") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39446, "res_mem_39446") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39432, "res_mem_39432") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        return 1;
    }
    
    struct memblock_device mem_40022;
    
    mem_40022.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40022, bytes_39450, "mem_40022")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, mem_40022, res_32168, -1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int32_t segmap_group_sizze_38506;
    
    segmap_group_sizze_38506 = ctx->sizes.buildKDtreezisegmap_group_sizze_38505;
    
    int64_t segmap_group_sizze_38507 = sext_i32_i64(segmap_group_sizze_38506);
    int64_t segmap_usable_groups_64_38508 = sdiv_up64(binop_x_39451,
                                                      segmap_group_sizze_38507);
    int32_t segmap_usable_groups_38509 =
            sext_i64_i32(segmap_usable_groups_64_38508);
    
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    
    CUdeviceptr kernel_arg_41129 = res_mem_39993.mem;
    CUdeviceptr kernel_arg_41130 = mem_40022.mem;
    
    if ((((((1 && segmap_usable_groups_38509 != 0) && 1 != 0) && 1 != 0) &&
          segmap_group_sizze_38506 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = segmap_usable_groups_38509;
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41126[] = {&ctx->global_failure, &res_32167,
                                     &res_32168, &kernel_arg_41129,
                                     &kernel_arg_41130};
        int64_t time_start_41127 = 0, time_end_41128 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "buildKDtree.segmap_38502");
            fprintf(stderr, "%d", segmap_usable_groups_38509);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", segmap_group_sizze_38506);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41127 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->buildKDtreezisegmap_38502_runs,
                                      &ctx->buildKDtreezisegmap_38502_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->buildKDtreezisegmap_38502, grid[0],
                                    grid[1], grid[2], segmap_group_sizze_38506,
                                    1, 1, 0, NULL, kernel_args_41126, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41128 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "buildKDtree.segmap_38502", time_end_41128 -
                    time_start_41127);
        }
    }
    
    struct memblock_device mem_40026;
    
    mem_40026.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40026, bytes_39450, "mem_40026")) {
        err = 1;
        goto cleanup;
    }
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_40026.mem + 0, res_mem_39993.mem + 0,
                              sext_i32_i64(res_32168) *
                              (int64_t) sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    if (memblock_unref_device(ctx, &res_mem_39993, "res_mem_39993") != 0)
        return 1;
    
    struct memblock_device mem_40030;
    
    mem_40030.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40030, bytes_39453, "mem_40030")) {
        err = 1;
        goto cleanup;
    }
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_40030.mem + 0, mem_39458.mem + 0,
                              sext_i32_i64(res_32166) *
                              (int64_t) sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    if (memblock_unref_device(ctx, &mem_39458, "mem_39458") != 0)
        return 1;
    
    struct memblock_device mem_40034;
    
    mem_40034.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40034, bytes_39453, "mem_40034")) {
        err = 1;
        goto cleanup;
    }
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_40034.mem + 0, mem_39455.mem + 0,
                              sext_i32_i64(res_32166) *
                              (int64_t) sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    if (memblock_unref_device(ctx, &mem_39455, "mem_39455") != 0)
        return 1;
    
    struct memblock_device mem_40038;
    
    mem_40038.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40038, bytes_39453, "mem_40038")) {
        err = 1;
        goto cleanup;
    }
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_40038.mem + 0, mem_39461.mem + 0,
                              sext_i32_i64(res_32166) *
                              (int64_t) sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    if (memblock_unref_device(ctx, &mem_39461, "mem_39461") != 0)
        return 1;
    out_arrsizze_40299 = res_32168;
    out_arrsizze_40300 = d_32136;
    out_arrsizze_40302 = res_32168;
    out_arrsizze_40304 = res_32168;
    out_arrsizze_40306 = res_32166;
    out_arrsizze_40308 = res_32166;
    out_arrsizze_40310 = res_32166;
    if (memblock_set_device(ctx, &out_mem_40298, &mem_40019, "mem_40019") != 0)
        return 1;
    if (memblock_set_device(ctx, &out_mem_40301, &mem_40026, "mem_40026") != 0)
        return 1;
    if (memblock_set_device(ctx, &out_mem_40303, &mem_40022, "mem_40022") != 0)
        return 1;
    if (memblock_set_device(ctx, &out_mem_40305, &mem_40030, "mem_40030") != 0)
        return 1;
    if (memblock_set_device(ctx, &out_mem_40307, &mem_40034, "mem_40034") != 0)
        return 1;
    if (memblock_set_device(ctx, &out_mem_40309, &mem_40038, "mem_40038") != 0)
        return 1;
    scalar_out_40295 = res_32165;
    scalar_out_40296 = res_32166;
    scalar_out_40297 = res_32168;
    *out_scalar_out_40833 = scalar_out_40295;
    *out_scalar_out_40834 = scalar_out_40296;
    *out_scalar_out_40835 = scalar_out_40297;
    (*out_mem_p_40836).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_40836, &out_mem_40298,
                            "out_mem_40298") != 0)
        return 1;
    *out_out_arrsizze_40837 = out_arrsizze_40299;
    *out_out_arrsizze_40838 = out_arrsizze_40300;
    (*out_mem_p_40839).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_40839, &out_mem_40301,
                            "out_mem_40301") != 0)
        return 1;
    *out_out_arrsizze_40840 = out_arrsizze_40302;
    (*out_mem_p_40841).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_40841, &out_mem_40303,
                            "out_mem_40303") != 0)
        return 1;
    *out_out_arrsizze_40842 = out_arrsizze_40304;
    (*out_mem_p_40843).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_40843, &out_mem_40305,
                            "out_mem_40305") != 0)
        return 1;
    *out_out_arrsizze_40844 = out_arrsizze_40306;
    (*out_mem_p_40845).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_40845, &out_mem_40307,
                            "out_mem_40307") != 0)
        return 1;
    *out_out_arrsizze_40846 = out_arrsizze_40308;
    (*out_mem_p_40847).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_40847, &out_mem_40309,
                            "out_mem_40309") != 0)
        return 1;
    *out_out_arrsizze_40848 = out_arrsizze_40310;
    if (memblock_unref_device(ctx, &mem_40038, "mem_40038") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_40034, "mem_40034") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_40030, "mem_40030") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_40026, "mem_40026") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_40022, "mem_40022") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_40019, "mem_40019") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_40013, "mem_40013") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_40011, "mem_40011") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_param_39466, "mem_param_39466") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_39993, "res_mem_39993") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39461, "mem_39461") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39458, "mem_39458") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39455, "mem_39455") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39452, "mem_39452") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_39446, "res_mem_39446") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_39432, "res_mem_39432") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40309, "out_mem_40309") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40307, "out_mem_40307") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40305, "out_mem_40305") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40303, "out_mem_40303") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhgpu_map_transpose_f32(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6)
{
    (void) ctx;
    
    int err = 0;
    
    if (!(num_arrays_4 == 0 || (x_elems_5 == 0 || y_elems_6 == 0))) {
        int32_t muly_8 = squot32(16, x_elems_5);
        int32_t mulx_7 = squot32(16, y_elems_6);
        
        if (num_arrays_4 == 1 && (x_elems_5 == 1 || y_elems_6 == 1)) {
            {
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->copy_dev_to_dev_runs,
                                              &ctx->copy_dev_to_dev_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuMemcpy(destmem_0.mem +
                                      sext_i32_i64(destoffset_1), srcmem_2.mem +
                                      sext_i32_i64(srcoffset_3),
                                      sext_i32_i64(x_elems_5 * y_elems_6 *
                                      (int64_t) sizeof(float))));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            }
        } else {
            if (sle32(x_elems_5, 8) && slt32(16, y_elems_6)) {
                unsigned int shared_sizze_41134 = 1088;
                CUdeviceptr kernel_arg_41136 = destmem_0.mem;
                CUdeviceptr kernel_arg_41137 = srcmem_2.mem;
                unsigned int shared_offset_41135 = 0;
                
                if ((((((1 && sdiv_up32(x_elems_5, 16) != 0) &&
                        sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16) != 0) &&
                       num_arrays_4 != 0) && 16 != 0) && 16 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16) >= 1 <<
                        16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (num_arrays_4 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = sdiv_up32(x_elems_5, 16);
                    grid[perm[1]] = sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16);
                    grid[perm[2]] = num_arrays_4;
                    
                    void *kernel_args_41131[] = {&perm[0], &perm[1], &perm[2],
                                                 &shared_offset_41135,
                                                 &destoffset_1, &srcoffset_3,
                                                 &num_arrays_4, &x_elems_5,
                                                 &y_elems_6, &mulx_7, &muly_8,
                                                 &kernel_arg_41136,
                                                 &kernel_arg_41137};
                    int64_t time_start_41132 = 0, time_end_41133 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "gpu_map_transpose_f32_low_width");
                        fprintf(stderr, "%d", sdiv_up32(x_elems_5, 16));
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", sdiv_up32(sdiv_up32(y_elems_6,
                                                                  muly_8), 16));
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", num_arrays_4);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", 16);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 16);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41132 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->gpu_map_transpose_f32_low_width_runs,
                                                  &ctx->gpu_map_transpose_f32_low_width_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_f32_low_width,
                                                grid[0], grid[1], grid[2], 16,
                                                16, 1, 0 + (shared_sizze_41134 +
                                                            (8 -
                                                             shared_sizze_41134 %
                                                             8) % 8), NULL,
                                                kernel_args_41131, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41133 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "gpu_map_transpose_f32_low_width",
                                time_end_41133 - time_start_41132);
                    }
                }
            } else {
                if (sle32(y_elems_6, 8) && slt32(16, x_elems_5)) {
                    unsigned int shared_sizze_41141 = 1088;
                    CUdeviceptr kernel_arg_41143 = destmem_0.mem;
                    CUdeviceptr kernel_arg_41144 = srcmem_2.mem;
                    unsigned int shared_offset_41142 = 0;
                    
                    if ((((((1 && sdiv_up32(sdiv_up32(x_elems_5, mulx_7), 16) !=
                             0) && sdiv_up32(y_elems_6, 16) != 0) &&
                           num_arrays_4 != 0) && 16 != 0) && 16 != 0) && 1 !=
                        0) {
                        int perm[3] = {0, 1, 2};
                        
                        if (sdiv_up32(y_elems_6, 16) >= 1 << 16) {
                            perm[1] = perm[0];
                            perm[0] = 1;
                        }
                        if (num_arrays_4 >= 1 << 16) {
                            perm[2] = perm[0];
                            perm[0] = 2;
                        }
                        
                        size_t grid[3];
                        
                        grid[perm[0]] = sdiv_up32(sdiv_up32(x_elems_5, mulx_7),
                                                  16);
                        grid[perm[1]] = sdiv_up32(y_elems_6, 16);
                        grid[perm[2]] = num_arrays_4;
                        
                        void *kernel_args_41138[] = {&perm[0], &perm[1],
                                                     &perm[2],
                                                     &shared_offset_41142,
                                                     &destoffset_1,
                                                     &srcoffset_3,
                                                     &num_arrays_4, &x_elems_5,
                                                     &y_elems_6, &mulx_7,
                                                     &muly_8, &kernel_arg_41143,
                                                     &kernel_arg_41144};
                        int64_t time_start_41139 = 0, time_end_41140 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr, "Launching %s with grid size (",
                                    "gpu_map_transpose_f32_low_height");
                            fprintf(stderr, "%d", sdiv_up32(sdiv_up32(x_elems_5,
                                                                      mulx_7),
                                                            16));
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", sdiv_up32(y_elems_6, 16));
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", num_arrays_4);
                            fprintf(stderr, ") and block size (");
                            fprintf(stderr, "%d", 16);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", 16);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", 1);
                            fprintf(stderr, ").\n");
                            time_start_41139 = get_wall_time();
                        }
                        
                        cudaEvent_t *pevents = NULL;
                        
                        if (ctx->profiling && !ctx->profiling_paused) {
                            pevents = cuda_get_events(&ctx->cuda,
                                                      &ctx->gpu_map_transpose_f32_low_height_runs,
                                                      &ctx->gpu_map_transpose_f32_low_height_total_runtime);
                            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                        }
                        CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_f32_low_height,
                                                    grid[0], grid[1], grid[2],
                                                    16, 16, 1, 0 +
                                                    (shared_sizze_41141 + (8 -
                                                                           shared_sizze_41141 %
                                                                           8) %
                                                     8), NULL,
                                                    kernel_args_41138, NULL));
                        if (pevents != NULL)
                            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                        if (ctx->debugging) {
                            CUDA_SUCCEED(cuCtxSynchronize());
                            time_end_41140 = get_wall_time();
                            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                    "gpu_map_transpose_f32_low_height",
                                    time_end_41140 - time_start_41139);
                        }
                    }
                } else {
                    if (sle32(x_elems_5, 8) && sle32(y_elems_6, 8)) {
                        unsigned int shared_sizze_41148 = 1;
                        CUdeviceptr kernel_arg_41150 = destmem_0.mem;
                        CUdeviceptr kernel_arg_41151 = srcmem_2.mem;
                        unsigned int shared_offset_41149 = 0;
                        
                        if ((((((1 && sdiv_up32(num_arrays_4 * x_elems_5 *
                                                y_elems_6, 256) != 0) && 1 !=
                                0) && 1 != 0) && 256 != 0) && 1 != 0) && 1 !=
                            0) {
                            int perm[3] = {0, 1, 2};
                            
                            if (1 >= 1 << 16) {
                                perm[1] = perm[0];
                                perm[0] = 1;
                            }
                            if (1 >= 1 << 16) {
                                perm[2] = perm[0];
                                perm[0] = 2;
                            }
                            
                            size_t grid[3];
                            
                            grid[perm[0]] = sdiv_up32(num_arrays_4 * x_elems_5 *
                                                      y_elems_6, 256);
                            grid[perm[1]] = 1;
                            grid[perm[2]] = 1;
                            
                            void *kernel_args_41145[] = {&shared_offset_41149,
                                                         &destoffset_1,
                                                         &srcoffset_3,
                                                         &num_arrays_4,
                                                         &x_elems_5, &y_elems_6,
                                                         &mulx_7, &muly_8,
                                                         &kernel_arg_41150,
                                                         &kernel_arg_41151};
                            int64_t time_start_41146 = 0, time_end_41147 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr, "Launching %s with grid size (",
                                        "gpu_map_transpose_f32_small");
                                fprintf(stderr, "%d", sdiv_up32(num_arrays_4 *
                                                                x_elems_5 *
                                                                y_elems_6,
                                                                256));
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ") and block size (");
                                fprintf(stderr, "%d", 256);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ").\n");
                                time_start_41146 = get_wall_time();
                            }
                            
                            cudaEvent_t *pevents = NULL;
                            
                            if (ctx->profiling && !ctx->profiling_paused) {
                                pevents = cuda_get_events(&ctx->cuda,
                                                          &ctx->gpu_map_transpose_f32_small_runs,
                                                          &ctx->gpu_map_transpose_f32_small_total_runtime);
                                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                            }
                            CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_f32_small,
                                                        grid[0], grid[1],
                                                        grid[2], 256, 1, 1, 0 +
                                                        (shared_sizze_41148 +
                                                         (8 -
                                                          shared_sizze_41148 %
                                                          8) % 8), NULL,
                                                        kernel_args_41145,
                                                        NULL));
                            if (pevents != NULL)
                                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                            if (ctx->debugging) {
                                CUDA_SUCCEED(cuCtxSynchronize());
                                time_end_41147 = get_wall_time();
                                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_f32_small",
                                        time_end_41147 - time_start_41146);
                            }
                        }
                    } else {
                        unsigned int shared_sizze_41155 = 4224;
                        CUdeviceptr kernel_arg_41157 = destmem_0.mem;
                        CUdeviceptr kernel_arg_41158 = srcmem_2.mem;
                        unsigned int shared_offset_41156 = 0;
                        
                        if ((((((1 && sdiv_up32(x_elems_5, 32) != 0) &&
                                sdiv_up32(y_elems_6, 32) != 0) &&
                               num_arrays_4 != 0) && 32 != 0) && 8 != 0) && 1 !=
                            0) {
                            int perm[3] = {0, 1, 2};
                            
                            if (sdiv_up32(y_elems_6, 32) >= 1 << 16) {
                                perm[1] = perm[0];
                                perm[0] = 1;
                            }
                            if (num_arrays_4 >= 1 << 16) {
                                perm[2] = perm[0];
                                perm[0] = 2;
                            }
                            
                            size_t grid[3];
                            
                            grid[perm[0]] = sdiv_up32(x_elems_5, 32);
                            grid[perm[1]] = sdiv_up32(y_elems_6, 32);
                            grid[perm[2]] = num_arrays_4;
                            
                            void *kernel_args_41152[] = {&perm[0], &perm[1],
                                                         &perm[2],
                                                         &shared_offset_41156,
                                                         &destoffset_1,
                                                         &srcoffset_3,
                                                         &num_arrays_4,
                                                         &x_elems_5, &y_elems_6,
                                                         &mulx_7, &muly_8,
                                                         &kernel_arg_41157,
                                                         &kernel_arg_41158};
                            int64_t time_start_41153 = 0, time_end_41154 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr, "Launching %s with grid size (",
                                        "gpu_map_transpose_f32");
                                fprintf(stderr, "%d", sdiv_up32(x_elems_5, 32));
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", sdiv_up32(y_elems_6, 32));
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", num_arrays_4);
                                fprintf(stderr, ") and block size (");
                                fprintf(stderr, "%d", 32);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 8);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ").\n");
                                time_start_41153 = get_wall_time();
                            }
                            
                            cudaEvent_t *pevents = NULL;
                            
                            if (ctx->profiling && !ctx->profiling_paused) {
                                pevents = cuda_get_events(&ctx->cuda,
                                                          &ctx->gpu_map_transpose_f32_runs,
                                                          &ctx->gpu_map_transpose_f32_total_runtime);
                                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                            }
                            CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_f32,
                                                        grid[0], grid[1],
                                                        grid[2], 32, 8, 1, 0 +
                                                        (shared_sizze_41155 +
                                                         (8 -
                                                          shared_sizze_41155 %
                                                          8) % 8), NULL,
                                                        kernel_args_41152,
                                                        NULL));
                            if (pevents != NULL)
                                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                            if (ctx->debugging) {
                                CUDA_SUCCEED(cuCtxSynchronize());
                                time_end_41154 = get_wall_time();
                                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_f32",
                                        time_end_41154 - time_start_41153);
                            }
                        }
                    }
                }
            }
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhgpu_map_transpose_i32(struct futhark_context *ctx,
                                                 struct memblock_device destmem_0,
                                                 int32_t destoffset_1,
                                                 struct memblock_device srcmem_2,
                                                 int32_t srcoffset_3,
                                                 int32_t num_arrays_4,
                                                 int32_t x_elems_5,
                                                 int32_t y_elems_6)
{
    (void) ctx;
    
    int err = 0;
    
    if (!(num_arrays_4 == 0 || (x_elems_5 == 0 || y_elems_6 == 0))) {
        int32_t muly_8 = squot32(16, x_elems_5);
        int32_t mulx_7 = squot32(16, y_elems_6);
        
        if (num_arrays_4 == 1 && (x_elems_5 == 1 || y_elems_6 == 1)) {
            {
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->copy_dev_to_dev_runs,
                                              &ctx->copy_dev_to_dev_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuMemcpy(destmem_0.mem +
                                      sext_i32_i64(destoffset_1), srcmem_2.mem +
                                      sext_i32_i64(srcoffset_3),
                                      sext_i32_i64(x_elems_5 * y_elems_6 *
                                      (int64_t) sizeof(int32_t))));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            }
        } else {
            if (sle32(x_elems_5, 8) && slt32(16, y_elems_6)) {
                unsigned int shared_sizze_41162 = 1088;
                CUdeviceptr kernel_arg_41164 = destmem_0.mem;
                CUdeviceptr kernel_arg_41165 = srcmem_2.mem;
                unsigned int shared_offset_41163 = 0;
                
                if ((((((1 && sdiv_up32(x_elems_5, 16) != 0) &&
                        sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16) != 0) &&
                       num_arrays_4 != 0) && 16 != 0) && 16 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16) >= 1 <<
                        16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (num_arrays_4 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = sdiv_up32(x_elems_5, 16);
                    grid[perm[1]] = sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16);
                    grid[perm[2]] = num_arrays_4;
                    
                    void *kernel_args_41159[] = {&perm[0], &perm[1], &perm[2],
                                                 &shared_offset_41163,
                                                 &destoffset_1, &srcoffset_3,
                                                 &num_arrays_4, &x_elems_5,
                                                 &y_elems_6, &mulx_7, &muly_8,
                                                 &kernel_arg_41164,
                                                 &kernel_arg_41165};
                    int64_t time_start_41160 = 0, time_end_41161 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "gpu_map_transpose_i32_low_width");
                        fprintf(stderr, "%d", sdiv_up32(x_elems_5, 16));
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", sdiv_up32(sdiv_up32(y_elems_6,
                                                                  muly_8), 16));
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", num_arrays_4);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", 16);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 16);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41160 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->gpu_map_transpose_i32_low_width_runs,
                                                  &ctx->gpu_map_transpose_i32_low_width_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_i32_low_width,
                                                grid[0], grid[1], grid[2], 16,
                                                16, 1, 0 + (shared_sizze_41162 +
                                                            (8 -
                                                             shared_sizze_41162 %
                                                             8) % 8), NULL,
                                                kernel_args_41159, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41161 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "gpu_map_transpose_i32_low_width",
                                time_end_41161 - time_start_41160);
                    }
                }
            } else {
                if (sle32(y_elems_6, 8) && slt32(16, x_elems_5)) {
                    unsigned int shared_sizze_41169 = 1088;
                    CUdeviceptr kernel_arg_41171 = destmem_0.mem;
                    CUdeviceptr kernel_arg_41172 = srcmem_2.mem;
                    unsigned int shared_offset_41170 = 0;
                    
                    if ((((((1 && sdiv_up32(sdiv_up32(x_elems_5, mulx_7), 16) !=
                             0) && sdiv_up32(y_elems_6, 16) != 0) &&
                           num_arrays_4 != 0) && 16 != 0) && 16 != 0) && 1 !=
                        0) {
                        int perm[3] = {0, 1, 2};
                        
                        if (sdiv_up32(y_elems_6, 16) >= 1 << 16) {
                            perm[1] = perm[0];
                            perm[0] = 1;
                        }
                        if (num_arrays_4 >= 1 << 16) {
                            perm[2] = perm[0];
                            perm[0] = 2;
                        }
                        
                        size_t grid[3];
                        
                        grid[perm[0]] = sdiv_up32(sdiv_up32(x_elems_5, mulx_7),
                                                  16);
                        grid[perm[1]] = sdiv_up32(y_elems_6, 16);
                        grid[perm[2]] = num_arrays_4;
                        
                        void *kernel_args_41166[] = {&perm[0], &perm[1],
                                                     &perm[2],
                                                     &shared_offset_41170,
                                                     &destoffset_1,
                                                     &srcoffset_3,
                                                     &num_arrays_4, &x_elems_5,
                                                     &y_elems_6, &mulx_7,
                                                     &muly_8, &kernel_arg_41171,
                                                     &kernel_arg_41172};
                        int64_t time_start_41167 = 0, time_end_41168 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr, "Launching %s with grid size (",
                                    "gpu_map_transpose_i32_low_height");
                            fprintf(stderr, "%d", sdiv_up32(sdiv_up32(x_elems_5,
                                                                      mulx_7),
                                                            16));
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", sdiv_up32(y_elems_6, 16));
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", num_arrays_4);
                            fprintf(stderr, ") and block size (");
                            fprintf(stderr, "%d", 16);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", 16);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", 1);
                            fprintf(stderr, ").\n");
                            time_start_41167 = get_wall_time();
                        }
                        
                        cudaEvent_t *pevents = NULL;
                        
                        if (ctx->profiling && !ctx->profiling_paused) {
                            pevents = cuda_get_events(&ctx->cuda,
                                                      &ctx->gpu_map_transpose_i32_low_height_runs,
                                                      &ctx->gpu_map_transpose_i32_low_height_total_runtime);
                            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                        }
                        CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_i32_low_height,
                                                    grid[0], grid[1], grid[2],
                                                    16, 16, 1, 0 +
                                                    (shared_sizze_41169 + (8 -
                                                                           shared_sizze_41169 %
                                                                           8) %
                                                     8), NULL,
                                                    kernel_args_41166, NULL));
                        if (pevents != NULL)
                            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                        if (ctx->debugging) {
                            CUDA_SUCCEED(cuCtxSynchronize());
                            time_end_41168 = get_wall_time();
                            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                    "gpu_map_transpose_i32_low_height",
                                    time_end_41168 - time_start_41167);
                        }
                    }
                } else {
                    if (sle32(x_elems_5, 8) && sle32(y_elems_6, 8)) {
                        unsigned int shared_sizze_41176 = 1;
                        CUdeviceptr kernel_arg_41178 = destmem_0.mem;
                        CUdeviceptr kernel_arg_41179 = srcmem_2.mem;
                        unsigned int shared_offset_41177 = 0;
                        
                        if ((((((1 && sdiv_up32(num_arrays_4 * x_elems_5 *
                                                y_elems_6, 256) != 0) && 1 !=
                                0) && 1 != 0) && 256 != 0) && 1 != 0) && 1 !=
                            0) {
                            int perm[3] = {0, 1, 2};
                            
                            if (1 >= 1 << 16) {
                                perm[1] = perm[0];
                                perm[0] = 1;
                            }
                            if (1 >= 1 << 16) {
                                perm[2] = perm[0];
                                perm[0] = 2;
                            }
                            
                            size_t grid[3];
                            
                            grid[perm[0]] = sdiv_up32(num_arrays_4 * x_elems_5 *
                                                      y_elems_6, 256);
                            grid[perm[1]] = 1;
                            grid[perm[2]] = 1;
                            
                            void *kernel_args_41173[] = {&shared_offset_41177,
                                                         &destoffset_1,
                                                         &srcoffset_3,
                                                         &num_arrays_4,
                                                         &x_elems_5, &y_elems_6,
                                                         &mulx_7, &muly_8,
                                                         &kernel_arg_41178,
                                                         &kernel_arg_41179};
                            int64_t time_start_41174 = 0, time_end_41175 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr, "Launching %s with grid size (",
                                        "gpu_map_transpose_i32_small");
                                fprintf(stderr, "%d", sdiv_up32(num_arrays_4 *
                                                                x_elems_5 *
                                                                y_elems_6,
                                                                256));
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ") and block size (");
                                fprintf(stderr, "%d", 256);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ").\n");
                                time_start_41174 = get_wall_time();
                            }
                            
                            cudaEvent_t *pevents = NULL;
                            
                            if (ctx->profiling && !ctx->profiling_paused) {
                                pevents = cuda_get_events(&ctx->cuda,
                                                          &ctx->gpu_map_transpose_i32_small_runs,
                                                          &ctx->gpu_map_transpose_i32_small_total_runtime);
                                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                            }
                            CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_i32_small,
                                                        grid[0], grid[1],
                                                        grid[2], 256, 1, 1, 0 +
                                                        (shared_sizze_41176 +
                                                         (8 -
                                                          shared_sizze_41176 %
                                                          8) % 8), NULL,
                                                        kernel_args_41173,
                                                        NULL));
                            if (pevents != NULL)
                                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                            if (ctx->debugging) {
                                CUDA_SUCCEED(cuCtxSynchronize());
                                time_end_41175 = get_wall_time();
                                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_i32_small",
                                        time_end_41175 - time_start_41174);
                            }
                        }
                    } else {
                        unsigned int shared_sizze_41183 = 4224;
                        CUdeviceptr kernel_arg_41185 = destmem_0.mem;
                        CUdeviceptr kernel_arg_41186 = srcmem_2.mem;
                        unsigned int shared_offset_41184 = 0;
                        
                        if ((((((1 && sdiv_up32(x_elems_5, 32) != 0) &&
                                sdiv_up32(y_elems_6, 32) != 0) &&
                               num_arrays_4 != 0) && 32 != 0) && 8 != 0) && 1 !=
                            0) {
                            int perm[3] = {0, 1, 2};
                            
                            if (sdiv_up32(y_elems_6, 32) >= 1 << 16) {
                                perm[1] = perm[0];
                                perm[0] = 1;
                            }
                            if (num_arrays_4 >= 1 << 16) {
                                perm[2] = perm[0];
                                perm[0] = 2;
                            }
                            
                            size_t grid[3];
                            
                            grid[perm[0]] = sdiv_up32(x_elems_5, 32);
                            grid[perm[1]] = sdiv_up32(y_elems_6, 32);
                            grid[perm[2]] = num_arrays_4;
                            
                            void *kernel_args_41180[] = {&perm[0], &perm[1],
                                                         &perm[2],
                                                         &shared_offset_41184,
                                                         &destoffset_1,
                                                         &srcoffset_3,
                                                         &num_arrays_4,
                                                         &x_elems_5, &y_elems_6,
                                                         &mulx_7, &muly_8,
                                                         &kernel_arg_41185,
                                                         &kernel_arg_41186};
                            int64_t time_start_41181 = 0, time_end_41182 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr, "Launching %s with grid size (",
                                        "gpu_map_transpose_i32");
                                fprintf(stderr, "%d", sdiv_up32(x_elems_5, 32));
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", sdiv_up32(y_elems_6, 32));
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", num_arrays_4);
                                fprintf(stderr, ") and block size (");
                                fprintf(stderr, "%d", 32);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 8);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ").\n");
                                time_start_41181 = get_wall_time();
                            }
                            
                            cudaEvent_t *pevents = NULL;
                            
                            if (ctx->profiling && !ctx->profiling_paused) {
                                pevents = cuda_get_events(&ctx->cuda,
                                                          &ctx->gpu_map_transpose_i32_runs,
                                                          &ctx->gpu_map_transpose_i32_total_runtime);
                                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                            }
                            CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_i32,
                                                        grid[0], grid[1],
                                                        grid[2], 32, 8, 1, 0 +
                                                        (shared_sizze_41183 +
                                                         (8 -
                                                          shared_sizze_41183 %
                                                          8) % 8), NULL,
                                                        kernel_args_41180,
                                                        NULL));
                            if (pevents != NULL)
                                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                            if (ctx->debugging) {
                                CUDA_SUCCEED(cuCtxSynchronize());
                                time_end_41182 = get_wall_time();
                                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_i32",
                                        time_end_41182 - time_start_41181);
                            }
                        }
                    }
                }
            }
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhgpu_map_transpose_i8(struct futhark_context *ctx,
                                                struct memblock_device destmem_0,
                                                int32_t destoffset_1,
                                                struct memblock_device srcmem_2,
                                                int32_t srcoffset_3,
                                                int32_t num_arrays_4,
                                                int32_t x_elems_5,
                                                int32_t y_elems_6)
{
    (void) ctx;
    
    int err = 0;
    
    if (!(num_arrays_4 == 0 || (x_elems_5 == 0 || y_elems_6 == 0))) {
        int32_t muly_8 = squot32(16, x_elems_5);
        int32_t mulx_7 = squot32(16, y_elems_6);
        
        if (num_arrays_4 == 1 && (x_elems_5 == 1 || y_elems_6 == 1)) {
            {
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->copy_dev_to_dev_runs,
                                              &ctx->copy_dev_to_dev_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuMemcpy(destmem_0.mem +
                                      sext_i32_i64(destoffset_1), srcmem_2.mem +
                                      sext_i32_i64(srcoffset_3),
                                      sext_i32_i64(x_elems_5 * y_elems_6 *
                                      (int64_t) sizeof(int8_t))));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            }
        } else {
            if (sle32(x_elems_5, 8) && slt32(16, y_elems_6)) {
                unsigned int shared_sizze_41190 = 272;
                CUdeviceptr kernel_arg_41192 = destmem_0.mem;
                CUdeviceptr kernel_arg_41193 = srcmem_2.mem;
                unsigned int shared_offset_41191 = 0;
                
                if ((((((1 && sdiv_up32(x_elems_5, 16) != 0) &&
                        sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16) != 0) &&
                       num_arrays_4 != 0) && 16 != 0) && 16 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16) >= 1 <<
                        16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (num_arrays_4 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = sdiv_up32(x_elems_5, 16);
                    grid[perm[1]] = sdiv_up32(sdiv_up32(y_elems_6, muly_8), 16);
                    grid[perm[2]] = num_arrays_4;
                    
                    void *kernel_args_41187[] = {&perm[0], &perm[1], &perm[2],
                                                 &shared_offset_41191,
                                                 &destoffset_1, &srcoffset_3,
                                                 &num_arrays_4, &x_elems_5,
                                                 &y_elems_6, &mulx_7, &muly_8,
                                                 &kernel_arg_41192,
                                                 &kernel_arg_41193};
                    int64_t time_start_41188 = 0, time_end_41189 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "gpu_map_transpose_i8_low_width");
                        fprintf(stderr, "%d", sdiv_up32(x_elems_5, 16));
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", sdiv_up32(sdiv_up32(y_elems_6,
                                                                  muly_8), 16));
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", num_arrays_4);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", 16);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 16);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41188 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->gpu_map_transpose_i8_low_width_runs,
                                                  &ctx->gpu_map_transpose_i8_low_width_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_i8_low_width,
                                                grid[0], grid[1], grid[2], 16,
                                                16, 1, 0 + (shared_sizze_41190 +
                                                            (8 -
                                                             shared_sizze_41190 %
                                                             8) % 8), NULL,
                                                kernel_args_41187, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41189 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "gpu_map_transpose_i8_low_width",
                                time_end_41189 - time_start_41188);
                    }
                }
            } else {
                if (sle32(y_elems_6, 8) && slt32(16, x_elems_5)) {
                    unsigned int shared_sizze_41197 = 272;
                    CUdeviceptr kernel_arg_41199 = destmem_0.mem;
                    CUdeviceptr kernel_arg_41200 = srcmem_2.mem;
                    unsigned int shared_offset_41198 = 0;
                    
                    if ((((((1 && sdiv_up32(sdiv_up32(x_elems_5, mulx_7), 16) !=
                             0) && sdiv_up32(y_elems_6, 16) != 0) &&
                           num_arrays_4 != 0) && 16 != 0) && 16 != 0) && 1 !=
                        0) {
                        int perm[3] = {0, 1, 2};
                        
                        if (sdiv_up32(y_elems_6, 16) >= 1 << 16) {
                            perm[1] = perm[0];
                            perm[0] = 1;
                        }
                        if (num_arrays_4 >= 1 << 16) {
                            perm[2] = perm[0];
                            perm[0] = 2;
                        }
                        
                        size_t grid[3];
                        
                        grid[perm[0]] = sdiv_up32(sdiv_up32(x_elems_5, mulx_7),
                                                  16);
                        grid[perm[1]] = sdiv_up32(y_elems_6, 16);
                        grid[perm[2]] = num_arrays_4;
                        
                        void *kernel_args_41194[] = {&perm[0], &perm[1],
                                                     &perm[2],
                                                     &shared_offset_41198,
                                                     &destoffset_1,
                                                     &srcoffset_3,
                                                     &num_arrays_4, &x_elems_5,
                                                     &y_elems_6, &mulx_7,
                                                     &muly_8, &kernel_arg_41199,
                                                     &kernel_arg_41200};
                        int64_t time_start_41195 = 0, time_end_41196 = 0;
                        
                        if (ctx->debugging) {
                            fprintf(stderr, "Launching %s with grid size (",
                                    "gpu_map_transpose_i8_low_height");
                            fprintf(stderr, "%d", sdiv_up32(sdiv_up32(x_elems_5,
                                                                      mulx_7),
                                                            16));
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", sdiv_up32(y_elems_6, 16));
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", num_arrays_4);
                            fprintf(stderr, ") and block size (");
                            fprintf(stderr, "%d", 16);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", 16);
                            fprintf(stderr, ", ");
                            fprintf(stderr, "%d", 1);
                            fprintf(stderr, ").\n");
                            time_start_41195 = get_wall_time();
                        }
                        
                        cudaEvent_t *pevents = NULL;
                        
                        if (ctx->profiling && !ctx->profiling_paused) {
                            pevents = cuda_get_events(&ctx->cuda,
                                                      &ctx->gpu_map_transpose_i8_low_height_runs,
                                                      &ctx->gpu_map_transpose_i8_low_height_total_runtime);
                            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                        }
                        CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_i8_low_height,
                                                    grid[0], grid[1], grid[2],
                                                    16, 16, 1, 0 +
                                                    (shared_sizze_41197 + (8 -
                                                                           shared_sizze_41197 %
                                                                           8) %
                                                     8), NULL,
                                                    kernel_args_41194, NULL));
                        if (pevents != NULL)
                            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                        if (ctx->debugging) {
                            CUDA_SUCCEED(cuCtxSynchronize());
                            time_end_41196 = get_wall_time();
                            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                    "gpu_map_transpose_i8_low_height",
                                    time_end_41196 - time_start_41195);
                        }
                    }
                } else {
                    if (sle32(x_elems_5, 8) && sle32(y_elems_6, 8)) {
                        unsigned int shared_sizze_41204 = 1;
                        CUdeviceptr kernel_arg_41206 = destmem_0.mem;
                        CUdeviceptr kernel_arg_41207 = srcmem_2.mem;
                        unsigned int shared_offset_41205 = 0;
                        
                        if ((((((1 && sdiv_up32(num_arrays_4 * x_elems_5 *
                                                y_elems_6, 256) != 0) && 1 !=
                                0) && 1 != 0) && 256 != 0) && 1 != 0) && 1 !=
                            0) {
                            int perm[3] = {0, 1, 2};
                            
                            if (1 >= 1 << 16) {
                                perm[1] = perm[0];
                                perm[0] = 1;
                            }
                            if (1 >= 1 << 16) {
                                perm[2] = perm[0];
                                perm[0] = 2;
                            }
                            
                            size_t grid[3];
                            
                            grid[perm[0]] = sdiv_up32(num_arrays_4 * x_elems_5 *
                                                      y_elems_6, 256);
                            grid[perm[1]] = 1;
                            grid[perm[2]] = 1;
                            
                            void *kernel_args_41201[] = {&shared_offset_41205,
                                                         &destoffset_1,
                                                         &srcoffset_3,
                                                         &num_arrays_4,
                                                         &x_elems_5, &y_elems_6,
                                                         &mulx_7, &muly_8,
                                                         &kernel_arg_41206,
                                                         &kernel_arg_41207};
                            int64_t time_start_41202 = 0, time_end_41203 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr, "Launching %s with grid size (",
                                        "gpu_map_transpose_i8_small");
                                fprintf(stderr, "%d", sdiv_up32(num_arrays_4 *
                                                                x_elems_5 *
                                                                y_elems_6,
                                                                256));
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ") and block size (");
                                fprintf(stderr, "%d", 256);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ").\n");
                                time_start_41202 = get_wall_time();
                            }
                            
                            cudaEvent_t *pevents = NULL;
                            
                            if (ctx->profiling && !ctx->profiling_paused) {
                                pevents = cuda_get_events(&ctx->cuda,
                                                          &ctx->gpu_map_transpose_i8_small_runs,
                                                          &ctx->gpu_map_transpose_i8_small_total_runtime);
                                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                            }
                            CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_i8_small,
                                                        grid[0], grid[1],
                                                        grid[2], 256, 1, 1, 0 +
                                                        (shared_sizze_41204 +
                                                         (8 -
                                                          shared_sizze_41204 %
                                                          8) % 8), NULL,
                                                        kernel_args_41201,
                                                        NULL));
                            if (pevents != NULL)
                                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                            if (ctx->debugging) {
                                CUDA_SUCCEED(cuCtxSynchronize());
                                time_end_41203 = get_wall_time();
                                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_i8_small",
                                        time_end_41203 - time_start_41202);
                            }
                        }
                    } else {
                        unsigned int shared_sizze_41211 = 1056;
                        CUdeviceptr kernel_arg_41213 = destmem_0.mem;
                        CUdeviceptr kernel_arg_41214 = srcmem_2.mem;
                        unsigned int shared_offset_41212 = 0;
                        
                        if ((((((1 && sdiv_up32(x_elems_5, 32) != 0) &&
                                sdiv_up32(y_elems_6, 32) != 0) &&
                               num_arrays_4 != 0) && 32 != 0) && 8 != 0) && 1 !=
                            0) {
                            int perm[3] = {0, 1, 2};
                            
                            if (sdiv_up32(y_elems_6, 32) >= 1 << 16) {
                                perm[1] = perm[0];
                                perm[0] = 1;
                            }
                            if (num_arrays_4 >= 1 << 16) {
                                perm[2] = perm[0];
                                perm[0] = 2;
                            }
                            
                            size_t grid[3];
                            
                            grid[perm[0]] = sdiv_up32(x_elems_5, 32);
                            grid[perm[1]] = sdiv_up32(y_elems_6, 32);
                            grid[perm[2]] = num_arrays_4;
                            
                            void *kernel_args_41208[] = {&perm[0], &perm[1],
                                                         &perm[2],
                                                         &shared_offset_41212,
                                                         &destoffset_1,
                                                         &srcoffset_3,
                                                         &num_arrays_4,
                                                         &x_elems_5, &y_elems_6,
                                                         &mulx_7, &muly_8,
                                                         &kernel_arg_41213,
                                                         &kernel_arg_41214};
                            int64_t time_start_41209 = 0, time_end_41210 = 0;
                            
                            if (ctx->debugging) {
                                fprintf(stderr, "Launching %s with grid size (",
                                        "gpu_map_transpose_i8");
                                fprintf(stderr, "%d", sdiv_up32(x_elems_5, 32));
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", sdiv_up32(y_elems_6, 32));
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", num_arrays_4);
                                fprintf(stderr, ") and block size (");
                                fprintf(stderr, "%d", 32);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 8);
                                fprintf(stderr, ", ");
                                fprintf(stderr, "%d", 1);
                                fprintf(stderr, ").\n");
                                time_start_41209 = get_wall_time();
                            }
                            
                            cudaEvent_t *pevents = NULL;
                            
                            if (ctx->profiling && !ctx->profiling_paused) {
                                pevents = cuda_get_events(&ctx->cuda,
                                                          &ctx->gpu_map_transpose_i8_runs,
                                                          &ctx->gpu_map_transpose_i8_total_runtime);
                                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                            }
                            CUDA_SUCCEED(cuLaunchKernel(ctx->gpu_map_transpose_i8,
                                                        grid[0], grid[1],
                                                        grid[2], 32, 8, 1, 0 +
                                                        (shared_sizze_41211 +
                                                         (8 -
                                                          shared_sizze_41211 %
                                                          8) % 8), NULL,
                                                        kernel_args_41208,
                                                        NULL));
                            if (pevents != NULL)
                                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                            if (ctx->debugging) {
                                CUDA_SUCCEED(cuCtxSynchronize());
                                time_end_41210 = get_wall_time();
                                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                        "gpu_map_transpose_i8", time_end_41210 -
                                        time_start_41209);
                            }
                        }
                    }
                }
            }
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhiota_i32(struct futhark_context *ctx,
                                    struct memblock_device mem_40449,
                                    int32_t n_40450, int32_t x_40451,
                                    int32_t s_40452)
{
    (void) ctx;
    
    int err = 0;
    int32_t group_sizze_40457;
    
    group_sizze_40457 = ctx->sizes.builtinzhiota_i32zigroup_sizze_40457;
    
    int64_t num_groups_40458;
    
    num_groups_40458 = sdiv_up64(sext_i32_i64(n_40450),
                                 sext_i32_i64(group_sizze_40457));
    
    CUdeviceptr kernel_arg_41218 = mem_40449.mem;
    
    if ((((((1 && sext_i64_i32(num_groups_40458) != 0) && 1 != 0) && 1 != 0) &&
          group_sizze_40457 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = sext_i64_i32(num_groups_40458);
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41215[] = {&kernel_arg_41218, &n_40450, &x_40451,
                                     &s_40452};
        int64_t time_start_41216 = 0, time_end_41217 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "builtin#iota_i32.iota_i32_40454");
            fprintf(stderr, "%d", sext_i64_i32(num_groups_40458));
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", group_sizze_40457);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41216 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->builtinzhiota_i32ziiota_i32_40454_runs,
                                      &ctx->builtinzhiota_i32ziiota_i32_40454_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->builtinzhiota_i32ziiota_i32_40454,
                                    grid[0], grid[1], grid[2],
                                    group_sizze_40457, 1, 1, 0, NULL,
                                    kernel_args_41215, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41217 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "builtin#iota_i32.iota_i32_40454", time_end_41217 -
                    time_start_41216);
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhreplicate_f32(struct futhark_context *ctx,
                                         struct memblock_device mem_40459,
                                         int32_t num_elems_40460,
                                         float val_40461)
{
    (void) ctx;
    
    int err = 0;
    int32_t group_sizze_40466;
    
    group_sizze_40466 = ctx->sizes.builtinzhreplicate_f32zigroup_sizze_40466;
    
    int64_t num_groups_40467;
    
    num_groups_40467 = sdiv_up64(sext_i32_i64(num_elems_40460),
                                 sext_i32_i64(group_sizze_40466));
    
    CUdeviceptr kernel_arg_41222 = mem_40459.mem;
    
    if ((((((1 && sext_i64_i32(num_groups_40467) != 0) && 1 != 0) && 1 != 0) &&
          group_sizze_40466 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = sext_i64_i32(num_groups_40467);
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41219[] = {&kernel_arg_41222, &num_elems_40460,
                                     &val_40461};
        int64_t time_start_41220 = 0, time_end_41221 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "builtin#replicate_f32.replicate_40463");
            fprintf(stderr, "%d", sext_i64_i32(num_groups_40467));
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", group_sizze_40466);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41220 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->builtinzhreplicate_f32zireplicate_40463_runs,
                                      &ctx->builtinzhreplicate_f32zireplicate_40463_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->builtinzhreplicate_f32zireplicate_40463,
                                    grid[0], grid[1], grid[2],
                                    group_sizze_40466, 1, 1, 0, NULL,
                                    kernel_args_41219, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41221 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "builtin#replicate_f32.replicate_40463", time_end_41221 -
                    time_start_41220);
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_builtinzhreplicate_i32(struct futhark_context *ctx,
                                         struct memblock_device mem_40468,
                                         int32_t num_elems_40469,
                                         int32_t val_40470)
{
    (void) ctx;
    
    int err = 0;
    int32_t group_sizze_40475;
    
    group_sizze_40475 = ctx->sizes.builtinzhreplicate_i32zigroup_sizze_40475;
    
    int64_t num_groups_40476;
    
    num_groups_40476 = sdiv_up64(sext_i32_i64(num_elems_40469),
                                 sext_i32_i64(group_sizze_40475));
    
    CUdeviceptr kernel_arg_41226 = mem_40468.mem;
    
    if ((((((1 && sext_i64_i32(num_groups_40476) != 0) && 1 != 0) && 1 != 0) &&
          group_sizze_40475 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = sext_i64_i32(num_groups_40476);
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41223[] = {&kernel_arg_41226, &num_elems_40469,
                                     &val_40470};
        int64_t time_start_41224 = 0, time_end_41225 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "builtin#replicate_i32.replicate_40472");
            fprintf(stderr, "%d", sext_i64_i32(num_groups_40476));
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", group_sizze_40475);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41224 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->builtinzhreplicate_i32zireplicate_40472_runs,
                                      &ctx->builtinzhreplicate_i32zireplicate_40472_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->builtinzhreplicate_i32zireplicate_40472,
                                    grid[0], grid[1], grid[2],
                                    group_sizze_40475, 1, 1, 0, NULL,
                                    kernel_args_41223, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41225 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "builtin#replicate_i32.replicate_40472", time_end_41225 -
                    time_start_41224);
        }
    }
    
  cleanup:
    { }
    return err;
}
static int futrts_exactKnnFixK(struct futhark_context *ctx,
                               struct memblock_device *out_mem_p_41227,
                               int32_t *out_out_arrsizze_41228,
                               int32_t *out_out_arrsizze_41229,
                               struct memblock_device *out_mem_p_41230,
                               int32_t *out_out_arrsizze_41231,
                               int32_t *out_out_arrsizze_41232,
                               int32_t *out_scalar_out_41233,
                               struct memblock_device ref_pts_mem_39418,
                               struct memblock_device median_dims_mem_39419,
                               struct memblock_device median_vals_mem_39420,
                               struct memblock_device prev_eqdims_mem_39421,
                               struct memblock_device queries_mem_39422,
                               struct memblock_device nat_leaves_mem_39423,
                               struct memblock_device knn_is_mem_39424,
                               struct memblock_device knn_vs_mem_39425,
                               int32_t m_31021, int32_t d_31022,
                               int32_t q_31023, int32_t q_31024,
                               int32_t q_31025, int32_t n_31026,
                               int32_t d_31027, int32_t n_31028,
                               int32_t n_31029, int32_t kk_31030,
                               int32_t n_31031, int32_t kk_31032,
                               int32_t s_31037)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    int32_t out_arrsizze_40297;
    struct memblock_device out_mem_40298;
    
    out_mem_40298.references = NULL;
    
    int32_t out_arrsizze_40299;
    int32_t out_arrsizze_40300;
    int32_t scalar_out_40301;
    bool dim_match_31042 = q_31023 == q_31024;
    bool empty_or_match_cert_31043;
    
    if (!dim_match_31042) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:269:1-288:33\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31044 = q_31023 == q_31025;
    bool empty_or_match_cert_31045;
    
    if (!dim_match_31044) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:269:1-288:33\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31046 = d_31022 == d_31027;
    bool empty_or_match_cert_31047;
    
    if (!dim_match_31046) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:269:1-288:33\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31048 = n_31026 == n_31028;
    bool empty_or_match_cert_31049;
    
    if (!dim_match_31048) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:269:1-288:33\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31050 = n_31026 == n_31029;
    bool dim_match_31051 = 8 == kk_31030;
    bool match_31052 = dim_match_31050 && dim_match_31051;
    bool empty_or_match_cert_31053;
    
    if (!match_31052) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:269:1-288:33\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31055 = n_31026 == n_31031;
    bool dim_match_31056 = 8 == kk_31032;
    bool match_31057 = dim_match_31055 && dim_match_31056;
    bool empty_or_match_cert_31058;
    
    if (!match_31057) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:269:1-288:33\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool empty_slice_31060 = s_31037 == 0;
    int32_t m_31061 = sub32(s_31037, 1);
    bool zzero_leq_i_p_m_t_s_31062 = sle32(0, m_31061);
    bool i_p_m_t_s_leq_w_31063 = slt32(m_31061, n_31026);
    bool i_lte_j_31064 = sle32(0, s_31037);
    bool y_31065 = zzero_leq_i_p_m_t_s_31062 && i_p_m_t_s_leq_w_31063;
    bool y_31066 = i_lte_j_31064 && y_31065;
    bool ok_or_empty_31067 = empty_slice_31060 || y_31066;
    bool index_certs_31068;
    
    if (!ok_or_empty_31067) {
        ctx->error = msgprintf("Error: %s%d%s%d%s\n\nBacktrace:\n%s",
                               "Index [:", s_31037,
                               "] out of bounds for array of shape [", n_31026,
                               "].",
                               "-> #0  driverKNN.fut:279:34-43\n   #1  driverKNN.fut:269:1-288:33\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int64_t binop_x_39427 = sext_i32_i64(s_31037);
    int64_t binop_x_39428 = 8 * binop_x_39427;
    int64_t bytes_39426 = 4 * binop_x_39428;
    struct memblock_device mem_39429;
    
    mem_39429.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39429, bytes_39426, "mem_39429")) {
        err = 1;
        goto cleanup;
    }
    
    int32_t group_sizze_40305;
    
    group_sizze_40305 = ctx->sizes.exactKnnFixKzigroup_sizze_40305;
    
    int64_t num_groups_40306;
    
    num_groups_40306 = sdiv_up64(sext_i32_i64(s_31037) * 8,
                                 sext_i32_i64(group_sizze_40305));
    
    CUdeviceptr kernel_arg_41237 = knn_is_mem_39424.mem;
    CUdeviceptr kernel_arg_41238 = mem_39429.mem;
    
    if ((((((1 && sext_i64_i32(num_groups_40306) != 0) && 1 != 0) && 1 != 0) &&
          group_sizze_40305 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = sext_i64_i32(num_groups_40306);
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41234[] = {&kk_31030, &s_31037, &kernel_arg_41237,
                                     &kernel_arg_41238};
        int64_t time_start_41235 = 0, time_end_41236 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "exactKnnFixK.copy_40302");
            fprintf(stderr, "%d", sext_i64_i32(num_groups_40306));
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", group_sizze_40305);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41235 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->exactKnnFixKzicopy_40302_runs,
                                      &ctx->exactKnnFixKzicopy_40302_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->exactKnnFixKzicopy_40302, grid[0],
                                    grid[1], grid[2], group_sizze_40305, 1, 1,
                                    0, NULL, kernel_args_41234, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41236 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "exactKnnFixK.copy_40302", time_end_41236 -
                    time_start_41235);
        }
    }
    
    struct memblock_device mem_39433;
    
    mem_39433.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39433, bytes_39426, "mem_39433")) {
        err = 1;
        goto cleanup;
    }
    
    int32_t group_sizze_40310;
    
    group_sizze_40310 = ctx->sizes.exactKnnFixKzigroup_sizze_40310;
    
    int64_t num_groups_40311;
    
    num_groups_40311 = sdiv_up64(sext_i32_i64(s_31037) * 8,
                                 sext_i32_i64(group_sizze_40310));
    
    CUdeviceptr kernel_arg_41242 = knn_vs_mem_39425.mem;
    CUdeviceptr kernel_arg_41243 = mem_39433.mem;
    
    if ((((((1 && sext_i64_i32(num_groups_40311) != 0) && 1 != 0) && 1 != 0) &&
          group_sizze_40310 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = sext_i64_i32(num_groups_40311);
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41239[] = {&kk_31032, &s_31037, &kernel_arg_41242,
                                     &kernel_arg_41243};
        int64_t time_start_41240 = 0, time_end_41241 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "exactKnnFixK.copy_40307");
            fprintf(stderr, "%d", sext_i64_i32(num_groups_40311));
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", group_sizze_40310);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41240 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->exactKnnFixKzicopy_40307_runs,
                                      &ctx->exactKnnFixKzicopy_40307_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->exactKnnFixKzicopy_40307, grid[0],
                                    grid[1], grid[2], group_sizze_40310, 1, 1,
                                    0, NULL, kernel_args_41239, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41241 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "exactKnnFixK.copy_40307", time_end_41241 -
                    time_start_41240);
        }
    }
    
    int32_t num_leaves_31075 = add32(1, q_31023);
    bool loop_cond_31076 = slt32(1, num_leaves_31075);
    bool res_31077;
    int32_t res_31078;
    int32_t res_31079;
    bool loop_while_31080;
    int32_t y_31081;
    int32_t c_31082;
    
    loop_while_31080 = loop_cond_31076;
    y_31081 = num_leaves_31075;
    c_31082 = 0;
    while (loop_while_31080) {
        int32_t loopres_31083 = ashr32(y_31081, 1);
        int32_t loopres_31084 = add32(1, c_31082);
        bool loop_cond_31085 = slt32(1, loopres_31083);
        bool loop_while_tmp_40312 = loop_cond_31085;
        int32_t y_tmp_40313 = loopres_31083;
        int32_t c_tmp_40314 = loopres_31084;
        
        loop_while_31080 = loop_while_tmp_40312;
        y_31081 = y_tmp_40313;
        c_31082 = c_tmp_40314;
    }
    res_31077 = loop_while_31080;
    res_31078 = y_31081;
    res_31079 = c_31082;
    
    int32_t h_31086 = sub32(res_31079, 1);
    bool zzero_31087 = num_leaves_31075 == 0;
    bool nonzzero_31088 = !zzero_31087;
    bool nonzzero_cert_31089;
    
    if (!nonzzero_31088) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "division by zero",
                               "-> #0  driverKNN.fut:22:13-26\n   #1  driverKNN.fut:237:30-45\n   #2  driverKNN.fut:282:5-64\n   #3  driverKNN.fut:269:1-288:33\n");
        if (memblock_unref_device(ctx, &mem_39433, "mem_39433") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39429, "mem_39429") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int32_t ppl_31090 = sdiv32(m_31021, num_leaves_31075);
    int32_t x_31091 = num_leaves_31075 * ppl_31090;
    bool dim_ok_31092 = x_31091 == m_31021;
    bool dim_ok_cert_31093;
    
    if (!dim_ok_31092) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "new shape has different number of elements than old shape",
                               "-> #0  /prelude/array.fut:95:3-33\n   #1  driverKNN.fut:238:16-47\n   #2  driverKNN.fut:282:5-64\n   #3  driverKNN.fut:269:1-288:33\n");
        if (memblock_unref_device(ctx, &mem_39433, "mem_39433") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39429, "mem_39429") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int64_t bytes_39434 = 4 * binop_x_39427;
    struct memblock_device mem_39436;
    
    mem_39436.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39436, bytes_39434, "mem_39436")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, mem_39436, s_31037, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39439;
    
    mem_39439.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39439, bytes_39434, "mem_39439")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f32(ctx, mem_39439, s_31037, 0.0F) != 0) {
        err = 1;
        goto cleanup;
    }
    
    bool loop_cond_31097 = slt32(0, s_31037);
    int32_t segred_group_sizze_33931;
    
    segred_group_sizze_33931 =
        ctx->sizes.exactKnnFixKzisegred_group_sizze_33930;
    
    int32_t num_groups_33933;
    int32_t max_num_groups_40333;
    
    max_num_groups_40333 = ctx->sizes.exactKnnFixKzisegred_num_groups_33932;
    num_groups_33933 = sext_i64_i32(smax64(1, smin64(sdiv_up64(binop_x_39427,
                                                               sext_i32_i64(segred_group_sizze_33931)),
                                                     sext_i32_i64(max_num_groups_40333))));
    
    bool suff_outer_par_33943;
    
    suff_outer_par_33943 = ctx->sizes.exactKnnFixKzisuff_outer_par_0 <= s_31037;
    
    int32_t max_group_sizze_34201;
    
    max_group_sizze_34201 = ctx->cuda.max_block_size;
    
    bool fits_34202 = sle32(ppl_31090, max_group_sizze_34201);
    bool suff_intra_par_34200;
    
    suff_intra_par_34200 = ctx->sizes.exactKnnFixKzisuff_intra_par_1 <=
        ppl_31090;
    
    bool intra_suff_and_fits_34203 = suff_intra_par_34200 && fits_34202;
    int32_t segmap_group_sizze_34083;
    
    segmap_group_sizze_34083 =
        ctx->sizes.exactKnnFixKzisegmap_group_sizze_33965;
    
    int32_t num_groups_34084;
    int32_t max_num_groups_40334;
    
    max_num_groups_40334 = ctx->sizes.exactKnnFixKzisegmap_num_groups_33967;
    num_groups_34084 = sext_i64_i32(smax64(1, smin64(sdiv_up64(binop_x_39427,
                                                               sext_i32_i64(segmap_group_sizze_34083)),
                                                     sext_i32_i64(max_num_groups_40334))));
    
    int32_t segmap_group_sizze_34442;
    
    segmap_group_sizze_34442 =
        ctx->sizes.exactKnnFixKzisegmap_group_sizze_34324;
    
    int32_t num_groups_34443;
    int32_t max_num_groups_40335;
    
    max_num_groups_40335 = ctx->sizes.exactKnnFixKzisegmap_num_groups_34326;
    num_groups_34443 = sext_i64_i32(smax64(1, smin64(sdiv_up64(binop_x_39427,
                                                               sext_i32_i64(segmap_group_sizze_34442)),
                                                     sext_i32_i64(max_num_groups_40335))));
    
    int64_t binop_x_39441 = sext_i32_i64(d_31027);
    int64_t binop_y_39442 = sext_i32_i64(n_31026);
    int64_t binop_x_39443 = binop_x_39441 * binop_y_39442;
    int64_t bytes_39440 = 4 * binop_x_39443;
    struct memblock_device mem_39444;
    
    mem_39444.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39444, bytes_39440, "mem_39444")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39444, 0,
                                              queries_mem_39422, 0, 1, d_31027,
                                              n_31026) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t binop_x_39446 = sext_i32_i64(ppl_31090);
    int64_t binop_y_39447 = sext_i32_i64(d_31022);
    int64_t binop_x_39448 = binop_x_39446 * binop_y_39447;
    int64_t binop_y_39449 = sext_i32_i64(num_leaves_31075);
    int64_t binop_x_39450 = binop_x_39448 * binop_y_39449;
    int64_t bytes_39445 = 4 * binop_x_39450;
    struct memblock_device mem_39451;
    
    mem_39451.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39451, bytes_39445, "mem_39451")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39451, 0,
                                              ref_pts_mem_39418, 0, 1,
                                              ppl_31090 * d_31022,
                                              num_leaves_31075) != 0) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39501;
    
    mem_39501.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39501, 4, "mem_39501")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39504;
    
    mem_39504.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39504, bytes_39434, "mem_39504")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39507;
    
    mem_39507.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39507, bytes_39434, "mem_39507")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39510;
    
    mem_39510.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39510, bytes_39434, "mem_39510")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_39554 = 4 * binop_x_39446;
    int32_t num_threads_40156 = segmap_group_sizze_34083 * num_groups_34084;
    int64_t num_threads64_40158 = sext_i32_i64(num_threads_40156);
    int64_t total_sizze_40159 = bytes_39554 * num_threads64_40158;
    int64_t total_sizze_40160 = 32 * num_threads64_40158;
    int64_t total_sizze_40161 = 32 * num_threads64_40158;
    int64_t num_groups64_40163 = sext_i32_i64(s_31037);
    int64_t total_sizze_40165 = 32 * num_groups64_40163;
    int64_t total_sizze_40166 = 32 * num_groups64_40163;
    int32_t num_threads_40167 = segmap_group_sizze_34442 * num_groups_34443;
    int64_t num_threads64_40169 = sext_i32_i64(num_threads_40167);
    int64_t total_sizze_40170 = bytes_39554 * num_threads64_40169;
    int64_t total_sizze_40171 = 32 * num_threads64_40169;
    int64_t total_sizze_40172 = 32 * num_threads64_40169;
    int32_t res_ixfn_40051;
    struct memblock_device res_mem_40042;
    
    res_mem_40042.references = NULL;
    
    struct memblock_device res_mem_40050;
    
    res_mem_40050.references = NULL;
    
    struct memblock_device res_mem_40055;
    
    res_mem_40055.references = NULL;
    
    struct memblock_device res_mem_40060;
    
    res_mem_40060.references = NULL;
    
    struct memblock_device res_mem_40065;
    
    res_mem_40065.references = NULL;
    
    bool res_31099;
    int32_t res_31105;
    bool loop_while_31106;
    int32_t i_31112;
    struct memblock_device mem_param_39459;
    
    mem_param_39459.references = NULL;
    
    struct memblock_device mem_param_39467;
    
    mem_param_39467.references = NULL;
    
    int32_t ctx_param_ext_39468;
    struct memblock_device mem_param_39472;
    
    mem_param_39472.references = NULL;
    
    struct memblock_device mem_param_39477;
    
    mem_param_39477.references = NULL;
    
    struct memblock_device mem_param_39482;
    
    mem_param_39482.references = NULL;
    ctx_param_ext_39468 = n_31028;
    if (memblock_set_device(ctx, &mem_param_39459, &mem_39429, "mem_39429") !=
        0)
        return 1;
    if (memblock_set_device(ctx, &mem_param_39467, &mem_39433, "mem_39433") !=
        0)
        return 1;
    if (memblock_set_device(ctx, &mem_param_39472, &nat_leaves_mem_39423,
                            "nat_leaves_mem_39423") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_param_39477, &mem_39436, "mem_39436") !=
        0)
        return 1;
    if (memblock_set_device(ctx, &mem_param_39482, &mem_39439, "mem_39439") !=
        0)
        return 1;
    loop_while_31106 = loop_cond_31097;
    i_31112 = 0;
    while (loop_while_31106) {
        struct memblock_device exactKnnFixKzicounter_mem_40349 =
                               ctx->exactKnnFixKzicounter_mem_40349;
        struct memblock_device group_res_arr_mem_40351;
        
        group_res_arr_mem_40351.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_40351,
                                  (int64_t) sizeof(int32_t) *
                                  (sext_i32_i64(segred_group_sizze_33931) *
                                   sext_i32_i64(num_groups_33933)),
                                  "group_res_arr_mem_40351")) {
            err = 1;
            goto cleanup;
        }
        
        int32_t num_threads_40353;
        
        num_threads_40353 = num_groups_33933 * segred_group_sizze_33931;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        
        unsigned int shared_sizze_41248 = (int64_t) sizeof(int32_t) *
                     sext_i32_i64(segred_group_sizze_33931);
        unsigned int shared_sizze_41250 = (int64_t) sizeof(bool);
        CUdeviceptr kernel_arg_41252 = median_dims_mem_39419.mem;
        CUdeviceptr kernel_arg_41253 = median_vals_mem_39420.mem;
        CUdeviceptr kernel_arg_41254 = prev_eqdims_mem_39421.mem;
        CUdeviceptr kernel_arg_41255 = mem_39444.mem;
        CUdeviceptr kernel_arg_41256 = mem_param_39467.mem;
        CUdeviceptr kernel_arg_41257 = mem_param_39472.mem;
        CUdeviceptr kernel_arg_41258 = mem_param_39477.mem;
        CUdeviceptr kernel_arg_41259 = mem_param_39482.mem;
        CUdeviceptr kernel_arg_41260 = mem_39501.mem;
        CUdeviceptr kernel_arg_41261 = mem_39504.mem;
        CUdeviceptr kernel_arg_41262 = mem_39507.mem;
        CUdeviceptr kernel_arg_41263 = mem_39510.mem;
        CUdeviceptr kernel_arg_41264 = exactKnnFixKzicounter_mem_40349.mem;
        CUdeviceptr kernel_arg_41265 = group_res_arr_mem_40351.mem;
        unsigned int shared_offset_41249 = 0;
        unsigned int shared_offset_41251 = 0 + (shared_sizze_41248 + (8 -
                                                                      shared_sizze_41248 %
                                                                      8) % 8);
        
        if ((((((1 && num_groups_33933 != 0) && 1 != 0) && 1 != 0) &&
              segred_group_sizze_33931 != 0) && 1 != 0) && 1 != 0) {
            int perm[3] = {0, 1, 2};
            
            if (1 >= 1 << 16) {
                perm[1] = perm[0];
                perm[0] = 1;
            }
            if (1 >= 1 << 16) {
                perm[2] = perm[0];
                perm[0] = 2;
            }
            
            size_t grid[3];
            
            grid[perm[0]] = num_groups_33933;
            grid[perm[1]] = 1;
            grid[perm[2]] = 1;
            
            void *kernel_args_41245[] = {&ctx->global_failure,
                                         &ctx->failure_is_an_option,
                                         &ctx->global_failure_args,
                                         &shared_offset_41249,
                                         &shared_offset_41251, &d_31022,
                                         &q_31023, &n_31026, &s_31037,
                                         &num_leaves_31075, &res_31079,
                                         &h_31086, &num_groups_33933,
                                         &kernel_arg_41252, &kernel_arg_41253,
                                         &kernel_arg_41254, &kernel_arg_41255,
                                         &kernel_arg_41256, &kernel_arg_41257,
                                         &kernel_arg_41258, &kernel_arg_41259,
                                         &kernel_arg_41260, &kernel_arg_41261,
                                         &kernel_arg_41262, &kernel_arg_41263,
                                         &kernel_arg_41264, &kernel_arg_41265,
                                         &num_threads_40353};
            int64_t time_start_41246 = 0, time_end_41247 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with grid size (",
                        "exactKnnFixK.segred_nonseg_33941");
                fprintf(stderr, "%d", num_groups_33933);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ") and block size (");
                fprintf(stderr, "%d", segred_group_sizze_33931);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ").\n");
                time_start_41246 = get_wall_time();
            }
            
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->exactKnnFixKzisegred_nonseg_33941_runs,
                                          &ctx->exactKnnFixKzisegred_nonseg_33941_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuLaunchKernel(ctx->exactKnnFixKzisegred_nonseg_33941,
                                        grid[0], grid[1], grid[2],
                                        segred_group_sizze_33931, 1, 1, 0 +
                                        (shared_sizze_41248 + (8 -
                                                               shared_sizze_41248 %
                                                               8) % 8) +
                                        (shared_sizze_41250 + (8 -
                                                               shared_sizze_41250 %
                                                               8) % 8), NULL,
                                        kernel_args_41245, NULL));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            if (ctx->debugging) {
                CUDA_SUCCEED(cuCtxSynchronize());
                time_end_41247 = get_wall_time();
                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                        "exactKnnFixK.segred_nonseg_33941", time_end_41247 -
                        time_start_41246);
            }
        }
        ctx->failure_is_an_option = 1;
        
        int32_t read_res_41266;
        
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_scalar_from_dev_runs,
                                          &ctx->copy_scalar_from_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpyDtoH(&read_res_41266, mem_39501.mem + 0 *
                                      sizeof(int32_t), sizeof(int32_t)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        if (futhark_context_sync(ctx) != 0)
            return 1;
        
        int32_t res_31279 = read_res_41266;
        int32_t res_31454 = res_31279;
        struct memblock_device res_mem_40005;
        
        res_mem_40005.references = NULL;
        
        struct memblock_device res_mem_40006;
        
        res_mem_40006.references = NULL;
        
        int32_t local_memory_capacity_40496;
        
        local_memory_capacity_40496 = ctx->cuda.max_shared_memory;
        if (sle64(0, sext_i32_i64(local_memory_capacity_40496)) &&
            suff_outer_par_33943) {
            struct memblock_device mem_39514;
            
            mem_39514.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39514, bytes_39426,
                                      "mem_39514")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39514, 0,
                                                      mem_param_39459, 0, 1, 8,
                                                      s_31037) != 0) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39518;
            
            mem_39518.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39518, bytes_39426,
                                      "mem_39518")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39518, 0,
                                                      mem_param_39467, 0, 1, 8,
                                                      s_31037) != 0) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39666;
            
            mem_39666.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39666, bytes_39426,
                                      "mem_39666")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39670;
            
            mem_39670.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39670, bytes_39426,
                                      "mem_39670")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39556;
            
            mem_39556.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39556, total_sizze_40159,
                                      "mem_39556")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device double_buffer_mem_40098;
            
            double_buffer_mem_40098.references = NULL;
            if (memblock_alloc_device(ctx, &double_buffer_mem_40098,
                                      total_sizze_40160,
                                      "double_buffer_mem_40098")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device double_buffer_mem_40099;
            
            double_buffer_mem_40099.references = NULL;
            if (memblock_alloc_device(ctx, &double_buffer_mem_40099,
                                      total_sizze_40161,
                                      "double_buffer_mem_40099")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegMap");
            
            CUdeviceptr kernel_arg_41270 = mem_39444.mem;
            CUdeviceptr kernel_arg_41271 = mem_39451.mem;
            CUdeviceptr kernel_arg_41272 = mem_39504.mem;
            CUdeviceptr kernel_arg_41273 = mem_39514.mem;
            CUdeviceptr kernel_arg_41274 = mem_39518.mem;
            CUdeviceptr kernel_arg_41275 = mem_39556.mem;
            CUdeviceptr kernel_arg_41276 = mem_39666.mem;
            CUdeviceptr kernel_arg_41277 = mem_39670.mem;
            CUdeviceptr kernel_arg_41278 = double_buffer_mem_40098.mem;
            CUdeviceptr kernel_arg_41279 = double_buffer_mem_40099.mem;
            
            if ((((((1 && num_groups_34084 != 0) && 1 != 0) && 1 != 0) &&
                  segmap_group_sizze_34083 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = num_groups_34084;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_41267[] = {&ctx->global_failure,
                                             &ctx->failure_is_an_option,
                                             &ctx->global_failure_args,
                                             &d_31022, &n_31026, &s_31037,
                                             &num_leaves_31075, &ppl_31090,
                                             &num_groups_34084,
                                             &kernel_arg_41270,
                                             &kernel_arg_41271,
                                             &kernel_arg_41272,
                                             &kernel_arg_41273,
                                             &kernel_arg_41274,
                                             &kernel_arg_41275,
                                             &kernel_arg_41276,
                                             &kernel_arg_41277,
                                             &kernel_arg_41278,
                                             &kernel_arg_41279};
                int64_t time_start_41268 = 0, time_end_41269 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "exactKnnFixK.segmap_33962");
                    fprintf(stderr, "%d", num_groups_34084);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segmap_group_sizze_34083);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_41268 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->exactKnnFixKzisegmap_33962_runs,
                                              &ctx->exactKnnFixKzisegmap_33962_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->exactKnnFixKzisegmap_33962,
                                            grid[0], grid[1], grid[2],
                                            segmap_group_sizze_34083, 1, 1, 0,
                                            NULL, kernel_args_41267, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_41269 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "exactKnnFixK.segmap_33962", time_end_41269 -
                            time_start_41268);
                }
            }
            ctx->failure_is_an_option = 1;
            if (memblock_unref_device(ctx, &mem_39514, "mem_39514") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39518, "mem_39518") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39556, "mem_39556") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40098,
                                      "double_buffer_mem_40098") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40099,
                                      "double_buffer_mem_40099") != 0)
                return 1;
            
            struct memblock_device mem_39998;
            
            mem_39998.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39998, bytes_39426,
                                      "mem_39998")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39998, 0,
                                                      mem_39666, 0, 1, s_31037,
                                                      8) != 0) {
                err = 1;
                goto cleanup;
            }
            if (memblock_unref_device(ctx, &mem_39666, "mem_39666") != 0)
                return 1;
            
            struct memblock_device mem_40003;
            
            mem_40003.references = NULL;
            if (memblock_alloc_device(ctx, &mem_40003, bytes_39426,
                                      "mem_40003")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_40003, 0,
                                                      mem_39670, 0, 1, s_31037,
                                                      8) != 0) {
                err = 1;
                goto cleanup;
            }
            if (memblock_unref_device(ctx, &mem_39670, "mem_39670") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_40005, &mem_39998,
                                    "mem_39998") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_40006, &mem_40003,
                                    "mem_40003") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_40003, "mem_40003") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39998, "mem_39998") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40099,
                                      "double_buffer_mem_40099") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40098,
                                      "double_buffer_mem_40098") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39556, "mem_39556") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39670, "mem_39670") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39666, "mem_39666") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39518, "mem_39518") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39514, "mem_39514") != 0)
                return 1;
        } else {
            struct memblock_device res_mem_39993;
            
            res_mem_39993.references = NULL;
            
            struct memblock_device res_mem_39994;
            
            res_mem_39994.references = NULL;
            
            int32_t local_memory_capacity_40495;
            
            local_memory_capacity_40495 = ctx->cuda.max_shared_memory;
            if (sle64(64 + bytes_39554 + 32 + 32 + (int64_t) sizeof(int32_t) *
                      sext_i32_i64(ppl_31090) + (int64_t) sizeof(float) *
                      sext_i32_i64(ppl_31090),
                      sext_i32_i64(local_memory_capacity_40495)) &&
                intra_suff_and_fits_34203) {
                struct memblock_device mem_39674;
                
                mem_39674.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39674, bytes_39426,
                                          "mem_39674")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39674, 0,
                                                          mem_param_39459, 0, 1,
                                                          8, s_31037) != 0) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39678;
                
                mem_39678.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39678, bytes_39426,
                                          "mem_39678")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39678, 0,
                                                          mem_param_39467, 0, 1,
                                                          8, s_31037) != 0) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39818;
                
                mem_39818.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39818, bytes_39426,
                                          "mem_39818")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39822;
                
                mem_39822.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39822, bytes_39426,
                                          "mem_39822")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device double_buffer_mem_40104;
                
                double_buffer_mem_40104.references = NULL;
                if (memblock_alloc_device(ctx, &double_buffer_mem_40104,
                                          total_sizze_40165,
                                          "double_buffer_mem_40104")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device double_buffer_mem_40105;
                
                double_buffer_mem_40105.references = NULL;
                if (memblock_alloc_device(ctx, &double_buffer_mem_40105,
                                          total_sizze_40166,
                                          "double_buffer_mem_40105")) {
                    err = 1;
                    goto cleanup;
                }
                
                unsigned int shared_sizze_41283 = (int64_t) sizeof(float) *
                             sext_i32_i64(ppl_31090);
                unsigned int shared_sizze_41285 = (int64_t) sizeof(int32_t) *
                             sext_i32_i64(ppl_31090);
                unsigned int shared_sizze_41287 = 32;
                unsigned int shared_sizze_41289 = 32;
                unsigned int shared_sizze_41291 = bytes_39554;
                unsigned int shared_sizze_41293 = 32;
                unsigned int shared_sizze_41295 = 32;
                CUdeviceptr kernel_arg_41297 = ref_pts_mem_39418.mem;
                CUdeviceptr kernel_arg_41298 = mem_39444.mem;
                CUdeviceptr kernel_arg_41299 = mem_39504.mem;
                CUdeviceptr kernel_arg_41300 = mem_39674.mem;
                CUdeviceptr kernel_arg_41301 = mem_39678.mem;
                CUdeviceptr kernel_arg_41302 = mem_39818.mem;
                CUdeviceptr kernel_arg_41303 = mem_39822.mem;
                CUdeviceptr kernel_arg_41304 = double_buffer_mem_40104.mem;
                CUdeviceptr kernel_arg_41305 = double_buffer_mem_40105.mem;
                unsigned int shared_offset_41284 = 0;
                unsigned int shared_offset_41286 = 0 + (shared_sizze_41283 +
                                                        (8 -
                                                         shared_sizze_41283 %
                                                         8) % 8);
                unsigned int shared_offset_41288 = 0 + (shared_sizze_41283 +
                                                        (8 -
                                                         shared_sizze_41283 %
                                                         8) % 8) +
                             (shared_sizze_41285 + (8 - shared_sizze_41285 %
                                                    8) % 8);
                unsigned int shared_offset_41290 = 0 + (shared_sizze_41283 +
                                                        (8 -
                                                         shared_sizze_41283 %
                                                         8) % 8) +
                             (shared_sizze_41285 + (8 - shared_sizze_41285 %
                                                    8) % 8) +
                             (shared_sizze_41287 + (8 - shared_sizze_41287 %
                                                    8) % 8);
                unsigned int shared_offset_41292 = 0 + (shared_sizze_41283 +
                                                        (8 -
                                                         shared_sizze_41283 %
                                                         8) % 8) +
                             (shared_sizze_41285 + (8 - shared_sizze_41285 %
                                                    8) % 8) +
                             (shared_sizze_41287 + (8 - shared_sizze_41287 %
                                                    8) % 8) +
                             (shared_sizze_41289 + (8 - shared_sizze_41289 %
                                                    8) % 8);
                unsigned int shared_offset_41294 = 0 + (shared_sizze_41283 +
                                                        (8 -
                                                         shared_sizze_41283 %
                                                         8) % 8) +
                             (shared_sizze_41285 + (8 - shared_sizze_41285 %
                                                    8) % 8) +
                             (shared_sizze_41287 + (8 - shared_sizze_41287 %
                                                    8) % 8) +
                             (shared_sizze_41289 + (8 - shared_sizze_41289 %
                                                    8) % 8) +
                             (shared_sizze_41291 + (8 - shared_sizze_41291 %
                                                    8) % 8);
                unsigned int shared_offset_41296 = 0 + (shared_sizze_41283 +
                                                        (8 -
                                                         shared_sizze_41283 %
                                                         8) % 8) +
                             (shared_sizze_41285 + (8 - shared_sizze_41285 %
                                                    8) % 8) +
                             (shared_sizze_41287 + (8 - shared_sizze_41287 %
                                                    8) % 8) +
                             (shared_sizze_41289 + (8 - shared_sizze_41289 %
                                                    8) % 8) +
                             (shared_sizze_41291 + (8 - shared_sizze_41291 %
                                                    8) % 8) +
                             (shared_sizze_41293 + (8 - shared_sizze_41293 %
                                                    8) % 8);
                
                if ((((((1 && s_31037 != 0) && 1 != 0) && 1 != 0) &&
                      ppl_31090 != 0) && 1 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = s_31037;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41280[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &shared_offset_41284,
                                                 &shared_offset_41286,
                                                 &shared_offset_41288,
                                                 &shared_offset_41290,
                                                 &shared_offset_41292,
                                                 &shared_offset_41294,
                                                 &shared_offset_41296, &d_31022,
                                                 &n_31026, &s_31037,
                                                 &num_leaves_31075, &ppl_31090,
                                                 &kernel_arg_41297,
                                                 &kernel_arg_41298,
                                                 &kernel_arg_41299,
                                                 &kernel_arg_41300,
                                                 &kernel_arg_41301,
                                                 &kernel_arg_41302,
                                                 &kernel_arg_41303,
                                                 &kernel_arg_41304,
                                                 &kernel_arg_41305};
                    int64_t time_start_41281 = 0, time_end_41282 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "exactKnnFixK.segmap_intragroup_33960");
                        fprintf(stderr, "%d", s_31037);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", ppl_31090);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41281 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->exactKnnFixKzisegmap_intragroup_33960_runs,
                                                  &ctx->exactKnnFixKzisegmap_intragroup_33960_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->exactKnnFixKzisegmap_intragroup_33960,
                                                grid[0], grid[1], grid[2],
                                                ppl_31090, 1, 1, 0 +
                                                (shared_sizze_41283 + (8 -
                                                                       shared_sizze_41283 %
                                                                       8) % 8) +
                                                (shared_sizze_41285 + (8 -
                                                                       shared_sizze_41285 %
                                                                       8) % 8) +
                                                (shared_sizze_41287 + (8 -
                                                                       shared_sizze_41287 %
                                                                       8) % 8) +
                                                (shared_sizze_41289 + (8 -
                                                                       shared_sizze_41289 %
                                                                       8) % 8) +
                                                (shared_sizze_41291 + (8 -
                                                                       shared_sizze_41291 %
                                                                       8) % 8) +
                                                (shared_sizze_41293 + (8 -
                                                                       shared_sizze_41293 %
                                                                       8) % 8) +
                                                (shared_sizze_41295 + (8 -
                                                                       shared_sizze_41295 %
                                                                       8) % 8),
                                                NULL, kernel_args_41280, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41282 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "exactKnnFixK.segmap_intragroup_33960",
                                time_end_41282 - time_start_41281);
                    }
                }
                ctx->failure_is_an_option = 1;
                if (memblock_unref_device(ctx, &mem_39674, "mem_39674") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39678, "mem_39678") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40104,
                                          "double_buffer_mem_40104") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40105,
                                          "double_buffer_mem_40105") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39993, &mem_39818,
                                        "mem_39818") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39994, &mem_39822,
                                        "mem_39822") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40105,
                                          "double_buffer_mem_40105") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40104,
                                          "double_buffer_mem_40104") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39822, "mem_39822") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39818, "mem_39818") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39678, "mem_39678") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39674, "mem_39674") != 0)
                    return 1;
            } else {
                struct memblock_device mem_39826;
                
                mem_39826.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39826, bytes_39426,
                                          "mem_39826")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39826, 0,
                                                          mem_param_39459, 0, 1,
                                                          8, s_31037) != 0) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39830;
                
                mem_39830.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39830, bytes_39426,
                                          "mem_39830")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39830, 0,
                                                          mem_param_39467, 0, 1,
                                                          8, s_31037) != 0) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39978;
                
                mem_39978.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39978, bytes_39426,
                                          "mem_39978")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39982;
                
                mem_39982.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39982, bytes_39426,
                                          "mem_39982")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39868;
                
                mem_39868.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39868, total_sizze_40170,
                                          "mem_39868")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device double_buffer_mem_40110;
                
                double_buffer_mem_40110.references = NULL;
                if (memblock_alloc_device(ctx, &double_buffer_mem_40110,
                                          total_sizze_40171,
                                          "double_buffer_mem_40110")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device double_buffer_mem_40111;
                
                double_buffer_mem_40111.references = NULL;
                if (memblock_alloc_device(ctx, &double_buffer_mem_40111,
                                          total_sizze_40172,
                                          "double_buffer_mem_40111")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                
                CUdeviceptr kernel_arg_41309 = mem_39444.mem;
                CUdeviceptr kernel_arg_41310 = mem_39451.mem;
                CUdeviceptr kernel_arg_41311 = mem_39504.mem;
                CUdeviceptr kernel_arg_41312 = mem_39826.mem;
                CUdeviceptr kernel_arg_41313 = mem_39830.mem;
                CUdeviceptr kernel_arg_41314 = mem_39868.mem;
                CUdeviceptr kernel_arg_41315 = mem_39978.mem;
                CUdeviceptr kernel_arg_41316 = mem_39982.mem;
                CUdeviceptr kernel_arg_41317 = double_buffer_mem_40110.mem;
                CUdeviceptr kernel_arg_41318 = double_buffer_mem_40111.mem;
                
                if ((((((1 && num_groups_34443 != 0) && 1 != 0) && 1 != 0) &&
                      segmap_group_sizze_34442 != 0) && 1 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = num_groups_34443;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41306[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &d_31022, &n_31026, &s_31037,
                                                 &num_leaves_31075, &ppl_31090,
                                                 &num_groups_34443,
                                                 &kernel_arg_41309,
                                                 &kernel_arg_41310,
                                                 &kernel_arg_41311,
                                                 &kernel_arg_41312,
                                                 &kernel_arg_41313,
                                                 &kernel_arg_41314,
                                                 &kernel_arg_41315,
                                                 &kernel_arg_41316,
                                                 &kernel_arg_41317,
                                                 &kernel_arg_41318};
                    int64_t time_start_41307 = 0, time_end_41308 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "exactKnnFixK.segmap_34321");
                        fprintf(stderr, "%d", num_groups_34443);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", segmap_group_sizze_34442);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41307 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->exactKnnFixKzisegmap_34321_runs,
                                                  &ctx->exactKnnFixKzisegmap_34321_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->exactKnnFixKzisegmap_34321,
                                                grid[0], grid[1], grid[2],
                                                segmap_group_sizze_34442, 1, 1,
                                                0, NULL, kernel_args_41306,
                                                NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41308 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "exactKnnFixK.segmap_34321", time_end_41308 -
                                time_start_41307);
                    }
                }
                ctx->failure_is_an_option = 1;
                if (memblock_unref_device(ctx, &mem_39826, "mem_39826") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39830, "mem_39830") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39868, "mem_39868") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40110,
                                          "double_buffer_mem_40110") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40111,
                                          "double_buffer_mem_40111") != 0)
                    return 1;
                
                struct memblock_device mem_39986;
                
                mem_39986.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39986, bytes_39426,
                                          "mem_39986")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39986, 0,
                                                          mem_39978, 0, 1,
                                                          s_31037, 8) != 0) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_unref_device(ctx, &mem_39978, "mem_39978") != 0)
                    return 1;
                
                struct memblock_device mem_39991;
                
                mem_39991.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39991, bytes_39426,
                                          "mem_39991")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39991, 0,
                                                          mem_39982, 0, 1,
                                                          s_31037, 8) != 0) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_unref_device(ctx, &mem_39982, "mem_39982") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39993, &mem_39986,
                                        "mem_39986") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39994, &mem_39991,
                                        "mem_39991") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39991, "mem_39991") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39986, "mem_39986") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40111,
                                          "double_buffer_mem_40111") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40110,
                                          "double_buffer_mem_40110") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39868, "mem_39868") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39982, "mem_39982") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39978, "mem_39978") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39830, "mem_39830") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39826, "mem_39826") != 0)
                    return 1;
            }
            if (memblock_set_device(ctx, &res_mem_40005, &res_mem_39993,
                                    "res_mem_39993") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_40006, &res_mem_39994,
                                    "res_mem_39994") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39994, "res_mem_39994") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39993, "res_mem_39993") !=
                0)
                return 1;
        }
        
        int32_t loopres_31570 = add32(1, i_31112);
        bool loop_cond_31571 = slt32(0, res_31454);
        struct memblock_device mem_40019;
        
        mem_40019.references = NULL;
        if (memblock_alloc_device(ctx, &mem_40019, bytes_39434, "mem_40019")) {
            err = 1;
            goto cleanup;
        }
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_dev_to_dev_runs,
                                          &ctx->copy_dev_to_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpy(mem_40019.mem + 0, mem_39504.mem + 0,
                                  sext_i32_i64(s_31037) *
                                  (int64_t) sizeof(int32_t)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        
        struct memblock_device mem_40025;
        
        mem_40025.references = NULL;
        if (memblock_alloc_device(ctx, &mem_40025, bytes_39434, "mem_40025")) {
            err = 1;
            goto cleanup;
        }
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_dev_to_dev_runs,
                                          &ctx->copy_dev_to_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpy(mem_40025.mem + 0, mem_39507.mem + 0,
                                  sext_i32_i64(s_31037) *
                                  (int64_t) sizeof(int32_t)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        
        struct memblock_device mem_40031;
        
        mem_40031.references = NULL;
        if (memblock_alloc_device(ctx, &mem_40031, bytes_39434, "mem_40031")) {
            err = 1;
            goto cleanup;
        }
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_dev_to_dev_runs,
                                          &ctx->copy_dev_to_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpy(mem_40031.mem + 0, mem_39510.mem + 0,
                                  sext_i32_i64(s_31037) *
                                  (int64_t) sizeof(float)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        
        int32_t ctx_param_ext_tmp_40336 = s_31037;
        struct memblock_device mem_param_tmp_40337;
        
        mem_param_tmp_40337.references = NULL;
        if (memblock_set_device(ctx, &mem_param_tmp_40337, &res_mem_40005,
                                "res_mem_40005") != 0)
            return 1;
        
        struct memblock_device mem_param_tmp_40338;
        
        mem_param_tmp_40338.references = NULL;
        if (memblock_set_device(ctx, &mem_param_tmp_40338, &res_mem_40006,
                                "res_mem_40006") != 0)
            return 1;
        
        struct memblock_device mem_param_tmp_40339;
        
        mem_param_tmp_40339.references = NULL;
        if (memblock_set_device(ctx, &mem_param_tmp_40339, &mem_40019,
                                "mem_40019") != 0)
            return 1;
        
        struct memblock_device mem_param_tmp_40340;
        
        mem_param_tmp_40340.references = NULL;
        if (memblock_set_device(ctx, &mem_param_tmp_40340, &mem_40025,
                                "mem_40025") != 0)
            return 1;
        
        struct memblock_device mem_param_tmp_40341;
        
        mem_param_tmp_40341.references = NULL;
        if (memblock_set_device(ctx, &mem_param_tmp_40341, &mem_40031,
                                "mem_40031") != 0)
            return 1;
        
        bool loop_while_tmp_40342;
        
        loop_while_tmp_40342 = loop_cond_31571;
        
        int32_t i_tmp_40348;
        
        i_tmp_40348 = loopres_31570;
        ctx_param_ext_39468 = ctx_param_ext_tmp_40336;
        if (memblock_set_device(ctx, &mem_param_39459, &mem_param_tmp_40337,
                                "mem_param_tmp_40337") != 0)
            return 1;
        if (memblock_set_device(ctx, &mem_param_39467, &mem_param_tmp_40338,
                                "mem_param_tmp_40338") != 0)
            return 1;
        if (memblock_set_device(ctx, &mem_param_39472, &mem_param_tmp_40339,
                                "mem_param_tmp_40339") != 0)
            return 1;
        if (memblock_set_device(ctx, &mem_param_39477, &mem_param_tmp_40340,
                                "mem_param_tmp_40340") != 0)
            return 1;
        if (memblock_set_device(ctx, &mem_param_39482, &mem_param_tmp_40341,
                                "mem_param_tmp_40341") != 0)
            return 1;
        loop_while_31106 = loop_while_tmp_40342;
        i_31112 = i_tmp_40348;
        if (memblock_unref_device(ctx, &mem_param_tmp_40341,
                                  "mem_param_tmp_40341") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_40340,
                                  "mem_param_tmp_40340") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_40339,
                                  "mem_param_tmp_40339") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_40338,
                                  "mem_param_tmp_40338") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_40337,
                                  "mem_param_tmp_40337") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_40031, "mem_40031") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_40025, "mem_40025") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_40019, "mem_40019") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_40006, "res_mem_40006") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_40005, "res_mem_40005") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_40351,
                                  "group_res_arr_mem_40351") != 0)
            return 1;
    }
    res_ixfn_40051 = ctx_param_ext_39468;
    if (memblock_set_device(ctx, &res_mem_40042, &mem_param_39459,
                            "mem_param_39459") != 0)
        return 1;
    if (memblock_set_device(ctx, &res_mem_40050, &mem_param_39467,
                            "mem_param_39467") != 0)
        return 1;
    if (memblock_set_device(ctx, &res_mem_40055, &mem_param_39472,
                            "mem_param_39472") != 0)
        return 1;
    if (memblock_set_device(ctx, &res_mem_40060, &mem_param_39477,
                            "mem_param_39477") != 0)
        return 1;
    if (memblock_set_device(ctx, &res_mem_40065, &mem_param_39482,
                            "mem_param_39482") != 0)
        return 1;
    res_31099 = loop_while_31106;
    res_31105 = i_31112;
    if (memblock_unref_device(ctx, &mem_39429, "mem_39429") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39433, "mem_39433") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39436, "mem_39436") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39439, "mem_39439") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39444, "mem_39444") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39451, "mem_39451") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39501, "mem_39501") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39504, "mem_39504") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39507, "mem_39507") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39510, "mem_39510") != 0)
        return 1;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(knn_is_mem_39424.mem + 0, res_mem_40042.mem + 0,
                              sext_i32_i64(s_31037 * 8) *
                              (int64_t) sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    if (memblock_unref_device(ctx, &res_mem_40042, "res_mem_40042") != 0)
        return 1;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(knn_vs_mem_39425.mem + 0, res_mem_40050.mem + 0,
                              sext_i32_i64(s_31037 * 8) *
                              (int64_t) sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    if (memblock_unref_device(ctx, &res_mem_40050, "res_mem_40050") != 0)
        return 1;
    
    int64_t binop_x_40068 = 8 * binop_y_39442;
    int64_t bytes_40066 = 4 * binop_x_40068;
    struct memblock_device mem_40069;
    
    mem_40069.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40069, bytes_40066, "mem_40069")) {
        err = 1;
        goto cleanup;
    }
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_40069.mem + 0, knn_is_mem_39424.mem + 0,
                              sext_i32_i64(n_31026 * 8) *
                              (int64_t) sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    
    struct memblock_device mem_40074;
    
    mem_40074.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40074, bytes_40066, "mem_40074")) {
        err = 1;
        goto cleanup;
    }
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_40074.mem + 0, knn_vs_mem_39425.mem + 0,
                              sext_i32_i64(n_31026 * 8) *
                              (int64_t) sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    out_arrsizze_40296 = n_31026;
    out_arrsizze_40297 = 8;
    out_arrsizze_40299 = n_31026;
    out_arrsizze_40300 = 8;
    if (memblock_set_device(ctx, &out_mem_40295, &mem_40069, "mem_40069") != 0)
        return 1;
    if (memblock_set_device(ctx, &out_mem_40298, &mem_40074, "mem_40074") != 0)
        return 1;
    scalar_out_40301 = res_31105;
    (*out_mem_p_41227).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41227, &out_mem_40295,
                            "out_mem_40295") != 0)
        return 1;
    *out_out_arrsizze_41228 = out_arrsizze_40296;
    *out_out_arrsizze_41229 = out_arrsizze_40297;
    (*out_mem_p_41230).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41230, &out_mem_40298,
                            "out_mem_40298") != 0)
        return 1;
    *out_out_arrsizze_41231 = out_arrsizze_40299;
    *out_out_arrsizze_41232 = out_arrsizze_40300;
    *out_scalar_out_41233 = scalar_out_40301;
    if (memblock_unref_device(ctx, &mem_40074, "mem_40074") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_40069, "mem_40069") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_param_39482, "mem_param_39482") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_param_39477, "mem_param_39477") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_param_39472, "mem_param_39472") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_param_39467, "mem_param_39467") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_param_39459, "mem_param_39459") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_40065, "res_mem_40065") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_40060, "res_mem_40060") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_40055, "res_mem_40055") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_40050, "res_mem_40050") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_40042, "res_mem_40042") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39510, "mem_39510") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39507, "mem_39507") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39504, "mem_39504") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39501, "mem_39501") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39451, "mem_39451") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39444, "mem_39444") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39439, "mem_39439") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39436, "mem_39436") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39433, "mem_39433") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39429, "mem_39429") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
static int futrts_findNaturalLeavesFixK(struct futhark_context *ctx,
                                        struct memblock_device *out_mem_p_41319,
                                        int32_t *out_out_arrsizze_41320,
                                        int32_t *out_out_arrsizze_41321,
                                        struct memblock_device *out_mem_p_41322,
                                        int32_t *out_out_arrsizze_41323,
                                        int32_t *out_out_arrsizze_41324,
                                        struct memblock_device *out_mem_p_41325,
                                        int32_t *out_out_arrsizze_41326,
                                        struct memblock_device ref_pts_mem_39418,
                                        struct memblock_device median_dims_mem_39419,
                                        struct memblock_device median_vals_mem_39420,
                                        struct memblock_device queries_mem_39421,
                                        int32_t m_31862, int32_t d_31863,
                                        int32_t q_31864, int32_t q_31865,
                                        int32_t n_31866, int32_t d_31867)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    int32_t out_arrsizze_40297;
    struct memblock_device out_mem_40298;
    
    out_mem_40298.references = NULL;
    
    int32_t out_arrsizze_40299;
    int32_t out_arrsizze_40300;
    struct memblock_device out_mem_40301;
    
    out_mem_40301.references = NULL;
    
    int32_t out_arrsizze_40302;
    bool dim_match_31872 = q_31864 == q_31865;
    bool empty_or_match_cert_31873;
    
    if (!dim_match_31872) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:173:1-179:62\n");
        if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31874 = d_31863 == d_31867;
    bool empty_or_match_cert_31875;
    
    if (!dim_match_31874) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:173:1-179:62\n");
        if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int32_t num_leaves_31877 = add32(1, q_31864);
    bool loop_cond_31878 = slt32(1, num_leaves_31877);
    bool res_31879;
    int32_t res_31880;
    int32_t res_31881;
    bool loop_while_31882;
    int32_t y_31883;
    int32_t c_31884;
    
    loop_while_31882 = loop_cond_31878;
    y_31883 = num_leaves_31877;
    c_31884 = 0;
    while (loop_while_31882) {
        int32_t loopres_31885 = ashr32(y_31883, 1);
        int32_t loopres_31886 = add32(1, c_31884);
        bool loop_cond_31887 = slt32(1, loopres_31885);
        bool loop_while_tmp_40303 = loop_cond_31887;
        int32_t y_tmp_40304 = loopres_31885;
        int32_t c_tmp_40305 = loopres_31886;
        
        loop_while_31882 = loop_while_tmp_40303;
        y_31883 = y_tmp_40304;
        c_31884 = c_tmp_40305;
    }
    res_31879 = loop_while_31882;
    res_31880 = y_31883;
    res_31881 = c_31884;
    
    bool zzero_31888 = num_leaves_31877 == 0;
    bool nonzzero_31889 = !zzero_31888;
    bool nonzzero_cert_31890;
    
    if (!nonzzero_31889) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "division by zero",
                               "-> #0  driverKNN.fut:22:13-26\n   #1  driverKNN.fut:159:30-45\n   #2  driverKNN.fut:179:3-62\n   #3  driverKNN.fut:173:1-179:62\n");
        if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int32_t ppl_31891 = sdiv32(m_31862, num_leaves_31877);
    int32_t x_31892 = num_leaves_31877 * ppl_31891;
    bool dim_ok_31893 = x_31892 == m_31862;
    bool dim_ok_cert_31894;
    
    if (!dim_ok_31893) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "new shape has different number of elements than old shape",
                               "-> #0  /prelude/array.fut:95:3-33\n   #1  driverKNN.fut:160:16-47\n   #2  driverKNN.fut:179:3-62\n   #3  driverKNN.fut:173:1-179:62\n");
        if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int32_t x_31896 = 1 << res_31881;
    int32_t y_31897 = sub32(x_31896, 1);
    bool res_31898 = sle32(y_31897, 0);
    bool loop_cond_31899 = !res_31898;
    int64_t n_35756 = sext_i32_i64(n_31866);
    int32_t segmap_group_sizze_35758;
    
    segmap_group_sizze_35758 =
        ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_35725;
    
    int64_t segmap_group_sizze_35759 = sext_i32_i64(segmap_group_sizze_35758);
    int64_t segmap_usable_groups_64_35760 = sdiv_up64(n_35756,
                                                      segmap_group_sizze_35759);
    int32_t segmap_usable_groups_35761 =
            sext_i64_i32(segmap_usable_groups_64_35760);
    int64_t binop_x_39423 = sext_i32_i64(d_31867);
    int64_t binop_x_39425 = n_35756 * binop_x_39423;
    int64_t bytes_39422 = 4 * binop_x_39425;
    struct memblock_device mem_39426;
    
    mem_39426.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39426, bytes_39422, "mem_39426")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39426, 0,
                                              queries_mem_39421, 0, 1, d_31867,
                                              n_31866) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_39428 = 4 * n_35756;
    struct memblock_device mem_39430;
    
    mem_39430.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39430, bytes_39428, "mem_39430")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    
    CUdeviceptr kernel_arg_41330 = median_dims_mem_39419.mem;
    CUdeviceptr kernel_arg_41331 = median_vals_mem_39420.mem;
    CUdeviceptr kernel_arg_41332 = mem_39426.mem;
    CUdeviceptr kernel_arg_41333 = mem_39430.mem;
    
    if ((((((1 && segmap_usable_groups_35761 != 0) && 1 != 0) && 1 != 0) &&
          segmap_group_sizze_35758 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = segmap_usable_groups_35761;
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41327[] = {&ctx->global_failure,
                                     &ctx->failure_is_an_option,
                                     &ctx->global_failure_args, &d_31863,
                                     &q_31864, &n_31866, &y_31897,
                                     &loop_cond_31899, &kernel_arg_41330,
                                     &kernel_arg_41331, &kernel_arg_41332,
                                     &kernel_arg_41333};
        int64_t time_start_41328 = 0, time_end_41329 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "findNaturalLeavesFixK.segmap_35722");
            fprintf(stderr, "%d", segmap_usable_groups_35761);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", segmap_group_sizze_35758);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41328 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->findNaturalLeavesFixKzisegmap_35722_runs,
                                      &ctx->findNaturalLeavesFixKzisegmap_35722_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->findNaturalLeavesFixKzisegmap_35722,
                                    grid[0], grid[1], grid[2],
                                    segmap_group_sizze_35758, 1, 1, 0, NULL,
                                    kernel_args_41327, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41329 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "findNaturalLeavesFixK.segmap_35722", time_end_41329 -
                    time_start_41328);
        }
    }
    ctx->failure_is_an_option = 1;
    if (memblock_unref_device(ctx, &mem_39426, "mem_39426") != 0)
        return 1;
    
    struct memblock_device mem_39433;
    
    mem_39433.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39433, bytes_39428, "mem_39433")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhiota_i32(ctx, mem_39433, n_31866, 0, 1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    bool cond_31928 = n_31866 == 0;
    int32_t iters_31929;
    
    if (cond_31928) {
        iters_31929 = 0;
    } else {
        int32_t x_31930 = add32(2, res_31881);
        int32_t x_31931 = sub32(x_31930, 1);
        int32_t res_31932 = sdiv32(x_31931, 2);
        
        iters_31929 = res_31932;
    }
    
    bool loop_nonempty_31933 = slt32(0, iters_31929);
    int32_t i_31934 = sub32(n_31866, 1);
    bool x_31935 = sle32(0, i_31934);
    bool y_31936 = slt32(i_31934, n_31866);
    bool bounds_check_31937 = x_31935 && y_31936;
    bool loop_not_taken_31938 = !loop_nonempty_31933;
    bool protect_assert_disj_31939 = bounds_check_31937 || loop_not_taken_31938;
    bool index_certs_31940;
    
    if (!protect_assert_disj_31939) {
        ctx->error = msgprintf("Error: %s%d%s%d%s\n\nBacktrace:\n%s", "Index [",
                               i_31934, "] out of bounds for array of shape [",
                               n_31866, "].",
                               "-> #0  /prelude/array.fut:18:29-34\n   #1  lib/github.com/diku-dk/sorts/radix_sort.fut:25:24-35\n   #2  lib/github.com/diku-dk/sorts/radix_sort.fut:53:31-62\n   #3  /prelude/functional.fut:9:42-44\n   #4  lib/github.com/diku-dk/sorts/radix_sort.fut:59:3-61:47\n   #5  lib/github.com/diku-dk/sorts/radix_sort.fut:68:3-51\n   #6  driverKNN.fut:8:12-85\n   #7  driverKNN.fut:163:36-79\n   #8  driverKNN.fut:179:3-62\n   #9  driverKNN.fut:173:1-179:62\n");
        if (memblock_unref_device(ctx, &mem_39433, "mem_39433") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39430, "mem_39430") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39426, "mem_39426") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int32_t segscan_group_sizze_35792;
    
    segscan_group_sizze_35792 =
        ctx->sizes.findNaturalLeavesFixKzisegscan_group_sizze_35791;
    
    int32_t num_groups_35794;
    int32_t max_num_groups_40323;
    
    max_num_groups_40323 =
        ctx->sizes.findNaturalLeavesFixKzisegscan_num_groups_35793;
    num_groups_35794 = sext_i64_i32(smax64(1, smin64(sdiv_up64(n_35756,
                                                               sext_i32_i64(segscan_group_sizze_35792)),
                                                     sext_i32_i64(max_num_groups_40323))));
    
    int32_t segmap_group_sizze_35803;
    
    segmap_group_sizze_35803 =
        ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_35802;
    
    int64_t segmap_group_sizze_35804 = sext_i32_i64(segmap_group_sizze_35803);
    int64_t segmap_usable_groups_64_35805 = sdiv_up_safe64(n_35756,
                                                           segmap_group_sizze_35804);
    int32_t segmap_usable_groups_35806 =
            sext_i64_i32(segmap_usable_groups_64_35805);
    struct memblock_device mem_39451;
    
    mem_39451.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39451, bytes_39428, "mem_39451")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39454;
    
    mem_39454.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39454, bytes_39428, "mem_39454")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39457;
    
    mem_39457.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39457, bytes_39428, "mem_39457")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39460;
    
    mem_39460.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39460, bytes_39428, "mem_39460")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39463;
    
    mem_39463.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39463, bytes_39428, "mem_39463")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device res_mem_39479;
    
    res_mem_39479.references = NULL;
    
    struct memblock_device res_mem_39484;
    
    res_mem_39484.references = NULL;
    
    struct memblock_device mem_param_39438;
    
    mem_param_39438.references = NULL;
    
    struct memblock_device mem_param_39443;
    
    mem_param_39443.references = NULL;
    if (memblock_set_device(ctx, &mem_param_39438, &mem_39430, "mem_39430") !=
        0)
        return 1;
    if (memblock_set_device(ctx, &mem_param_39443, &mem_39433, "mem_39433") !=
        0)
        return 1;
    for (int32_t i_31943 = 0; i_31943 < iters_31929; i_31943++) {
        int32_t lifted_2_radix_sort_step_arg_31946 = mul32(2, i_31943);
        int32_t lifted_0_get_bit_arg_31947 = add32(1,
                                                   lifted_2_radix_sort_step_arg_31946);
        
        if (slt32(0, n_31866)) {
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegScan");
            
            int32_t stage1_max_num_groups_40328;
            
            stage1_max_num_groups_40328 = ctx->cuda.max_block_size;
            
            int32_t stage1_num_groups_40329;
            
            stage1_num_groups_40329 = smin32(stage1_max_num_groups_40328,
                                             num_groups_35794);
            
            int32_t num_threads_40330;
            
            num_threads_40330 = stage1_num_groups_40329 *
                segscan_group_sizze_35792;
            
            unsigned int shared_sizze_41337 = smax64(1,
                                                     (int64_t) sizeof(int32_t) *
                                                     sext_i32_i64(segscan_group_sizze_35792));
            unsigned int shared_sizze_41339 = smax64(1,
                                                     (int64_t) sizeof(int32_t) *
                                                     sext_i32_i64(segscan_group_sizze_35792));
            unsigned int shared_sizze_41341 = smax64(1,
                                                     (int64_t) sizeof(int32_t) *
                                                     sext_i32_i64(segscan_group_sizze_35792));
            unsigned int shared_sizze_41343 = smax64(1,
                                                     (int64_t) sizeof(int32_t) *
                                                     sext_i32_i64(segscan_group_sizze_35792));
            CUdeviceptr kernel_arg_41345 = mem_param_39438.mem;
            CUdeviceptr kernel_arg_41346 = mem_39451.mem;
            CUdeviceptr kernel_arg_41347 = mem_39454.mem;
            CUdeviceptr kernel_arg_41348 = mem_39457.mem;
            CUdeviceptr kernel_arg_41349 = mem_39460.mem;
            CUdeviceptr kernel_arg_41350 = mem_39463.mem;
            unsigned int shared_offset_41338 = 0;
            unsigned int shared_offset_41340 = 0 + (shared_sizze_41337 + (8 -
                                                                          shared_sizze_41337 %
                                                                          8) %
                                                    8);
            unsigned int shared_offset_41342 = 0 + (shared_sizze_41337 + (8 -
                                                                          shared_sizze_41337 %
                                                                          8) %
                                                    8) + (shared_sizze_41339 +
                                                          (8 -
                                                           shared_sizze_41339 %
                                                           8) % 8);
            unsigned int shared_offset_41344 = 0 + (shared_sizze_41337 + (8 -
                                                                          shared_sizze_41337 %
                                                                          8) %
                                                    8) + (shared_sizze_41339 +
                                                          (8 -
                                                           shared_sizze_41339 %
                                                           8) % 8) +
                         (shared_sizze_41341 + (8 - shared_sizze_41341 % 8) %
                          8);
            
            if ((((((1 && stage1_num_groups_40329 != 0) && 1 != 0) && 1 != 0) &&
                  segscan_group_sizze_35792 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = stage1_num_groups_40329;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_41334[] = {&ctx->global_failure,
                                             &shared_offset_41338,
                                             &shared_offset_41340,
                                             &shared_offset_41342,
                                             &shared_offset_41344, &n_31866,
                                             &lifted_2_radix_sort_step_arg_31946,
                                             &lifted_0_get_bit_arg_31947,
                                             &kernel_arg_41345,
                                             &kernel_arg_41346,
                                             &kernel_arg_41347,
                                             &kernel_arg_41348,
                                             &kernel_arg_41349,
                                             &kernel_arg_41350,
                                             &num_threads_40330};
                int64_t time_start_41335 = 0, time_end_41336 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "findNaturalLeavesFixK.scan_stage1_35797");
                    fprintf(stderr, "%d", stage1_num_groups_40329);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segscan_group_sizze_35792);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_41335 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->findNaturalLeavesFixKziscan_stage1_35797_runs,
                                              &ctx->findNaturalLeavesFixKziscan_stage1_35797_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->findNaturalLeavesFixKziscan_stage1_35797,
                                            grid[0], grid[1], grid[2],
                                            segscan_group_sizze_35792, 1, 1, 0 +
                                            (shared_sizze_41337 + (8 -
                                                                   shared_sizze_41337 %
                                                                   8) % 8) +
                                            (shared_sizze_41339 + (8 -
                                                                   shared_sizze_41339 %
                                                                   8) % 8) +
                                            (shared_sizze_41341 + (8 -
                                                                   shared_sizze_41341 %
                                                                   8) % 8) +
                                            (shared_sizze_41343 + (8 -
                                                                   shared_sizze_41343 %
                                                                   8) % 8),
                                            NULL, kernel_args_41334, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_41336 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "findNaturalLeavesFixK.scan_stage1_35797",
                            time_end_41336 - time_start_41335);
                }
            }
            if (ctx->debugging)
                fprintf(stderr, "%s: %llu%c", "elems_per_group",
                        (long long) (segscan_group_sizze_35792 *
                                     sdiv_up32(n_31866, num_threads_40330)),
                        '\n');
            
            unsigned int shared_sizze_41354 = smax64(1,
                                                     (int64_t) sizeof(int32_t) *
                                                     sext_i32_i64(stage1_num_groups_40329));
            unsigned int shared_sizze_41356 = smax64(1,
                                                     (int64_t) sizeof(int32_t) *
                                                     sext_i32_i64(stage1_num_groups_40329));
            unsigned int shared_sizze_41358 = smax64(1,
                                                     (int64_t) sizeof(int32_t) *
                                                     sext_i32_i64(stage1_num_groups_40329));
            unsigned int shared_sizze_41360 = smax64(1,
                                                     (int64_t) sizeof(int32_t) *
                                                     sext_i32_i64(stage1_num_groups_40329));
            CUdeviceptr kernel_arg_41362 = mem_39451.mem;
            CUdeviceptr kernel_arg_41363 = mem_39454.mem;
            CUdeviceptr kernel_arg_41364 = mem_39457.mem;
            CUdeviceptr kernel_arg_41365 = mem_39460.mem;
            unsigned int shared_offset_41355 = 0;
            unsigned int shared_offset_41357 = 0 + (shared_sizze_41354 + (8 -
                                                                          shared_sizze_41354 %
                                                                          8) %
                                                    8);
            unsigned int shared_offset_41359 = 0 + (shared_sizze_41354 + (8 -
                                                                          shared_sizze_41354 %
                                                                          8) %
                                                    8) + (shared_sizze_41356 +
                                                          (8 -
                                                           shared_sizze_41356 %
                                                           8) % 8);
            unsigned int shared_offset_41361 = 0 + (shared_sizze_41354 + (8 -
                                                                          shared_sizze_41354 %
                                                                          8) %
                                                    8) + (shared_sizze_41356 +
                                                          (8 -
                                                           shared_sizze_41356 %
                                                           8) % 8) +
                         (shared_sizze_41358 + (8 - shared_sizze_41358 % 8) %
                          8);
            
            if ((((((1 && 1 != 0) && 1 != 0) && 1 != 0) &&
                  stage1_num_groups_40329 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = 1;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_41351[] = {&ctx->global_failure,
                                             &shared_offset_41355,
                                             &shared_offset_41357,
                                             &shared_offset_41359,
                                             &shared_offset_41361, &n_31866,
                                             &kernel_arg_41362,
                                             &kernel_arg_41363,
                                             &kernel_arg_41364,
                                             &kernel_arg_41365,
                                             &stage1_num_groups_40329,
                                             &num_threads_40330};
                int64_t time_start_41352 = 0, time_end_41353 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "findNaturalLeavesFixK.scan_stage2_35797");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", stage1_num_groups_40329);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_41352 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->findNaturalLeavesFixKziscan_stage2_35797_runs,
                                              &ctx->findNaturalLeavesFixKziscan_stage2_35797_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->findNaturalLeavesFixKziscan_stage2_35797,
                                            grid[0], grid[1], grid[2],
                                            stage1_num_groups_40329, 1, 1, 0 +
                                            (shared_sizze_41354 + (8 -
                                                                   shared_sizze_41354 %
                                                                   8) % 8) +
                                            (shared_sizze_41356 + (8 -
                                                                   shared_sizze_41356 %
                                                                   8) % 8) +
                                            (shared_sizze_41358 + (8 -
                                                                   shared_sizze_41358 %
                                                                   8) % 8) +
                                            (shared_sizze_41360 + (8 -
                                                                   shared_sizze_41360 %
                                                                   8) % 8),
                                            NULL, kernel_args_41351, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_41353 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "findNaturalLeavesFixK.scan_stage2_35797",
                            time_end_41353 - time_start_41352);
                }
            }
            
            int32_t required_groups_40403;
            
            required_groups_40403 = sdiv_up32(n_31866,
                                              segscan_group_sizze_35792);
            
            CUdeviceptr kernel_arg_41369 = mem_39451.mem;
            CUdeviceptr kernel_arg_41370 = mem_39454.mem;
            CUdeviceptr kernel_arg_41371 = mem_39457.mem;
            CUdeviceptr kernel_arg_41372 = mem_39460.mem;
            
            if ((((((1 && num_groups_35794 != 0) && 1 != 0) && 1 != 0) &&
                  segscan_group_sizze_35792 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = num_groups_35794;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_41366[] = {&ctx->global_failure, &n_31866,
                                             &num_groups_35794,
                                             &kernel_arg_41369,
                                             &kernel_arg_41370,
                                             &kernel_arg_41371,
                                             &kernel_arg_41372,
                                             &num_threads_40330,
                                             &required_groups_40403};
                int64_t time_start_41367 = 0, time_end_41368 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "findNaturalLeavesFixK.scan_stage3_35797");
                    fprintf(stderr, "%d", num_groups_35794);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segscan_group_sizze_35792);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_41367 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->findNaturalLeavesFixKziscan_stage3_35797_runs,
                                              &ctx->findNaturalLeavesFixKziscan_stage3_35797_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->findNaturalLeavesFixKziscan_stage3_35797,
                                            grid[0], grid[1], grid[2],
                                            segscan_group_sizze_35792, 1, 1, 0,
                                            NULL, kernel_args_41366, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_41368 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "findNaturalLeavesFixK.scan_stage3_35797",
                            time_end_41368 - time_start_41367);
                }
            }
        }
        
        int32_t read_res_41373;
        
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_scalar_from_dev_runs,
                                          &ctx->copy_scalar_from_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpyDtoH(&read_res_41373, mem_39451.mem +
                                      sext_i32_i64(i_31934) * sizeof(int32_t),
                                      sizeof(int32_t)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        if (futhark_context_sync(ctx) != 0)
            return 1;
        
        int32_t res_31998 = read_res_41373;
        int32_t read_res_41374;
        
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_scalar_from_dev_runs,
                                          &ctx->copy_scalar_from_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpyDtoH(&read_res_41374, mem_39454.mem +
                                      sext_i32_i64(i_31934) * sizeof(int32_t),
                                      sizeof(int32_t)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        if (futhark_context_sync(ctx) != 0)
            return 1;
        
        int32_t res_31999 = read_res_41374;
        int32_t read_res_41375;
        
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_scalar_from_dev_runs,
                                          &ctx->copy_scalar_from_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpyDtoH(&read_res_41375, mem_39457.mem +
                                      sext_i32_i64(i_31934) * sizeof(int32_t),
                                      sizeof(int32_t)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        if (futhark_context_sync(ctx) != 0)
            return 1;
        
        int32_t res_32000 = read_res_41375;
        struct memblock_device mem_39466;
        
        mem_39466.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39466, bytes_39428, "mem_39466")) {
            err = 1;
            goto cleanup;
        }
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_dev_to_dev_runs,
                                          &ctx->copy_dev_to_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpy(mem_39466.mem + 0, mem_param_39438.mem + 0,
                                  sext_i32_i64(n_31866) *
                                  (int64_t) sizeof(int32_t)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        
        struct memblock_device mem_39469;
        
        mem_39469.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39469, bytes_39428, "mem_39469")) {
            err = 1;
            goto cleanup;
        }
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_dev_to_dev_runs,
                                          &ctx->copy_dev_to_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpy(mem_39469.mem + 0, mem_param_39443.mem + 0,
                                  sext_i32_i64(n_31866) *
                                  (int64_t) sizeof(int32_t)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        
        CUdeviceptr kernel_arg_41379 = mem_param_39438.mem;
        CUdeviceptr kernel_arg_41380 = mem_param_39443.mem;
        CUdeviceptr kernel_arg_41381 = mem_39451.mem;
        CUdeviceptr kernel_arg_41382 = mem_39454.mem;
        CUdeviceptr kernel_arg_41383 = mem_39457.mem;
        CUdeviceptr kernel_arg_41384 = mem_39460.mem;
        CUdeviceptr kernel_arg_41385 = mem_39463.mem;
        CUdeviceptr kernel_arg_41386 = mem_39466.mem;
        CUdeviceptr kernel_arg_41387 = mem_39469.mem;
        
        if ((((((1 && segmap_usable_groups_35806 != 0) && 1 != 0) && 1 != 0) &&
              segmap_group_sizze_35803 != 0) && 1 != 0) && 1 != 0) {
            int perm[3] = {0, 1, 2};
            
            if (1 >= 1 << 16) {
                perm[1] = perm[0];
                perm[0] = 1;
            }
            if (1 >= 1 << 16) {
                perm[2] = perm[0];
                perm[0] = 2;
            }
            
            size_t grid[3];
            
            grid[perm[0]] = segmap_usable_groups_35806;
            grid[perm[1]] = 1;
            grid[perm[2]] = 1;
            
            void *kernel_args_41376[] = {&ctx->global_failure, &n_31866,
                                         &res_31998, &res_31999, &res_32000,
                                         &kernel_arg_41379, &kernel_arg_41380,
                                         &kernel_arg_41381, &kernel_arg_41382,
                                         &kernel_arg_41383, &kernel_arg_41384,
                                         &kernel_arg_41385, &kernel_arg_41386,
                                         &kernel_arg_41387};
            int64_t time_start_41377 = 0, time_end_41378 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with grid size (",
                        "findNaturalLeavesFixK.segmap_35799");
                fprintf(stderr, "%d", segmap_usable_groups_35806);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ") and block size (");
                fprintf(stderr, "%d", segmap_group_sizze_35803);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ").\n");
                time_start_41377 = get_wall_time();
            }
            
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->findNaturalLeavesFixKzisegmap_35799_runs,
                                          &ctx->findNaturalLeavesFixKzisegmap_35799_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuLaunchKernel(ctx->findNaturalLeavesFixKzisegmap_35799,
                                        grid[0], grid[1], grid[2],
                                        segmap_group_sizze_35803, 1, 1, 0, NULL,
                                        kernel_args_41376, NULL));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            if (ctx->debugging) {
                CUDA_SUCCEED(cuCtxSynchronize());
                time_end_41378 = get_wall_time();
                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                        "findNaturalLeavesFixK.segmap_35799", time_end_41378 -
                        time_start_41377);
            }
        }
        
        struct memblock_device mem_param_tmp_40324;
        
        mem_param_tmp_40324.references = NULL;
        if (memblock_set_device(ctx, &mem_param_tmp_40324, &mem_39466,
                                "mem_39466") != 0)
            return 1;
        
        struct memblock_device mem_param_tmp_40325;
        
        mem_param_tmp_40325.references = NULL;
        if (memblock_set_device(ctx, &mem_param_tmp_40325, &mem_39469,
                                "mem_39469") != 0)
            return 1;
        if (memblock_set_device(ctx, &mem_param_39438, &mem_param_tmp_40324,
                                "mem_param_tmp_40324") != 0)
            return 1;
        if (memblock_set_device(ctx, &mem_param_39443, &mem_param_tmp_40325,
                                "mem_param_tmp_40325") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_40325,
                                  "mem_param_tmp_40325") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_40324,
                                  "mem_param_tmp_40324") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39469, "mem_39469") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39466, "mem_39466") != 0)
            return 1;
    }
    if (memblock_set_device(ctx, &res_mem_39479, &mem_param_39438,
                            "mem_param_39438") != 0)
        return 1;
    if (memblock_set_device(ctx, &res_mem_39484, &mem_param_39443,
                            "mem_param_39443") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39433, "mem_39433") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39451, "mem_39451") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39454, "mem_39454") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39457, "mem_39457") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39460, "mem_39460") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39463, "mem_39463") != 0)
        return 1;
    
    struct memblock_device mem_39486;
    
    mem_39486.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39486, 32, "mem_39486")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, mem_39486, 8, -1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39488;
    
    mem_39488.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39488, 32, "mem_39488")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f32(ctx, mem_39488, 8, INFINITY) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int32_t segmap_group_sizze_36203;
    
    segmap_group_sizze_36203 =
        ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_36189;
    
    int64_t segmap_group_sizze_36204 = sext_i32_i64(segmap_group_sizze_36203);
    int64_t segmap_usable_groups_64_36205 = sdiv_up64(n_35756,
                                                      segmap_group_sizze_36204);
    int32_t segmap_usable_groups_36206 =
            sext_i64_i32(segmap_usable_groups_64_36205);
    struct memblock_device mem_39491;
    
    mem_39491.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39491, n_35756, "mem_39491")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39493;
    
    mem_39493.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39493, n_35756, "mem_39493")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39496;
    
    mem_39496.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39496, bytes_39428, "mem_39496")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39499;
    
    mem_39499.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39499, bytes_39428, "mem_39499")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    
    CUdeviceptr kernel_arg_41391 = mem_39430.mem;
    CUdeviceptr kernel_arg_41392 = res_mem_39484.mem;
    CUdeviceptr kernel_arg_41393 = mem_39491.mem;
    CUdeviceptr kernel_arg_41394 = mem_39493.mem;
    CUdeviceptr kernel_arg_41395 = mem_39496.mem;
    CUdeviceptr kernel_arg_41396 = mem_39499.mem;
    
    if ((((((1 && segmap_usable_groups_36206 != 0) && 1 != 0) && 1 != 0) &&
          segmap_group_sizze_36203 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = segmap_usable_groups_36206;
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41388[] = {&ctx->global_failure,
                                     &ctx->failure_is_an_option,
                                     &ctx->global_failure_args, &n_31866,
                                     &kernel_arg_41391, &kernel_arg_41392,
                                     &kernel_arg_41393, &kernel_arg_41394,
                                     &kernel_arg_41395, &kernel_arg_41396};
        int64_t time_start_41389 = 0, time_end_41390 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "findNaturalLeavesFixK.segmap_36186");
            fprintf(stderr, "%d", segmap_usable_groups_36206);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", segmap_group_sizze_36203);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41389 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->findNaturalLeavesFixKzisegmap_36186_runs,
                                      &ctx->findNaturalLeavesFixKzisegmap_36186_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->findNaturalLeavesFixKzisegmap_36186,
                                    grid[0], grid[1], grid[2],
                                    segmap_group_sizze_36203, 1, 1, 0, NULL,
                                    kernel_args_41388, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41390 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "findNaturalLeavesFixK.segmap_36186", time_end_41390 -
                    time_start_41389);
        }
    }
    ctx->failure_is_an_option = 1;
    
    int64_t d_36230 = sext_i32_i64(d_31863);
    int64_t nest_sizze_36232 = n_35756 * d_36230;
    int32_t segmap_group_sizze_36233;
    
    segmap_group_sizze_36233 =
        ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_36151;
    
    int64_t segmap_group_sizze_36234 = sext_i32_i64(segmap_group_sizze_36233);
    int64_t segmap_usable_groups_64_36235 = sdiv_up64(nest_sizze_36232,
                                                      segmap_group_sizze_36234);
    int32_t segmap_usable_groups_36236 =
            sext_i64_i32(segmap_usable_groups_64_36235);
    int64_t bytes_39501 = 4 * nest_sizze_36232;
    struct memblock_device mem_39505;
    
    mem_39505.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39505, bytes_39501, "mem_39505")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    
    CUdeviceptr kernel_arg_41400 = queries_mem_39421.mem;
    CUdeviceptr kernel_arg_41401 = res_mem_39484.mem;
    CUdeviceptr kernel_arg_41402 = mem_39491.mem;
    CUdeviceptr kernel_arg_41403 = mem_39493.mem;
    CUdeviceptr kernel_arg_41404 = mem_39505.mem;
    
    if ((((((1 && segmap_usable_groups_36236 != 0) && 1 != 0) && 1 != 0) &&
          segmap_group_sizze_36233 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = segmap_usable_groups_36236;
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41397[] = {&ctx->global_failure,
                                     &ctx->failure_is_an_option,
                                     &ctx->global_failure_args, &d_31863,
                                     &n_31866, &d_31867, &kernel_arg_41400,
                                     &kernel_arg_41401, &kernel_arg_41402,
                                     &kernel_arg_41403, &kernel_arg_41404};
        int64_t time_start_41398 = 0, time_end_41399 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "findNaturalLeavesFixK.segmap_36146");
            fprintf(stderr, "%d", segmap_usable_groups_36236);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", segmap_group_sizze_36233);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41398 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->findNaturalLeavesFixKzisegmap_36146_runs,
                                      &ctx->findNaturalLeavesFixKzisegmap_36146_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->findNaturalLeavesFixKzisegmap_36146,
                                    grid[0], grid[1], grid[2],
                                    segmap_group_sizze_36233, 1, 1, 0, NULL,
                                    kernel_args_41397, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41399 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "findNaturalLeavesFixK.segmap_36146", time_end_41399 -
                    time_start_41398);
        }
    }
    ctx->failure_is_an_option = 1;
    if (memblock_unref_device(ctx, &res_mem_39484, "res_mem_39484") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39491, "mem_39491") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39493, "mem_39493") != 0)
        return 1;
    
    int32_t segmap_group_sizze_36251;
    
    segmap_group_sizze_36251 =
        ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_36065;
    
    int32_t num_groups_36252;
    int32_t max_num_groups_40448;
    
    max_num_groups_40448 =
        ctx->sizes.findNaturalLeavesFixKzisegmap_num_groups_36067;
    num_groups_36252 = sext_i64_i32(smax64(1, smin64(sdiv_up64(n_35756,
                                                               sext_i32_i64(segmap_group_sizze_36251)),
                                                     sext_i32_i64(max_num_groups_40448))));
    
    int64_t binop_x_39509 = n_35756 * d_36230;
    int64_t bytes_39506 = 4 * binop_x_39509;
    struct memblock_device mem_39510;
    
    mem_39510.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39510, bytes_39506, "mem_39510")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39510, 0, mem_39505, 0,
                                              1, d_31863, n_31866) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_39505, "mem_39505") != 0)
        return 1;
    
    int64_t binop_y_39513 = sext_i32_i64(num_leaves_31877);
    int64_t binop_x_39514 = d_36230 * binop_y_39513;
    int64_t binop_y_39515 = sext_i32_i64(ppl_31891);
    int64_t binop_x_39516 = binop_x_39514 * binop_y_39515;
    int64_t bytes_39511 = 4 * binop_x_39516;
    struct memblock_device mem_39517;
    
    mem_39517.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39517, bytes_39511, "mem_39517")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39517, 0,
                                              ref_pts_mem_39418, 0, 1, d_31863,
                                              num_leaves_31877 * ppl_31891) !=
        0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t binop_x_39583 = 8 * n_35756;
    int64_t bytes_39581 = 4 * binop_x_39583;
    struct memblock_device mem_39584;
    
    mem_39584.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39584, bytes_39581, "mem_39584")) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39588;
    
    mem_39588.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39588, bytes_39581, "mem_39588")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    
    CUdeviceptr kernel_arg_41408 = mem_39486.mem;
    CUdeviceptr kernel_arg_41409 = mem_39488.mem;
    CUdeviceptr kernel_arg_41410 = mem_39496.mem;
    CUdeviceptr kernel_arg_41411 = mem_39510.mem;
    CUdeviceptr kernel_arg_41412 = mem_39517.mem;
    CUdeviceptr kernel_arg_41413 = mem_39584.mem;
    CUdeviceptr kernel_arg_41414 = mem_39588.mem;
    
    if ((((((1 && num_groups_36252 != 0) && 1 != 0) && 1 != 0) &&
          segmap_group_sizze_36251 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = num_groups_36252;
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41405[] = {&ctx->global_failure,
                                     &ctx->failure_is_an_option,
                                     &ctx->global_failure_args, &d_31863,
                                     &n_31866, &num_leaves_31877, &ppl_31891,
                                     &num_groups_36252, &kernel_arg_41408,
                                     &kernel_arg_41409, &kernel_arg_41410,
                                     &kernel_arg_41411, &kernel_arg_41412,
                                     &kernel_arg_41413, &kernel_arg_41414};
        int64_t time_start_41406 = 0, time_end_41407 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "findNaturalLeavesFixK.segmap_36062");
            fprintf(stderr, "%d", num_groups_36252);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", segmap_group_sizze_36251);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41406 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->findNaturalLeavesFixKzisegmap_36062_runs,
                                      &ctx->findNaturalLeavesFixKzisegmap_36062_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->findNaturalLeavesFixKzisegmap_36062,
                                    grid[0], grid[1], grid[2],
                                    segmap_group_sizze_36251, 1, 1, 0, NULL,
                                    kernel_args_41405, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41407 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "findNaturalLeavesFixK.segmap_36062", time_end_41407 -
                    time_start_41406);
        }
    }
    ctx->failure_is_an_option = 1;
    if (memblock_unref_device(ctx, &mem_39486, "mem_39486") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39488, "mem_39488") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39496, "mem_39496") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39510, "mem_39510") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39517, "mem_39517") != 0)
        return 1;
    
    int32_t nk_32108 = mul32(8, n_31866);
    bool bounds_invalid_upwards_32109 = slt32(nk_32108, 0);
    bool valid_32110 = !bounds_invalid_upwards_32109;
    bool range_valid_c_32111;
    
    if (!valid_32110) {
        ctx->error = msgprintf("Error: %s%d%s%d%s%d%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", nk_32108,
                               " is invalid.",
                               "-> #0  /prelude/math.fut:461:23-30\n   #1  /prelude/array.fut:60:3-12\n   #2  util.fut:34:27-33\n   #3  driverKNN.fut:169:16-47\n   #4  driverKNN.fut:179:3-62\n   #5  driverKNN.fut:173:1-179:62\n");
        if (memblock_unref_device(ctx, &mem_39588, "mem_39588") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39584, "mem_39584") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39517, "mem_39517") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39510, "mem_39510") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39505, "mem_39505") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39499, "mem_39499") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39496, "mem_39496") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39493, "mem_39493") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39491, "mem_39491") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39488, "mem_39488") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39486, "mem_39486") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_39443, "mem_param_39443") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_39438, "mem_param_39438") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39484, "res_mem_39484") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39479, "res_mem_39479") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39463, "mem_39463") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39460, "mem_39460") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39457, "mem_39457") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39454, "mem_39454") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39451, "mem_39451") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39433, "mem_39433") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39430, "mem_39430") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39426, "mem_39426") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int64_t binop_x_39590 = sext_i32_i64(nk_32108);
    int64_t bytes_39589 = 4 * binop_x_39590;
    struct memblock_device mem_39591;
    
    mem_39591.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39591, bytes_39589, "mem_39591")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, mem_39591, nk_32108, -1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39594;
    
    mem_39594.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39594, bytes_39589, "mem_39594")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f32(ctx, mem_39594, nk_32108, INFINITY) !=
        0) {
        err = 1;
        goto cleanup;
    }
    
    int32_t segmap_group_sizze_36307;
    
    segmap_group_sizze_36307 =
        ctx->sizes.findNaturalLeavesFixKzisegmap_group_sizze_36306;
    
    int64_t segmap_group_sizze_36308 = sext_i32_i64(segmap_group_sizze_36307);
    int64_t segmap_usable_groups_64_36309 = sdiv_up64(binop_x_39590,
                                                      segmap_group_sizze_36308);
    int32_t segmap_usable_groups_36310 =
            sext_i64_i32(segmap_usable_groups_64_36309);
    struct memblock_device mem_39598;
    
    mem_39598.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39598, bytes_39581, "mem_39598")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39598, 0, mem_39584, 0,
                                              1, n_31866, 8) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_39584, "mem_39584") != 0)
        return 1;
    
    struct memblock_device mem_39602;
    
    mem_39602.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39602, bytes_39581, "mem_39602")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39602, 0, mem_39588, 0,
                                              1, n_31866, 8) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_39588, "mem_39588") != 0)
        return 1;
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    
    CUdeviceptr kernel_arg_41418 = mem_39499.mem;
    CUdeviceptr kernel_arg_41419 = mem_39591.mem;
    CUdeviceptr kernel_arg_41420 = mem_39594.mem;
    CUdeviceptr kernel_arg_41421 = mem_39598.mem;
    CUdeviceptr kernel_arg_41422 = mem_39602.mem;
    
    if ((((((1 && segmap_usable_groups_36310 != 0) && 1 != 0) && 1 != 0) &&
          segmap_group_sizze_36307 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = segmap_usable_groups_36310;
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41415[] = {&ctx->global_failure,
                                     &ctx->failure_is_an_option,
                                     &ctx->global_failure_args, &n_31866,
                                     &nk_32108, &kernel_arg_41418,
                                     &kernel_arg_41419, &kernel_arg_41420,
                                     &kernel_arg_41421, &kernel_arg_41422};
        int64_t time_start_41416 = 0, time_end_41417 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "findNaturalLeavesFixK.segmap_36303");
            fprintf(stderr, "%d", segmap_usable_groups_36310);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", segmap_group_sizze_36307);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41416 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->findNaturalLeavesFixKzisegmap_36303_runs,
                                      &ctx->findNaturalLeavesFixKzisegmap_36303_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->findNaturalLeavesFixKzisegmap_36303,
                                    grid[0], grid[1], grid[2],
                                    segmap_group_sizze_36307, 1, 1, 0, NULL,
                                    kernel_args_41415, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41417 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "findNaturalLeavesFixK.segmap_36303", time_end_41417 -
                    time_start_41416);
        }
    }
    ctx->failure_is_an_option = 1;
    if (memblock_unref_device(ctx, &mem_39499, "mem_39499") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39598, "mem_39598") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39602, "mem_39602") != 0)
        return 1;
    
    struct memblock_device mem_39607;
    
    mem_39607.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39607, bytes_39581, "mem_39607")) {
        err = 1;
        goto cleanup;
    }
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_39607.mem + 0, mem_39591.mem + 0,
                              sext_i32_i64(n_31866 * 8) *
                              (int64_t) sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    if (memblock_unref_device(ctx, &mem_39591, "mem_39591") != 0)
        return 1;
    
    struct memblock_device mem_39611;
    
    mem_39611.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39611, bytes_39581, "mem_39611")) {
        err = 1;
        goto cleanup;
    }
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_39611.mem + 0, mem_39594.mem + 0,
                              sext_i32_i64(n_31866 * 8) *
                              (int64_t) sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    if (memblock_unref_device(ctx, &mem_39594, "mem_39594") != 0)
        return 1;
    out_arrsizze_40296 = n_31866;
    out_arrsizze_40297 = 8;
    out_arrsizze_40299 = n_31866;
    out_arrsizze_40300 = 8;
    out_arrsizze_40302 = n_31866;
    if (memblock_set_device(ctx, &out_mem_40295, &mem_39607, "mem_39607") != 0)
        return 1;
    if (memblock_set_device(ctx, &out_mem_40298, &mem_39611, "mem_39611") != 0)
        return 1;
    if (memblock_set_device(ctx, &out_mem_40301, &mem_39430, "mem_39430") != 0)
        return 1;
    (*out_mem_p_41319).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41319, &out_mem_40295,
                            "out_mem_40295") != 0)
        return 1;
    *out_out_arrsizze_41320 = out_arrsizze_40296;
    *out_out_arrsizze_41321 = out_arrsizze_40297;
    (*out_mem_p_41322).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41322, &out_mem_40298,
                            "out_mem_40298") != 0)
        return 1;
    *out_out_arrsizze_41323 = out_arrsizze_40299;
    *out_out_arrsizze_41324 = out_arrsizze_40300;
    (*out_mem_p_41325).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41325, &out_mem_40301,
                            "out_mem_40301") != 0)
        return 1;
    *out_out_arrsizze_41326 = out_arrsizze_40302;
    if (memblock_unref_device(ctx, &mem_39611, "mem_39611") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39607, "mem_39607") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39602, "mem_39602") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39598, "mem_39598") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39594, "mem_39594") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39591, "mem_39591") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39588, "mem_39588") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39584, "mem_39584") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39517, "mem_39517") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39510, "mem_39510") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39505, "mem_39505") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39499, "mem_39499") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39496, "mem_39496") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39493, "mem_39493") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39491, "mem_39491") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39488, "mem_39488") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39486, "mem_39486") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_param_39443, "mem_param_39443") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_param_39438, "mem_param_39438") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_39484, "res_mem_39484") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_39479, "res_mem_39479") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39463, "mem_39463") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39460, "mem_39460") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39457, "mem_39457") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39454, "mem_39454") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39451, "mem_39451") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39433, "mem_39433") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39430, "mem_39430") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39426, "mem_39426") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40301, "out_mem_40301") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
static int futrts_mkImgPatches(struct futhark_context *ctx,
                               struct memblock_device *out_mem_p_41423,
                               int32_t *out_out_arrsizze_41424,
                               int32_t *out_out_arrsizze_41425,
                               struct memblock_device img_mem_39418,
                               int32_t h_32683, int32_t w_32684,
                               int32_t c_32685, int32_t p_32686)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    int32_t out_arrsizze_40297;
    int32_t x_32688 = sub32(w_32684, p_32686);
    int32_t n_cols_32689 = add32(1, x_32688);
    int32_t x_32690 = sub32(h_32683, p_32686);
    int32_t n_rows_32691 = add32(1, x_32690);
    int32_t x_32692 = mul32(p_32686, p_32686);
    int32_t ppc_32693 = mul32(c_32685, x_32692);
    int32_t n_all_32694 = mul32(n_cols_32689, n_rows_32691);
    bool bounds_invalid_upwards_32695 = slt32(n_rows_32691, 0);
    bool valid_32696 = !bounds_invalid_upwards_32695;
    bool range_valid_c_32697;
    
    if (!valid_32696) {
        ctx->error = msgprintf("Error: %s%d%s%d%s%d%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", n_rows_32691,
                               " is invalid.",
                               "-> #0  /prelude/math.fut:461:23-30\n   #1  /prelude/array.fut:60:3-12\n   #2  /prelude/array.fut:130:28-33\n   #3  driverKNN.fut:39:15-47\n   #4  driverKNN.fut:28:1-42:11\n");
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool bounds_invalid_upwards_32699 = slt32(n_cols_32689, 0);
    bool valid_32700 = !bounds_invalid_upwards_32699;
    bool range_valid_c_32701;
    
    if (!valid_32700) {
        ctx->error = msgprintf("Error: %s%d%s%d%s%d%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", n_cols_32689,
                               " is invalid.",
                               "-> #0  /prelude/math.fut:461:23-30\n   #1  /prelude/array.fut:60:3-12\n   #2  /prelude/array.fut:126:11-16\n   #3  /prelude/functional.fut:15:59-65\n   #4  /prelude/soacs.fut:48:3-10\n   #5  /prelude/array.fut:130:3-34\n   #6  driverKNN.fut:39:15-47\n   #7  driverKNN.fut:28:1-42:11\n");
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool bounds_invalid_upwards_32703 = slt32(p_32686, 0);
    bool valid_32704 = !bounds_invalid_upwards_32703;
    bool range_valid_c_32705;
    
    if (!valid_32704) {
        ctx->error = msgprintf("Error: %s%d%s%d%s%d%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", p_32686,
                               " is invalid.",
                               "-> #0  /prelude/math.fut:461:23-30\n   #1  /prelude/array.fut:60:3-12\n   #2  /prelude/array.fut:130:28-33\n   #3  driverKNN.fut:35:9-38:17\n   #4  /prelude/soacs.fut:48:3-10\n   #5  /prelude/array.fut:126:3-17\n   #6  /prelude/functional.fut:15:59-65\n   #7  /prelude/soacs.fut:48:3-10\n   #8  /prelude/array.fut:130:3-34\n   #9  driverKNN.fut:39:15-47\n   #10 driverKNN.fut:28:1-42:11\n");
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int64_t n_rows_39252 = sext_i32_i64(n_rows_32691);
    int64_t n_cols_39253 = sext_i32_i64(n_cols_32689);
    int64_t p_39254 = sext_i32_i64(p_32686);
    int64_t c_39256 = sext_i32_i64(c_32685);
    int64_t y_39258 = p_39254 * c_39256;
    int64_t y_39259 = p_39254 * y_39258;
    int64_t y_39260 = n_cols_39253 * y_39259;
    int64_t nest_sizze_39261 = n_rows_39252 * y_39260;
    int32_t segmap_group_sizze_39262;
    
    segmap_group_sizze_39262 =
        ctx->sizes.mkImgPatcheszisegmap_group_sizze_38773;
    
    int64_t segmap_group_sizze_39263 = sext_i32_i64(segmap_group_sizze_39262);
    int64_t segmap_usable_groups_64_39264 = sdiv_up64(nest_sizze_39261,
                                                      segmap_group_sizze_39263);
    int32_t segmap_usable_groups_39265 =
            sext_i64_i32(segmap_usable_groups_64_39264);
    int64_t binop_x_39423 = n_rows_39252 * n_cols_39253;
    int64_t binop_x_39425 = p_39254 * binop_x_39423;
    int64_t binop_x_39427 = p_39254 * binop_x_39425;
    int64_t bytes_39420 = c_39256 * binop_x_39427;
    struct memblock_device mem_39429;
    
    mem_39429.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39429, bytes_39420, "mem_39429")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    
    CUdeviceptr kernel_arg_41429 = img_mem_39418.mem;
    CUdeviceptr kernel_arg_41430 = mem_39429.mem;
    
    if ((((((1 && segmap_usable_groups_39265 != 0) && 1 != 0) && 1 != 0) &&
          segmap_group_sizze_39262 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = segmap_usable_groups_39265;
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41426[] = {&ctx->global_failure,
                                     &ctx->failure_is_an_option,
                                     &ctx->global_failure_args, &h_32683,
                                     &w_32684, &c_32685, &p_32686,
                                     &n_cols_32689, &n_rows_32691,
                                     &kernel_arg_41429, &kernel_arg_41430};
        int64_t time_start_41427 = 0, time_end_41428 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "mkImgPatches.segmap_38762");
            fprintf(stderr, "%d", segmap_usable_groups_39265);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", segmap_group_sizze_39262);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41427 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->mkImgPatcheszisegmap_38762_runs,
                                      &ctx->mkImgPatcheszisegmap_38762_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->mkImgPatcheszisegmap_38762, grid[0],
                                    grid[1], grid[2], segmap_group_sizze_39262,
                                    1, 1, 0, NULL, kernel_args_41426, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41428 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "mkImgPatches.segmap_38762", time_end_41428 -
                    time_start_41427);
        }
    }
    ctx->failure_is_an_option = 1;
    out_arrsizze_40296 = n_all_32694;
    out_arrsizze_40297 = ppc_32693;
    if (memblock_set_device(ctx, &out_mem_40295, &mem_39429, "mem_39429") != 0)
        return 1;
    (*out_mem_p_41423).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41423, &out_mem_40295,
                            "out_mem_40295") != 0)
        return 1;
    *out_out_arrsizze_41424 = out_arrsizze_40296;
    *out_out_arrsizze_41425 = out_arrsizze_40297;
    if (memblock_unref_device(ctx, &mem_39429, "mem_39429") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
static int futrts_propagateFixK(struct futhark_context *ctx,
                                struct memblock_device *out_mem_p_41431,
                                int32_t *out_out_arrsizze_41432,
                                int32_t *out_out_arrsizze_41433,
                                struct memblock_device *out_mem_p_41434,
                                int32_t *out_out_arrsizze_41435,
                                int32_t *out_out_arrsizze_41436,
                                struct memblock_device ref_pts_mem_39418,
                                struct memblock_device indir_mem_39419,
                                struct memblock_device orig2leaf_mem_39420,
                                struct memblock_device queries0_mem_39421,
                                struct memblock_device nat_leaves0_mem_39422,
                                struct memblock_device knn_inds_mem_39423,
                                struct memblock_device knn_dsts_mem_39424,
                                int32_t m_31574, int32_t d_31575,
                                int32_t m_31576, int32_t m_31577,
                                int32_t n_31578, int32_t d_31579,
                                int32_t n_31580, int32_t n_31581,
                                int32_t kk_31582, int32_t n_31583,
                                int32_t kk_31584, int32_t h_31585,
                                int32_t nr_31586)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    int32_t out_arrsizze_40297;
    struct memblock_device out_mem_40298;
    
    out_mem_40298.references = NULL;
    
    int32_t out_arrsizze_40299;
    int32_t out_arrsizze_40300;
    bool dim_match_31594 = m_31574 == m_31576;
    bool empty_or_match_cert_31595;
    
    if (!dim_match_31594) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31596 = m_31574 == m_31577;
    bool empty_or_match_cert_31597;
    
    if (!dim_match_31596) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31598 = d_31575 == d_31579;
    bool empty_or_match_cert_31599;
    
    if (!dim_match_31598) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31600 = n_31578 == n_31580;
    bool empty_or_match_cert_31601;
    
    if (!dim_match_31600) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31602 = n_31578 == n_31581;
    bool dim_match_31603 = 8 == kk_31582;
    bool match_31604 = dim_match_31602 && dim_match_31603;
    bool empty_or_match_cert_31605;
    
    if (!match_31604) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31607 = n_31578 == n_31583;
    bool dim_match_31608 = 8 == kk_31584;
    bool match_31609 = dim_match_31607 && dim_match_31608;
    bool empty_or_match_cert_31610;
    
    if (!match_31609) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool zzero_31612 = nr_31586 == 0;
    bool nonzzero_31613 = !zzero_31612;
    bool nonzzero_cert_31614;
    
    if (!nonzzero_31613) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "division by zero",
                               "-> #0  driverKNN.fut:403:12-17\n   #1  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int32_t nc_31615 = sdiv32(n_31578, nr_31586);
    int32_t x_31616 = nr_31586 * nc_31615;
    bool dim_ok_31617 = x_31616 == n_31578;
    bool dim_ok_cert_31618;
    
    if (!dim_ok_31617) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "new shape has different number of elements than old shape",
                               "-> #0  /prelude/array.fut:95:3-33\n   #1  driverKNN.fut:404:17-40\n   #2  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int64_t binop_x_39426 = sext_i32_i64(n_31578);
    int64_t binop_x_39427 = 8 * binop_x_39426;
    int64_t bytes_39425 = 4 * binop_x_39427;
    struct memblock_device mem_39428;
    
    mem_39428.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39428, bytes_39425, "mem_39428")) {
        err = 1;
        goto cleanup;
    }
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_39428.mem + 0, knn_inds_mem_39423.mem + 0,
                              sext_i32_i64(n_31578 * 8) *
                              (int64_t) sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    
    struct memblock_device mem_39432;
    
    mem_39432.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39432, bytes_39425, "mem_39432")) {
        err = 1;
        goto cleanup;
    }
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_39432.mem + 0, knn_dsts_mem_39424.mem + 0,
                              sext_i32_i64(n_31578 * 8) *
                              (int64_t) sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    
    bool dim_ok_cert_31623;
    
    if (!dim_ok_31617) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "new shape has different number of elements than old shape",
                               "-> #0  /prelude/array.fut:95:3-33\n   #1  /prelude/functional.fut:12:39-41\n   #2  driverKNN.fut:406:14-58\n   #3  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &mem_39432, "mem_39432") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39428, "mem_39428") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int32_t y_31626 = add32(1, h_31585);
    int32_t num_leaves_31627 = 1 << y_31626;
    bool zzero_31628 = num_leaves_31627 == 0;
    bool nonzzero_31629 = !zzero_31628;
    bool nonzzero_cert_31630;
    
    if (!nonzzero_31629) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "division by zero",
                               "-> #0  driverKNN.fut:315:13-26\n   #1  driverKNN.fut:408:15-73\n   #2  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &mem_39432, "mem_39432") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39428, "mem_39428") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int32_t ppl_31631 = sdiv32(m_31574, num_leaves_31627);
    int32_t x_31632 = num_leaves_31627 * ppl_31631;
    bool dim_ok_31633 = x_31632 == m_31574;
    bool dim_ok_cert_31634;
    
    if (!dim_ok_31633) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "new shape has different number of elements than old shape",
                               "-> #0  /prelude/array.fut:95:3-33\n   #1  driverKNN.fut:316:16-47\n   #2  driverKNN.fut:408:15-73\n   #3  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &mem_39432, "mem_39432") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39428, "mem_39428") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int32_t upper_bound_31636 = sub32(nr_31586, 1);
    bool loop_nonempty_31637 = slt32(0, upper_bound_31636);
    bool zzero_31638 = nc_31615 == 0;
    bool nonzzero_31639 = !zzero_31638;
    bool loop_not_taken_31640 = !loop_nonempty_31637;
    bool protect_assert_disj_31641 = nonzzero_31639 || loop_not_taken_31640;
    bool nonzzero_cert_31642;
    
    if (!protect_assert_disj_31641) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "division by zero",
                               "-> #0  driverKNN.fut:297:20-40\n   #1  driverKNN.fut:335:27-75\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:326:9-350:42\n   #5  driverKNN.fut:408:15-73\n   #6  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &mem_39432, "mem_39432") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39428, "mem_39428") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int64_t nc_34828 = sext_i32_i64(nc_31615);
    int32_t segmap_group_sizze_34830;
    
    segmap_group_sizze_34830 =
        ctx->sizes.propagateFixKzisegmap_group_sizze_34703;
    
    int32_t num_groups_34831;
    int32_t max_num_groups_40301;
    
    max_num_groups_40301 = ctx->sizes.propagateFixKzisegmap_num_groups_34705;
    num_groups_34831 = sext_i64_i32(smax64(1, smin64(sdiv_up64(nc_34828,
                                                               sext_i32_i64(segmap_group_sizze_34830)),
                                                     sext_i32_i64(max_num_groups_40301))));
    
    bool suff_outer_par_34893;
    
    suff_outer_par_34893 = ctx->sizes.propagateFixKzisuff_outer_par_2 <=
        nc_31615;
    
    int32_t max_group_sizze_35161;
    
    max_group_sizze_35161 = ctx->cuda.max_block_size;
    
    bool fits_35162 = sle32(ppl_31631, max_group_sizze_35161);
    bool suff_intra_par_35160;
    
    suff_intra_par_35160 = ctx->sizes.propagateFixKzisuff_intra_par_3 <=
        ppl_31631;
    
    bool intra_suff_and_fits_35163 = suff_intra_par_35160 && fits_35162;
    int32_t segmap_group_sizze_35038;
    
    segmap_group_sizze_35038 =
        ctx->sizes.propagateFixKzisegmap_group_sizze_34915;
    
    int32_t num_groups_35039;
    int32_t max_num_groups_40302;
    
    max_num_groups_40302 = ctx->sizes.propagateFixKzisegmap_num_groups_34917;
    num_groups_35039 = sext_i64_i32(smax64(1, smin64(sdiv_up64(nc_34828,
                                                               sext_i32_i64(segmap_group_sizze_35038)),
                                                     sext_i32_i64(max_num_groups_40302))));
    
    int32_t segmap_group_sizze_35413;
    
    segmap_group_sizze_35413 =
        ctx->sizes.propagateFixKzisegmap_group_sizze_35290;
    
    int32_t num_groups_35414;
    int32_t max_num_groups_40303;
    
    max_num_groups_40303 = ctx->sizes.propagateFixKzisegmap_num_groups_35292;
    num_groups_35414 = sext_i64_i32(smax64(1, smin64(sdiv_up64(nc_34828,
                                                               sext_i32_i64(segmap_group_sizze_35413)),
                                                     sext_i32_i64(max_num_groups_40303))));
    
    int32_t num_threads_39324 = segmap_group_sizze_34830 * num_groups_34831;
    int32_t y_39325 = smod_safe32(m_31577, num_threads_39324);
    int32_t x_39326 = sub32(num_threads_39324, y_39325);
    int32_t y_39327 = smod_safe32(x_39326, num_threads_39324);
    int32_t padded_sizze_39328 = add32(m_31577, y_39327);
    int32_t per_chunk_39330 = squot_safe32(padded_sizze_39328,
                                           num_threads_39324);
    int64_t binop_x_39434 = sext_i32_i64(y_39327);
    int64_t bytes_39433 = 4 * binop_x_39434;
    struct memblock_device mem_39435;
    
    mem_39435.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39435, bytes_39433, "mem_39435")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t binop_x_39437 = sext_i32_i64(padded_sizze_39328);
    int64_t bytes_39436 = 4 * binop_x_39437;
    struct memblock_device mem_39438;
    
    mem_39438.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39438, bytes_39436, "mem_39438")) {
        err = 1;
        goto cleanup;
    }
    
    int32_t tmp_offs_40304 = 0;
    
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_39438.mem + sext_i32_i64(tmp_offs_40304 * 4),
                              orig2leaf_mem_39420.mem + 0,
                              sext_i32_i64(m_31577) *
                              (int64_t) sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    tmp_offs_40304 += m_31577;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_39438.mem + sext_i32_i64(tmp_offs_40304 * 4),
                              mem_39435.mem + 0, sext_i32_i64(y_39327) *
                              (int64_t) sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    tmp_offs_40304 += y_39327;
    if (memblock_unref_device(ctx, &mem_39435, "mem_39435") != 0)
        return 1;
    
    int64_t binop_x_39440 = sext_i32_i64(per_chunk_39330);
    int64_t binop_y_39441 = sext_i32_i64(num_threads_39324);
    int64_t binop_x_39442 = binop_x_39440 * binop_y_39441;
    int64_t bytes_39439 = 4 * binop_x_39442;
    struct memblock_device mem_39443;
    
    mem_39443.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39443, bytes_39439, "mem_39443")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39443, 0, mem_39438, 0,
                                              1, per_chunk_39330,
                                              num_threads_39324) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_39438, "mem_39438") != 0)
        return 1;
    
    int64_t binop_x_39445 = sext_i32_i64(d_31575);
    int64_t binop_y_39446 = sext_i32_i64(nr_31586);
    int64_t binop_x_39447 = binop_x_39445 * binop_y_39446;
    int64_t binop_x_39449 = nc_34828 * binop_x_39447;
    int64_t bytes_39444 = 4 * binop_x_39449;
    struct memblock_device mem_39450;
    
    mem_39450.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39450, bytes_39444, "mem_39450")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39450, 0,
                                              queries0_mem_39421, 0, 1, d_31575,
                                              nr_31586 * nc_31615) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t binop_x_39452 = sext_i32_i64(ppl_31631);
    int64_t binop_x_39454 = binop_x_39445 * binop_x_39452;
    int64_t binop_y_39455 = sext_i32_i64(num_leaves_31627);
    int64_t binop_x_39456 = binop_x_39454 * binop_y_39455;
    int64_t bytes_39451 = 4 * binop_x_39456;
    struct memblock_device mem_39457;
    
    mem_39457.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39457, bytes_39451, "mem_39457")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39457, 0,
                                              ref_pts_mem_39418, 0, 1,
                                              ppl_31631 * d_31575,
                                              num_leaves_31627) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int32_t ctx_val_39482 = 8 * nc_31615;
    int64_t bytes_39509 = 4 * nc_34828;
    struct memblock_device mem_39511;
    
    mem_39511.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39511, bytes_39509, "mem_39511")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t binop_x_39514 = 8 * nc_34828;
    int64_t bytes_39512 = 4 * binop_x_39514;
    struct memblock_device mem_39515;
    
    mem_39515.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39515, bytes_39512, "mem_39515")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t bytes_39559 = 4 * binop_x_39452;
    int32_t num_threads_40176 = segmap_group_sizze_35038 * num_groups_35039;
    int64_t num_threads64_40178 = sext_i32_i64(num_threads_40176);
    int64_t total_sizze_40179 = bytes_39559 * num_threads64_40178;
    int64_t total_sizze_40180 = 32 * num_threads64_40178;
    int64_t total_sizze_40181 = 32 * num_threads64_40178;
    int64_t num_groups64_40183 = sext_i32_i64(nc_31615);
    int64_t total_sizze_40185 = 32 * num_groups64_40183;
    int64_t total_sizze_40186 = 32 * num_groups64_40183;
    int32_t num_threads_40187 = segmap_group_sizze_35413 * num_groups_35414;
    int64_t num_threads64_40189 = sext_i32_i64(num_threads_40187);
    int64_t total_sizze_40190 = bytes_39559 * num_threads64_40189;
    int64_t total_sizze_40191 = 32 * num_threads64_40189;
    int64_t total_sizze_40192 = 32 * num_threads64_40189;
    
    for (int32_t im1_31646 = 0; im1_31646 < upper_bound_31636; im1_31646++) {
        int32_t i_31649 = add32(1, im1_31646);
        bool y_31650 = slt32(im1_31646, nr_31586);
        bool index_certs_31651;
        
        if (!y_31650) {
            ctx->error = msgprintf("Error: %s%d%s%d%s\n\nBacktrace:\n%s",
                                   "Index [", im1_31646,
                                   "] out of bounds for array of shape [",
                                   nr_31586, "].",
                                   "-> #0  driverKNN.fut:321:42-50\n   #1  driverKNN.fut:408:15-73\n   #2  driverKNN.fut:392:1-414:28\n");
            if (memblock_unref_device(ctx, &mem_39515, "mem_39515") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39511, "mem_39511") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39457, "mem_39457") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39450, "mem_39450") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39443, "mem_39443") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39438, "mem_39438") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39435, "mem_39435") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39432, "mem_39432") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39428, "mem_39428") != 0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") !=
                0)
                return 1;
            return 1;
        }
        
        bool x_31654 = sle32(0, i_31649);
        bool y_31655 = slt32(i_31649, nr_31586);
        bool bounds_check_31656 = x_31654 && y_31655;
        bool index_certs_31657;
        
        if (!bounds_check_31656) {
            ctx->error = msgprintf("Error: %s%d%s%d%s\n\nBacktrace:\n%s",
                                   "Index [", i_31649,
                                   "] out of bounds for array of shape [",
                                   nr_31586, "].",
                                   "-> #0  driverKNN.fut:322:52-58\n   #1  driverKNN.fut:408:15-73\n   #2  driverKNN.fut:392:1-414:28\n");
            if (memblock_unref_device(ctx, &mem_39515, "mem_39515") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39511, "mem_39511") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39457, "mem_39457") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39450, "mem_39450") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39443, "mem_39443") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39438, "mem_39438") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39435, "mem_39435") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39432, "mem_39432") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39428, "mem_39428") != 0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") !=
                0)
                return 1;
            return 1;
        }
        
        int32_t binop_x_39322 = nc_31615 * i_31649;
        
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        
        CUdeviceptr kernel_arg_41440 = indir_mem_39419.mem;
        CUdeviceptr kernel_arg_41441 = orig2leaf_mem_39420.mem;
        CUdeviceptr kernel_arg_41442 = nat_leaves0_mem_39422.mem;
        CUdeviceptr kernel_arg_41443 = mem_39428.mem;
        CUdeviceptr kernel_arg_41444 = mem_39443.mem;
        CUdeviceptr kernel_arg_41445 = mem_39511.mem;
        CUdeviceptr kernel_arg_41446 = mem_39515.mem;
        
        if ((((((1 && num_groups_34831 != 0) && 1 != 0) && 1 != 0) &&
              segmap_group_sizze_34830 != 0) && 1 != 0) && 1 != 0) {
            int perm[3] = {0, 1, 2};
            
            if (1 >= 1 << 16) {
                perm[1] = perm[0];
                perm[0] = 1;
            }
            if (1 >= 1 << 16) {
                perm[2] = perm[0];
                perm[0] = 2;
            }
            
            size_t grid[3];
            
            grid[perm[0]] = num_groups_34831;
            grid[perm[1]] = 1;
            grid[perm[2]] = 1;
            
            void *kernel_args_41437[] = {&ctx->global_failure,
                                         &ctx->failure_is_an_option,
                                         &ctx->global_failure_args, &m_31574,
                                         &nc_31615, &upper_bound_31636,
                                         &im1_31646, &num_groups_34831,
                                         &binop_x_39322, &num_threads_39324,
                                         &per_chunk_39330, &kernel_arg_41440,
                                         &kernel_arg_41441, &kernel_arg_41442,
                                         &kernel_arg_41443, &kernel_arg_41444,
                                         &ctx_val_39482, &kernel_arg_41445,
                                         &kernel_arg_41446};
            int64_t time_start_41438 = 0, time_end_41439 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with grid size (",
                        "propagateFixK.segmap_34700");
                fprintf(stderr, "%d", num_groups_34831);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ") and block size (");
                fprintf(stderr, "%d", segmap_group_sizze_34830);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ").\n");
                time_start_41438 = get_wall_time();
            }
            
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->propagateFixKzisegmap_34700_runs,
                                          &ctx->propagateFixKzisegmap_34700_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuLaunchKernel(ctx->propagateFixKzisegmap_34700,
                                        grid[0], grid[1], grid[2],
                                        segmap_group_sizze_34830, 1, 1, 0, NULL,
                                        kernel_args_41437, NULL));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            if (ctx->debugging) {
                CUDA_SUCCEED(cuCtxSynchronize());
                time_end_41439 = get_wall_time();
                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                        "propagateFixK.segmap_34700", time_end_41439 -
                        time_start_41438);
            }
        }
        ctx->failure_is_an_option = 1;
        
        struct memblock_device res_mem_40010;
        
        res_mem_40010.references = NULL;
        
        struct memblock_device res_mem_40011;
        
        res_mem_40011.references = NULL;
        
        int32_t local_memory_capacity_40454;
        
        local_memory_capacity_40454 = ctx->cuda.max_shared_memory;
        if (((sle64(0, sext_i32_i64(local_memory_capacity_40454)) && sle64(0,
                                                                           sext_i32_i64(local_memory_capacity_40454))) &&
             sle64(0, sext_i32_i64(local_memory_capacity_40454))) &&
            suff_outer_par_34893) {
            struct memblock_device mem_39519;
            
            mem_39519.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39519, bytes_39512,
                                      "mem_39519")) {
                err = 1;
                goto cleanup;
            }
            
            int32_t group_sizze_40326;
            
            group_sizze_40326 = ctx->sizes.propagateFixKzigroup_sizze_40326;
            
            int64_t num_groups_40327;
            
            num_groups_40327 = sdiv_up64(sext_i32_i64(nc_31615) * 8,
                                         sext_i32_i64(group_sizze_40326));
            
            CUdeviceptr kernel_arg_41450 = mem_39428.mem;
            CUdeviceptr kernel_arg_41451 = mem_39519.mem;
            
            if ((((((1 && sext_i64_i32(num_groups_40327) != 0) && 1 != 0) &&
                   1 != 0) && group_sizze_40326 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = sext_i64_i32(num_groups_40327);
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_41447[] = {&nc_31615, &i_31649,
                                             &kernel_arg_41450, &ctx_val_39482,
                                             &kernel_arg_41451};
                int64_t time_start_41448 = 0, time_end_41449 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "propagateFixK.copy_40323");
                    fprintf(stderr, "%d", sext_i64_i32(num_groups_40327));
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", group_sizze_40326);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_41448 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->propagateFixKzicopy_40323_runs,
                                              &ctx->propagateFixKzicopy_40323_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->propagateFixKzicopy_40323,
                                            grid[0], grid[1], grid[2],
                                            group_sizze_40326, 1, 1, 0, NULL,
                                            kernel_args_41447, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_41449 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "propagateFixK.copy_40323", time_end_41449 -
                            time_start_41448);
                }
            }
            
            struct memblock_device mem_39523;
            
            mem_39523.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39523, bytes_39512,
                                      "mem_39523")) {
                err = 1;
                goto cleanup;
            }
            
            int32_t group_sizze_40331;
            
            group_sizze_40331 = ctx->sizes.propagateFixKzigroup_sizze_40331;
            
            int64_t num_groups_40332;
            
            num_groups_40332 = sdiv_up64(sext_i32_i64(nc_31615) * 8,
                                         sext_i32_i64(group_sizze_40331));
            
            CUdeviceptr kernel_arg_41455 = mem_39432.mem;
            CUdeviceptr kernel_arg_41456 = mem_39523.mem;
            
            if ((((((1 && sext_i64_i32(num_groups_40332) != 0) && 1 != 0) &&
                   1 != 0) && group_sizze_40331 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = sext_i64_i32(num_groups_40332);
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_41452[] = {&nc_31615, &i_31649,
                                             &kernel_arg_41455, &ctx_val_39482,
                                             &kernel_arg_41456};
                int64_t time_start_41453 = 0, time_end_41454 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "propagateFixK.copy_40328");
                    fprintf(stderr, "%d", sext_i64_i32(num_groups_40332));
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", group_sizze_40331);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_41453 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->propagateFixKzicopy_40328_runs,
                                              &ctx->propagateFixKzicopy_40328_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->propagateFixKzicopy_40328,
                                            grid[0], grid[1], grid[2],
                                            group_sizze_40331, 1, 1, 0, NULL,
                                            kernel_args_41452, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_41454 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "propagateFixK.copy_40328", time_end_41454 -
                            time_start_41453);
                }
            }
            
            struct memblock_device mem_39671;
            
            mem_39671.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39671, bytes_39512,
                                      "mem_39671")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39675;
            
            mem_39675.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39675, bytes_39512,
                                      "mem_39675")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39561;
            
            mem_39561.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39561, total_sizze_40179,
                                      "mem_39561")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device double_buffer_mem_40098;
            
            double_buffer_mem_40098.references = NULL;
            if (memblock_alloc_device(ctx, &double_buffer_mem_40098,
                                      total_sizze_40180,
                                      "double_buffer_mem_40098")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device double_buffer_mem_40099;
            
            double_buffer_mem_40099.references = NULL;
            if (memblock_alloc_device(ctx, &double_buffer_mem_40099,
                                      total_sizze_40181,
                                      "double_buffer_mem_40099")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegMap");
            
            CUdeviceptr kernel_arg_41460 = mem_39450.mem;
            CUdeviceptr kernel_arg_41461 = mem_39457.mem;
            CUdeviceptr kernel_arg_41462 = mem_39511.mem;
            CUdeviceptr kernel_arg_41463 = mem_39515.mem;
            CUdeviceptr kernel_arg_41464 = mem_39519.mem;
            CUdeviceptr kernel_arg_41465 = mem_39523.mem;
            CUdeviceptr kernel_arg_41466 = mem_39561.mem;
            CUdeviceptr kernel_arg_41467 = mem_39671.mem;
            CUdeviceptr kernel_arg_41468 = mem_39675.mem;
            CUdeviceptr kernel_arg_41469 = double_buffer_mem_40098.mem;
            CUdeviceptr kernel_arg_41470 = double_buffer_mem_40099.mem;
            
            if ((((((1 && num_groups_35039 != 0) && 1 != 0) && 1 != 0) &&
                  segmap_group_sizze_35038 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = num_groups_35039;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_41457[] = {&ctx->global_failure,
                                             &ctx->failure_is_an_option,
                                             &ctx->global_failure_args,
                                             &d_31575, &nr_31586, &nc_31615,
                                             &num_leaves_31627, &ppl_31631,
                                             &i_31649, &num_groups_35039,
                                             &kernel_arg_41460,
                                             &kernel_arg_41461,
                                             &kernel_arg_41462,
                                             &kernel_arg_41463,
                                             &kernel_arg_41464,
                                             &kernel_arg_41465,
                                             &kernel_arg_41466,
                                             &kernel_arg_41467,
                                             &kernel_arg_41468,
                                             &kernel_arg_41469,
                                             &kernel_arg_41470};
                int64_t time_start_41458 = 0, time_end_41459 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "propagateFixK.segmap_34912");
                    fprintf(stderr, "%d", num_groups_35039);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segmap_group_sizze_35038);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_41458 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->propagateFixKzisegmap_34912_runs,
                                              &ctx->propagateFixKzisegmap_34912_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->propagateFixKzisegmap_34912,
                                            grid[0], grid[1], grid[2],
                                            segmap_group_sizze_35038, 1, 1, 0,
                                            NULL, kernel_args_41457, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_41459 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "propagateFixK.segmap_34912", time_end_41459 -
                            time_start_41458);
                }
            }
            ctx->failure_is_an_option = 1;
            if (memblock_unref_device(ctx, &mem_39519, "mem_39519") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39523, "mem_39523") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39561, "mem_39561") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40098,
                                      "double_buffer_mem_40098") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40099,
                                      "double_buffer_mem_40099") != 0)
                return 1;
            
            struct memblock_device mem_40003;
            
            mem_40003.references = NULL;
            if (memblock_alloc_device(ctx, &mem_40003, bytes_39512,
                                      "mem_40003")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_40003, 0,
                                                      mem_39671, 0, 1, nc_31615,
                                                      8) != 0) {
                err = 1;
                goto cleanup;
            }
            if (memblock_unref_device(ctx, &mem_39671, "mem_39671") != 0)
                return 1;
            
            struct memblock_device mem_40008;
            
            mem_40008.references = NULL;
            if (memblock_alloc_device(ctx, &mem_40008, bytes_39512,
                                      "mem_40008")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_40008, 0,
                                                      mem_39675, 0, 1, nc_31615,
                                                      8) != 0) {
                err = 1;
                goto cleanup;
            }
            if (memblock_unref_device(ctx, &mem_39675, "mem_39675") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_40010, &mem_40003,
                                    "mem_40003") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_40011, &mem_40008,
                                    "mem_40008") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_40008, "mem_40008") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_40003, "mem_40003") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40099,
                                      "double_buffer_mem_40099") != 0)
                return 1;
            if (memblock_unref_device(ctx, &double_buffer_mem_40098,
                                      "double_buffer_mem_40098") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39561, "mem_39561") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39675, "mem_39675") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39671, "mem_39671") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39523, "mem_39523") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39519, "mem_39519") != 0)
                return 1;
        } else {
            struct memblock_device res_mem_39998;
            
            res_mem_39998.references = NULL;
            
            struct memblock_device res_mem_39999;
            
            res_mem_39999.references = NULL;
            
            int32_t local_memory_capacity_40453;
            
            local_memory_capacity_40453 = ctx->cuda.max_shared_memory;
            if (((sle64(0, sext_i32_i64(local_memory_capacity_40453)) &&
                  sle64(0, sext_i32_i64(local_memory_capacity_40453))) &&
                 sle64(64 + bytes_39559 + 32 + 32 + (int64_t) sizeof(int32_t) *
                       sext_i32_i64(ppl_31631) + (int64_t) sizeof(float) *
                       sext_i32_i64(ppl_31631),
                       sext_i32_i64(local_memory_capacity_40453))) &&
                intra_suff_and_fits_35163) {
                struct memblock_device mem_39679;
                
                mem_39679.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39679, bytes_39512,
                                          "mem_39679")) {
                    err = 1;
                    goto cleanup;
                }
                
                int32_t group_sizze_40369;
                
                group_sizze_40369 = ctx->sizes.propagateFixKzigroup_sizze_40369;
                
                int64_t num_groups_40370;
                
                num_groups_40370 = sdiv_up64(sext_i32_i64(nc_31615) * 8,
                                             sext_i32_i64(group_sizze_40369));
                
                CUdeviceptr kernel_arg_41474 = mem_39428.mem;
                CUdeviceptr kernel_arg_41475 = mem_39679.mem;
                
                if ((((((1 && sext_i64_i32(num_groups_40370) != 0) && 1 != 0) &&
                       1 != 0) && group_sizze_40369 != 0) && 1 != 0) && 1 !=
                    0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = sext_i64_i32(num_groups_40370);
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41471[] = {&nc_31615, &i_31649,
                                                 &kernel_arg_41474,
                                                 &ctx_val_39482,
                                                 &kernel_arg_41475};
                    int64_t time_start_41472 = 0, time_end_41473 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "propagateFixK.copy_40366");
                        fprintf(stderr, "%d", sext_i64_i32(num_groups_40370));
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", group_sizze_40369);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41472 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->propagateFixKzicopy_40366_runs,
                                                  &ctx->propagateFixKzicopy_40366_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->propagateFixKzicopy_40366,
                                                grid[0], grid[1], grid[2],
                                                group_sizze_40369, 1, 1, 0,
                                                NULL, kernel_args_41471, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41473 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "propagateFixK.copy_40366", time_end_41473 -
                                time_start_41472);
                    }
                }
                
                struct memblock_device mem_39683;
                
                mem_39683.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39683, bytes_39512,
                                          "mem_39683")) {
                    err = 1;
                    goto cleanup;
                }
                
                int32_t group_sizze_40374;
                
                group_sizze_40374 = ctx->sizes.propagateFixKzigroup_sizze_40374;
                
                int64_t num_groups_40375;
                
                num_groups_40375 = sdiv_up64(sext_i32_i64(nc_31615) * 8,
                                             sext_i32_i64(group_sizze_40374));
                
                CUdeviceptr kernel_arg_41479 = mem_39432.mem;
                CUdeviceptr kernel_arg_41480 = mem_39683.mem;
                
                if ((((((1 && sext_i64_i32(num_groups_40375) != 0) && 1 != 0) &&
                       1 != 0) && group_sizze_40374 != 0) && 1 != 0) && 1 !=
                    0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = sext_i64_i32(num_groups_40375);
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41476[] = {&nc_31615, &i_31649,
                                                 &kernel_arg_41479,
                                                 &ctx_val_39482,
                                                 &kernel_arg_41480};
                    int64_t time_start_41477 = 0, time_end_41478 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "propagateFixK.copy_40371");
                        fprintf(stderr, "%d", sext_i64_i32(num_groups_40375));
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", group_sizze_40374);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41477 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->propagateFixKzicopy_40371_runs,
                                                  &ctx->propagateFixKzicopy_40371_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->propagateFixKzicopy_40371,
                                                grid[0], grid[1], grid[2],
                                                group_sizze_40374, 1, 1, 0,
                                                NULL, kernel_args_41476, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41478 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "propagateFixK.copy_40371", time_end_41478 -
                                time_start_41477);
                    }
                }
                
                struct memblock_device mem_39823;
                
                mem_39823.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39823, bytes_39512,
                                          "mem_39823")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39827;
                
                mem_39827.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39827, bytes_39512,
                                          "mem_39827")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device double_buffer_mem_40104;
                
                double_buffer_mem_40104.references = NULL;
                if (memblock_alloc_device(ctx, &double_buffer_mem_40104,
                                          total_sizze_40185,
                                          "double_buffer_mem_40104")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device double_buffer_mem_40105;
                
                double_buffer_mem_40105.references = NULL;
                if (memblock_alloc_device(ctx, &double_buffer_mem_40105,
                                          total_sizze_40186,
                                          "double_buffer_mem_40105")) {
                    err = 1;
                    goto cleanup;
                }
                
                unsigned int shared_sizze_41484 = (int64_t) sizeof(float) *
                             sext_i32_i64(ppl_31631);
                unsigned int shared_sizze_41486 = (int64_t) sizeof(int32_t) *
                             sext_i32_i64(ppl_31631);
                unsigned int shared_sizze_41488 = 32;
                unsigned int shared_sizze_41490 = 32;
                unsigned int shared_sizze_41492 = bytes_39559;
                unsigned int shared_sizze_41494 = 32;
                unsigned int shared_sizze_41496 = 32;
                CUdeviceptr kernel_arg_41498 = ref_pts_mem_39418.mem;
                CUdeviceptr kernel_arg_41499 = mem_39450.mem;
                CUdeviceptr kernel_arg_41500 = mem_39511.mem;
                CUdeviceptr kernel_arg_41501 = mem_39515.mem;
                CUdeviceptr kernel_arg_41502 = mem_39679.mem;
                CUdeviceptr kernel_arg_41503 = mem_39683.mem;
                CUdeviceptr kernel_arg_41504 = mem_39823.mem;
                CUdeviceptr kernel_arg_41505 = mem_39827.mem;
                CUdeviceptr kernel_arg_41506 = double_buffer_mem_40104.mem;
                CUdeviceptr kernel_arg_41507 = double_buffer_mem_40105.mem;
                unsigned int shared_offset_41485 = 0;
                unsigned int shared_offset_41487 = 0 + (shared_sizze_41484 +
                                                        (8 -
                                                         shared_sizze_41484 %
                                                         8) % 8);
                unsigned int shared_offset_41489 = 0 + (shared_sizze_41484 +
                                                        (8 -
                                                         shared_sizze_41484 %
                                                         8) % 8) +
                             (shared_sizze_41486 + (8 - shared_sizze_41486 %
                                                    8) % 8);
                unsigned int shared_offset_41491 = 0 + (shared_sizze_41484 +
                                                        (8 -
                                                         shared_sizze_41484 %
                                                         8) % 8) +
                             (shared_sizze_41486 + (8 - shared_sizze_41486 %
                                                    8) % 8) +
                             (shared_sizze_41488 + (8 - shared_sizze_41488 %
                                                    8) % 8);
                unsigned int shared_offset_41493 = 0 + (shared_sizze_41484 +
                                                        (8 -
                                                         shared_sizze_41484 %
                                                         8) % 8) +
                             (shared_sizze_41486 + (8 - shared_sizze_41486 %
                                                    8) % 8) +
                             (shared_sizze_41488 + (8 - shared_sizze_41488 %
                                                    8) % 8) +
                             (shared_sizze_41490 + (8 - shared_sizze_41490 %
                                                    8) % 8);
                unsigned int shared_offset_41495 = 0 + (shared_sizze_41484 +
                                                        (8 -
                                                         shared_sizze_41484 %
                                                         8) % 8) +
                             (shared_sizze_41486 + (8 - shared_sizze_41486 %
                                                    8) % 8) +
                             (shared_sizze_41488 + (8 - shared_sizze_41488 %
                                                    8) % 8) +
                             (shared_sizze_41490 + (8 - shared_sizze_41490 %
                                                    8) % 8) +
                             (shared_sizze_41492 + (8 - shared_sizze_41492 %
                                                    8) % 8);
                unsigned int shared_offset_41497 = 0 + (shared_sizze_41484 +
                                                        (8 -
                                                         shared_sizze_41484 %
                                                         8) % 8) +
                             (shared_sizze_41486 + (8 - shared_sizze_41486 %
                                                    8) % 8) +
                             (shared_sizze_41488 + (8 - shared_sizze_41488 %
                                                    8) % 8) +
                             (shared_sizze_41490 + (8 - shared_sizze_41490 %
                                                    8) % 8) +
                             (shared_sizze_41492 + (8 - shared_sizze_41492 %
                                                    8) % 8) +
                             (shared_sizze_41494 + (8 - shared_sizze_41494 %
                                                    8) % 8);
                
                if ((((((1 && nc_31615 != 0) && 1 != 0) && 1 != 0) &&
                      ppl_31631 != 0) && 1 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = nc_31615;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41481[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &shared_offset_41485,
                                                 &shared_offset_41487,
                                                 &shared_offset_41489,
                                                 &shared_offset_41491,
                                                 &shared_offset_41493,
                                                 &shared_offset_41495,
                                                 &shared_offset_41497, &d_31575,
                                                 &nr_31586, &nc_31615,
                                                 &num_leaves_31627, &ppl_31631,
                                                 &i_31649, &kernel_arg_41498,
                                                 &kernel_arg_41499,
                                                 &kernel_arg_41500,
                                                 &kernel_arg_41501,
                                                 &kernel_arg_41502,
                                                 &kernel_arg_41503,
                                                 &kernel_arg_41504,
                                                 &kernel_arg_41505,
                                                 &kernel_arg_41506,
                                                 &kernel_arg_41507};
                    int64_t time_start_41482 = 0, time_end_41483 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "propagateFixK.segmap_intragroup_34910");
                        fprintf(stderr, "%d", nc_31615);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", ppl_31631);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41482 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->propagateFixKzisegmap_intragroup_34910_runs,
                                                  &ctx->propagateFixKzisegmap_intragroup_34910_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->propagateFixKzisegmap_intragroup_34910,
                                                grid[0], grid[1], grid[2],
                                                ppl_31631, 1, 1, 0 +
                                                (shared_sizze_41484 + (8 -
                                                                       shared_sizze_41484 %
                                                                       8) % 8) +
                                                (shared_sizze_41486 + (8 -
                                                                       shared_sizze_41486 %
                                                                       8) % 8) +
                                                (shared_sizze_41488 + (8 -
                                                                       shared_sizze_41488 %
                                                                       8) % 8) +
                                                (shared_sizze_41490 + (8 -
                                                                       shared_sizze_41490 %
                                                                       8) % 8) +
                                                (shared_sizze_41492 + (8 -
                                                                       shared_sizze_41492 %
                                                                       8) % 8) +
                                                (shared_sizze_41494 + (8 -
                                                                       shared_sizze_41494 %
                                                                       8) % 8) +
                                                (shared_sizze_41496 + (8 -
                                                                       shared_sizze_41496 %
                                                                       8) % 8),
                                                NULL, kernel_args_41481, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41483 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "propagateFixK.segmap_intragroup_34910",
                                time_end_41483 - time_start_41482);
                    }
                }
                ctx->failure_is_an_option = 1;
                if (memblock_unref_device(ctx, &mem_39679, "mem_39679") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39683, "mem_39683") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40104,
                                          "double_buffer_mem_40104") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40105,
                                          "double_buffer_mem_40105") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39998, &mem_39823,
                                        "mem_39823") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39999, &mem_39827,
                                        "mem_39827") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40105,
                                          "double_buffer_mem_40105") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40104,
                                          "double_buffer_mem_40104") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39827, "mem_39827") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39823, "mem_39823") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39683, "mem_39683") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39679, "mem_39679") != 0)
                    return 1;
            } else {
                struct memblock_device mem_39831;
                
                mem_39831.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39831, bytes_39512,
                                          "mem_39831")) {
                    err = 1;
                    goto cleanup;
                }
                
                int32_t group_sizze_40413;
                
                group_sizze_40413 = ctx->sizes.propagateFixKzigroup_sizze_40413;
                
                int64_t num_groups_40414;
                
                num_groups_40414 = sdiv_up64(sext_i32_i64(nc_31615) * 8,
                                             sext_i32_i64(group_sizze_40413));
                
                CUdeviceptr kernel_arg_41511 = mem_39428.mem;
                CUdeviceptr kernel_arg_41512 = mem_39831.mem;
                
                if ((((((1 && sext_i64_i32(num_groups_40414) != 0) && 1 != 0) &&
                       1 != 0) && group_sizze_40413 != 0) && 1 != 0) && 1 !=
                    0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = sext_i64_i32(num_groups_40414);
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41508[] = {&nc_31615, &i_31649,
                                                 &kernel_arg_41511,
                                                 &ctx_val_39482,
                                                 &kernel_arg_41512};
                    int64_t time_start_41509 = 0, time_end_41510 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "propagateFixK.copy_40410");
                        fprintf(stderr, "%d", sext_i64_i32(num_groups_40414));
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", group_sizze_40413);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41509 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->propagateFixKzicopy_40410_runs,
                                                  &ctx->propagateFixKzicopy_40410_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->propagateFixKzicopy_40410,
                                                grid[0], grid[1], grid[2],
                                                group_sizze_40413, 1, 1, 0,
                                                NULL, kernel_args_41508, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41510 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "propagateFixK.copy_40410", time_end_41510 -
                                time_start_41509);
                    }
                }
                
                struct memblock_device mem_39835;
                
                mem_39835.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39835, bytes_39512,
                                          "mem_39835")) {
                    err = 1;
                    goto cleanup;
                }
                
                int32_t group_sizze_40418;
                
                group_sizze_40418 = ctx->sizes.propagateFixKzigroup_sizze_40418;
                
                int64_t num_groups_40419;
                
                num_groups_40419 = sdiv_up64(sext_i32_i64(nc_31615) * 8,
                                             sext_i32_i64(group_sizze_40418));
                
                CUdeviceptr kernel_arg_41516 = mem_39432.mem;
                CUdeviceptr kernel_arg_41517 = mem_39835.mem;
                
                if ((((((1 && sext_i64_i32(num_groups_40419) != 0) && 1 != 0) &&
                       1 != 0) && group_sizze_40418 != 0) && 1 != 0) && 1 !=
                    0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = sext_i64_i32(num_groups_40419);
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41513[] = {&nc_31615, &i_31649,
                                                 &kernel_arg_41516,
                                                 &ctx_val_39482,
                                                 &kernel_arg_41517};
                    int64_t time_start_41514 = 0, time_end_41515 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "propagateFixK.copy_40415");
                        fprintf(stderr, "%d", sext_i64_i32(num_groups_40419));
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", group_sizze_40418);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41514 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->propagateFixKzicopy_40415_runs,
                                                  &ctx->propagateFixKzicopy_40415_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->propagateFixKzicopy_40415,
                                                grid[0], grid[1], grid[2],
                                                group_sizze_40418, 1, 1, 0,
                                                NULL, kernel_args_41513, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41515 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "propagateFixK.copy_40415", time_end_41515 -
                                time_start_41514);
                    }
                }
                
                struct memblock_device mem_39983;
                
                mem_39983.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39983, bytes_39512,
                                          "mem_39983")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39987;
                
                mem_39987.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39987, bytes_39512,
                                          "mem_39987")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39873;
                
                mem_39873.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39873, total_sizze_40190,
                                          "mem_39873")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device double_buffer_mem_40110;
                
                double_buffer_mem_40110.references = NULL;
                if (memblock_alloc_device(ctx, &double_buffer_mem_40110,
                                          total_sizze_40191,
                                          "double_buffer_mem_40110")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device double_buffer_mem_40111;
                
                double_buffer_mem_40111.references = NULL;
                if (memblock_alloc_device(ctx, &double_buffer_mem_40111,
                                          total_sizze_40192,
                                          "double_buffer_mem_40111")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                
                CUdeviceptr kernel_arg_41521 = mem_39450.mem;
                CUdeviceptr kernel_arg_41522 = mem_39457.mem;
                CUdeviceptr kernel_arg_41523 = mem_39511.mem;
                CUdeviceptr kernel_arg_41524 = mem_39515.mem;
                CUdeviceptr kernel_arg_41525 = mem_39831.mem;
                CUdeviceptr kernel_arg_41526 = mem_39835.mem;
                CUdeviceptr kernel_arg_41527 = mem_39873.mem;
                CUdeviceptr kernel_arg_41528 = mem_39983.mem;
                CUdeviceptr kernel_arg_41529 = mem_39987.mem;
                CUdeviceptr kernel_arg_41530 = double_buffer_mem_40110.mem;
                CUdeviceptr kernel_arg_41531 = double_buffer_mem_40111.mem;
                
                if ((((((1 && num_groups_35414 != 0) && 1 != 0) && 1 != 0) &&
                      segmap_group_sizze_35413 != 0) && 1 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = num_groups_35414;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41518[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &d_31575, &nr_31586, &nc_31615,
                                                 &num_leaves_31627, &ppl_31631,
                                                 &i_31649, &num_groups_35414,
                                                 &kernel_arg_41521,
                                                 &kernel_arg_41522,
                                                 &kernel_arg_41523,
                                                 &kernel_arg_41524,
                                                 &kernel_arg_41525,
                                                 &kernel_arg_41526,
                                                 &kernel_arg_41527,
                                                 &kernel_arg_41528,
                                                 &kernel_arg_41529,
                                                 &kernel_arg_41530,
                                                 &kernel_arg_41531};
                    int64_t time_start_41519 = 0, time_end_41520 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "propagateFixK.segmap_35287");
                        fprintf(stderr, "%d", num_groups_35414);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", segmap_group_sizze_35413);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41519 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->propagateFixKzisegmap_35287_runs,
                                                  &ctx->propagateFixKzisegmap_35287_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->propagateFixKzisegmap_35287,
                                                grid[0], grid[1], grid[2],
                                                segmap_group_sizze_35413, 1, 1,
                                                0, NULL, kernel_args_41518,
                                                NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41520 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "propagateFixK.segmap_35287", time_end_41520 -
                                time_start_41519);
                    }
                }
                ctx->failure_is_an_option = 1;
                if (memblock_unref_device(ctx, &mem_39831, "mem_39831") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39835, "mem_39835") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39873, "mem_39873") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40110,
                                          "double_buffer_mem_40110") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40111,
                                          "double_buffer_mem_40111") != 0)
                    return 1;
                
                struct memblock_device mem_39991;
                
                mem_39991.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39991, bytes_39512,
                                          "mem_39991")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39991, 0,
                                                          mem_39983, 0, 1,
                                                          nc_31615, 8) != 0) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_unref_device(ctx, &mem_39983, "mem_39983") != 0)
                    return 1;
                
                struct memblock_device mem_39996;
                
                mem_39996.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39996, bytes_39512,
                                          "mem_39996")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39996, 0,
                                                          mem_39987, 0, 1,
                                                          nc_31615, 8) != 0) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_unref_device(ctx, &mem_39987, "mem_39987") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39998, &mem_39991,
                                        "mem_39991") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39999, &mem_39996,
                                        "mem_39996") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39996, "mem_39996") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39991, "mem_39991") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40111,
                                          "double_buffer_mem_40111") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &double_buffer_mem_40110,
                                          "double_buffer_mem_40110") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39873, "mem_39873") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39987, "mem_39987") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39983, "mem_39983") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39835, "mem_39835") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39831, "mem_39831") != 0)
                    return 1;
            }
            if (memblock_set_device(ctx, &res_mem_40010, &res_mem_39998,
                                    "res_mem_39998") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_40011, &res_mem_39999,
                                    "res_mem_39999") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39999, "res_mem_39999") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39998, "res_mem_39998") !=
                0)
                return 1;
        }
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_dev_to_dev_runs,
                                          &ctx->copy_dev_to_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpy(mem_39428.mem + sext_i32_i64(i_31649 *
                                  ctx_val_39482 * 4), res_mem_40010.mem + 0,
                                  sext_i32_i64(nc_31615 * 8) *
                                  (int64_t) sizeof(int32_t)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        if (memblock_unref_device(ctx, &res_mem_40010, "res_mem_40010") != 0)
            return 1;
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_dev_to_dev_runs,
                                          &ctx->copy_dev_to_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpy(mem_39432.mem + sext_i32_i64(i_31649 *
                                  ctx_val_39482 * 4), res_mem_40011.mem + 0,
                                  sext_i32_i64(nc_31615 * 8) *
                                  (int64_t) sizeof(float)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        if (memblock_unref_device(ctx, &res_mem_40011, "res_mem_40011") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_40011, "res_mem_40011") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_40010, "res_mem_40010") != 0)
            return 1;
    }
    if (memblock_unref_device(ctx, &mem_39443, "mem_39443") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39450, "mem_39450") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39457, "mem_39457") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39511, "mem_39511") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39515, "mem_39515") != 0)
        return 1;
    
    bool dim_match_31848 = n_31578 == x_31616;
    bool empty_or_match_cert_31849;
    
    if (!dim_match_31848) {
        ctx->error = msgprintf("Error: %s%d%s%d%s%d%s%d%s\n\nBacktrace:\n%s",
                               "Value of (core language) shape (", x_31616,
                               ", ", 8, ") cannot match shape of type `[",
                               n_31578, "][", 8, "](i32, f32)`.",
                               "-> #0  driverKNN.fut:409:20-52\n   #1  driverKNN.fut:392:1-414:28\n");
        if (memblock_unref_device(ctx, &mem_39515, "mem_39515") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39511, "mem_39511") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39457, "mem_39457") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39450, "mem_39450") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39443, "mem_39443") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39438, "mem_39438") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39435, "mem_39435") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39432, "mem_39432") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39428, "mem_39428") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    struct memblock_device mem_40037;
    
    mem_40037.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40037, bytes_39425, "mem_40037")) {
        err = 1;
        goto cleanup;
    }
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(mem_40037.mem + 0, mem_39432.mem + 0,
                              sext_i32_i64(n_31578 * 8) *
                              (int64_t) sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    if (memblock_unref_device(ctx, &mem_39432, "mem_39432") != 0)
        return 1;
    
    int32_t segmap_group_sizze_35639;
    
    segmap_group_sizze_35639 =
        ctx->sizes.propagateFixKzisegmap_group_sizze_35598;
    
    int64_t segmap_group_sizze_35640 = sext_i32_i64(segmap_group_sizze_35639);
    int64_t segmap_usable_groups_64_35641 = sdiv_up64(binop_x_39427,
                                                      segmap_group_sizze_35640);
    int32_t segmap_usable_groups_35642 =
            sext_i64_i32(segmap_usable_groups_64_35641);
    struct memblock_device mem_40042;
    
    mem_40042.references = NULL;
    if (memblock_alloc_device(ctx, &mem_40042, bytes_39425, "mem_40042")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(stderr, "%s\n", "\n# SegMap");
    
    CUdeviceptr kernel_arg_41535 = indir_mem_39419.mem;
    CUdeviceptr kernel_arg_41536 = mem_39428.mem;
    CUdeviceptr kernel_arg_41537 = mem_40042.mem;
    
    if ((((((1 && segmap_usable_groups_35642 != 0) && 1 != 0) && 1 != 0) &&
          segmap_group_sizze_35639 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = segmap_usable_groups_35642;
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41532[] = {&ctx->global_failure,
                                     &ctx->failure_is_an_option,
                                     &ctx->global_failure_args, &m_31574,
                                     &n_31578, &kernel_arg_41535,
                                     &kernel_arg_41536, &ctx_val_39482,
                                     &kernel_arg_41537};
        int64_t time_start_41533 = 0, time_end_41534 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "propagateFixK.segmap_35593");
            fprintf(stderr, "%d", segmap_usable_groups_35642);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", segmap_group_sizze_35639);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41533 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->propagateFixKzisegmap_35593_runs,
                                      &ctx->propagateFixKzisegmap_35593_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->propagateFixKzisegmap_35593, grid[0],
                                    grid[1], grid[2], segmap_group_sizze_35639,
                                    1, 1, 0, NULL, kernel_args_41532, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41534 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "propagateFixK.segmap_35593", time_end_41534 -
                    time_start_41533);
        }
    }
    ctx->failure_is_an_option = 1;
    if (memblock_unref_device(ctx, &mem_39428, "mem_39428") != 0)
        return 1;
    out_arrsizze_40296 = n_31578;
    out_arrsizze_40297 = 8;
    out_arrsizze_40299 = n_31578;
    out_arrsizze_40300 = 8;
    if (memblock_set_device(ctx, &out_mem_40295, &mem_40042, "mem_40042") != 0)
        return 1;
    if (memblock_set_device(ctx, &out_mem_40298, &mem_40037, "mem_40037") != 0)
        return 1;
    (*out_mem_p_41431).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41431, &out_mem_40295,
                            "out_mem_40295") != 0)
        return 1;
    *out_out_arrsizze_41432 = out_arrsizze_40296;
    *out_out_arrsizze_41433 = out_arrsizze_40297;
    (*out_mem_p_41434).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41434, &out_mem_40298,
                            "out_mem_40298") != 0)
        return 1;
    *out_out_arrsizze_41435 = out_arrsizze_40299;
    *out_out_arrsizze_41436 = out_arrsizze_40300;
    if (memblock_unref_device(ctx, &mem_40042, "mem_40042") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_40037, "mem_40037") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39515, "mem_39515") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39511, "mem_39511") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39457, "mem_39457") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39450, "mem_39450") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39443, "mem_39443") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39438, "mem_39438") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39435, "mem_39435") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39432, "mem_39432") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39428, "mem_39428") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40298, "out_mem_40298") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
static int futrts_reducePatchDim(struct futhark_context *ctx,
                                 struct memblock_device *out_mem_p_41538,
                                 int32_t *out_out_arrsizze_41539,
                                 int32_t *out_out_arrsizze_41540,
                                 struct memblock_device img_mem_39418,
                                 struct memblock_device comps_mem_39419,
                                 struct memblock_device means_mem_39420,
                                 int32_t n_30993, int32_t d_30994,
                                 int32_t d_red_30995, int32_t d_30996,
                                 int32_t d_30997)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    int32_t out_arrsizze_40297;
    bool dim_match_31001 = d_30994 == d_30996;
    bool empty_or_match_cert_31002;
    
    if (!dim_match_31001) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:47:1-52:11\n");
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_31004 = d_30994 == d_30997;
    bool empty_or_match_cert_31005;
    
    if (!dim_match_31004) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:47:1-52:11\n");
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool suff_outer_par_33762;
    
    suff_outer_par_33762 = ctx->sizes.reducePatchDimzisuff_outer_par_0 <=
        n_30993;
    
    int64_t n_33785 = sext_i32_i64(n_30993);
    int32_t segmap_group_sizze_33787;
    
    segmap_group_sizze_33787 =
        ctx->sizes.reducePatchDimzisegmap_group_sizze_33767;
    
    int32_t num_groups_33788;
    int32_t max_num_groups_40298;
    
    max_num_groups_40298 = ctx->sizes.reducePatchDimzisegmap_num_groups_33769;
    num_groups_33788 = sext_i64_i32(smax64(1, smin64(sdiv_up64(n_33785,
                                                               sext_i32_i64(segmap_group_sizze_33787)),
                                                     sext_i32_i64(max_num_groups_40298))));
    
    int64_t d_red_33881 = sext_i32_i64(d_red_30995);
    int64_t nest_sizze_33883 = n_33785 * d_red_33881;
    int32_t segmap_group_sizze_33884;
    
    segmap_group_sizze_33884 =
        ctx->sizes.reducePatchDimzisegmap_group_sizze_33811;
    
    int64_t segmap_group_sizze_33885 = sext_i32_i64(segmap_group_sizze_33884);
    int32_t comparatee_33889 = n_30993 * d_red_30995;
    bool suff_outer_par_33890;
    
    suff_outer_par_33890 = ctx->sizes.reducePatchDimzisuff_outer_par_1 <=
        comparatee_33889;
    
    int64_t d_33905 = sext_i32_i64(d_30994);
    int64_t nest_sizze_33910 = nest_sizze_33883 * d_33905;
    int32_t segred_group_sizze_33911;
    
    segred_group_sizze_33911 =
        ctx->sizes.reducePatchDimzisegred_group_sizze_33840;
    
    int32_t num_groups_33912;
    int32_t max_num_groups_40299;
    
    max_num_groups_40299 = ctx->sizes.reducePatchDimzisegred_num_groups_33842;
    num_groups_33912 = sext_i64_i32(smax64(1, smin64(sdiv_up64(nest_sizze_33910,
                                                               sext_i32_i64(segred_group_sizze_33911)),
                                                     sext_i32_i64(max_num_groups_40299))));
    
    int64_t bytes_39421 = n_33785 * d_33905;
    int64_t binop_x_39444 = n_33785 * d_red_33881;
    int64_t bytes_39441 = 4 * binop_x_39444;
    int64_t bytes_39426 = 4 * d_red_33881;
    int64_t bytes_39464 = 4 * nest_sizze_33883;
    int64_t binop_x_39447 = sext_i32_i64(d_30996);
    int64_t binop_x_39449 = d_red_33881 * binop_x_39447;
    int64_t bytes_39446 = 4 * binop_x_39449;
    int32_t num_threads_40143 = segmap_group_sizze_33787 * num_groups_33788;
    int64_t num_threads64_40145 = sext_i32_i64(num_threads_40143);
    int64_t total_sizze_40146 = bytes_39426 * num_threads64_40145;
    struct memblock_device res_mem_39470;
    
    res_mem_39470.references = NULL;
    
    int32_t local_memory_capacity_40377;
    
    local_memory_capacity_40377 = ctx->cuda.max_shared_memory;
    if (sle64(0, sext_i32_i64(local_memory_capacity_40377)) &&
        suff_outer_par_33762) {
        struct memblock_device mem_39424;
        
        mem_39424.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39424, bytes_39421, "mem_39424")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_i8(ctx, mem_39424, 0,
                                                 img_mem_39418, 0, 1, d_30994,
                                                 n_30993) != 0) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_39445;
        
        mem_39445.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39445, bytes_39441, "mem_39445")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_39428;
        
        mem_39428.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39428, total_sizze_40146,
                                  "mem_39428")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegMap");
        
        CUdeviceptr kernel_arg_41544 = comps_mem_39419.mem;
        CUdeviceptr kernel_arg_41545 = means_mem_39420.mem;
        CUdeviceptr kernel_arg_41546 = mem_39424.mem;
        CUdeviceptr kernel_arg_41547 = mem_39428.mem;
        CUdeviceptr kernel_arg_41548 = mem_39445.mem;
        
        if ((((((1 && num_groups_33788 != 0) && 1 != 0) && 1 != 0) &&
              segmap_group_sizze_33787 != 0) && 1 != 0) && 1 != 0) {
            int perm[3] = {0, 1, 2};
            
            if (1 >= 1 << 16) {
                perm[1] = perm[0];
                perm[0] = 1;
            }
            if (1 >= 1 << 16) {
                perm[2] = perm[0];
                perm[0] = 2;
            }
            
            size_t grid[3];
            
            grid[perm[0]] = num_groups_33788;
            grid[perm[1]] = 1;
            grid[perm[2]] = 1;
            
            void *kernel_args_41541[] = {&ctx->global_failure, &n_30993,
                                         &d_30994, &d_red_30995, &d_30996,
                                         &num_groups_33788, &kernel_arg_41544,
                                         &kernel_arg_41545, &kernel_arg_41546,
                                         &kernel_arg_41547, &kernel_arg_41548};
            int64_t time_start_41542 = 0, time_end_41543 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with grid size (",
                        "reducePatchDim.segmap_33764");
                fprintf(stderr, "%d", num_groups_33788);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ") and block size (");
                fprintf(stderr, "%d", segmap_group_sizze_33787);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ").\n");
                time_start_41542 = get_wall_time();
            }
            
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->reducePatchDimzisegmap_33764_runs,
                                          &ctx->reducePatchDimzisegmap_33764_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuLaunchKernel(ctx->reducePatchDimzisegmap_33764,
                                        grid[0], grid[1], grid[2],
                                        segmap_group_sizze_33787, 1, 1, 0, NULL,
                                        kernel_args_41541, NULL));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            if (ctx->debugging) {
                CUDA_SUCCEED(cuCtxSynchronize());
                time_end_41543 = get_wall_time();
                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                        "reducePatchDim.segmap_33764", time_end_41543 -
                        time_start_41542);
            }
        }
        if (memblock_unref_device(ctx, &mem_39424, "mem_39424") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39428, "mem_39428") != 0)
            return 1;
        
        struct memblock_device mem_39468;
        
        mem_39468.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39468, bytes_39464, "mem_39468")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39468, 0, mem_39445,
                                                  0, 1, n_30993, d_red_30995) !=
            0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_unref_device(ctx, &mem_39445, "mem_39445") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_39470, &mem_39468, "mem_39468") !=
            0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39468, "mem_39468") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39428, "mem_39428") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39445, "mem_39445") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39424, "mem_39424") != 0)
            return 1;
    } else {
        int64_t segmap_usable_groups_64_33886 = sdiv_up64(nest_sizze_33883,
                                                          segmap_group_sizze_33885);
        int32_t segmap_usable_groups_33887 =
                sext_i64_i32(segmap_usable_groups_64_33886);
        struct memblock_device res_mem_39463;
        
        res_mem_39463.references = NULL;
        
        int32_t local_memory_capacity_40376;
        
        local_memory_capacity_40376 = ctx->cuda.max_shared_memory;
        if (sle64(0, sext_i32_i64(local_memory_capacity_40376)) &&
            suff_outer_par_33890) {
            struct memblock_device mem_39450;
            
            mem_39450.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39450, bytes_39446,
                                      "mem_39450")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39450, 0,
                                                      comps_mem_39419, 0, 1,
                                                      d_30996, d_red_30995) !=
                0) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39456;
            
            mem_39456.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39456, bytes_39464,
                                      "mem_39456")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegMap");
            
            CUdeviceptr kernel_arg_41552 = img_mem_39418.mem;
            CUdeviceptr kernel_arg_41553 = means_mem_39420.mem;
            CUdeviceptr kernel_arg_41554 = mem_39450.mem;
            CUdeviceptr kernel_arg_41555 = mem_39456.mem;
            
            if ((((((1 && segmap_usable_groups_33887 != 0) && 1 != 0) && 1 !=
                   0) && segmap_group_sizze_33884 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = segmap_usable_groups_33887;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_41549[] = {&ctx->global_failure, &n_30993,
                                             &d_30994, &d_red_30995,
                                             &kernel_arg_41552,
                                             &kernel_arg_41553,
                                             &kernel_arg_41554,
                                             &kernel_arg_41555};
                int64_t time_start_41550 = 0, time_end_41551 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "reducePatchDim.segmap_33806");
                    fprintf(stderr, "%d", segmap_usable_groups_33887);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segmap_group_sizze_33884);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_41550 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->reducePatchDimzisegmap_33806_runs,
                                              &ctx->reducePatchDimzisegmap_33806_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->reducePatchDimzisegmap_33806,
                                            grid[0], grid[1], grid[2],
                                            segmap_group_sizze_33884, 1, 1, 0,
                                            NULL, kernel_args_41549, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_41551 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "reducePatchDim.segmap_33806", time_end_41551 -
                            time_start_41550);
                }
            }
            if (memblock_unref_device(ctx, &mem_39450, "mem_39450") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_39463, &mem_39456,
                                    "mem_39456") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39456, "mem_39456") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39450, "mem_39450") != 0)
                return 1;
        } else {
            struct memblock_device mem_39462;
            
            mem_39462.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39462, bytes_39464,
                                      "mem_39462")) {
                err = 1;
                goto cleanup;
            }
            if (slt32(d_30994 * 2, segred_group_sizze_33911)) {
                int32_t segment_sizze_nonzzero_40317 = smax32(1, d_30994);
                int32_t num_threads_40318 = num_groups_33912 *
                        segred_group_sizze_33911;
                
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegRed-small");
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_segments",
                            (long long) (n_30993 * d_red_30995), '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segment_size",
                            (long long) d_30994, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segments_per_group",
                            (long long) squot32(segred_group_sizze_33911,
                                                segment_sizze_nonzzero_40317),
                            '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "required_groups",
                            (long long) sdiv_up32(n_30993 * d_red_30995,
                                                  squot32(segred_group_sizze_33911,
                                                          segment_sizze_nonzzero_40317)),
                            '\n');
                
                unsigned int shared_sizze_41559 = (int64_t) sizeof(float) *
                             sext_i32_i64(segred_group_sizze_33911);
                CUdeviceptr kernel_arg_41561 = img_mem_39418.mem;
                CUdeviceptr kernel_arg_41562 = comps_mem_39419.mem;
                CUdeviceptr kernel_arg_41563 = means_mem_39420.mem;
                CUdeviceptr kernel_arg_41564 = mem_39462.mem;
                unsigned int shared_offset_41560 = 0;
                
                if ((((((1 && num_groups_33912 != 0) && 1 != 0) && 1 != 0) &&
                      segred_group_sizze_33911 != 0) && 1 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = num_groups_33912;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41556[] = {&ctx->global_failure,
                                                 &shared_offset_41560, &n_30993,
                                                 &d_30994, &d_red_30995,
                                                 &d_30996, &num_groups_33912,
                                                 &kernel_arg_41561,
                                                 &kernel_arg_41562,
                                                 &kernel_arg_41563,
                                                 &kernel_arg_41564,
                                                 &segment_sizze_nonzzero_40317};
                    int64_t time_start_41557 = 0, time_end_41558 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "reducePatchDim.segred_small_33846");
                        fprintf(stderr, "%d", num_groups_33912);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", segred_group_sizze_33911);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41557 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->reducePatchDimzisegred_small_33846_runs,
                                                  &ctx->reducePatchDimzisegred_small_33846_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->reducePatchDimzisegred_small_33846,
                                                grid[0], grid[1], grid[2],
                                                segred_group_sizze_33911, 1, 1,
                                                0 + (shared_sizze_41559 + (8 -
                                                                           shared_sizze_41559 %
                                                                           8) %
                                                     8), NULL,
                                                kernel_args_41556, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41558 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "reducePatchDim.segred_small_33846",
                                time_end_41558 - time_start_41557);
                    }
                }
            } else {
                int32_t groups_per_segment_40337 = sdiv_up32(num_groups_33912,
                                                             smax32(1, n_30993 *
                                                                    d_red_30995));
                int32_t elements_per_thread_40338 = sdiv_up32(d_30994,
                                                              segred_group_sizze_33911 *
                                                              groups_per_segment_40337);
                int32_t virt_num_groups_40339 = groups_per_segment_40337 *
                        (n_30993 * d_red_30995);
                int32_t num_threads_40340 = num_groups_33912 *
                        segred_group_sizze_33911;
                int32_t threads_per_segment_40341 = groups_per_segment_40337 *
                        segred_group_sizze_33911;
                
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegRed-large");
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_segments",
                            (long long) (n_30993 * d_red_30995), '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "segment_size",
                            (long long) d_30994, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "virt_num_groups",
                            (long long) virt_num_groups_40339, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "num_groups",
                            (long long) num_groups_33912, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "group_size",
                            (long long) segred_group_sizze_33911, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "elems_per_thread",
                            (long long) elements_per_thread_40338, '\n');
                if (ctx->debugging)
                    fprintf(stderr, "%s: %llu%c", "groups_per_segment",
                            (long long) groups_per_segment_40337, '\n');
                
                struct memblock_device group_res_arr_mem_40342;
                
                group_res_arr_mem_40342.references = NULL;
                if (memblock_alloc_device(ctx, &group_res_arr_mem_40342,
                                          (int64_t) sizeof(float) *
                                          (sext_i32_i64(segred_group_sizze_33911) *
                                           sext_i32_i64(virt_num_groups_40339)),
                                          "group_res_arr_mem_40342")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device reducePatchDimzicounter_mem_40344 =
                                       ctx->reducePatchDimzicounter_mem_40344;
                unsigned int shared_sizze_41569 = (int64_t) sizeof(bool);
                unsigned int shared_sizze_41571 = (int64_t) sizeof(float) *
                             sext_i32_i64(segred_group_sizze_33911);
                CUdeviceptr kernel_arg_41573 = img_mem_39418.mem;
                CUdeviceptr kernel_arg_41574 = comps_mem_39419.mem;
                CUdeviceptr kernel_arg_41575 = means_mem_39420.mem;
                CUdeviceptr kernel_arg_41576 = mem_39462.mem;
                CUdeviceptr kernel_arg_41577 = group_res_arr_mem_40342.mem;
                CUdeviceptr kernel_arg_41578 =
                            reducePatchDimzicounter_mem_40344.mem;
                unsigned int shared_offset_41570 = 0;
                unsigned int shared_offset_41572 = 0 + (shared_sizze_41569 +
                                                        (8 -
                                                         shared_sizze_41569 %
                                                         8) % 8);
                
                if ((((((1 && num_groups_33912 != 0) && 1 != 0) && 1 != 0) &&
                      segred_group_sizze_33911 != 0) && 1 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = num_groups_33912;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41566[] = {&ctx->global_failure,
                                                 &shared_offset_41570,
                                                 &shared_offset_41572, &d_30994,
                                                 &d_red_30995, &d_30996,
                                                 &num_groups_33912,
                                                 &kernel_arg_41573,
                                                 &kernel_arg_41574,
                                                 &kernel_arg_41575,
                                                 &kernel_arg_41576,
                                                 &groups_per_segment_40337,
                                                 &elements_per_thread_40338,
                                                 &virt_num_groups_40339,
                                                 &threads_per_segment_40341,
                                                 &kernel_arg_41577,
                                                 &kernel_arg_41578};
                    int64_t time_start_41567 = 0, time_end_41568 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "reducePatchDim.segred_large_33846");
                        fprintf(stderr, "%d", num_groups_33912);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", segred_group_sizze_33911);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41567 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->reducePatchDimzisegred_large_33846_runs,
                                                  &ctx->reducePatchDimzisegred_large_33846_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->reducePatchDimzisegred_large_33846,
                                                grid[0], grid[1], grid[2],
                                                segred_group_sizze_33911, 1, 1,
                                                0 + (shared_sizze_41569 + (8 -
                                                                           shared_sizze_41569 %
                                                                           8) %
                                                     8) + (shared_sizze_41571 +
                                                           (8 -
                                                            shared_sizze_41571 %
                                                            8) % 8), NULL,
                                                kernel_args_41566, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41568 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "reducePatchDim.segred_large_33846",
                                time_end_41568 - time_start_41567);
                    }
                }
                if (memblock_unref_device(ctx, &group_res_arr_mem_40342,
                                          "group_res_arr_mem_40342") != 0)
                    return 1;
            }
            if (memblock_set_device(ctx, &res_mem_39463, &mem_39462,
                                    "mem_39462") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39462, "mem_39462") != 0)
                return 1;
        }
        if (memblock_set_device(ctx, &res_mem_39470, &res_mem_39463,
                                "res_mem_39463") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39463, "res_mem_39463") != 0)
            return 1;
    }
    out_arrsizze_40296 = n_30993;
    out_arrsizze_40297 = d_red_30995;
    if (memblock_set_device(ctx, &out_mem_40295, &res_mem_39470,
                            "res_mem_39470") != 0)
        return 1;
    (*out_mem_p_41538).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41538, &out_mem_40295,
                            "out_mem_40295") != 0)
        return 1;
    *out_out_arrsizze_41539 = out_arrsizze_40296;
    *out_out_arrsizze_41540 = out_arrsizze_40297;
    if (memblock_unref_device(ctx, &res_mem_39470, "res_mem_39470") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
static int futrts_selectBestNN(struct futhark_context *ctx,
                               struct memblock_device *out_mem_p_41579,
                               int32_t *out_out_arrsizze_41580,
                               struct memblock_device *out_mem_p_41581,
                               int32_t *out_out_arrsizze_41582,
                               float *out_scalar_out_41583,
                               struct memblock_device knn_inds_mem_39418,
                               struct memblock_device imgA_mem_39419,
                               struct memblock_device imgB_mem_39420,
                               int32_t n_30870, int32_t kk_30871,
                               int32_t h1_30872, int32_t w1_30873,
                               int32_t c_30874, int32_t h2_30875,
                               int32_t w2_30876, int32_t c_30877,
                               int32_t p_30878)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    struct memblock_device out_mem_40297;
    
    out_mem_40297.references = NULL;
    
    int32_t out_arrsizze_40298;
    float scalar_out_40299;
    bool dim_match_30882 = 8 == kk_30871;
    bool empty_or_match_cert_30883;
    
    if (!dim_match_30882) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:90:1-131:38\n");
        if (memblock_unref_device(ctx, &out_mem_40297, "out_mem_40297") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool dim_match_30884 = c_30874 == c_30877;
    bool empty_or_match_cert_30885;
    
    if (!dim_match_30884) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:90:1-131:38\n");
        if (memblock_unref_device(ctx, &out_mem_40297, "out_mem_40297") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int32_t x_30886 = sub32(w1_30873, p_30878);
    int32_t n_colsA_30887 = add32(1, x_30886);
    int32_t x_30888 = sub32(w2_30876, p_30878);
    int32_t n_colsB_30889 = add32(1, x_30888);
    int32_t x_30890 = mul32(p_30878, p_30878);
    int32_t patch_len_30891 = mul32(c_30874, x_30890);
    bool zzero_30893 = n_colsA_30887 == 0;
    bool nonzzero_30894 = !zzero_30893;
    bool nonzzero_cert_30895;
    
    if (!nonzzero_30894) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "division by zero",
                               "-> #0  driverKNN.fut:101:19-32\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  driverKNN.fut:100:5-129:27\n   #4  driverKNN.fut:90:1-131:38\n");
        if (memblock_unref_device(ctx, &out_mem_40297, "out_mem_40297") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool bounds_invalid_upwards_30896 = slt32(patch_len_30891, 0);
    bool valid_30897 = !bounds_invalid_upwards_30896;
    bool range_valid_c_30898;
    
    if (!valid_30897) {
        ctx->error = msgprintf("Error: %s%d%s%d%s%d%s\n\nBacktrace:\n%s",
                               "Range ", 0, "..", 1, "..<", patch_len_30891,
                               " is invalid.",
                               "-> #0  /prelude/math.fut:461:23-30\n   #1  /prelude/array.fut:60:3-12\n   #2  driverKNN.fut:109:30-43\n   #3  /prelude/soacs.fut:56:19-23\n   #4  /prelude/soacs.fut:56:3-37\n   #5  driverKNN.fut:100:5-129:27\n   #6  driverKNN.fut:90:1-131:38\n");
        if (memblock_unref_device(ctx, &out_mem_40297, "out_mem_40297") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool zzero_30900 = c_30874 == 0;
    bool nonzzero_30901 = !zzero_30900;
    bool nonzzero_cert_30902;
    
    if (!nonzzero_30901) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "division by zero",
                               "-> #0  driverKNN.fut:104:38-44\n   #1  driverKNN.fut:103:23-109:44\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:100:5-129:27\n   #5  driverKNN.fut:90:1-131:38\n");
        if (memblock_unref_device(ctx, &out_mem_40297, "out_mem_40297") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool zzero_30903 = p_30878 == 0;
    bool nonzzero_30904 = !zzero_30903;
    bool nonzzero_cert_30905;
    
    if (!nonzzero_30904) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "division by zero",
                               "-> #0  driverKNN.fut:106:37-42\n   #1  driverKNN.fut:103:23-109:44\n   #2  /prelude/soacs.fut:56:19-23\n   #3  /prelude/soacs.fut:56:3-37\n   #4  driverKNN.fut:100:5-129:27\n   #5  driverKNN.fut:90:1-131:38\n");
        if (memblock_unref_device(ctx, &out_mem_40297, "out_mem_40297") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool zzero_30906 = n_colsB_30889 == 0;
    bool nonzzero_30907 = !zzero_30906;
    bool nonzzero_cert_30908;
    
    if (!nonzzero_30907) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "division by zero",
                               "-> #0  driverKNN.fut:113:22-35\n   #1  /prelude/soacs.fut:56:19-23\n   #2  /prelude/soacs.fut:56:3-37\n   #3  driverKNN.fut:100:5-129:27\n   #4  driverKNN.fut:90:1-131:38\n");
        if (memblock_unref_device(ctx, &out_mem_40297, "out_mem_40297") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool suff_outer_redomap_32736;
    
    suff_outer_redomap_32736 = ctx->sizes.selectBestNNzisuff_outer_redomap_0 <=
        n_30870;
    
    int64_t n_32750 = sext_i32_i64(n_30870);
    int32_t segred_group_sizze_32752;
    
    segred_group_sizze_32752 =
        ctx->sizes.selectBestNNzisegred_group_sizze_32739;
    
    int32_t num_groups_32753;
    int32_t max_num_groups_40300;
    
    max_num_groups_40300 = ctx->sizes.selectBestNNzisegred_num_groups_32741;
    num_groups_32753 = sext_i64_i32(smax64(1, smin64(sdiv_up64(n_32750,
                                                               sext_i32_i64(segred_group_sizze_32752)),
                                                     sext_i32_i64(max_num_groups_40300))));
    
    bool suff_outer_par_33450;
    
    suff_outer_par_33450 = ctx->sizes.selectBestNNzisuff_outer_par_1 <= n_30870;
    
    int32_t max_group_sizze_33453;
    
    max_group_sizze_33453 = ctx->cuda.max_block_size;
    
    bool fits_33454 = sle32(patch_len_30891, max_group_sizze_33453);
    bool suff_intra_par_33456;
    
    suff_intra_par_33456 = ctx->sizes.selectBestNNzisuff_intra_par_2 <=
        patch_len_30891;
    
    bool intra_suff_and_fits_33457 = fits_33454 && suff_intra_par_33456;
    int32_t segmap_group_sizze_33463;
    
    segmap_group_sizze_33463 =
        ctx->sizes.selectBestNNzisegmap_group_sizze_32879;
    
    int64_t segmap_group_sizze_33464 = sext_i32_i64(segmap_group_sizze_33463);
    int64_t patch_len_33652 = sext_i32_i64(patch_len_30891);
    int64_t nest_sizze_33654 = n_32750 * patch_len_33652;
    int32_t segmap_group_sizze_33655;
    
    segmap_group_sizze_33655 =
        ctx->sizes.selectBestNNzisegmap_group_sizze_33239;
    
    int64_t segmap_group_sizze_33656 = sext_i32_i64(segmap_group_sizze_33655);
    int32_t segmap_group_sizze_33688;
    
    segmap_group_sizze_33688 =
        ctx->sizes.selectBestNNzisegmap_group_sizze_33135;
    
    int64_t segmap_group_sizze_33689 = sext_i32_i64(segmap_group_sizze_33688);
    int32_t segred_group_sizze_33749;
    
    segred_group_sizze_33749 =
        ctx->sizes.selectBestNNzisegred_group_sizze_33440;
    
    int32_t num_groups_33750;
    int32_t max_num_groups_40301;
    
    max_num_groups_40301 = ctx->sizes.selectBestNNzisegred_num_groups_33442;
    num_groups_33750 = sext_i64_i32(smax64(1, smin64(sdiv_up64(n_32750,
                                                               sext_i32_i64(segred_group_sizze_33749)),
                                                     sext_i32_i64(max_num_groups_40301))));
    
    int64_t binop_x_39422 = sext_i32_i64(kk_30871);
    int64_t binop_x_39424 = n_32750 * binop_x_39422;
    int64_t bytes_39421 = 4 * binop_x_39424;
    int64_t bytes_39444 = 4 * n_32750;
    int64_t bytes_39427 = 4 * patch_len_33652;
    int64_t bytes_39501 = 4 * nest_sizze_33654;
    int64_t binop_x_39514 = n_32750 * patch_len_33652;
    int64_t bytes_39511 = 4 * binop_x_39514;
    int32_t num_threads_40123 = segred_group_sizze_32752 * num_groups_32753;
    int64_t num_threads64_40125 = sext_i32_i64(num_threads_40123);
    int64_t total_sizze_40126 = bytes_39427 * num_threads64_40125;
    struct memblock_device res_mem_39543;
    
    res_mem_39543.references = NULL;
    
    struct memblock_device res_mem_39544;
    
    res_mem_39544.references = NULL;
    
    float res_30910;
    int32_t local_memory_capacity_40402;
    
    local_memory_capacity_40402 = ctx->cuda.max_shared_memory;
    if (sle64((int64_t) sizeof(bool) + (int64_t) sizeof(float) *
              sext_i32_i64(segred_group_sizze_32752),
              sext_i32_i64(local_memory_capacity_40402)) &&
        suff_outer_redomap_32736) {
        struct memblock_device mem_39425;
        
        mem_39425.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39425, bytes_39421, "mem_39425")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39425, 0,
                                                  knn_inds_mem_39418, 0, 1,
                                                  kk_30871, n_30870) != 0) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_39443;
        
        mem_39443.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39443, 4, "mem_39443")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_39446;
        
        mem_39446.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39446, bytes_39444, "mem_39446")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_39449;
        
        mem_39449.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39449, bytes_39444, "mem_39449")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device mem_39429;
        
        mem_39429.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39429, total_sizze_40126,
                                  "mem_39429")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device selectBestNNzicounter_mem_40302 =
                               ctx->selectBestNNzicounter_mem_40302;
        struct memblock_device group_res_arr_mem_40304;
        
        group_res_arr_mem_40304.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_40304,
                                  (int64_t) sizeof(float) *
                                  (sext_i32_i64(segred_group_sizze_32752) *
                                   sext_i32_i64(num_groups_32753)),
                                  "group_res_arr_mem_40304")) {
            err = 1;
            goto cleanup;
        }
        
        int32_t num_threads_40306;
        
        num_threads_40306 = num_groups_32753 * segred_group_sizze_32752;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        
        unsigned int shared_sizze_41588 = (int64_t) sizeof(float) *
                     sext_i32_i64(segred_group_sizze_32752);
        unsigned int shared_sizze_41590 = (int64_t) sizeof(bool);
        CUdeviceptr kernel_arg_41592 = imgA_mem_39419.mem;
        CUdeviceptr kernel_arg_41593 = imgB_mem_39420.mem;
        CUdeviceptr kernel_arg_41594 = mem_39425.mem;
        CUdeviceptr kernel_arg_41595 = mem_39429.mem;
        CUdeviceptr kernel_arg_41596 = mem_39443.mem;
        CUdeviceptr kernel_arg_41597 = mem_39446.mem;
        CUdeviceptr kernel_arg_41598 = mem_39449.mem;
        CUdeviceptr kernel_arg_41599 = selectBestNNzicounter_mem_40302.mem;
        CUdeviceptr kernel_arg_41600 = group_res_arr_mem_40304.mem;
        unsigned int shared_offset_41589 = 0;
        unsigned int shared_offset_41591 = 0 + (shared_sizze_41588 + (8 -
                                                                      shared_sizze_41588 %
                                                                      8) % 8);
        
        if ((((((1 && num_groups_32753 != 0) && 1 != 0) && 1 != 0) &&
              segred_group_sizze_32752 != 0) && 1 != 0) && 1 != 0) {
            int perm[3] = {0, 1, 2};
            
            if (1 >= 1 << 16) {
                perm[1] = perm[0];
                perm[0] = 1;
            }
            if (1 >= 1 << 16) {
                perm[2] = perm[0];
                perm[0] = 2;
            }
            
            size_t grid[3];
            
            grid[perm[0]] = num_groups_32753;
            grid[perm[1]] = 1;
            grid[perm[2]] = 1;
            
            void *kernel_args_41585[] = {&ctx->global_failure,
                                         &ctx->failure_is_an_option,
                                         &ctx->global_failure_args,
                                         &shared_offset_41589,
                                         &shared_offset_41591, &n_30870,
                                         &h1_30872, &w1_30873, &c_30874,
                                         &h2_30875, &w2_30876, &c_30877,
                                         &p_30878, &n_colsA_30887,
                                         &n_colsB_30889, &patch_len_30891,
                                         &num_groups_32753, &kernel_arg_41592,
                                         &kernel_arg_41593, &kernel_arg_41594,
                                         &kernel_arg_41595, &kernel_arg_41596,
                                         &kernel_arg_41597, &kernel_arg_41598,
                                         &kernel_arg_41599, &kernel_arg_41600,
                                         &num_threads_40306};
            int64_t time_start_41586 = 0, time_end_41587 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with grid size (",
                        "selectBestNN.segred_nonseg_32749");
                fprintf(stderr, "%d", num_groups_32753);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ") and block size (");
                fprintf(stderr, "%d", segred_group_sizze_32752);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ").\n");
                time_start_41586 = get_wall_time();
            }
            
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->selectBestNNzisegred_nonseg_32749_runs,
                                          &ctx->selectBestNNzisegred_nonseg_32749_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuLaunchKernel(ctx->selectBestNNzisegred_nonseg_32749,
                                        grid[0], grid[1], grid[2],
                                        segred_group_sizze_32752, 1, 1, 0 +
                                        (shared_sizze_41588 + (8 -
                                                               shared_sizze_41588 %
                                                               8) % 8) +
                                        (shared_sizze_41590 + (8 -
                                                               shared_sizze_41590 %
                                                               8) % 8), NULL,
                                        kernel_args_41585, NULL));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            if (ctx->debugging) {
                CUDA_SUCCEED(cuCtxSynchronize());
                time_end_41587 = get_wall_time();
                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                        "selectBestNN.segred_nonseg_32749", time_end_41587 -
                        time_start_41586);
            }
        }
        ctx->failure_is_an_option = 1;
        if (memblock_unref_device(ctx, &mem_39425, "mem_39425") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39429, "mem_39429") != 0)
            return 1;
        
        float read_res_41601;
        
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_scalar_from_dev_runs,
                                          &ctx->copy_scalar_from_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpyDtoH(&read_res_41601, mem_39443.mem + 0 *
                                      sizeof(float), sizeof(float)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        if (futhark_context_sync(ctx) != 0)
            return 1;
        
        float res_32837 = read_res_41601;
        
        if (memblock_unref_device(ctx, &mem_39443, "mem_39443") != 0)
            return 1;
        
        struct memblock_device mem_39537;
        
        mem_39537.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39537, bytes_39444, "mem_39537")) {
            err = 1;
            goto cleanup;
        }
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_dev_to_dev_runs,
                                          &ctx->copy_dev_to_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpy(mem_39537.mem + 0, mem_39446.mem + 0,
                                  sext_i32_i64(n_30870) *
                                  (int64_t) sizeof(int32_t)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        if (memblock_unref_device(ctx, &mem_39446, "mem_39446") != 0)
            return 1;
        
        struct memblock_device mem_39541;
        
        mem_39541.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39541, bytes_39444, "mem_39541")) {
            err = 1;
            goto cleanup;
        }
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_dev_to_dev_runs,
                                          &ctx->copy_dev_to_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpy(mem_39541.mem + 0, mem_39449.mem + 0,
                                  sext_i32_i64(n_30870) *
                                  (int64_t) sizeof(float)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_39543, &mem_39537, "mem_39537") !=
            0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_39544, &mem_39541, "mem_39541") !=
            0)
            return 1;
        res_30910 = res_32837;
        if (memblock_unref_device(ctx, &mem_39541, "mem_39541") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39537, "mem_39537") != 0)
            return 1;
        if (memblock_unref_device(ctx, &group_res_arr_mem_40304,
                                  "group_res_arr_mem_40304") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39429, "mem_39429") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39449, "mem_39449") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39446, "mem_39446") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39443, "mem_39443") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39425, "mem_39425") != 0)
            return 1;
    } else {
        struct memblock_device res_map_acc_mem_39529;
        
        res_map_acc_mem_39529.references = NULL;
        
        struct memblock_device res_mem_39530;
        
        res_mem_39530.references = NULL;
        
        struct memblock_device res_mem_39531;
        
        res_mem_39531.references = NULL;
        
        int32_t local_memory_capacity_40371;
        
        local_memory_capacity_40371 = ctx->cuda.max_shared_memory;
        if (sle64(0, sext_i32_i64(local_memory_capacity_40371)) &&
            suff_outer_par_33450) {
            int64_t segmap_usable_groups_64_33465 = sdiv_up64(n_32750,
                                                              segmap_group_sizze_33464);
            int32_t segmap_usable_groups_33466 =
                    sext_i64_i32(segmap_usable_groups_64_33465);
            struct memblock_device mem_39454;
            
            mem_39454.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39454, bytes_39421,
                                      "mem_39454")) {
                err = 1;
                goto cleanup;
            }
            if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39454, 0,
                                                      knn_inds_mem_39418, 0, 1,
                                                      kk_30871, n_30870) != 0) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39473;
            
            mem_39473.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39473, bytes_39444,
                                      "mem_39473")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39476;
            
            mem_39476.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39476, bytes_39444,
                                      "mem_39476")) {
                err = 1;
                goto cleanup;
            }
            
            struct memblock_device mem_39479;
            
            mem_39479.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39479, bytes_39444,
                                      "mem_39479")) {
                err = 1;
                goto cleanup;
            }
            
            int32_t num_threads_40127 = segmap_group_sizze_33463 *
                    segmap_usable_groups_33466;
            int64_t num_threads64_40129 = sext_i32_i64(num_threads_40127);
            int64_t total_sizze_40130 = bytes_39427 * num_threads64_40129;
            struct memblock_device mem_39458;
            
            mem_39458.references = NULL;
            if (memblock_alloc_device(ctx, &mem_39458, total_sizze_40130,
                                      "mem_39458")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(stderr, "%s\n", "\n# SegMap");
            
            CUdeviceptr kernel_arg_41605 = imgA_mem_39419.mem;
            CUdeviceptr kernel_arg_41606 = imgB_mem_39420.mem;
            CUdeviceptr kernel_arg_41607 = mem_39454.mem;
            CUdeviceptr kernel_arg_41608 = mem_39458.mem;
            CUdeviceptr kernel_arg_41609 = mem_39473.mem;
            CUdeviceptr kernel_arg_41610 = mem_39476.mem;
            CUdeviceptr kernel_arg_41611 = mem_39479.mem;
            
            if ((((((1 && segmap_usable_groups_33466 != 0) && 1 != 0) && 1 !=
                   0) && segmap_group_sizze_33463 != 0) && 1 != 0) && 1 != 0) {
                int perm[3] = {0, 1, 2};
                
                if (1 >= 1 << 16) {
                    perm[1] = perm[0];
                    perm[0] = 1;
                }
                if (1 >= 1 << 16) {
                    perm[2] = perm[0];
                    perm[0] = 2;
                }
                
                size_t grid[3];
                
                grid[perm[0]] = segmap_usable_groups_33466;
                grid[perm[1]] = 1;
                grid[perm[2]] = 1;
                
                void *kernel_args_41602[] = {&ctx->global_failure,
                                             &ctx->failure_is_an_option,
                                             &ctx->global_failure_args,
                                             &n_30870, &h1_30872, &w1_30873,
                                             &c_30874, &h2_30875, &w2_30876,
                                             &c_30877, &p_30878, &n_colsA_30887,
                                             &n_colsB_30889, &patch_len_30891,
                                             &segmap_usable_groups_33466,
                                             &kernel_arg_41605,
                                             &kernel_arg_41606,
                                             &kernel_arg_41607,
                                             &kernel_arg_41608,
                                             &kernel_arg_41609,
                                             &kernel_arg_41610,
                                             &kernel_arg_41611};
                int64_t time_start_41603 = 0, time_end_41604 = 0;
                
                if (ctx->debugging) {
                    fprintf(stderr, "Launching %s with grid size (",
                            "selectBestNN.segmap_32876");
                    fprintf(stderr, "%d", segmap_usable_groups_33466);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ") and block size (");
                    fprintf(stderr, "%d", segmap_group_sizze_33463);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ", ");
                    fprintf(stderr, "%d", 1);
                    fprintf(stderr, ").\n");
                    time_start_41603 = get_wall_time();
                }
                
                cudaEvent_t *pevents = NULL;
                
                if (ctx->profiling && !ctx->profiling_paused) {
                    pevents = cuda_get_events(&ctx->cuda,
                                              &ctx->selectBestNNzisegmap_32876_runs,
                                              &ctx->selectBestNNzisegmap_32876_total_runtime);
                    CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                }
                CUDA_SUCCEED(cuLaunchKernel(ctx->selectBestNNzisegmap_32876,
                                            grid[0], grid[1], grid[2],
                                            segmap_group_sizze_33463, 1, 1, 0,
                                            NULL, kernel_args_41602, NULL));
                if (pevents != NULL)
                    CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                if (ctx->debugging) {
                    CUDA_SUCCEED(cuCtxSynchronize());
                    time_end_41604 = get_wall_time();
                    fprintf(stderr, "Kernel %s runtime: %ldus\n",
                            "selectBestNN.segmap_32876", time_end_41604 -
                            time_start_41603);
                }
            }
            ctx->failure_is_an_option = 1;
            if (memblock_unref_device(ctx, &mem_39454, "mem_39454") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39458, "mem_39458") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_map_acc_mem_39529, &mem_39473,
                                    "mem_39473") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_39530, &mem_39476,
                                    "mem_39476") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_39531, &mem_39479,
                                    "mem_39479") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39458, "mem_39458") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39479, "mem_39479") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39476, "mem_39476") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39473, "mem_39473") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_39454, "mem_39454") != 0)
                return 1;
        } else {
            struct memblock_device res_map_acc_mem_39526;
            
            res_map_acc_mem_39526.references = NULL;
            
            struct memblock_device res_mem_39527;
            
            res_mem_39527.references = NULL;
            
            struct memblock_device res_mem_39528;
            
            res_mem_39528.references = NULL;
            
            int32_t local_memory_capacity_40370;
            
            local_memory_capacity_40370 = ctx->cuda.max_shared_memory;
            if (sle64(bytes_39427 + (int64_t) sizeof(float) *
                      sext_i32_i64(patch_len_30891),
                      sext_i32_i64(local_memory_capacity_40370)) &&
                intra_suff_and_fits_33457) {
                struct memblock_device mem_39484;
                
                mem_39484.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39484, bytes_39421,
                                          "mem_39484")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39484, 0,
                                                          knn_inds_mem_39418, 0,
                                                          1, kk_30871,
                                                          n_30870) != 0) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39493;
                
                mem_39493.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39493, bytes_39444,
                                          "mem_39493")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39496;
                
                mem_39496.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39496, bytes_39444,
                                          "mem_39496")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39499;
                
                mem_39499.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39499, bytes_39444,
                                          "mem_39499")) {
                    err = 1;
                    goto cleanup;
                }
                
                unsigned int shared_sizze_41615 = (int64_t) sizeof(float) *
                             sext_i32_i64(patch_len_30891);
                unsigned int shared_sizze_41617 = bytes_39427;
                CUdeviceptr kernel_arg_41619 = imgA_mem_39419.mem;
                CUdeviceptr kernel_arg_41620 = imgB_mem_39420.mem;
                CUdeviceptr kernel_arg_41621 = mem_39484.mem;
                CUdeviceptr kernel_arg_41622 = mem_39493.mem;
                CUdeviceptr kernel_arg_41623 = mem_39496.mem;
                CUdeviceptr kernel_arg_41624 = mem_39499.mem;
                unsigned int shared_offset_41616 = 0;
                unsigned int shared_offset_41618 = 0 + (shared_sizze_41615 +
                                                        (8 -
                                                         shared_sizze_41615 %
                                                         8) % 8);
                
                if ((((((1 && n_30870 != 0) && 1 != 0) && 1 != 0) &&
                      patch_len_30891 != 0) && 1 != 0) && 1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = n_30870;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41612[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &shared_offset_41616,
                                                 &shared_offset_41618, &n_30870,
                                                 &h1_30872, &w1_30873, &c_30874,
                                                 &h2_30875, &w2_30876, &c_30877,
                                                 &p_30878, &n_colsA_30887,
                                                 &n_colsB_30889,
                                                 &patch_len_30891,
                                                 &kernel_arg_41619,
                                                 &kernel_arg_41620,
                                                 &kernel_arg_41621,
                                                 &kernel_arg_41622,
                                                 &kernel_arg_41623,
                                                 &kernel_arg_41624};
                    int64_t time_start_41613 = 0, time_end_41614 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "selectBestNN.segmap_intragroup_32874");
                        fprintf(stderr, "%d", n_30870);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", patch_len_30891);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41613 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->selectBestNNzisegmap_intragroup_32874_runs,
                                                  &ctx->selectBestNNzisegmap_intragroup_32874_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->selectBestNNzisegmap_intragroup_32874,
                                                grid[0], grid[1], grid[2],
                                                patch_len_30891, 1, 1, 0 +
                                                (shared_sizze_41615 + (8 -
                                                                       shared_sizze_41615 %
                                                                       8) % 8) +
                                                (shared_sizze_41617 + (8 -
                                                                       shared_sizze_41617 %
                                                                       8) % 8),
                                                NULL, kernel_args_41612, NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41614 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "selectBestNN.segmap_intragroup_32874",
                                time_end_41614 - time_start_41613);
                    }
                }
                ctx->failure_is_an_option = 1;
                if (memblock_unref_device(ctx, &mem_39484, "mem_39484") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_map_acc_mem_39526, &mem_39493,
                                        "mem_39493") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39527, &mem_39496,
                                        "mem_39496") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39528, &mem_39499,
                                        "mem_39499") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39499, "mem_39499") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39496, "mem_39496") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39493, "mem_39493") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39484, "mem_39484") != 0)
                    return 1;
            } else {
                int64_t segmap_usable_groups_64_33657 =
                        sdiv_up64(nest_sizze_33654, segmap_group_sizze_33656);
                int32_t segmap_usable_groups_33658 =
                        sext_i64_i32(segmap_usable_groups_64_33657);
                struct memblock_device mem_39505;
                
                mem_39505.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39505, bytes_39501,
                                          "mem_39505")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                
                CUdeviceptr kernel_arg_41628 = imgA_mem_39419.mem;
                CUdeviceptr kernel_arg_41629 = mem_39505.mem;
                
                if ((((((1 && segmap_usable_groups_33658 != 0) && 1 != 0) &&
                       1 != 0) && segmap_group_sizze_33655 != 0) && 1 != 0) &&
                    1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = segmap_usable_groups_33658;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41625[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &n_30870, &h1_30872, &w1_30873,
                                                 &c_30874, &p_30878,
                                                 &n_colsA_30887,
                                                 &patch_len_30891,
                                                 &kernel_arg_41628,
                                                 &kernel_arg_41629};
                    int64_t time_start_41626 = 0, time_end_41627 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "selectBestNN.segmap_33234");
                        fprintf(stderr, "%d", segmap_usable_groups_33658);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", segmap_group_sizze_33655);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41626 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->selectBestNNzisegmap_33234_runs,
                                                  &ctx->selectBestNNzisegmap_33234_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->selectBestNNzisegmap_33234,
                                                grid[0], grid[1], grid[2],
                                                segmap_group_sizze_33655, 1, 1,
                                                0, NULL, kernel_args_41625,
                                                NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41627 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "selectBestNN.segmap_33234", time_end_41627 -
                                time_start_41626);
                    }
                }
                ctx->failure_is_an_option = 1;
                
                int64_t segmap_usable_groups_64_33690 = sdiv_up64(n_32750,
                                                                  segmap_group_sizze_33689);
                int32_t segmap_usable_groups_33691 =
                        sext_i64_i32(segmap_usable_groups_64_33690);
                struct memblock_device mem_39510;
                
                mem_39510.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39510, bytes_39421,
                                          "mem_39510")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_i32(ctx, mem_39510, 0,
                                                          knn_inds_mem_39418, 0,
                                                          1, kk_30871,
                                                          n_30870) != 0) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39515;
                
                mem_39515.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39515, bytes_39511,
                                          "mem_39515")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhgpu_map_transpose_f32(ctx, mem_39515, 0,
                                                          mem_39505, 0, 1,
                                                          patch_len_30891,
                                                          n_30870) != 0) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_unref_device(ctx, &mem_39505, "mem_39505") != 0)
                    return 1;
                
                struct memblock_device mem_39519;
                
                mem_39519.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39519, bytes_39444,
                                          "mem_39519")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39522;
                
                mem_39522.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39522, bytes_39444,
                                          "mem_39522")) {
                    err = 1;
                    goto cleanup;
                }
                
                struct memblock_device mem_39525;
                
                mem_39525.references = NULL;
                if (memblock_alloc_device(ctx, &mem_39525, bytes_39444,
                                          "mem_39525")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(stderr, "%s\n", "\n# SegMap");
                
                CUdeviceptr kernel_arg_41633 = imgB_mem_39420.mem;
                CUdeviceptr kernel_arg_41634 = mem_39510.mem;
                CUdeviceptr kernel_arg_41635 = mem_39515.mem;
                CUdeviceptr kernel_arg_41636 = mem_39519.mem;
                CUdeviceptr kernel_arg_41637 = mem_39522.mem;
                CUdeviceptr kernel_arg_41638 = mem_39525.mem;
                
                if ((((((1 && segmap_usable_groups_33691 != 0) && 1 != 0) &&
                       1 != 0) && segmap_group_sizze_33688 != 0) && 1 != 0) &&
                    1 != 0) {
                    int perm[3] = {0, 1, 2};
                    
                    if (1 >= 1 << 16) {
                        perm[1] = perm[0];
                        perm[0] = 1;
                    }
                    if (1 >= 1 << 16) {
                        perm[2] = perm[0];
                        perm[0] = 2;
                    }
                    
                    size_t grid[3];
                    
                    grid[perm[0]] = segmap_usable_groups_33691;
                    grid[perm[1]] = 1;
                    grid[perm[2]] = 1;
                    
                    void *kernel_args_41630[] = {&ctx->global_failure,
                                                 &ctx->failure_is_an_option,
                                                 &ctx->global_failure_args,
                                                 &n_30870, &c_30874, &h2_30875,
                                                 &w2_30876, &c_30877, &p_30878,
                                                 &n_colsB_30889,
                                                 &patch_len_30891,
                                                 &kernel_arg_41633,
                                                 &kernel_arg_41634,
                                                 &kernel_arg_41635,
                                                 &kernel_arg_41636,
                                                 &kernel_arg_41637,
                                                 &kernel_arg_41638};
                    int64_t time_start_41631 = 0, time_end_41632 = 0;
                    
                    if (ctx->debugging) {
                        fprintf(stderr, "Launching %s with grid size (",
                                "selectBestNN.segmap_33132");
                        fprintf(stderr, "%d", segmap_usable_groups_33691);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ") and block size (");
                        fprintf(stderr, "%d", segmap_group_sizze_33688);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ", ");
                        fprintf(stderr, "%d", 1);
                        fprintf(stderr, ").\n");
                        time_start_41631 = get_wall_time();
                    }
                    
                    cudaEvent_t *pevents = NULL;
                    
                    if (ctx->profiling && !ctx->profiling_paused) {
                        pevents = cuda_get_events(&ctx->cuda,
                                                  &ctx->selectBestNNzisegmap_33132_runs,
                                                  &ctx->selectBestNNzisegmap_33132_total_runtime);
                        CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
                    }
                    CUDA_SUCCEED(cuLaunchKernel(ctx->selectBestNNzisegmap_33132,
                                                grid[0], grid[1], grid[2],
                                                segmap_group_sizze_33688, 1, 1,
                                                0, NULL, kernel_args_41630,
                                                NULL));
                    if (pevents != NULL)
                        CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
                    if (ctx->debugging) {
                        CUDA_SUCCEED(cuCtxSynchronize());
                        time_end_41632 = get_wall_time();
                        fprintf(stderr, "Kernel %s runtime: %ldus\n",
                                "selectBestNN.segmap_33132", time_end_41632 -
                                time_start_41631);
                    }
                }
                ctx->failure_is_an_option = 1;
                if (memblock_unref_device(ctx, &mem_39510, "mem_39510") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39515, "mem_39515") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_map_acc_mem_39526, &mem_39519,
                                        "mem_39519") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39527, &mem_39522,
                                        "mem_39522") != 0)
                    return 1;
                if (memblock_set_device(ctx, &res_mem_39528, &mem_39525,
                                        "mem_39525") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39525, "mem_39525") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39522, "mem_39522") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39519, "mem_39519") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39515, "mem_39515") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39510, "mem_39510") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_39505, "mem_39505") != 0)
                    return 1;
            }
            if (memblock_set_device(ctx, &res_map_acc_mem_39529,
                                    &res_map_acc_mem_39526,
                                    "res_map_acc_mem_39526") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_39530, &res_mem_39527,
                                    "res_mem_39527") != 0)
                return 1;
            if (memblock_set_device(ctx, &res_mem_39531, &res_mem_39528,
                                    "res_mem_39528") != 0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39528, "res_mem_39528") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_mem_39527, "res_mem_39527") !=
                0)
                return 1;
            if (memblock_unref_device(ctx, &res_map_acc_mem_39526,
                                      "res_map_acc_mem_39526") != 0)
                return 1;
        }
        
        struct memblock_device mem_39534;
        
        mem_39534.references = NULL;
        if (memblock_alloc_device(ctx, &mem_39534, 4, "mem_39534")) {
            err = 1;
            goto cleanup;
        }
        
        struct memblock_device selectBestNNzicounter_mem_40372 =
                               ctx->selectBestNNzicounter_mem_40372;
        struct memblock_device group_res_arr_mem_40374;
        
        group_res_arr_mem_40374.references = NULL;
        if (memblock_alloc_device(ctx, &group_res_arr_mem_40374,
                                  (int64_t) sizeof(float) *
                                  (sext_i32_i64(segred_group_sizze_33749) *
                                   sext_i32_i64(num_groups_33750)),
                                  "group_res_arr_mem_40374")) {
            err = 1;
            goto cleanup;
        }
        
        int32_t num_threads_40376;
        
        num_threads_40376 = num_groups_33750 * segred_group_sizze_33749;
        if (ctx->debugging)
            fprintf(stderr, "%s\n", "\n# SegRed");
        
        unsigned int shared_sizze_41643 = (int64_t) sizeof(float) *
                     sext_i32_i64(segred_group_sizze_33749);
        unsigned int shared_sizze_41645 = (int64_t) sizeof(bool);
        CUdeviceptr kernel_arg_41647 = res_map_acc_mem_39529.mem;
        CUdeviceptr kernel_arg_41648 = mem_39534.mem;
        CUdeviceptr kernel_arg_41649 = selectBestNNzicounter_mem_40372.mem;
        CUdeviceptr kernel_arg_41650 = group_res_arr_mem_40374.mem;
        unsigned int shared_offset_41644 = 0;
        unsigned int shared_offset_41646 = 0 + (shared_sizze_41643 + (8 -
                                                                      shared_sizze_41643 %
                                                                      8) % 8);
        
        if ((((((1 && num_groups_33750 != 0) && 1 != 0) && 1 != 0) &&
              segred_group_sizze_33749 != 0) && 1 != 0) && 1 != 0) {
            int perm[3] = {0, 1, 2};
            
            if (1 >= 1 << 16) {
                perm[1] = perm[0];
                perm[0] = 1;
            }
            if (1 >= 1 << 16) {
                perm[2] = perm[0];
                perm[0] = 2;
            }
            
            size_t grid[3];
            
            grid[perm[0]] = num_groups_33750;
            grid[perm[1]] = 1;
            grid[perm[2]] = 1;
            
            void *kernel_args_41640[] = {&ctx->global_failure,
                                         &shared_offset_41644,
                                         &shared_offset_41646, &n_30870,
                                         &num_groups_33750, &kernel_arg_41647,
                                         &kernel_arg_41648, &kernel_arg_41649,
                                         &kernel_arg_41650, &num_threads_40376};
            int64_t time_start_41641 = 0, time_end_41642 = 0;
            
            if (ctx->debugging) {
                fprintf(stderr, "Launching %s with grid size (",
                        "selectBestNN.segred_nonseg_33448");
                fprintf(stderr, "%d", num_groups_33750);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ") and block size (");
                fprintf(stderr, "%d", segred_group_sizze_33749);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ", ");
                fprintf(stderr, "%d", 1);
                fprintf(stderr, ").\n");
                time_start_41641 = get_wall_time();
            }
            
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->selectBestNNzisegred_nonseg_33448_runs,
                                          &ctx->selectBestNNzisegred_nonseg_33448_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuLaunchKernel(ctx->selectBestNNzisegred_nonseg_33448,
                                        grid[0], grid[1], grid[2],
                                        segred_group_sizze_33749, 1, 1, 0 +
                                        (shared_sizze_41643 + (8 -
                                                               shared_sizze_41643 %
                                                               8) % 8) +
                                        (shared_sizze_41645 + (8 -
                                                               shared_sizze_41645 %
                                                               8) % 8), NULL,
                                        kernel_args_41640, NULL));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
            if (ctx->debugging) {
                CUDA_SUCCEED(cuCtxSynchronize());
                time_end_41642 = get_wall_time();
                fprintf(stderr, "Kernel %s runtime: %ldus\n",
                        "selectBestNN.segred_nonseg_33448", time_end_41642 -
                        time_start_41641);
            }
        }
        if (memblock_unref_device(ctx, &res_map_acc_mem_39529,
                                  "res_map_acc_mem_39529") != 0)
            return 1;
        
        float read_res_41651;
        
        {
            cudaEvent_t *pevents = NULL;
            
            if (ctx->profiling && !ctx->profiling_paused) {
                pevents = cuda_get_events(&ctx->cuda,
                                          &ctx->copy_scalar_from_dev_runs,
                                          &ctx->copy_scalar_from_dev_total_runtime);
                CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
            }
            CUDA_SUCCEED(cuMemcpyDtoH(&read_res_41651, mem_39534.mem + 0 *
                                      sizeof(float), sizeof(float)));
            if (pevents != NULL)
                CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        }
        if (futhark_context_sync(ctx) != 0)
            return 1;
        
        float res_33757 = read_res_41651;
        
        if (memblock_unref_device(ctx, &mem_39534, "mem_39534") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_39543, &res_mem_39530,
                                "res_mem_39530") != 0)
            return 1;
        if (memblock_set_device(ctx, &res_mem_39544, &res_mem_39531,
                                "res_mem_39531") != 0)
            return 1;
        res_30910 = res_33757;
        if (memblock_unref_device(ctx, &group_res_arr_mem_40374,
                                  "group_res_arr_mem_40374") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_39534, "mem_39534") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39531, "res_mem_39531") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_mem_39530, "res_mem_39530") != 0)
            return 1;
        if (memblock_unref_device(ctx, &res_map_acc_mem_39529,
                                  "res_map_acc_mem_39529") != 0)
            return 1;
    }
    
    float res_30992;
    
    res_30992 = futrts_sqrt32(res_30910);
    out_arrsizze_40296 = n_30870;
    out_arrsizze_40298 = n_30870;
    if (memblock_set_device(ctx, &out_mem_40295, &res_mem_39543,
                            "res_mem_39543") != 0)
        return 1;
    if (memblock_set_device(ctx, &out_mem_40297, &res_mem_39544,
                            "res_mem_39544") != 0)
        return 1;
    scalar_out_40299 = res_30992;
    (*out_mem_p_41579).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41579, &out_mem_40295,
                            "out_mem_40295") != 0)
        return 1;
    *out_out_arrsizze_41580 = out_arrsizze_40296;
    (*out_mem_p_41581).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41581, &out_mem_40297,
                            "out_mem_40297") != 0)
        return 1;
    *out_out_arrsizze_41582 = out_arrsizze_40298;
    *out_scalar_out_41583 = scalar_out_40299;
    if (memblock_unref_device(ctx, &res_mem_39544, "res_mem_39544") != 0)
        return 1;
    if (memblock_unref_device(ctx, &res_mem_39543, "res_mem_39543") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40297, "out_mem_40297") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
static int futrts_selectBestNN_BAD(struct futhark_context *ctx,
                                   struct memblock_device *out_mem_p_41652,
                                   int32_t *out_out_arrsizze_41653,
                                   struct memblock_device *out_mem_p_41654,
                                   int32_t *out_out_arrsizze_41655,
                                   struct memblock_device knn_inds_mem_39418,
                                   struct memblock_device imgA_mem_39419,
                                   struct memblock_device imgB_mem_39420,
                                   int32_t n_30845, int32_t kk_30846,
                                   int32_t h1_30847, int32_t w1_30848,
                                   int32_t c_30849, int32_t h2_30850,
                                   int32_t w2_30851, int32_t c_30852,
                                   int32_t p_30853)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    struct memblock_device out_mem_40297;
    
    out_mem_40297.references = NULL;
    
    int32_t out_arrsizze_40298;
    bool dim_match_30857 = 8 == kk_30846;
    bool empty_or_match_cert_30858;
    
    if (!dim_match_30857) {
        ctx->error = msgprintf("Error: %s\n\nBacktrace:\n%s",
                               "function arguments of wrong shape",
                               "-> #0  driverKNN.fut:84:1-88:37\n");
        if (memblock_unref_device(ctx, &out_mem_40297, "out_mem_40297") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    bool empty_slice_30859 = n_30845 == 0;
    int32_t m_30860 = sub32(n_30845, 1);
    bool zzero_leq_i_p_m_t_s_30861 = sle32(0, m_30860);
    bool i_p_m_t_s_leq_w_30862 = slt32(m_30860, n_30845);
    bool i_lte_j_30863 = sle32(0, n_30845);
    bool y_30864 = zzero_leq_i_p_m_t_s_30861 && i_p_m_t_s_leq_w_30862;
    bool y_30865 = i_lte_j_30863 && y_30864;
    bool ok_or_empty_30866 = empty_slice_30859 || y_30865;
    bool index_certs_30867;
    
    if (!ok_or_empty_30866) {
        ctx->error = msgprintf("Error: %s%d%s%d%s%d%s%d%s\n\nBacktrace:\n%s",
                               "Index [", 0, ":, ", 0,
                               "] out of bounds for array of shape [", n_30845,
                               "][", 8, "].",
                               "-> #0  driverKNN.fut:88:4-16\n   #1  driverKNN.fut:84:1-88:37\n");
        if (memblock_unref_device(ctx, &out_mem_40297, "out_mem_40297") != 0)
            return 1;
        if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
            return 1;
        return 1;
    }
    
    int64_t binop_x_39422 = sext_i32_i64(n_30845);
    int64_t bytes_39421 = 4 * binop_x_39422;
    struct memblock_device mem_39423;
    
    mem_39423.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39423, bytes_39421, "mem_39423")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f32(ctx, mem_39423, n_30845, 0.0F) != 0) {
        err = 1;
        goto cleanup;
    }
    
    struct memblock_device mem_39426;
    
    mem_39426.references = NULL;
    if (memblock_alloc_device(ctx, &mem_39426, bytes_39421, "mem_39426")) {
        err = 1;
        goto cleanup;
    }
    
    int32_t group_sizze_40311;
    
    group_sizze_40311 = ctx->sizes.selectBestNN_BADzigroup_sizze_40311;
    
    int64_t num_groups_40312;
    
    num_groups_40312 = sdiv_up64(sext_i32_i64(n_30845),
                                 sext_i32_i64(group_sizze_40311));
    
    CUdeviceptr kernel_arg_41659 = knn_inds_mem_39418.mem;
    CUdeviceptr kernel_arg_41660 = mem_39426.mem;
    
    if ((((((1 && sext_i64_i32(num_groups_40312) != 0) && 1 != 0) && 1 != 0) &&
          group_sizze_40311 != 0) && 1 != 0) && 1 != 0) {
        int perm[3] = {0, 1, 2};
        
        if (1 >= 1 << 16) {
            perm[1] = perm[0];
            perm[0] = 1;
        }
        if (1 >= 1 << 16) {
            perm[2] = perm[0];
            perm[0] = 2;
        }
        
        size_t grid[3];
        
        grid[perm[0]] = sext_i64_i32(num_groups_40312);
        grid[perm[1]] = 1;
        grid[perm[2]] = 1;
        
        void *kernel_args_41656[] = {&n_30845, &kk_30846, &kernel_arg_41659,
                                     &kernel_arg_41660};
        int64_t time_start_41657 = 0, time_end_41658 = 0;
        
        if (ctx->debugging) {
            fprintf(stderr, "Launching %s with grid size (",
                    "selectBestNN_BAD.copy_40308");
            fprintf(stderr, "%d", sext_i64_i32(num_groups_40312));
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ") and block size (");
            fprintf(stderr, "%d", group_sizze_40311);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ", ");
            fprintf(stderr, "%d", 1);
            fprintf(stderr, ").\n");
            time_start_41657 = get_wall_time();
        }
        
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda,
                                      &ctx->selectBestNN_BADzicopy_40308_runs,
                                      &ctx->selectBestNN_BADzicopy_40308_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuLaunchKernel(ctx->selectBestNN_BADzicopy_40308, grid[0],
                                    grid[1], grid[2], group_sizze_40311, 1, 1,
                                    0, NULL, kernel_args_41656, NULL));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
        if (ctx->debugging) {
            CUDA_SUCCEED(cuCtxSynchronize());
            time_end_41658 = get_wall_time();
            fprintf(stderr, "Kernel %s runtime: %ldus\n",
                    "selectBestNN_BAD.copy_40308", time_end_41658 -
                    time_start_41657);
        }
    }
    out_arrsizze_40296 = n_30845;
    out_arrsizze_40298 = n_30845;
    if (memblock_set_device(ctx, &out_mem_40295, &mem_39426, "mem_39426") != 0)
        return 1;
    if (memblock_set_device(ctx, &out_mem_40297, &mem_39423, "mem_39423") != 0)
        return 1;
    (*out_mem_p_41652).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41652, &out_mem_40295,
                            "out_mem_40295") != 0)
        return 1;
    *out_out_arrsizze_41653 = out_arrsizze_40296;
    (*out_mem_p_41654).references = NULL;
    if (memblock_set_device(ctx, &*out_mem_p_41654, &out_mem_40297,
                            "out_mem_40297") != 0)
        return 1;
    *out_out_arrsizze_41655 = out_arrsizze_40298;
    if (memblock_unref_device(ctx, &mem_39426, "mem_39426") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_39423, "mem_39423") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40297, "out_mem_40297") != 0)
        return 1;
    if (memblock_unref_device(ctx, &out_mem_40295, "out_mem_40295") != 0)
        return 1;
    
  cleanup:
    { }
    return err;
}
struct futhark_f32_3d {
    struct memblock_device mem;
    int64_t shape[3];
} ;
struct futhark_f32_3d *futhark_new_f32_3d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0,
                                          int64_t dim1, int64_t dim2)
{
    struct futhark_f32_3d *bad = NULL;
    struct futhark_f32_3d *arr =
                          (struct futhark_f32_3d *) malloc(sizeof(struct futhark_f32_3d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) (dim0 * dim1 * dim2) *
                              sizeof(float), "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    arr->shape[2] = dim2;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_host_to_dev_runs,
                                      &ctx->copy_host_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyHtoD(arr->mem.mem + 0, data + 0, (size_t) (dim0 *
                                                                        dim1 *
                                                                        dim2) *
                                  sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_f32_3d *futhark_new_raw_f32_3d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0, int64_t dim1,
                                              int64_t dim2)
{
    struct futhark_f32_3d *bad = NULL;
    struct futhark_f32_3d *arr =
                          (struct futhark_f32_3d *) malloc(sizeof(struct futhark_f32_3d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) (dim0 * dim1 * dim2) *
                              sizeof(float), "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    arr->shape[2] = dim2;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(arr->mem.mem + 0, data + offset, (size_t) (dim0 *
                                                                         dim1 *
                                                                         dim2) *
                              sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f32_3d(struct futhark_context *ctx, struct futhark_f32_3d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f32_3d(struct futhark_context *ctx,
                          struct futhark_f32_3d *arr, float *data)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_host_runs,
                                      &ctx->copy_dev_to_host_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyDtoH(data + 0, arr->mem.mem + 0,
                                  (size_t) (arr->shape[0] * arr->shape[1] *
                                            arr->shape[2]) * sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return 0;
}
CUdeviceptr futhark_values_raw_f32_3d(struct futhark_context *ctx,
                                      struct futhark_f32_3d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f32_3d(struct futhark_context *ctx,
                                    struct futhark_f32_3d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_u8_2d {
    struct memblock_device mem;
    int64_t shape[2];
} ;
struct futhark_u8_2d *futhark_new_u8_2d(struct futhark_context *ctx, const
                                        uint8_t *data, int64_t dim0,
                                        int64_t dim1)
{
    struct futhark_u8_2d *bad = NULL;
    struct futhark_u8_2d *arr =
                         (struct futhark_u8_2d *) malloc(sizeof(struct futhark_u8_2d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) (dim0 * dim1) *
                              sizeof(uint8_t), "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_host_to_dev_runs,
                                      &ctx->copy_host_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyHtoD(arr->mem.mem + 0, data + 0, (size_t) (dim0 *
                                                                        dim1) *
                                  sizeof(uint8_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_u8_2d *futhark_new_raw_u8_2d(struct futhark_context *ctx, const
                                            CUdeviceptr data, int offset,
                                            int64_t dim0, int64_t dim1)
{
    struct futhark_u8_2d *bad = NULL;
    struct futhark_u8_2d *arr =
                         (struct futhark_u8_2d *) malloc(sizeof(struct futhark_u8_2d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) (dim0 * dim1) *
                              sizeof(uint8_t), "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(arr->mem.mem + 0, data + offset, (size_t) (dim0 *
                                                                         dim1) *
                              sizeof(uint8_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_u8_2d(struct futhark_context *ctx, struct futhark_u8_2d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_u8_2d(struct futhark_context *ctx, struct futhark_u8_2d *arr,
                         uint8_t *data)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_host_runs,
                                      &ctx->copy_dev_to_host_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyDtoH(data + 0, arr->mem.mem + 0,
                                  (size_t) (arr->shape[0] * arr->shape[1]) *
                                  sizeof(uint8_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return 0;
}
CUdeviceptr futhark_values_raw_u8_2d(struct futhark_context *ctx,
                                     struct futhark_u8_2d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_u8_2d(struct futhark_context *ctx,
                                   struct futhark_u8_2d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_i32_3d {
    struct memblock_device mem;
    int64_t shape[3];
} ;
struct futhark_i32_3d *futhark_new_i32_3d(struct futhark_context *ctx, const
                                          int32_t *data, int64_t dim0,
                                          int64_t dim1, int64_t dim2)
{
    struct futhark_i32_3d *bad = NULL;
    struct futhark_i32_3d *arr =
                          (struct futhark_i32_3d *) malloc(sizeof(struct futhark_i32_3d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) (dim0 * dim1 * dim2) *
                              sizeof(int32_t), "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    arr->shape[2] = dim2;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_host_to_dev_runs,
                                      &ctx->copy_host_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyHtoD(arr->mem.mem + 0, data + 0, (size_t) (dim0 *
                                                                        dim1 *
                                                                        dim2) *
                                  sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_i32_3d *futhark_new_raw_i32_3d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0, int64_t dim1,
                                              int64_t dim2)
{
    struct futhark_i32_3d *bad = NULL;
    struct futhark_i32_3d *arr =
                          (struct futhark_i32_3d *) malloc(sizeof(struct futhark_i32_3d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) (dim0 * dim1 * dim2) *
                              sizeof(int32_t), "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    arr->shape[2] = dim2;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(arr->mem.mem + 0, data + offset, (size_t) (dim0 *
                                                                         dim1 *
                                                                         dim2) *
                              sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_i32_3d(struct futhark_context *ctx, struct futhark_i32_3d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_i32_3d(struct futhark_context *ctx,
                          struct futhark_i32_3d *arr, int32_t *data)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_host_runs,
                                      &ctx->copy_dev_to_host_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyDtoH(data + 0, arr->mem.mem + 0,
                                  (size_t) (arr->shape[0] * arr->shape[1] *
                                            arr->shape[2]) * sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return 0;
}
CUdeviceptr futhark_values_raw_i32_3d(struct futhark_context *ctx,
                                      struct futhark_i32_3d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_i32_3d(struct futhark_context *ctx,
                                    struct futhark_i32_3d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_i32_2d {
    struct memblock_device mem;
    int64_t shape[2];
} ;
struct futhark_i32_2d *futhark_new_i32_2d(struct futhark_context *ctx, const
                                          int32_t *data, int64_t dim0,
                                          int64_t dim1)
{
    struct futhark_i32_2d *bad = NULL;
    struct futhark_i32_2d *arr =
                          (struct futhark_i32_2d *) malloc(sizeof(struct futhark_i32_2d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) (dim0 * dim1) *
                              sizeof(int32_t), "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_host_to_dev_runs,
                                      &ctx->copy_host_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyHtoD(arr->mem.mem + 0, data + 0, (size_t) (dim0 *
                                                                        dim1) *
                                  sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_i32_2d *futhark_new_raw_i32_2d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0, int64_t dim1)
{
    struct futhark_i32_2d *bad = NULL;
    struct futhark_i32_2d *arr =
                          (struct futhark_i32_2d *) malloc(sizeof(struct futhark_i32_2d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) (dim0 * dim1) *
                              sizeof(int32_t), "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(arr->mem.mem + 0, data + offset, (size_t) (dim0 *
                                                                         dim1) *
                              sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_i32_2d(struct futhark_context *ctx, struct futhark_i32_2d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_i32_2d(struct futhark_context *ctx,
                          struct futhark_i32_2d *arr, int32_t *data)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_host_runs,
                                      &ctx->copy_dev_to_host_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyDtoH(data + 0, arr->mem.mem + 0,
                                  (size_t) (arr->shape[0] * arr->shape[1]) *
                                  sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return 0;
}
CUdeviceptr futhark_values_raw_i32_2d(struct futhark_context *ctx,
                                      struct futhark_i32_2d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_i32_2d(struct futhark_context *ctx,
                                    struct futhark_i32_2d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_f32_1d {
    struct memblock_device mem;
    int64_t shape[1];
} ;
struct futhark_f32_1d *futhark_new_f32_1d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0)
{
    struct futhark_f32_1d *bad = NULL;
    struct futhark_f32_1d *arr =
                          (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(float),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_host_to_dev_runs,
                                      &ctx->copy_host_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyHtoD(arr->mem.mem + 0, data + 0, (size_t) dim0 *
                                  sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_f32_1d *futhark_new_raw_f32_1d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0)
{
    struct futhark_f32_1d *bad = NULL;
    struct futhark_f32_1d *arr =
                          (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(float),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(arr->mem.mem + 0, data + offset, (size_t) dim0 *
                              sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f32_1d(struct futhark_context *ctx, struct futhark_f32_1d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f32_1d(struct futhark_context *ctx,
                          struct futhark_f32_1d *arr, float *data)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_host_runs,
                                      &ctx->copy_dev_to_host_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyDtoH(data + 0, arr->mem.mem + 0,
                                  (size_t) arr->shape[0] * sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return 0;
}
CUdeviceptr futhark_values_raw_f32_1d(struct futhark_context *ctx,
                                      struct futhark_f32_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f32_1d(struct futhark_context *ctx,
                                    struct futhark_f32_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_i32_1d {
    struct memblock_device mem;
    int64_t shape[1];
} ;
struct futhark_i32_1d *futhark_new_i32_1d(struct futhark_context *ctx, const
                                          int32_t *data, int64_t dim0)
{
    struct futhark_i32_1d *bad = NULL;
    struct futhark_i32_1d *arr =
                          (struct futhark_i32_1d *) malloc(sizeof(struct futhark_i32_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(int32_t),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_host_to_dev_runs,
                                      &ctx->copy_host_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyHtoD(arr->mem.mem + 0, data + 0, (size_t) dim0 *
                                  sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_i32_1d *futhark_new_raw_i32_1d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0)
{
    struct futhark_i32_1d *bad = NULL;
    struct futhark_i32_1d *arr =
                          (struct futhark_i32_1d *) malloc(sizeof(struct futhark_i32_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) dim0 * sizeof(int32_t),
                              "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(arr->mem.mem + 0, data + offset, (size_t) dim0 *
                              sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_i32_1d(struct futhark_context *ctx, struct futhark_i32_1d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_i32_1d(struct futhark_context *ctx,
                          struct futhark_i32_1d *arr, int32_t *data)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_host_runs,
                                      &ctx->copy_dev_to_host_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyDtoH(data + 0, arr->mem.mem + 0,
                                  (size_t) arr->shape[0] * sizeof(int32_t)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return 0;
}
CUdeviceptr futhark_values_raw_i32_1d(struct futhark_context *ctx,
                                      struct futhark_i32_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_i32_1d(struct futhark_context *ctx,
                                    struct futhark_i32_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_f32_2d {
    struct memblock_device mem;
    int64_t shape[2];
} ;
struct futhark_f32_2d *futhark_new_f32_2d(struct futhark_context *ctx, const
                                          float *data, int64_t dim0,
                                          int64_t dim1)
{
    struct futhark_f32_2d *bad = NULL;
    struct futhark_f32_2d *arr =
                          (struct futhark_f32_2d *) malloc(sizeof(struct futhark_f32_2d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) (dim0 * dim1) *
                              sizeof(float), "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_host_to_dev_runs,
                                      &ctx->copy_host_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyHtoD(arr->mem.mem + 0, data + 0, (size_t) (dim0 *
                                                                        dim1) *
                                  sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
struct futhark_f32_2d *futhark_new_raw_f32_2d(struct futhark_context *ctx, const
                                              CUdeviceptr data, int offset,
                                              int64_t dim0, int64_t dim1)
{
    struct futhark_f32_2d *bad = NULL;
    struct futhark_f32_2d *arr =
                          (struct futhark_f32_2d *) malloc(sizeof(struct futhark_f32_2d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, (size_t) (dim0 * dim1) *
                              sizeof(float), "arr->mem"))
        return NULL;
    arr->shape[0] = dim0;
    arr->shape[1] = dim1;
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_dev_runs,
                                      &ctx->copy_dev_to_dev_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpy(arr->mem.mem + 0, data + offset, (size_t) (dim0 *
                                                                         dim1) *
                              sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f32_2d(struct futhark_context *ctx, struct futhark_f32_2d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f32_2d(struct futhark_context *ctx,
                          struct futhark_f32_2d *arr, float *data)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    {
        cudaEvent_t *pevents = NULL;
        
        if (ctx->profiling && !ctx->profiling_paused) {
            pevents = cuda_get_events(&ctx->cuda, &ctx->copy_dev_to_host_runs,
                                      &ctx->copy_dev_to_host_total_runtime);
            CUDA_SUCCEED(cudaEventRecord(pevents[0], 0));
        }
        CUDA_SUCCEED(cuMemcpyDtoH(data + 0, arr->mem.mem + 0,
                                  (size_t) (arr->shape[0] * arr->shape[1]) *
                                  sizeof(float)));
        if (pevents != NULL)
            CUDA_SUCCEED(cudaEventRecord(pevents[1], 0));
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return 0;
}
CUdeviceptr futhark_values_raw_f32_2d(struct futhark_context *ctx,
                                      struct futhark_f32_2d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f32_2d(struct futhark_context *ctx,
                                    struct futhark_f32_2d *arr)
{
    (void) ctx;
    return arr->shape;
}
int futhark_entry_buildKDtree(struct futhark_context *ctx, int32_t *out0,
                              int32_t *out1, int32_t *out2,
                              struct futhark_f32_2d **out3,
                              struct futhark_i32_1d **out4,
                              struct futhark_i32_1d **out5,
                              struct futhark_i32_1d **out6,
                              struct futhark_f32_1d **out7,
                              struct futhark_i32_1d **out8, const int32_t in0,
                              const struct futhark_f32_2d *in1)
{
    struct memblock_device input_mem_39418;
    
    input_mem_39418.references = NULL;
    
    int32_t m_32135;
    int32_t d_32136;
    int32_t defppl_32137;
    int32_t scalar_out_40295;
    int32_t scalar_out_40296;
    int32_t scalar_out_40297;
    struct memblock_device out_mem_40298;
    
    out_mem_40298.references = NULL;
    
    int32_t out_arrsizze_40299;
    int32_t out_arrsizze_40300;
    struct memblock_device out_mem_40301;
    
    out_mem_40301.references = NULL;
    
    int32_t out_arrsizze_40302;
    struct memblock_device out_mem_40303;
    
    out_mem_40303.references = NULL;
    
    int32_t out_arrsizze_40304;
    struct memblock_device out_mem_40305;
    
    out_mem_40305.references = NULL;
    
    int32_t out_arrsizze_40306;
    struct memblock_device out_mem_40307;
    
    out_mem_40307.references = NULL;
    
    int32_t out_arrsizze_40308;
    struct memblock_device out_mem_40309;
    
    out_mem_40309.references = NULL;
    
    int32_t out_arrsizze_40310;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    defppl_32137 = in0;
    input_mem_39418 = in1->mem;
    m_32135 = in1->shape[0];
    d_32136 = in1->shape[1];
    
    int ret = futrts_buildKDtree(ctx, &scalar_out_40295, &scalar_out_40296,
                                 &scalar_out_40297, &out_mem_40298,
                                 &out_arrsizze_40299, &out_arrsizze_40300,
                                 &out_mem_40301, &out_arrsizze_40302,
                                 &out_mem_40303, &out_arrsizze_40304,
                                 &out_mem_40305, &out_arrsizze_40306,
                                 &out_mem_40307, &out_arrsizze_40308,
                                 &out_mem_40309, &out_arrsizze_40310,
                                 input_mem_39418, m_32135, d_32136,
                                 defppl_32137);
    
    if (ret == 0) {
        *out0 = scalar_out_40295;
        *out1 = scalar_out_40296;
        *out2 = scalar_out_40297;
        assert((*out3 =
                (struct futhark_f32_2d *) malloc(sizeof(struct futhark_f32_2d))) !=
            NULL);
        (*out3)->mem = out_mem_40298;
        (*out3)->shape[0] = out_arrsizze_40299;
        (*out3)->shape[1] = out_arrsizze_40300;
        assert((*out4 =
                (struct futhark_i32_1d *) malloc(sizeof(struct futhark_i32_1d))) !=
            NULL);
        (*out4)->mem = out_mem_40301;
        (*out4)->shape[0] = out_arrsizze_40302;
        assert((*out5 =
                (struct futhark_i32_1d *) malloc(sizeof(struct futhark_i32_1d))) !=
            NULL);
        (*out5)->mem = out_mem_40303;
        (*out5)->shape[0] = out_arrsizze_40304;
        assert((*out6 =
                (struct futhark_i32_1d *) malloc(sizeof(struct futhark_i32_1d))) !=
            NULL);
        (*out6)->mem = out_mem_40305;
        (*out6)->shape[0] = out_arrsizze_40306;
        assert((*out7 =
                (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d))) !=
            NULL);
        (*out7)->mem = out_mem_40307;
        (*out7)->shape[0] = out_arrsizze_40308;
        assert((*out8 =
                (struct futhark_i32_1d *) malloc(sizeof(struct futhark_i32_1d))) !=
            NULL);
        (*out8)->mem = out_mem_40309;
        (*out8)->shape[0] = out_arrsizze_40310;
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_exactKnnFixK(struct futhark_context *ctx,
                               struct futhark_i32_2d **out0,
                               struct futhark_f32_2d **out1, int32_t *out2,
                               const struct futhark_f32_2d *in0, const
                               struct futhark_i32_1d *in1, const
                               struct futhark_f32_1d *in2, const
                               struct futhark_i32_1d *in3, const int32_t in4,
                               const struct futhark_f32_2d *in5, const
                               struct futhark_i32_1d *in6, const
                               struct futhark_i32_2d *in7, const
                               struct futhark_f32_2d *in8)
{
    struct memblock_device ref_pts_mem_39418;
    
    ref_pts_mem_39418.references = NULL;
    
    struct memblock_device median_dims_mem_39419;
    
    median_dims_mem_39419.references = NULL;
    
    struct memblock_device median_vals_mem_39420;
    
    median_vals_mem_39420.references = NULL;
    
    struct memblock_device prev_eqdims_mem_39421;
    
    prev_eqdims_mem_39421.references = NULL;
    
    struct memblock_device queries_mem_39422;
    
    queries_mem_39422.references = NULL;
    
    struct memblock_device nat_leaves_mem_39423;
    
    nat_leaves_mem_39423.references = NULL;
    
    struct memblock_device knn_is_mem_39424;
    
    knn_is_mem_39424.references = NULL;
    
    struct memblock_device knn_vs_mem_39425;
    
    knn_vs_mem_39425.references = NULL;
    
    int32_t m_31021;
    int32_t d_31022;
    int32_t q_31023;
    int32_t q_31024;
    int32_t q_31025;
    int32_t n_31026;
    int32_t d_31027;
    int32_t n_31028;
    int32_t n_31029;
    int32_t kk_31030;
    int32_t n_31031;
    int32_t kk_31032;
    int32_t s_31037;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    int32_t out_arrsizze_40297;
    struct memblock_device out_mem_40298;
    
    out_mem_40298.references = NULL;
    
    int32_t out_arrsizze_40299;
    int32_t out_arrsizze_40300;
    int32_t scalar_out_40301;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    ref_pts_mem_39418 = in0->mem;
    m_31021 = in0->shape[0];
    d_31022 = in0->shape[1];
    median_dims_mem_39419 = in1->mem;
    q_31023 = in1->shape[0];
    median_vals_mem_39420 = in2->mem;
    q_31024 = in2->shape[0];
    prev_eqdims_mem_39421 = in3->mem;
    q_31025 = in3->shape[0];
    s_31037 = in4;
    queries_mem_39422 = in5->mem;
    n_31026 = in5->shape[0];
    d_31027 = in5->shape[1];
    nat_leaves_mem_39423 = in6->mem;
    n_31028 = in6->shape[0];
    knn_is_mem_39424 = in7->mem;
    n_31029 = in7->shape[0];
    kk_31030 = in7->shape[1];
    knn_vs_mem_39425 = in8->mem;
    n_31031 = in8->shape[0];
    kk_31032 = in8->shape[1];
    
    int ret = futrts_exactKnnFixK(ctx, &out_mem_40295, &out_arrsizze_40296,
                                  &out_arrsizze_40297, &out_mem_40298,
                                  &out_arrsizze_40299, &out_arrsizze_40300,
                                  &scalar_out_40301, ref_pts_mem_39418,
                                  median_dims_mem_39419, median_vals_mem_39420,
                                  prev_eqdims_mem_39421, queries_mem_39422,
                                  nat_leaves_mem_39423, knn_is_mem_39424,
                                  knn_vs_mem_39425, m_31021, d_31022, q_31023,
                                  q_31024, q_31025, n_31026, d_31027, n_31028,
                                  n_31029, kk_31030, n_31031, kk_31032,
                                  s_31037);
    
    if (ret == 0) {
        assert((*out0 =
                (struct futhark_i32_2d *) malloc(sizeof(struct futhark_i32_2d))) !=
            NULL);
        (*out0)->mem = out_mem_40295;
        (*out0)->shape[0] = out_arrsizze_40296;
        (*out0)->shape[1] = out_arrsizze_40297;
        assert((*out1 =
                (struct futhark_f32_2d *) malloc(sizeof(struct futhark_f32_2d))) !=
            NULL);
        (*out1)->mem = out_mem_40298;
        (*out1)->shape[0] = out_arrsizze_40299;
        (*out1)->shape[1] = out_arrsizze_40300;
        *out2 = scalar_out_40301;
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_findNaturalLeavesFixK(struct futhark_context *ctx,
                                        struct futhark_i32_2d **out0,
                                        struct futhark_f32_2d **out1,
                                        struct futhark_i32_1d **out2, const
                                        struct futhark_f32_2d *in0, const
                                        struct futhark_i32_1d *in1, const
                                        struct futhark_f32_1d *in2, const
                                        struct futhark_f32_2d *in3)
{
    struct memblock_device ref_pts_mem_39418;
    
    ref_pts_mem_39418.references = NULL;
    
    struct memblock_device median_dims_mem_39419;
    
    median_dims_mem_39419.references = NULL;
    
    struct memblock_device median_vals_mem_39420;
    
    median_vals_mem_39420.references = NULL;
    
    struct memblock_device queries_mem_39421;
    
    queries_mem_39421.references = NULL;
    
    int32_t m_31862;
    int32_t d_31863;
    int32_t q_31864;
    int32_t q_31865;
    int32_t n_31866;
    int32_t d_31867;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    int32_t out_arrsizze_40297;
    struct memblock_device out_mem_40298;
    
    out_mem_40298.references = NULL;
    
    int32_t out_arrsizze_40299;
    int32_t out_arrsizze_40300;
    struct memblock_device out_mem_40301;
    
    out_mem_40301.references = NULL;
    
    int32_t out_arrsizze_40302;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    ref_pts_mem_39418 = in0->mem;
    m_31862 = in0->shape[0];
    d_31863 = in0->shape[1];
    median_dims_mem_39419 = in1->mem;
    q_31864 = in1->shape[0];
    median_vals_mem_39420 = in2->mem;
    q_31865 = in2->shape[0];
    queries_mem_39421 = in3->mem;
    n_31866 = in3->shape[0];
    d_31867 = in3->shape[1];
    
    int ret = futrts_findNaturalLeavesFixK(ctx, &out_mem_40295,
                                           &out_arrsizze_40296,
                                           &out_arrsizze_40297, &out_mem_40298,
                                           &out_arrsizze_40299,
                                           &out_arrsizze_40300, &out_mem_40301,
                                           &out_arrsizze_40302,
                                           ref_pts_mem_39418,
                                           median_dims_mem_39419,
                                           median_vals_mem_39420,
                                           queries_mem_39421, m_31862, d_31863,
                                           q_31864, q_31865, n_31866, d_31867);
    
    if (ret == 0) {
        assert((*out0 =
                (struct futhark_i32_2d *) malloc(sizeof(struct futhark_i32_2d))) !=
            NULL);
        (*out0)->mem = out_mem_40295;
        (*out0)->shape[0] = out_arrsizze_40296;
        (*out0)->shape[1] = out_arrsizze_40297;
        assert((*out1 =
                (struct futhark_f32_2d *) malloc(sizeof(struct futhark_f32_2d))) !=
            NULL);
        (*out1)->mem = out_mem_40298;
        (*out1)->shape[0] = out_arrsizze_40299;
        (*out1)->shape[1] = out_arrsizze_40300;
        assert((*out2 =
                (struct futhark_i32_1d *) malloc(sizeof(struct futhark_i32_1d))) !=
            NULL);
        (*out2)->mem = out_mem_40301;
        (*out2)->shape[0] = out_arrsizze_40302;
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_mkImgPatches(struct futhark_context *ctx,
                               struct futhark_u8_2d **out0, const int32_t in0,
                               const struct futhark_i32_3d *in1)
{
    struct memblock_device img_mem_39418;
    
    img_mem_39418.references = NULL;
    
    int32_t h_32683;
    int32_t w_32684;
    int32_t c_32685;
    int32_t p_32686;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    int32_t out_arrsizze_40297;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    p_32686 = in0;
    img_mem_39418 = in1->mem;
    h_32683 = in1->shape[0];
    w_32684 = in1->shape[1];
    c_32685 = in1->shape[2];
    
    int ret = futrts_mkImgPatches(ctx, &out_mem_40295, &out_arrsizze_40296,
                                  &out_arrsizze_40297, img_mem_39418, h_32683,
                                  w_32684, c_32685, p_32686);
    
    if (ret == 0) {
        assert((*out0 =
                (struct futhark_u8_2d *) malloc(sizeof(struct futhark_u8_2d))) !=
            NULL);
        (*out0)->mem = out_mem_40295;
        (*out0)->shape[0] = out_arrsizze_40296;
        (*out0)->shape[1] = out_arrsizze_40297;
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_propagateFixK(struct futhark_context *ctx,
                                struct futhark_i32_2d **out0,
                                struct futhark_f32_2d **out1, const int32_t in0,
                                const int32_t in1, const
                                struct futhark_f32_2d *in2, const
                                struct futhark_i32_1d *in3, const
                                struct futhark_i32_1d *in4, const
                                struct futhark_f32_2d *in5, const
                                struct futhark_i32_1d *in6, const
                                struct futhark_i32_2d *in7, const
                                struct futhark_f32_2d *in8)
{
    struct memblock_device ref_pts_mem_39418;
    
    ref_pts_mem_39418.references = NULL;
    
    struct memblock_device indir_mem_39419;
    
    indir_mem_39419.references = NULL;
    
    struct memblock_device orig2leaf_mem_39420;
    
    orig2leaf_mem_39420.references = NULL;
    
    struct memblock_device queries0_mem_39421;
    
    queries0_mem_39421.references = NULL;
    
    struct memblock_device nat_leaves0_mem_39422;
    
    nat_leaves0_mem_39422.references = NULL;
    
    struct memblock_device knn_inds_mem_39423;
    
    knn_inds_mem_39423.references = NULL;
    
    struct memblock_device knn_dsts_mem_39424;
    
    knn_dsts_mem_39424.references = NULL;
    
    int32_t m_31574;
    int32_t d_31575;
    int32_t m_31576;
    int32_t m_31577;
    int32_t n_31578;
    int32_t d_31579;
    int32_t n_31580;
    int32_t n_31581;
    int32_t kk_31582;
    int32_t n_31583;
    int32_t kk_31584;
    int32_t h_31585;
    int32_t nr_31586;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    int32_t out_arrsizze_40297;
    struct memblock_device out_mem_40298;
    
    out_mem_40298.references = NULL;
    
    int32_t out_arrsizze_40299;
    int32_t out_arrsizze_40300;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    h_31585 = in0;
    nr_31586 = in1;
    ref_pts_mem_39418 = in2->mem;
    m_31574 = in2->shape[0];
    d_31575 = in2->shape[1];
    indir_mem_39419 = in3->mem;
    m_31576 = in3->shape[0];
    orig2leaf_mem_39420 = in4->mem;
    m_31577 = in4->shape[0];
    queries0_mem_39421 = in5->mem;
    n_31578 = in5->shape[0];
    d_31579 = in5->shape[1];
    nat_leaves0_mem_39422 = in6->mem;
    n_31580 = in6->shape[0];
    knn_inds_mem_39423 = in7->mem;
    n_31581 = in7->shape[0];
    kk_31582 = in7->shape[1];
    knn_dsts_mem_39424 = in8->mem;
    n_31583 = in8->shape[0];
    kk_31584 = in8->shape[1];
    
    int ret = futrts_propagateFixK(ctx, &out_mem_40295, &out_arrsizze_40296,
                                   &out_arrsizze_40297, &out_mem_40298,
                                   &out_arrsizze_40299, &out_arrsizze_40300,
                                   ref_pts_mem_39418, indir_mem_39419,
                                   orig2leaf_mem_39420, queries0_mem_39421,
                                   nat_leaves0_mem_39422, knn_inds_mem_39423,
                                   knn_dsts_mem_39424, m_31574, d_31575,
                                   m_31576, m_31577, n_31578, d_31579, n_31580,
                                   n_31581, kk_31582, n_31583, kk_31584,
                                   h_31585, nr_31586);
    
    if (ret == 0) {
        assert((*out0 =
                (struct futhark_i32_2d *) malloc(sizeof(struct futhark_i32_2d))) !=
            NULL);
        (*out0)->mem = out_mem_40295;
        (*out0)->shape[0] = out_arrsizze_40296;
        (*out0)->shape[1] = out_arrsizze_40297;
        assert((*out1 =
                (struct futhark_f32_2d *) malloc(sizeof(struct futhark_f32_2d))) !=
            NULL);
        (*out1)->mem = out_mem_40298;
        (*out1)->shape[0] = out_arrsizze_40299;
        (*out1)->shape[1] = out_arrsizze_40300;
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_reducePatchDim(struct futhark_context *ctx,
                                 struct futhark_f32_2d **out0, const
                                 struct futhark_u8_2d *in0, const
                                 struct futhark_f32_2d *in1, const
                                 struct futhark_f32_1d *in2)
{
    struct memblock_device img_mem_39418;
    
    img_mem_39418.references = NULL;
    
    struct memblock_device comps_mem_39419;
    
    comps_mem_39419.references = NULL;
    
    struct memblock_device means_mem_39420;
    
    means_mem_39420.references = NULL;
    
    int32_t n_30993;
    int32_t d_30994;
    int32_t d_red_30995;
    int32_t d_30996;
    int32_t d_30997;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    int32_t out_arrsizze_40297;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    img_mem_39418 = in0->mem;
    n_30993 = in0->shape[0];
    d_30994 = in0->shape[1];
    comps_mem_39419 = in1->mem;
    d_red_30995 = in1->shape[0];
    d_30996 = in1->shape[1];
    means_mem_39420 = in2->mem;
    d_30997 = in2->shape[0];
    
    int ret = futrts_reducePatchDim(ctx, &out_mem_40295, &out_arrsizze_40296,
                                    &out_arrsizze_40297, img_mem_39418,
                                    comps_mem_39419, means_mem_39420, n_30993,
                                    d_30994, d_red_30995, d_30996, d_30997);
    
    if (ret == 0) {
        assert((*out0 =
                (struct futhark_f32_2d *) malloc(sizeof(struct futhark_f32_2d))) !=
            NULL);
        (*out0)->mem = out_mem_40295;
        (*out0)->shape[0] = out_arrsizze_40296;
        (*out0)->shape[1] = out_arrsizze_40297;
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_selectBestNN(struct futhark_context *ctx,
                               struct futhark_i32_1d **out0,
                               struct futhark_f32_1d **out1, float *out2, const
                               int32_t in0, const struct futhark_i32_2d *in1,
                               const struct futhark_i32_3d *in2, const
                               struct futhark_i32_3d *in3)
{
    struct memblock_device knn_inds_mem_39418;
    
    knn_inds_mem_39418.references = NULL;
    
    struct memblock_device imgA_mem_39419;
    
    imgA_mem_39419.references = NULL;
    
    struct memblock_device imgB_mem_39420;
    
    imgB_mem_39420.references = NULL;
    
    int32_t n_30870;
    int32_t kk_30871;
    int32_t h1_30872;
    int32_t w1_30873;
    int32_t c_30874;
    int32_t h2_30875;
    int32_t w2_30876;
    int32_t c_30877;
    int32_t p_30878;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    struct memblock_device out_mem_40297;
    
    out_mem_40297.references = NULL;
    
    int32_t out_arrsizze_40298;
    float scalar_out_40299;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    p_30878 = in0;
    knn_inds_mem_39418 = in1->mem;
    n_30870 = in1->shape[0];
    kk_30871 = in1->shape[1];
    imgA_mem_39419 = in2->mem;
    h1_30872 = in2->shape[0];
    w1_30873 = in2->shape[1];
    c_30874 = in2->shape[2];
    imgB_mem_39420 = in3->mem;
    h2_30875 = in3->shape[0];
    w2_30876 = in3->shape[1];
    c_30877 = in3->shape[2];
    
    int ret = futrts_selectBestNN(ctx, &out_mem_40295, &out_arrsizze_40296,
                                  &out_mem_40297, &out_arrsizze_40298,
                                  &scalar_out_40299, knn_inds_mem_39418,
                                  imgA_mem_39419, imgB_mem_39420, n_30870,
                                  kk_30871, h1_30872, w1_30873, c_30874,
                                  h2_30875, w2_30876, c_30877, p_30878);
    
    if (ret == 0) {
        assert((*out0 =
                (struct futhark_i32_1d *) malloc(sizeof(struct futhark_i32_1d))) !=
            NULL);
        (*out0)->mem = out_mem_40295;
        (*out0)->shape[0] = out_arrsizze_40296;
        assert((*out1 =
                (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d))) !=
            NULL);
        (*out1)->mem = out_mem_40297;
        (*out1)->shape[0] = out_arrsizze_40298;
        *out2 = scalar_out_40299;
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_selectBestNN_BAD(struct futhark_context *ctx,
                                   struct futhark_i32_1d **out0,
                                   struct futhark_f32_1d **out1, const
                                   int32_t in0, const
                                   struct futhark_i32_2d *in1, const
                                   struct futhark_f32_3d *in2, const
                                   struct futhark_f32_3d *in3)
{
    struct memblock_device knn_inds_mem_39418;
    
    knn_inds_mem_39418.references = NULL;
    
    struct memblock_device imgA_mem_39419;
    
    imgA_mem_39419.references = NULL;
    
    struct memblock_device imgB_mem_39420;
    
    imgB_mem_39420.references = NULL;
    
    int32_t n_30845;
    int32_t kk_30846;
    int32_t h1_30847;
    int32_t w1_30848;
    int32_t c_30849;
    int32_t h2_30850;
    int32_t w2_30851;
    int32_t c_30852;
    int32_t p_30853;
    struct memblock_device out_mem_40295;
    
    out_mem_40295.references = NULL;
    
    int32_t out_arrsizze_40296;
    struct memblock_device out_mem_40297;
    
    out_mem_40297.references = NULL;
    
    int32_t out_arrsizze_40298;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED(cuCtxPushCurrent(ctx->cuda.cu_ctx));
    p_30853 = in0;
    knn_inds_mem_39418 = in1->mem;
    n_30845 = in1->shape[0];
    kk_30846 = in1->shape[1];
    imgA_mem_39419 = in2->mem;
    h1_30847 = in2->shape[0];
    w1_30848 = in2->shape[1];
    c_30849 = in2->shape[2];
    imgB_mem_39420 = in3->mem;
    h2_30850 = in3->shape[0];
    w2_30851 = in3->shape[1];
    c_30852 = in3->shape[2];
    
    int ret = futrts_selectBestNN_BAD(ctx, &out_mem_40295, &out_arrsizze_40296,
                                      &out_mem_40297, &out_arrsizze_40298,
                                      knn_inds_mem_39418, imgA_mem_39419,
                                      imgB_mem_39420, n_30845, kk_30846,
                                      h1_30847, w1_30848, c_30849, h2_30850,
                                      w2_30851, c_30852, p_30853);
    
    if (ret == 0) {
        assert((*out0 =
                (struct futhark_i32_1d *) malloc(sizeof(struct futhark_i32_1d))) !=
            NULL);
        (*out0)->mem = out_mem_40295;
        (*out0)->shape[0] = out_arrsizze_40296;
        assert((*out1 =
                (struct futhark_f32_1d *) malloc(sizeof(struct futhark_f32_1d))) !=
            NULL);
        (*out1)->mem = out_mem_40297;
        (*out1)->shape[0] = out_arrsizze_40298;
    }
    CUDA_SUCCEED(cuCtxPopCurrent(&ctx->cuda.cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
